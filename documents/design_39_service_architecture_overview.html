<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/39_service_architecture_overview | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_39_service_architecture_overview.html">design/39_service_architecture_overview</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="service-architecture-overview" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Service Architecture Overview<a href="#service-architecture-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This document explains the service layer architecture in backtest-kit, which sits between the Public API and Client classes. The service layer implements a matrix-based organization pattern where services are categorized by both functional role (Connection, Schema, Validation, Global, Logic, Markdown, Template, Command) and component type (Strategy, Exchange, Frame, Risk, Sizing, Walker, Optimizer, Partial). This page covers the service matrix structure and dependency injection system. For implementation details of specific service categories, see pages 7.2-7.7.</p>
<a id="service-layer-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Layer Pattern<a href="#service-layer-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The service layer implements a dependency injection architecture using Symbol-based tokens from <code>di-scoped</code> package. All services are singleton instances registered in <a href="">src/lib/core/provide.ts:52-131</a> using the <code>provide()</code> function and injected in <a href="">src/lib/index.ts:57-210</a> using the <code>inject&lt;T&gt;()</code> function. The DI container is initialized via <code>init()</code> call at <a href="">src/lib/index.ts:226</a>.</p>
<p>The service layer isolates business logic (Client classes) from framework concerns (validation, context propagation, persistence, reporting). Client classes (<code>ClientStrategy</code>, <code>ClientExchange</code>, <code>ClientFrame</code>, <code>ClientRisk</code>, <code>ClientSizing</code>, <code>ClientOptimizer</code>) have no DI dependencies and receive all parameters explicitly through constructor injection, while services handle cross-cutting concerns through the DI container.</p>
<a id="service-category-matrix" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Category Matrix<a href="#service-category-matrix" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework organizes services into 11 functional categories, with most categories having component-specific implementations following a matrix pattern:</p>
<p><strong>Service Categories by Function:</strong></p>
<p><img src="../media/39_Service_Architecture_Overview_0.svg" alt="Mermaid Diagram"></p>
<a id="service-organization-in-code" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Organization in Code<a href="#service-organization-in-code" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Services are organized into 11 groups in the codebase, with each group containing related service instances:</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Service Count</th>
<th>Symbol Names (types.ts)</th>
<th>File Location</th>
</tr>
</thead>
<tbody>
<tr>
<td>Base Services</td>
<td>1</td>
<td><code>loggerService</code></td>
<td><a href="">src/lib/services/base/</a></td>
</tr>
<tr>
<td>Context Services</td>
<td>2</td>
<td><code>executionContextService</code>, <code>methodContextService</code></td>
<td><a href="">src/lib/services/context/</a></td>
</tr>
<tr>
<td>Connection Services</td>
<td>7</td>
<td><code>exchangeConnectionService</code>, <code>strategyConnectionService</code>, <code>frameConnectionService</code>, <code>sizingConnectionService</code>, <code>riskConnectionService</code>, <code>optimizerConnectionService</code>, <code>partialConnectionService</code></td>
<td><a href="">src/lib/services/connection/</a></td>
</tr>
<tr>
<td>Schema Services</td>
<td>7</td>
<td><code>exchangeSchemaService</code>, <code>strategySchemaService</code>, <code>frameSchemaService</code>, <code>walkerSchemaService</code>, <code>sizingSchemaService</code>, <code>riskSchemaService</code>, <code>optimizerSchemaService</code></td>
<td><a href="">src/lib/services/schema/</a></td>
</tr>
<tr>
<td>Global Services</td>
<td>7</td>
<td><code>exchangeGlobalService</code>, <code>strategyGlobalService</code>, <code>frameGlobalService</code>, <code>sizingGlobalService</code>, <code>riskGlobalService</code>, <code>optimizerGlobalService</code>, <code>partialGlobalService</code></td>
<td><a href="">src/lib/services/global/</a></td>
</tr>
<tr>
<td>Command Services</td>
<td>3</td>
<td><code>liveCommandService</code>, <code>backtestCommandService</code>, <code>walkerCommandService</code></td>
<td><a href="">src/lib/services/command/</a></td>
</tr>
<tr>
<td>Logic Private Services</td>
<td>3</td>
<td><code>backtestLogicPrivateService</code>, <code>liveLogicPrivateService</code>, <code>walkerLogicPrivateService</code></td>
<td><a href="">src/lib/services/logic/private/</a></td>
</tr>
<tr>
<td>Logic Public Services</td>
<td>3</td>
<td><code>backtestLogicPublicService</code>, <code>liveLogicPublicService</code>, <code>walkerLogicPublicService</code></td>
<td><a href="">src/lib/services/logic/public/</a></td>
</tr>
<tr>
<td>Markdown Services</td>
<td>7</td>
<td><code>backtestMarkdownService</code>, <code>liveMarkdownService</code>, <code>scheduleMarkdownService</code>, <code>performanceMarkdownService</code>, <code>walkerMarkdownService</code>, <code>heatMarkdownService</code>, <code>partialMarkdownService</code></td>
<td><a href="">src/lib/services/markdown/</a></td>
</tr>
<tr>
<td>Validation Services</td>
<td>7</td>
<td><code>exchangeValidationService</code>, <code>strategyValidationService</code>, <code>frameValidationService</code>, <code>walkerValidationService</code>, <code>sizingValidationService</code>, <code>riskValidationService</code>, <code>optimizerValidationService</code></td>
<td><a href="">src/lib/services/validation/</a></td>
</tr>
<tr>
<td>Template Services</td>
<td>1</td>
<td><code>optimizerTemplateService</code></td>
<td><a href="">src/lib/services/template/</a></td>
</tr>
</tbody>
</table>
<p><strong>Total Service Count:</strong> 48 services</p>
<p>The dependency injection container is initialized through three core files:</p>
<ol>
<li><strong><a href="">src/lib/core/types.ts:1-97</a></strong>: Defines Symbol-based tokens for all 48 services organized into category groups at lines 1-3 (base), 5-8 (context), 10-18 (connection), 20-28 (schema), 30-38 (global), 40-44 (command), 46-50 (logicPrivate), 52-56 (logicPublic), 58-66 (markdown), 68-76 (validation), 78-80 (template)</li>
<li><strong><a href="">src/lib/core/provide.ts:52-131</a></strong>: Binds service implementations to tokens using <code>provide()</code> function with factory callbacks</li>
<li><strong><a href="">src/lib/index.ts:57-224</a></strong>: Injects services using <code>inject&lt;T&gt;()</code> and aggregates them into the unified <code>backtest</code> export object at lines 212-224</li>
</ol>
<a id="dependency-injection-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Dependency Injection System<a href="#dependency-injection-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Services use Symbol-based dependency injection for type-safe resolution. Each service type has a unique Symbol identifier defined in <a href="">src/lib/core/types.ts</a>, which is used as a token key for the DI container.</p>
<p><strong>DI Container Initialization Flow:</strong></p>
<p><img src="../media/39_Service_Architecture_Overview_1.svg" alt="Mermaid Diagram"></p>
<p>The DI container resolves the dependency graph at initialization time via <code>init()</code> called in <a href="">src/lib/index.ts:226</a>. Services receive dependencies through constructor injection, with the <code>di-scoped</code> package handling singleton lifecycle and lazy initialization.</p>
<a id="service-category-responsibilities" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Category Responsibilities<a href="#service-category-responsibilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each service category has a specific role in the framework's execution flow:</p>
<a id="base-services-1-service" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Base Services (1 service)<a href="#base-services-1-service" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>LoggerService</code> provides logging infrastructure with <code>info()</code>, <code>warn()</code>, and <code>error()</code> methods. All services inject <code>LoggerService</code> via DI and use method name constants for log identification.</p>
<p><strong>File Location:</strong> <a href="">src/lib/services/base/LoggerService.ts</a></p>
<a id="context-services-2-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Services (2 services)<a href="#context-services-2-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>ExecutionContextService</code> and <code>MethodContextService</code> provide scoped context propagation using the <code>di-scoped</code> package. <code>ExecutionContextService</code> stores execution-level context (<code>symbol</code>, <code>when</code>, <code>backtest</code> flag), while <code>MethodContextService</code> stores method-level context (<code>strategyName</code>, <code>exchangeName</code>, <code>frameName</code>, <code>riskName</code>, <code>sizingName</code>, <code>optimizerName</code>).</p>
<p><strong>File Location:</strong> <a href="">src/lib/services/context/</a></p>
<a id="schema-services-7-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schema Services (7 services)<a href="#schema-services-7-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Store component configurations using the <code>ToolRegistry</code> pattern from <code>functools-kit</code>. Schema services provide a typed registry for strategies, exchanges, frames, walkers, sizing, risk profiles, and optimizers. They expose <code>register()</code>, <code>get()</code>, and <code>override()</code> methods for component management.</p>
<p><strong>Implementations:</strong> <code>StrategySchemaService</code>, <code>ExchangeSchemaService</code>, <code>FrameSchemaService</code>, <code>WalkerSchemaService</code>, <code>SizingSchemaService</code>, <code>RiskSchemaService</code>, <code>OptimizerSchemaService</code></p>
<p><strong>File Location:</strong> <a href="">src/lib/services/schema/</a></p>
<a id="validation-services-7-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Services (7 services)<a href="#validation-services-7-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Perform runtime existence checks and cross-component validation. Validation services verify that referenced components exist before execution begins and use memoization to cache validation results. They expose validation methods named after the <code>add*</code> pattern (e.g., <code>addStrategy()</code>, <code>addExchange()</code>).</p>
<p><strong>Implementations:</strong> <code>StrategyValidationService</code>, <code>ExchangeValidationService</code>, <code>FrameValidationService</code>, <code>WalkerValidationService</code>, <code>SizingValidationService</code>, <code>RiskValidationService</code>, <code>OptimizerValidationService</code></p>
<p><strong>File Location:</strong> <a href="">src/lib/services/validation/</a></p>
<a id="connection-services-7-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Connection Services (7 services)<a href="#connection-services-7-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Create and memoize Client class instances. Connection services act as factories for <code>ClientStrategy</code>, <code>ClientExchange</code>, <code>ClientFrame</code>, <code>ClientRisk</code>, <code>ClientSizing</code>, <code>ClientOptimizer</code>, and <code>ClientPartial</code>. They use <code>functools-kit</code>'s <code>memoize()</code> to ensure one instance per component name, with memoization keys based on component identifier (e.g., <code>strategyName</code>, <code>exchangeName</code>).</p>
<p><strong>Implementations:</strong> <code>StrategyConnectionService</code>, <code>ExchangeConnectionService</code>, <code>FrameConnectionService</code>, <code>SizingConnectionService</code>, <code>RiskConnectionService</code>, <code>OptimizerConnectionService</code>, <code>PartialConnectionService</code></p>
<p><strong>File Location:</strong> <a href="">src/lib/services/connection/</a></p>
<a id="global-services-7-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Global Services (7 services)<a href="#global-services-7-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Provide public API entry points with validation and context setup. Global services wrap lower-level Connection services and ensure all prerequisites are met before component instantiation. They orchestrate validation, context injection, and delegation to Connection services for Client class instantiation.</p>
<p><strong>Implementations:</strong> <code>StrategyGlobalService</code>, <code>ExchangeGlobalService</code>, <code>FrameGlobalService</code>, <code>SizingGlobalService</code>, <code>RiskGlobalService</code>, <code>OptimizerGlobalService</code>, <code>PartialGlobalService</code></p>
<p><strong>File Location:</strong> <a href="">src/lib/services/global/</a></p>
<a id="command-services-3-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Command Services (3 services)<a href="#command-services-3-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Provide execution mode entry points with validation orchestration. Command services validate all required components exist (strategy, exchange, frame) before delegating to Logic Public services. They expose <code>run()</code> methods that return async generators.</p>
<p><strong>Implementations:</strong> <code>BacktestCommandService</code>, <code>LiveCommandService</code>, <code>WalkerCommandService</code></p>
<p><strong>File Location:</strong> <a href="">src/lib/services/command/</a></p>
<a id="logic-public-services-3-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Logic Public Services (3 services)<a href="#logic-public-services-3-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Wrap execution logic with method context propagation. Logic Public services use <code>MethodContextService.runAsyncIterator()</code> to inject method-level context before delegating to Logic Private services. They expose <code>run()</code> methods that return async generators.</p>
<p><strong>Implementations:</strong> <code>BacktestLogicPublicService</code>, <code>LiveLogicPublicService</code>, <code>WalkerLogicPublicService</code></p>
<p><strong>File Location:</strong> <a href="">src/lib/services/logic/public/</a></p>
<a id="logic-private-services-3-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Logic Private Services (3 services)<a href="#logic-private-services-3-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Implement core execution loops and async generator flows. Logic Private services contain the actual backtest/live/walker execution logic, including timeframe iteration, signal detection, and result streaming. They expose <code>run()</code> methods that return async generators.</p>
<p><strong>Implementations:</strong> <code>BacktestLogicPrivateService</code>, <code>LiveLogicPrivateService</code>, <code>WalkerLogicPrivateService</code></p>
<p><strong>File Location:</strong> <a href="">src/lib/services/logic/private/</a></p>
<a id="markdown-services-7-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Markdown Services (7 services)<a href="#markdown-services-7-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Subscribe to event emitters and generate performance reports. Markdown services accumulate signal events, calculate statistics (Sharpe Ratio, Win Rate, etc.), and format results as markdown tables. They use memoization per strategy/exchange/frame to maintain separate report storage. They expose <code>getData()</code>, <code>getReport()</code>, and <code>dump()</code> methods.</p>
<p><strong>Implementations:</strong> <code>BacktestMarkdownService</code>, <code>LiveMarkdownService</code>, <code>ScheduleMarkdownService</code>, <code>PerformanceMarkdownService</code>, <code>WalkerMarkdownService</code>, <code>HeatMarkdownService</code>, <code>PartialMarkdownService</code></p>
<p><strong>File Location:</strong> <a href="">src/lib/services/markdown/</a></p>
<a id="template-services-1-service" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Template Services (1 service)<a href="#template-services-1-service" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>OptimizerTemplateService</code> provides code generation templates for AI-powered strategy optimization. It exposes 11 template methods (<code>getTopBanner()</code>, <code>getJsonDumpTemplate()</code>, <code>getTextTemplate()</code>, <code>getJsonTemplate()</code>, <code>getExchangeTemplate()</code>, <code>getFrameTemplate()</code>, <code>getStrategyTemplate()</code>, <code>getWalkerTemplate()</code>, <code>getLauncherTemplate()</code>, etc.) that generate standalone Node.js code.</p>
<p><strong>File Location:</strong> <a href="">src/lib/services/template/OptimizerTemplateService.ts</a></p>
<a id="service-dependency-chain" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Dependency Chain<a href="#service-dependency-chain" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Services form a dependency chain from user-facing API functions to Client classes. The chain follows a consistent pattern: API → Command → Logic Public → Logic Private → Global → Connection → Schema → Client.</p>
<p><strong>Backtest Execution Flow:</strong></p>
<p><img src="../media/39_Service_Architecture_Overview_2.svg" alt="Mermaid Diagram"></p>
<p>The pattern is identical for Live and Walker modes, with <code>LiveCommandService</code>/<code>WalkerCommandService</code>, <code>LiveLogicPublicService</code>/<code>WalkerLogicPublicService</code>, and <code>LiveLogicPrivateService</code>/<code>WalkerLogicPrivateService</code> replacing the Backtest equivalents.</p>
<a id="component-service-matrix" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Component Service Matrix<a href="#component-service-matrix" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Services are organized around eight component types (Strategy, Exchange, Frame, Walker, Sizing, Risk, Optimizer, Partial), with most components having a complete service stack following the Global → Connection → Schema → Validation pattern:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Global Service</th>
<th>Connection Service</th>
<th>Schema Service</th>
<th>Validation Service</th>
<th>Client Class</th>
</tr>
</thead>
<tbody>
<tr>
<td>Strategy</td>
<td><code>StrategyGlobalService</code></td>
<td><code>StrategyConnectionService</code></td>
<td><code>StrategySchemaService</code></td>
<td><code>StrategyValidationService</code></td>
<td><code>ClientStrategy</code></td>
</tr>
<tr>
<td>Exchange</td>
<td><code>ExchangeGlobalService</code></td>
<td><code>ExchangeConnectionService</code></td>
<td><code>ExchangeSchemaService</code></td>
<td><code>ExchangeValidationService</code></td>
<td><code>ClientExchange</code></td>
</tr>
<tr>
<td>Frame</td>
<td><code>FrameGlobalService</code></td>
<td><code>FrameConnectionService</code></td>
<td><code>FrameSchemaService</code></td>
<td><code>FrameValidationService</code></td>
<td><code>ClientFrame</code></td>
</tr>
<tr>
<td>Risk</td>
<td><code>RiskGlobalService</code></td>
<td><code>RiskConnectionService</code></td>
<td><code>RiskSchemaService</code></td>
<td><code>RiskValidationService</code></td>
<td><code>ClientRisk</code></td>
</tr>
<tr>
<td>Sizing</td>
<td><code>SizingGlobalService</code></td>
<td><code>SizingConnectionService</code></td>
<td><code>SizingSchemaService</code></td>
<td><code>SizingValidationService</code></td>
<td><code>ClientSizing</code></td>
</tr>
<tr>
<td>Optimizer</td>
<td><code>OptimizerGlobalService</code></td>
<td><code>OptimizerConnectionService</code></td>
<td><code>OptimizerSchemaService</code></td>
<td><code>OptimizerValidationService</code></td>
<td><code>ClientOptimizer</code></td>
</tr>
<tr>
<td>Partial</td>
<td><code>PartialGlobalService</code></td>
<td><code>PartialConnectionService</code></td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Walker</td>
<td>-</td>
<td>-</td>
<td><code>WalkerSchemaService</code></td>
<td><code>WalkerValidationService</code></td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Component Service Dependencies:</strong></p>
<p><img src="../media/39_Service_Architecture_Overview_3.svg" alt="Mermaid Diagram"></p>
<p>Walker is a special case that uses Logic services instead of Global/Connection services, as it orchestrates multiple backtest runs rather than managing a single Client instance.</p>
<a id="context-propagation-through-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Propagation Through Services<a href="#context-propagation-through-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Services use <code>MethodContextService</code> and <code>ExecutionContextService</code> from <code>di-scoped</code> to propagate context without explicit parameters. The context flows through the service stack:</p>
<p><img src="../media/39_Service_Architecture_Overview_4.svg" alt="Mermaid Diagram"></p>
<p>Services at any depth can resolve <code>MethodContextService</code> or <code>ExecutionContextService</code> via DI to access context without it being passed as parameters. This enables clean APIs where strategy authors call <code>getCandles(symbol, interval, limit)</code> instead of <code>getCandles(symbol, interval, limit, context)</code>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#service-architecture-overview"><span>Service <wbr/>Architecture <wbr/>Overview</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#service-layer-pattern"><span>Service <wbr/>Layer <wbr/>Pattern</span></a></li><li><a href="#service-category-matrix"><span>Service <wbr/>Category <wbr/>Matrix</span></a></li><li><a href="#service-organization-in-code"><span>Service <wbr/>Organization in <wbr/>Code</span></a></li><li><a href="#dependency-injection-system"><span>Dependency <wbr/>Injection <wbr/>System</span></a></li><li><a href="#service-category-responsibilities"><span>Service <wbr/>Category <wbr/>Responsibilities</span></a></li><li><ul><li><a href="#base-services-1-service"><span>Base <wbr/>Services (1 service)</span></a></li><li><a href="#context-services-2-services"><span>Context <wbr/>Services (2 services)</span></a></li><li><a href="#schema-services-7-services"><span>Schema <wbr/>Services (7 services)</span></a></li><li><a href="#validation-services-7-services"><span>Validation <wbr/>Services (7 services)</span></a></li><li><a href="#connection-services-7-services"><span>Connection <wbr/>Services (7 services)</span></a></li><li><a href="#global-services-7-services"><span>Global <wbr/>Services (7 services)</span></a></li><li><a href="#command-services-3-services"><span>Command <wbr/>Services (3 services)</span></a></li><li><a href="#logic-public-services-3-services"><span>Logic <wbr/>Public <wbr/>Services (3 services)</span></a></li><li><a href="#logic-private-services-3-services"><span>Logic <wbr/>Private <wbr/>Services (3 services)</span></a></li><li><a href="#markdown-services-7-services"><span>Markdown <wbr/>Services (7 services)</span></a></li><li><a href="#template-services-1-service"><span>Template <wbr/>Services (1 service)</span></a></li></ul></li><li><a href="#service-dependency-chain"><span>Service <wbr/>Dependency <wbr/>Chain</span></a></li><li><a href="#component-service-matrix"><span>Component <wbr/>Service <wbr/>Matrix</span></a></li><li><a href="#context-propagation-through-services"><span>Context <wbr/>Propagation <wbr/>Through <wbr/>Services</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
