<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/24_timeframes-and-frames | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_24_timeframes-and-frames.html">design/24_timeframes-and-frames</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="timeframes-and-frames" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Timeframes and Frames<a href="#timeframes-and-frames" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This page documents the frame system, which defines backtest periods and generates timeframe arrays for historical simulation. Frames specify date ranges and intervals for backtest execution, producing sequential timestamps that drive strategy tick evaluation.</p>
<p>For exchange data fetching and candle retrieval, see <a href="design_22_exchange-configuration.html">Exchange Configuration</a>. For candle data structures and VWAP calculation, see <a href="design_23_candle-data-and-vwap.html">Candle Data and VWAP</a>. For overall backtest execution flow, see <a href="design_17_backtest-mode.html">Backtest Mode</a>.</p>
<hr>
<a id="frame-configuration-schema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Frame Configuration Schema<a href="#frame-configuration-schema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frames are registered via <code>addFrame()</code> using the <code>IFrameSchema</code> interface, which defines the backtest period and timestamp generation parameters.</p>
<a id="iframeschema-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IFrameSchema Structure<a href="#iframeschema-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>frameName</code></td>
<td><code>FrameName</code> (string)</td>
<td>Unique identifier for the frame</td>
</tr>
<tr>
<td><code>note</code></td>
<td><code>string</code> (optional)</td>
<td>Developer note for documentation</td>
</tr>
<tr>
<td><code>interval</code></td>
<td><code>FrameInterval</code></td>
<td>Timestamp spacing interval (e.g., &quot;1m&quot;, &quot;1h&quot;, &quot;1d&quot;)</td>
</tr>
<tr>
<td><code>startDate</code></td>
<td><code>Date</code></td>
<td>Start of backtest period (inclusive)</td>
</tr>
<tr>
<td><code>endDate</code></td>
<td><code>Date</code></td>
<td>End of backtest period (inclusive)</td>
</tr>
<tr>
<td><code>callbacks</code></td>
<td><code>Partial&lt;IFrameCallbacks&gt;</code> (optional)</td>
<td>Lifecycle event handlers</td>
</tr>
</tbody>
</table>
<a id="frame-intervals" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Frame Intervals<a href="#frame-intervals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>FrameInterval</code> type defines the granularity of timestamps in the generated timeframe array. Each timestamp represents a tick moment when <code>ClientStrategy.tick()</code> is called during backtest execution.</p>
<table>
<thead>
<tr>
<th>Interval</th>
<th>Description</th>
<th>Typical Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&quot;1m&quot;</code></td>
<td>1 minute</td>
<td>High-frequency strategies, precise entry timing</td>
</tr>
<tr>
<td><code>&quot;3m&quot;</code></td>
<td>3 minutes</td>
<td>Reduced tick count while maintaining granularity</td>
</tr>
<tr>
<td><code>&quot;5m&quot;</code></td>
<td>5 minutes</td>
<td>Intraday strategies with moderate frequency</td>
</tr>
<tr>
<td><code>&quot;15m&quot;</code></td>
<td>15 minutes</td>
<td>Standard intraday timeframe</td>
</tr>
<tr>
<td><code>&quot;30m&quot;</code></td>
<td>30 minutes</td>
<td>Swing trading, reduced computational overhead</td>
</tr>
<tr>
<td><code>&quot;1h&quot;</code></td>
<td>1 hour</td>
<td>Hourly strategy evaluation</td>
</tr>
<tr>
<td><code>&quot;2h&quot;</code></td>
<td>2 hours</td>
<td>Multi-hour analysis</td>
</tr>
<tr>
<td><code>&quot;4h&quot;</code></td>
<td>4 hours</td>
<td>Standard 4-hour trading timeframe</td>
</tr>
<tr>
<td><code>&quot;6h&quot;</code></td>
<td>6 hours</td>
<td>Quarter-day analysis</td>
</tr>
<tr>
<td><code>&quot;8h&quot;</code></td>
<td>8 hours</td>
<td>Third-day analysis</td>
</tr>
<tr>
<td><code>&quot;12h&quot;</code></td>
<td>12 hours</td>
<td>Half-day analysis</td>
</tr>
<tr>
<td><code>&quot;1d&quot;</code></td>
<td>1 day</td>
<td>Daily strategy evaluation</td>
</tr>
<tr>
<td><code>&quot;3d&quot;</code></td>
<td>3 days</td>
<td>Multi-day swing trading</td>
</tr>
</tbody>
</table>
<hr>
<a id="frame-callbacks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Frame Callbacks<a href="#frame-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>IFrameCallbacks</code> interface provides lifecycle hooks for frame events.</p>
<a id="ontimeframe-callback" class="tsd-anchor"></a><h3 class="tsd-anchor-link">onTimeframe Callback<a href="#ontimeframe-callback" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Called after timeframe array generation, providing access to the generated timestamps and configuration parameters.</p>
<p><strong>Signature:</strong></p>
<pre><code class="typescript"><span class="hl-10">onTimeframe</span><span class="hl-1">: (</span><br/><span class="hl-1">  </span><span class="hl-4">timeframe</span><span class="hl-1">: </span><span class="hl-4">Date</span><span class="hl-1">[],</span><br/><span class="hl-1">  </span><span class="hl-4">startDate</span><span class="hl-1">: </span><span class="hl-4">Date</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">endDate</span><span class="hl-1">: </span><span class="hl-4">Date</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval</span><span class="hl-1">: </span><span class="hl-4">FrameInterval</span><br/><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span>
</code><button type="button">Copy</button></pre>

<p><strong>Parameters:</strong></p>
<ul>
<li><code>timeframe</code>: Array of Date objects representing tick timestamps</li>
<li><code>startDate</code>: Start of the backtest period</li>
<li><code>endDate</code>: End of the backtest period</li>
<li><code>interval</code>: Interval used for generation</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Logging timeframe size for debugging</li>
<li>Validating generated timestamps</li>
<li>Performance monitoring</li>
<li>Custom reporting</li>
</ul>
<hr>
<a id="frame-registration-and-discovery" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Frame Registration and Discovery<a href="#frame-registration-and-discovery" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="registration-via-addframe" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration via addFrame<a href="#registration-via-addframe" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Frames are registered using the <code>addFrame()</code> function, which validates and stores the frame schema in <code>FrameSchemaService</code>.</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;One day test period&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-02T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onTimeframe</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">timeframe</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-7">${</span><span class="hl-4">timeframe</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> timestamps from </span><span class="hl-7">${</span><span class="hl-4">startDate</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2"> to </span><span class="hl-7">${</span><span class="hl-4">endDate</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2"> at </span><span class="hl-7">${</span><span class="hl-4">interval</span><span class="hl-7">}</span><span class="hl-2"> intervals`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="registration-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Flow<a href="#registration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/24-timeframes-and-frames_0.svg" alt="Mermaid Diagram"></p>
<a id="discovery-via-listframes" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Discovery via listFrames<a href="#discovery-via-listframes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All registered frames can be retrieved using <code>listFrames()</code>, which returns an array of <code>IFrameSchema</code> objects.</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">frames</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">listFrames</span><span class="hl-1">();</span><br/><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">frame</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">frames</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Frame: </span><span class="hl-7">${</span><span class="hl-4">frame</span><span class="hl-9">.</span><span class="hl-4">frameName</span><span class="hl-7">}</span><span class="hl-2">, Interval: </span><span class="hl-7">${</span><span class="hl-4">frame</span><span class="hl-9">.</span><span class="hl-4">interval</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Period: </span><span class="hl-7">${</span><span class="hl-4">frame</span><span class="hl-9">.</span><span class="hl-4">startDate</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2"> to </span><span class="hl-7">${</span><span class="hl-4">frame</span><span class="hl-9">.</span><span class="hl-4">endDate</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="timeframe-generation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Timeframe Generation<a href="#timeframe-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="gettimeframe-method" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getTimeframe Method<a href="#gettimeframe-method" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>IFrame.getTimeframe()</code> method generates an array of Date objects spaced according to the configured interval. This array drives backtest execution by defining every moment when <code>ClientStrategy.tick()</code> is called.</p>
<p><strong>Signature:</strong></p>
<pre><code class="typescript"><span class="hl-10">getTimeframe</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-13">FrameName</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">&lt;</span><span class="hl-4">Date</span><span class="hl-1">[]&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol</code>: Trading pair symbol (unused in implementation, present for API consistency)</li>
<li><code>frameName</code>: Frame identifier to retrieve from registry</li>
</ul>
<p><strong>Returns:</strong> Promise resolving to array of Date objects representing tick timestamps</p>
<a id="timeframe-generation-architecture" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Timeframe Generation Architecture<a href="#timeframe-generation-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/24-timeframes-and-frames_1.svg" alt="Mermaid Diagram"></p>
<a id="generation-algorithm" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Generation Algorithm<a href="#generation-algorithm" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The timeframe generation follows this logic:</p>
<ol>
<li>Retrieve <code>IFrameSchema</code> from <code>FrameSchemaService</code> by <code>frameName</code></li>
<li>Initialize array with <code>startDate</code></li>
<li>Increment timestamp by interval duration</li>
<li>Append to array while timestamp &lt;= <code>endDate</code></li>
<li>Invoke <code>onTimeframe</code> callback if configured</li>
<li>Return Date array</li>
</ol>
<p><strong>Example Output:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Frame: interval=&quot;1m&quot;, startDate=2024-01-01T00:00:00Z, endDate=2024-01-01T00:05:00Z</span><br/><span class="hl-5">// Generated timeframe:</span><br/><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">), </span><span class="hl-5">// timestamp 0</span><br/><span class="hl-1">  </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:01:00Z&quot;</span><span class="hl-1">), </span><span class="hl-5">// timestamp 1</span><br/><span class="hl-1">  </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:02:00Z&quot;</span><span class="hl-1">), </span><span class="hl-5">// timestamp 2</span><br/><span class="hl-1">  </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:03:00Z&quot;</span><span class="hl-1">), </span><span class="hl-5">// timestamp 3</span><br/><span class="hl-1">  </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:04:00Z&quot;</span><span class="hl-1">), </span><span class="hl-5">// timestamp 4</span><br/><span class="hl-1">  </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:05:00Z&quot;</span><span class="hl-1">), </span><span class="hl-5">// timestamp 5</span><br/><span class="hl-1">]</span><br/><span class="hl-5">// Total: 6 timestamps (5 minutes + 1 for inclusive endDate)</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="frame-service-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Frame Service Architecture<a href="#frame-service-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The frame system uses a layered service architecture with dependency injection for loose coupling and memoization for performance optimization.</p>
<a id="service-layer-diagram" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Layer Diagram<a href="#service-layer-diagram" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/24-timeframes-and-frames_2.svg" alt="Mermaid Diagram"></p>
<a id="service-responsibilities" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Responsibilities<a href="#service-responsibilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Service</th>
<th>File Reference</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FrameValidationService</code></td>
<td><a href="">src/lib/index.ts:44</a></td>
<td>Validates frame schema structure on registration, provides list() method</td>
</tr>
<tr>
<td><code>FrameSchemaService</code></td>
<td><a href="">src/lib/index.ts:24</a></td>
<td>Stores frame schemas in registry, provides get(frameName) retrieval</td>
</tr>
<tr>
<td><code>FrameConnectionService</code></td>
<td><a href="">src/lib/index.ts:81</a></td>
<td>Creates and memoizes ClientFrame instances, key: frameName</td>
</tr>
<tr>
<td><code>FrameCoreService</code></td>
<td><a href="">src/lib/index.ts:116</a></td>
<td>Provides getTimeframe() method, delegates to connection service</td>
</tr>
<tr>
<td><code>ClientFrame</code></td>
<td><a href="">types.d.ts:432-435</a></td>
<td>Implements IFrame interface, generates timeframe arrays</td>
</tr>
</tbody>
</table>
<hr>
<a id="frame-usage-in-backtest-execution" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Frame Usage in Backtest Execution<a href="#frame-usage-in-backtest-execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frames drive the backtest execution loop by providing an ordered sequence of timestamps for strategy evaluation.</p>
<a id="backtest-iteration-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Iteration Flow<a href="#backtest-iteration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/24-timeframes-and-frames_3.svg" alt="Mermaid Diagram"></p>
<a id="key-implementation-details" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Key Implementation Details<a href="#key-implementation-details" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li>
<p><strong>Frame Retrieval</strong> (<a href="">src/lib/services/logic/private/BacktestLogicPrivateService.ts:69-73</a>):</p>
<ul>
<li><code>BacktestLogicPrivateService</code> calls <code>frameCoreService.getTimeframe(symbol, frameName)</code></li>
<li>Returns <code>Date[]</code> array of timestamps</li>
<li>Stored in <code>timeframes</code> variable for iteration</li>
</ul>
</li>
<li>
<p><strong>Sequential Iteration</strong> (<a href="">src/lib/services/logic/private/BacktestLogicPrivateService.ts:78-449</a>):</p>
<ul>
<li>Loop: <code>while (i &lt; timeframes.length)</code></li>
<li>Each iteration: <code>when = timeframes[i]</code></li>
<li><code>when</code> passed to <code>strategyCoreService.tick(symbol, when, true)</code></li>
</ul>
</li>
<li>
<p><strong>Progress Tracking</strong> (<a href="">src/lib/services/logic/private/BacktestLogicPrivateService.ts:84-92</a>):</p>
<ul>
<li>Emits <code>progressBacktestEmitter</code> with processed/total frame counts</li>
<li>Progress calculation: <code>i / totalFrames</code></li>
</ul>
</li>
<li>
<p><strong>Frame Skipping Optimization</strong> (<a href="">src/lib/services/logic/private/BacktestLogicPrivateService.ts:273-279</a>, <a href="">src/lib/services/logic/private/BacktestLogicPrivateService.ts:403-409</a>):</p>
<ul>
<li>When signal opens, <code>backtest()</code> processes all candles until close</li>
<li>After signal closes, skip timeframes until <code>closeTimestamp</code></li>
<li>Optimization: avoids redundant tick calls while position is active</li>
</ul>
</li>
</ol>
<hr>
<a id="frame-context-propagation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Frame Context Propagation<a href="#frame-context-propagation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frames are propagated through the execution context via <code>MethodContextService</code>, which uses dependency injection scoping to provide implicit context without explicit parameter passing.</p>
<a id="context-flow-architecture" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Flow Architecture<a href="#context-flow-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/24-timeframes-and-frames_4.svg" alt="Mermaid Diagram"></p>
<a id="context-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Structure<a href="#context-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>IMethodContext</code> interface provides routing information for service lookups:</p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-13">IMethodContext</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-13">ExchangeName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">StrategyName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-13">FrameName</span><span class="hl-1">;  </span><span class="hl-5">// Used for frame retrieval</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Usage in BacktestLogicPrivateService:</strong></p>
<ul>
<li>Injected: <a href="">src/lib/services/logic/private/BacktestLogicPrivateService.ts:44-46</a></li>
<li>Read: <a href="">src/lib/services/logic/private/BacktestLogicPrivateService.ts:71</a></li>
<li>Passed to: <code>frameCoreService.getTimeframe(symbol, this.methodContextService.context.frameName)</code></li>
</ul>
<hr>
<a id="complete-frame-lifecycle-example" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Complete Frame Lifecycle Example<a href="#complete-frame-lifecycle-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This example demonstrates the complete lifecycle from frame registration to backtest execution.</p>
<pre><code class="typescript"><span class="hl-5">// 1. Register frame</span><br/><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;jan-2024-test&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T12:00:00Z&quot;</span><span class="hl-1">),  </span><span class="hl-5">// 12 hours</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onTimeframe</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">timeframe</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Frame generated: </span><span class="hl-7">${</span><span class="hl-4">timeframe</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> timestamps`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Period: </span><span class="hl-7">${</span><span class="hl-4">startDate</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2"> to </span><span class="hl-7">${</span><span class="hl-4">endDate</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Interval: </span><span class="hl-7">${</span><span class="hl-4">interval</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-5">// Output: Frame generated: 145 timestamps (12 hours * 12 per hour + 1)</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// 2. Register other required components</span><br/><span class="hl-0">addExchange</span><span class="hl-1">({ </span><span class="hl-5">/* exchange config */</span><span class="hl-1"> });</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({ </span><span class="hl-5">/* strategy config */</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// 3. Run backtest</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;jan-2024-test&quot;</span><span class="hl-1">  </span><span class="hl-5">// References registered frame</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal closed at </span><span class="hl-7">${</span><span class="hl-7">new</span><span class="hl-9"> </span><span class="hl-0">Date</span><span class="hl-9">(</span><span class="hl-4">result</span><span class="hl-9">.</span><span class="hl-4">closeTimestamp</span><span class="hl-9">).</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Internal execution flow:</span><br/><span class="hl-5">// 1. BacktestLogicPrivateService.run() called</span><br/><span class="hl-5">// 2. frameCoreService.getTimeframe(&quot;BTCUSDT&quot;, &quot;jan-2024-test&quot;)</span><br/><span class="hl-5">// 3. FrameConnectionService retrieves/creates ClientFrame</span><br/><span class="hl-5">// 4. ClientFrame generates 145 timestamps (5-minute intervals for 12 hours)</span><br/><span class="hl-5">// 5. Loop iterates: i=0 to i=144</span><br/><span class="hl-5">// 6. Each iteration: strategyCoreService.tick() called with timeframes[i]</span><br/><span class="hl-5">// 7. When signal opens: backtest() processes candles, skips to close</span><br/><span class="hl-5">// 8. Process continues until i &gt;= 145</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#timeframes-and-frames"><span>Timeframes and <wbr/>Frames</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#frame-configuration-schema"><span>Frame <wbr/>Configuration <wbr/>Schema</span></a></li><li><ul><li><a href="#iframeschema-structure"><span>IFrame<wbr/>Schema <wbr/>Structure</span></a></li><li><a href="#frame-intervals"><span>Frame <wbr/>Intervals</span></a></li></ul></li><li><a href="#frame-callbacks"><span>Frame <wbr/>Callbacks</span></a></li><li><ul><li><a href="#ontimeframe-callback"><span>on<wbr/>Timeframe <wbr/>Callback</span></a></li></ul></li><li><a href="#frame-registration-and-discovery"><span>Frame <wbr/>Registration and <wbr/>Discovery</span></a></li><li><ul><li><a href="#registration-via-addframe"><span>Registration via add<wbr/>Frame</span></a></li><li><a href="#registration-flow"><span>Registration <wbr/>Flow</span></a></li><li><a href="#discovery-via-listframes"><span>Discovery via list<wbr/>Frames</span></a></li></ul></li><li><a href="#timeframe-generation"><span>Timeframe <wbr/>Generation</span></a></li><li><ul><li><a href="#gettimeframe-method"><span>get<wbr/>Timeframe <wbr/>Method</span></a></li><li><a href="#timeframe-generation-architecture"><span>Timeframe <wbr/>Generation <wbr/>Architecture</span></a></li><li><a href="#generation-algorithm"><span>Generation <wbr/>Algorithm</span></a></li></ul></li><li><a href="#frame-service-architecture"><span>Frame <wbr/>Service <wbr/>Architecture</span></a></li><li><ul><li><a href="#service-layer-diagram"><span>Service <wbr/>Layer <wbr/>Diagram</span></a></li><li><a href="#service-responsibilities"><span>Service <wbr/>Responsibilities</span></a></li></ul></li><li><a href="#frame-usage-in-backtest-execution"><span>Frame <wbr/>Usage in <wbr/>Backtest <wbr/>Execution</span></a></li><li><ul><li><a href="#backtest-iteration-flow"><span>Backtest <wbr/>Iteration <wbr/>Flow</span></a></li><li><a href="#key-implementation-details"><span>Key <wbr/>Implementation <wbr/>Details</span></a></li></ul></li><li><a href="#frame-context-propagation"><span>Frame <wbr/>Context <wbr/>Propagation</span></a></li><li><ul><li><a href="#context-flow-architecture"><span>Context <wbr/>Flow <wbr/>Architecture</span></a></li><li><a href="#context-structure"><span>Context <wbr/>Structure</span></a></li></ul></li><li><a href="#complete-frame-lifecycle-example"><span>Complete <wbr/>Frame <wbr/>Lifecycle <wbr/>Example</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
