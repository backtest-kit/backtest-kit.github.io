<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/05_core_concepts | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_05_core_concepts.html">design/05_core_concepts</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="core-concepts" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Core Concepts<a href="#core-concepts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page introduces the fundamental architectural patterns and execution models of backtest-kit. It covers the three execution modes (Backtest, Live, Walker), the signal lifecycle state machine, and the component-based registration system. For detailed API documentation, see <a href="design_14_public_api_reference.html">Public API Reference</a>. For implementation details of specific components, see <a href="design_23_component_types.html">Component Types</a>.</p>
<a id="execution-modes" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Execution Modes<a href="#execution-modes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>backtest-kit provides three execution modes that share the same strategy and exchange components but operate under different timing and data models:</p>
<a id="mode-comparison" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Mode Comparison<a href="#mode-comparison" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/05_Core_Concepts_0.svg" alt="Mermaid Diagram"></p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Time Progression</th>
<th>Data Source</th>
<th>Use Case</th>
<th>Completion</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Backtest</strong></td>
<td>Historical timestamps from <code>IFrameSchema</code></td>
<td><code>Frame.getTimeframe()</code> array</td>
<td>Strategy validation on past data</td>
<td>Finite (when timeframe exhausted)</td>
</tr>
<tr>
<td><strong>Live</strong></td>
<td>Real-time via <code>Date.now()</code></td>
<td>Live exchange API calls</td>
<td>Production trading</td>
<td>Infinite (until stopped)</td>
</tr>
<tr>
<td><strong>Walker</strong></td>
<td>Orchestrates multiple Backtests</td>
<td>Shared <code>IFrameSchema</code> across strategies</td>
<td>A/B testing and optimization</td>
<td>Finite (after all strategies tested)</td>
</tr>
</tbody>
</table>
<a id="code-entry-points" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Code Entry Points<a href="#code-entry-points" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The execution modes are accessed through singleton utility classes:</p>
<ul>
<li><strong>Backtest</strong>: <code>Backtest.run(symbol, { strategyName, exchangeName, frameName })</code> - <a href="">src/classes/Backtest.ts:38-66</a></li>
<li><strong>Live</strong>: <code>Live.run(symbol, { strategyName, exchangeName })</code> - <a href="">src/classes/Live.ts:55-82</a></li>
<li><strong>Walker</strong>: <code>Walker.run(symbol, { walkerName })</code> - <a href="">src/classes/Walker.ts:39-87</a></li>
</ul>
<p>Each mode implements a similar async generator pattern but with different orchestration logic. Backtest and Live both call <code>strategy.tick()</code> or <code>strategy.backtest()</code>, while Walker iterates through multiple strategies and compares their results by a configurable metric (<code>WalkerMetric</code>).</p>
<a id="signal-lifecycle" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Lifecycle<a href="#signal-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Signals progress through a state machine implemented as a discriminated union of result types. The <code>action</code> field serves as the discriminator for type-safe state handling.</p>
<a id="state-machine-diagram" class="tsd-anchor"></a><h3 class="tsd-anchor-link">State Machine Diagram<a href="#state-machine-diagram" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/05_Core_Concepts_1.svg" alt="Mermaid Diagram"></p>
<a id="signal-state-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signal State Types<a href="#signal-state-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework uses TypeScript discriminated unions for type-safe signal state handling:</p>
<pre><code class="typescript"><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">IStrategyTickResult</span><span class="hl-1"> = </span><br/><span class="hl-1">  | </span><span class="hl-10">IStrategyTickResultIdle</span><span class="hl-1"> </span><br/><span class="hl-1">  | </span><span class="hl-10">IStrategyTickResultScheduled</span><br/><span class="hl-1">  | </span><span class="hl-10">IStrategyTickResultOpened</span><span class="hl-1"> </span><br/><span class="hl-1">  | </span><span class="hl-10">IStrategyTickResultActive</span><span class="hl-1"> </span><br/><span class="hl-1">  | </span><span class="hl-10">IStrategyTickResultClosed</span><br/><span class="hl-1">  | </span><span class="hl-10">IStrategyTickResultCancelled</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>Each state type has a unique <code>action</code> discriminator:</p>
<ul>
<li><strong>idle</strong>: No active signal, strategy waiting for entry conditions - <a href="">src/interfaces/Strategy.interface.ts:162-175</a></li>
<li><strong>scheduled</strong>: Signal created with <code>priceOpen</code>, waiting for price to reach entry point - <a href="">src/interfaces/Strategy.interface.ts:181-194</a></li>
<li><strong>opened</strong>: Position just entered, initial signal creation - <a href="">src/interfaces/Strategy.interface.ts:200-213</a></li>
<li><strong>active</strong>: Position monitoring for TP/SL/time conditions - <a href="">src/interfaces/Strategy.interface.ts:219-232</a></li>
<li><strong>closed</strong>: Position exited with PNL calculation - <a href="">src/interfaces/Strategy.interface.ts:238-257</a></li>
<li><strong>cancelled</strong>: Scheduled signal never activated (timeout or pre-entry SL hit) - <a href="">src/interfaces/Strategy.interface.ts:263-278</a></li>
</ul>
<a id="key-lifecycle-timestamps" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Key Lifecycle Timestamps<a href="#key-lifecycle-timestamps" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Signals track two critical timestamps for accurate duration calculation:</p>
<ul>
<li><strong>scheduledAt</strong>: When signal was first created (either immediate or scheduled) - <a href="">src/interfaces/Strategy.interface.ts:54-54</a></li>
<li><strong>pendingAt</strong>: When position became active at <code>priceOpen</code> (updated on scheduled signal activation) - <a href="">src/interfaces/Strategy.interface.ts:56-56</a></li>
</ul>
<p>The <code>minuteEstimatedTime</code> countdown uses <code>pendingAt</code>, not <code>scheduledAt</code>, ensuring scheduled signals don't count waiting time toward expiration - <a href="">src/client/ClientStrategy.ts:681-683</a>.</p>
<a id="component-based-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Component-Based Architecture<a href="#component-based-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>backtest-kit uses a registration-based architecture where components are defined as schemas and instantiated on-demand via dependency injection.</p>
<a id="component-registration-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Component Registration Flow<a href="#component-registration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/05_Core_Concepts_2.svg" alt="Mermaid Diagram"></p>
<a id="component-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Component Types<a href="#component-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework provides six registrable component types, each with a dedicated schema interface:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Schema Interface</th>
<th>Purpose</th>
<th>Registration Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Strategy</strong></td>
<td><code>IStrategySchema</code></td>
<td>Signal generation logic via <code>getSignal()</code></td>
<td><code>addStrategy()</code></td>
</tr>
<tr>
<td><strong>Exchange</strong></td>
<td><code>IExchangeSchema</code></td>
<td>Market data via <code>getCandles()</code>, price formatting</td>
<td><code>addExchange()</code></td>
</tr>
<tr>
<td><strong>Frame</strong></td>
<td><code>IFrameSchema</code></td>
<td>Backtest timeframe generation via <code>getTimeframe()</code></td>
<td><code>addFrame()</code></td>
</tr>
<tr>
<td><strong>Risk</strong></td>
<td><code>IRiskSchema</code></td>
<td>Portfolio-level position limits and validations</td>
<td><code>addRisk()</code></td>
</tr>
<tr>
<td><strong>Sizing</strong></td>
<td><code>ISizingSchema</code></td>
<td>Position size calculation (fixed, Kelly, ATR)</td>
<td><code>addSizing()</code></td>
</tr>
<tr>
<td><strong>Walker</strong></td>
<td><code>IWalkerSchema</code></td>
<td>Multi-strategy comparison configuration</td>
<td><code>addWalker()</code></td>
</tr>
</tbody>
</table>
<p>Each schema is stored in a corresponding <code>*SchemaService</code> using the ToolRegistry pattern - <a href="">src/lib/services/schema/StrategySchemaService.ts</a>, <a href="">src/lib/services/schema/ExchangeSchemaService.ts</a>, etc.</p>
<a id="schema-to-client-instance-mapping" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schema to Client Instance Mapping<a href="#schema-to-client-instance-mapping" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework uses memoized Connection Services to lazily instantiate Client classes:</p>
<p><img src="../media/05_Core_Concepts_3.svg" alt="Mermaid Diagram"></p>
<p>This two-tier architecture (Schema Services + Connection Services) enables:</p>
<ol>
<li><strong>Validation at registration time</strong>: Schema structure is validated immediately via <code>*ValidationService.validate()</code> - <a href="">src/lib/services/validation/StrategyValidationService.ts</a></li>
<li><strong>Lazy instantiation</strong>: Client instances are only created when first used, reducing memory overhead</li>
<li><strong>Instance reuse</strong>: Memoization ensures one Client per schema name, preventing state duplication</li>
<li><strong>Crash recovery</strong>: Live mode can restore persisted state via <code>waitForInit()</code> before first operation - <a href="">src/client/ClientStrategy.ts:298-330</a></li>
</ol>
<a id="context-propagation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Propagation<a href="#context-propagation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework uses <code>di-scoped</code> to propagate execution context without explicit parameter passing. Two context types flow through the system:</p>
<a id="context-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Types<a href="#context-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>ExecutionContext</strong> (<code>IExecutionContext</code>):</p>
<ul>
<li><code>symbol</code>: Trading pair (e.g., &quot;BTCUSDT&quot;)</li>
<li><code>when</code>: Current timestamp (historical for backtest, <code>Date.now()</code> for live)</li>
<li><code>backtest</code>: Boolean flag indicating execution mode</li>
</ul>
<p><strong>MethodContext</strong> (<code>IMethodContext</code>):</p>
<ul>
<li><code>strategyName</code>: Which strategy schema to use</li>
<li><code>exchangeName</code>: Which exchange schema to use</li>
<li><code>frameName</code>: Which frame schema to use (empty string for live mode)</li>
</ul>
<a id="context-flow-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Flow Example<a href="#context-flow-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/05_Core_Concepts_4.svg" alt="Mermaid Diagram"></p>
<p>This pattern enables clean strategy code without framework boilerplate:</p>
<pre><code class="typescript"><span class="hl-5">// Strategy author writes:</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">candles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Framework automatically injects:</span><br/><span class="hl-5">// - executionContext.when (which timestamp to query)</span><br/><span class="hl-5">// - methodContext.exchangeName (which exchange to use)</span><br/><span class="hl-5">// - executionContext.backtest (historical vs real-time data)</span>
</code><button type="button">Copy</button></pre>

<p>For detailed context propagation mechanics, see <a href="design_12_context_propagation.html">Context Propagation</a>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#core-concepts"><span>Core <wbr/>Concepts</span></a><ul><li><a href="#execution-modes"><span>Execution <wbr/>Modes</span></a></li><li><ul><li><a href="#mode-comparison"><span>Mode <wbr/>Comparison</span></a></li><li><a href="#code-entry-points"><span>Code <wbr/>Entry <wbr/>Points</span></a></li></ul></li><li><a href="#signal-lifecycle"><span>Signal <wbr/>Lifecycle</span></a></li><li><ul><li><a href="#state-machine-diagram"><span>State <wbr/>Machine <wbr/>Diagram</span></a></li><li><a href="#signal-state-types"><span>Signal <wbr/>State <wbr/>Types</span></a></li><li><a href="#key-lifecycle-timestamps"><span>Key <wbr/>Lifecycle <wbr/>Timestamps</span></a></li></ul></li><li><a href="#component-based-architecture"><span>Component-<wbr/>Based <wbr/>Architecture</span></a></li><li><ul><li><a href="#component-registration-flow"><span>Component <wbr/>Registration <wbr/>Flow</span></a></li><li><a href="#component-types"><span>Component <wbr/>Types</span></a></li><li><a href="#schema-to-client-instance-mapping"><span>Schema to <wbr/>Client <wbr/>Instance <wbr/>Mapping</span></a></li></ul></li><li><a href="#context-propagation"><span>Context <wbr/>Propagation</span></a></li><li><ul><li><a href="#context-types"><span>Context <wbr/>Types</span></a></li><li><a href="#context-flow-example"><span>Context <wbr/>Flow <wbr/>Example</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
