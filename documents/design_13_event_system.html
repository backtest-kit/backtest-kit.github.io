<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/13_event_system | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_13_event_system.html">design/13_event_system</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="event-system" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Event System<a href="#event-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Event System provides observability and monitoring capabilities for backtest-kit through a publish-subscribe architecture. It enables external code to react to strategy execution events, errors, and progress updates without coupling to internal execution logic.</p>
<p>This document covers event emitters, listener functions, queued processing, and event flow patterns. For signal lifecycle states, see <a href="design_46_signal_lifecycle.html">Signal Lifecycle</a>. For execution mode details, see <a href="design_06_execution_modes.html">Execution Modes</a>. For callback configuration, see <a href="design_24_strategy_schemas.html">Strategy Schemas</a>.</p>
<hr>
<a id="architecture-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Overview<a href="#architecture-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The event system uses <code>Subject</code> instances from <code>functools-kit</code> as event emitters. All listener functions wrap callbacks with the <code>queued</code> utility to ensure sequential processing even when callbacks are asynchronous.</p>
<p><strong>Core Pattern:</strong></p>
<pre><code><span class="hl-4">Event</span><span class="hl-1"> </span><span class="hl-4">Source</span><span class="hl-1"> → </span><span class="hl-4">Subject</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">() → </span><span class="hl-4">Queued</span><span class="hl-1"> </span><span class="hl-4">Listener</span><span class="hl-1"> → </span><span class="hl-4">User</span><span class="hl-1"> </span><span class="hl-4">Callback</span>
</code><button>Copy</button></pre>

<p><strong>Event Emitter Diagram</strong></p>
<p><img src="../media/13_Event_System_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="event-categories" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Categories<a href="#event-categories" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="signal-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signal Events<a href="#signal-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Signal events represent strategy execution state changes. Three emitters handle different execution contexts:</p>
<table>
<thead>
<tr>
<th>Emitter</th>
<th>Purpose</th>
<th>Event Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>signalEmitter</code></td>
<td>All signal events (live + backtest)</td>
<td><code>IStrategyTickResult</code></td>
</tr>
<tr>
<td><code>signalBacktestEmitter</code></td>
<td>Backtest-only signals</td>
<td><code>IStrategyTickResult</code></td>
</tr>
<tr>
<td><code>signalLiveEmitter</code></td>
<td>Live-only signals</td>
<td><code>IStrategyTickResult</code></td>
</tr>
</tbody>
</table>
<p>The <code>IStrategyTickResult</code> discriminated union includes:</p>
<ul>
<li><code>IStrategyTickResultIdle</code> - No active position</li>
<li><code>IStrategyTickResultScheduled</code> - Delayed entry signal created</li>
<li><code>IStrategyTickResultOpened</code> - New position opened</li>
<li><code>IStrategyTickResultActive</code> - Position being monitored</li>
<li><code>IStrategyTickResultClosed</code> - Position closed with PnL</li>
<li><code>IStrategyTickResultCancelled</code> - Scheduled signal cancelled</li>
</ul>
<a id="completion-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Completion Events<a href="#completion-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Completion events signal when background execution finishes:</p>
<table>
<thead>
<tr>
<th>Emitter</th>
<th>Purpose</th>
<th>Event Type</th>
<th>Trigger</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>doneBacktestSubject</code></td>
<td>Backtest completion</td>
<td><code>DoneContract</code></td>
<td><code>Backtest.background()</code> ends</td>
</tr>
<tr>
<td><code>doneLiveSubject</code></td>
<td>Live trading completion</td>
<td><code>DoneContract</code></td>
<td><code>Live.background()</code> ends</td>
</tr>
<tr>
<td><code>doneWalkerSubject</code></td>
<td>Walker completion</td>
<td><code>DoneContract</code></td>
<td><code>Walker.background()</code> ends</td>
</tr>
</tbody>
</table>
<a id="progress-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Progress Events<a href="#progress-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Progress events track execution advancement:</p>
<table>
<thead>
<tr>
<th>Emitter</th>
<th>Purpose</th>
<th>Event Type</th>
<th>Frequency</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>progressEmitter</code></td>
<td>Backtest progress</td>
<td><code>ProgressContract</code></td>
<td>Per timeframe batch</td>
</tr>
<tr>
<td><code>walkerEmitter</code></td>
<td>Walker strategy progress</td>
<td><code>WalkerContract</code></td>
<td>Per strategy completion</td>
</tr>
<tr>
<td><code>walkerCompleteSubject</code></td>
<td>Walker final results</td>
<td><code>IWalkerResults</code></td>
<td>Once at end</td>
</tr>
</tbody>
</table>
<a id="error-and-validation-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error and Validation Events<a href="#error-and-validation-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Emitter</th>
<th>Purpose</th>
<th>Event Type</th>
<th>Trigger</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>errorEmitter</code></td>
<td>Background execution errors</td>
<td><code>Error</code></td>
<td>Caught exceptions in <code>.background()</code></td>
</tr>
<tr>
<td><code>validationSubject</code></td>
<td>Risk validation failures</td>
<td><code>Error</code></td>
<td>Risk validation function throws</td>
</tr>
</tbody>
</table>
<a id="performance-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Performance Events<a href="#performance-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Emitter</th>
<th>Purpose</th>
<th>Event Type</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>performanceEmitter</code></td>
<td>Timing metrics</td>
<td><code>PerformanceContract</code></td>
<td>Profiling and bottleneck detection</td>
</tr>
</tbody>
</table>
<hr>
<a id="listener-functions" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Listener Functions<a href="#listener-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All listener functions follow a consistent pattern:</p>
<pre><code class="typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">listen</span><span class="hl-6">*</span><span class="hl-1">(</span><span class="hl-0">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-10">EventType</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">): () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span>
</code><button type="button">Copy</button></pre>

<p>Returns an unsubscribe function to stop listening.</p>
<a id="standard-listeners" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Standard Listeners<a href="#standard-listeners" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Function</th>
<th>Emitter</th>
<th>Queued</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>listenSignal()</code></td>
<td><code>signalEmitter</code></td>
<td>Yes</td>
<td>All signal events</td>
</tr>
<tr>
<td><code>listenSignalBacktest()</code></td>
<td><code>signalBacktestEmitter</code></td>
<td>Yes</td>
<td>Backtest signals only</td>
</tr>
<tr>
<td><code>listenSignalLive()</code></td>
<td><code>signalLiveEmitter</code></td>
<td>Yes</td>
<td>Live signals only</td>
</tr>
<tr>
<td><code>listenError()</code></td>
<td><code>errorEmitter</code></td>
<td>Yes</td>
<td>Background errors</td>
</tr>
<tr>
<td><code>listenDoneBacktest()</code></td>
<td><code>doneBacktestSubject</code></td>
<td>Yes</td>
<td>Backtest completion</td>
</tr>
<tr>
<td><code>listenDoneLive()</code></td>
<td><code>doneLiveSubject</code></td>
<td>Yes</td>
<td>Live completion</td>
</tr>
<tr>
<td><code>listenDoneWalker()</code></td>
<td><code>doneWalkerSubject</code></td>
<td>Yes</td>
<td>Walker completion</td>
</tr>
<tr>
<td><code>listenProgress()</code></td>
<td><code>progressEmitter</code></td>
<td>Yes</td>
<td>Backtest progress</td>
</tr>
<tr>
<td><code>listenPerformance()</code></td>
<td><code>performanceEmitter</code></td>
<td>Yes</td>
<td>Performance metrics</td>
</tr>
<tr>
<td><code>listenWalker()</code></td>
<td><code>walkerEmitter</code></td>
<td>Yes</td>
<td>Walker progress</td>
</tr>
<tr>
<td><code>listenWalkerComplete()</code></td>
<td><code>walkerCompleteSubject</code></td>
<td>Yes</td>
<td>Walker final results</td>
</tr>
<tr>
<td><code>listenValidation()</code></td>
<td><code>validationSubject</code></td>
<td>Yes</td>
<td>Risk validation errors</td>
</tr>
</tbody>
</table>
<a id="once-listeners" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Once Listeners<a href="#once-listeners" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Once listeners use <code>.filter().once()</code> pattern for one-time execution:</p>
<pre><code class="typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">listen</span><span class="hl-6">*</span><span class="hl-0">Once</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-0">filterFn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-10">EventType</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">boolean</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-10">EventType</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><br/><span class="hl-1">): () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span>
</code><button type="button">Copy</button></pre>

<table>
<thead>
<tr>
<th>Function</th>
<th>Emitter</th>
<th>Pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>listenSignalOnce()</code></td>
<td><code>signalEmitter</code></td>
<td>Filter + auto-unsubscribe</td>
</tr>
<tr>
<td><code>listenSignalBacktestOnce()</code></td>
<td><code>signalBacktestEmitter</code></td>
<td>Filter + auto-unsubscribe</td>
</tr>
<tr>
<td><code>listenSignalLiveOnce()</code></td>
<td><code>signalLiveEmitter</code></td>
<td>Filter + auto-unsubscribe</td>
</tr>
<tr>
<td><code>listenDoneBacktestOnce()</code></td>
<td><code>doneBacktestSubject</code></td>
<td>Filter + auto-unsubscribe</td>
</tr>
<tr>
<td><code>listenDoneLiveOnce()</code></td>
<td><code>doneLiveSubject</code></td>
<td>Filter + auto-unsubscribe</td>
</tr>
<tr>
<td><code>listenDoneWalkerOnce()</code></td>
<td><code>doneWalkerSubject</code></td>
<td>Filter + auto-unsubscribe</td>
</tr>
<tr>
<td><code>listenWalkerOnce()</code></td>
<td><code>walkerEmitter</code></td>
<td>Filter + auto-unsubscribe</td>
</tr>
</tbody>
</table>
<hr>
<a id="queued-processing-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Queued Processing Pattern<a href="#queued-processing-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All continuous listeners wrap callbacks with <code>queued()</code> from <code>functools-kit</code> to ensure sequential execution:</p>
<pre><code class="typescript"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">listenSignal</span><span class="hl-1">(</span><span class="hl-0">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-10">IStrategyTickResult</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-7">LISTEN_SIGNAL_METHOD_NAME</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">signalEmitter</span><span class="hl-1">.</span><span class="hl-0">subscribe</span><span class="hl-1">(</span><span class="hl-0">queued</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-0">fn</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">)));</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Guarantees:</strong></p>
<ol>
<li>Events processed in order received</li>
<li>Next event waits for previous callback to complete</li>
<li>No concurrent callback execution</li>
<li>Prevents race conditions in async handlers</li>
</ol>
<p><strong>Queued Processing Flow</strong></p>
<p><img src="../media/13_Event_System_1.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="event-flow-through-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Flow Through System<a href="#event-flow-through-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="backtest-event-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Event Flow<a href="#backtest-event-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Backtest Signal Event Flow</strong></p>
<p><img src="../media/13_Event_System_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Emission Points:</strong></p>
<ol>
<li><strong>Signal Events</strong>: Emitted by <code>BacktestLogicPrivateService.run()</code> for each tick result</li>
<li><strong>Progress Events</strong>: Emitted periodically during timeframe iteration</li>
<li><strong>Completion Events</strong>: Emitted when <code>Backtest.background()</code> finishes</li>
</ol>
<a id="live-event-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live Event Flow<a href="#live-event-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Live Signal Event Flow</strong></p>
<p><img src="../media/13_Event_System_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Emission Points:</strong></p>
<ol>
<li><strong>Signal Events</strong>: Emitted by <code>LiveLogicPrivateService.run()</code> for each tick result</li>
<li><strong>Persistence</strong>: State saved before events emitted</li>
<li><strong>Completion Events</strong>: Emitted when <code>Live.background()</code> stops and last position closes</li>
</ol>
<a id="walker-event-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Walker Event Flow<a href="#walker-event-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Walker Progress Event Flow</strong></p>
<p><img src="../media/13_Event_System_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Emission Points:</strong></p>
<ol>
<li><strong>Progress Events</strong>: Emitted after each strategy backtest completes</li>
<li><strong>Completion Events</strong>: Emitted when all strategies tested</li>
<li><strong>Final Results</strong>: Emitted with best strategy selection</li>
</ol>
<hr>
<a id="event-contracts" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Contracts<a href="#event-contracts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Event payloads are defined as TypeScript interfaces:</p>
<a id="donecontract" class="tsd-anchor"></a><h3 class="tsd-anchor-link">DoneContract<a href="#donecontract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">DoneContract</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Emitted by completion subjects (<code>doneBacktestSubject</code>, <code>doneLiveSubject</code>, <code>doneWalkerSubject</code>).</p>
<a id="progresscontract" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ProgressContract<a href="#progresscontract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ProgressContract</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">processedFrames</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalFrames</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">progress</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">; </span><span class="hl-5">// 0-1 float</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Emitted by <code>progressEmitter</code> during backtest execution.</p>
<a id="performancecontract" class="tsd-anchor"></a><h3 class="tsd-anchor-link">PerformanceContract<a href="#performancecontract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">PerformanceContract</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">metricType</span><span class="hl-1">: </span><span class="hl-10">PerformanceMetricType</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">duration</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">; </span><span class="hl-5">// milliseconds</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Emitted by <code>performanceEmitter</code> for profiling.</p>
<a id="walkercontract" class="tsd-anchor"></a><h3 class="tsd-anchor-link">WalkerContract<a href="#walkercontract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">WalkerContract</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategiesTested</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalStrategies</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">metricValue</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">bestStrategy</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">bestMetric</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Emitted by <code>walkerEmitter</code> after each strategy completes.</p>
<hr>
<a id="integration-points" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration Points<a href="#integration-points" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="emitting-events-from-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Emitting Events from Services<a href="#emitting-events-from-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Events are emitted by logic services and client classes:</p>
<p><strong>BacktestLogicPrivateService:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Emit signal events</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">signalEmitter</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">signalBacktestEmitter</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Emit progress</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">progressEmitter</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">({...});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Backtest.background():</strong></p>
<pre><code class="typescript"><span class="hl-5">// Emit completion</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">doneBacktestSubject</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">exchangeName</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">backtest:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="using-listeners-in-application-code" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using Listeners in Application Code<a href="#using-listeners-in-application-code" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Basic Listener:</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenSignalBacktest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">unsubscribe</span><span class="hl-1"> = </span><span class="hl-0">listenSignalBacktest</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`PnL: </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">pnl</span><span class="hl-9">.</span><span class="hl-4">pnlPercentage</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Later: stop listening</span><br/><span class="hl-0">unsubscribe</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p><strong>Once Listener:</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenDoneBacktestOnce</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">listenDoneBacktestOnce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1"> === </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT backtest completed&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Error Handling:</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenError</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">listenError</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Background error:&quot;</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">// Send to monitoring service</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="markdown-service-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Markdown Service Integration<a href="#markdown-service-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Markdown services automatically subscribe to event emitters to accumulate data for report generation:</p>
<p><strong>BacktestMarkdownService:</strong></p>
<ul>
<li>Subscribes to <code>signalBacktestEmitter</code></li>
<li>Accumulates closed signals</li>
<li>Generates statistics and markdown reports</li>
</ul>
<p><strong>LiveMarkdownService:</strong></p>
<ul>
<li>Subscribes to <code>signalLiveEmitter</code></li>
<li>Maintains bounded queue (MAX_EVENTS = 25)</li>
<li>Prevents memory leaks in long-running processes</li>
</ul>
<p><strong>WalkerMarkdownService:</strong></p>
<ul>
<li>Subscribes to <code>walkerEmitter</code> and <code>walkerCompleteSubject</code></li>
<li>Tracks strategy comparison results</li>
</ul>
<hr>
<a id="event-system-summary-table" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event System Summary Table<a href="#event-system-summary-table" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Event Type</th>
<th>Emitter</th>
<th>Listener</th>
<th>Contract</th>
<th>Queued</th>
<th>Once Variant</th>
</tr>
</thead>
<tbody>
<tr>
<td>All signals</td>
<td><code>signalEmitter</code></td>
<td><code>listenSignal()</code></td>
<td><code>IStrategyTickResult</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Backtest signals</td>
<td><code>signalBacktestEmitter</code></td>
<td><code>listenSignalBacktest()</code></td>
<td><code>IStrategyTickResult</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Live signals</td>
<td><code>signalLiveEmitter</code></td>
<td><code>listenSignalLive()</code></td>
<td><code>IStrategyTickResult</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Backtest done</td>
<td><code>doneBacktestSubject</code></td>
<td><code>listenDoneBacktest()</code></td>
<td><code>DoneContract</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Live done</td>
<td><code>doneLiveSubject</code></td>
<td><code>listenDoneLive()</code></td>
<td><code>DoneContract</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Walker done</td>
<td><code>doneWalkerSubject</code></td>
<td><code>listenDoneWalker()</code></td>
<td><code>DoneContract</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Progress</td>
<td><code>progressEmitter</code></td>
<td><code>listenProgress()</code></td>
<td><code>ProgressContract</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Performance</td>
<td><code>performanceEmitter</code></td>
<td><code>listenPerformance()</code></td>
<td><code>PerformanceContract</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Walker progress</td>
<td><code>walkerEmitter</code></td>
<td><code>listenWalker()</code></td>
<td><code>WalkerContract</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Walker complete</td>
<td><code>walkerCompleteSubject</code></td>
<td><code>listenWalkerComplete()</code></td>
<td><code>IWalkerResults</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Errors</td>
<td><code>errorEmitter</code></td>
<td><code>listenError()</code></td>
<td><code>Error</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Validation</td>
<td><code>validationSubject</code></td>
<td><code>listenValidation()</code></td>
<td><code>Error</code></td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody>
</table>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#event-system"><span>Event <wbr/>System</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#architecture-overview"><span>Architecture <wbr/>Overview</span></a></li><li><a href="#event-categories"><span>Event <wbr/>Categories</span></a></li><li><ul><li><a href="#signal-events"><span>Signal <wbr/>Events</span></a></li><li><a href="#completion-events"><span>Completion <wbr/>Events</span></a></li><li><a href="#progress-events"><span>Progress <wbr/>Events</span></a></li><li><a href="#error-and-validation-events"><span>Error and <wbr/>Validation <wbr/>Events</span></a></li><li><a href="#performance-events"><span>Performance <wbr/>Events</span></a></li></ul></li><li><a href="#listener-functions"><span>Listener <wbr/>Functions</span></a></li><li><ul><li><a href="#standard-listeners"><span>Standard <wbr/>Listeners</span></a></li><li><a href="#once-listeners"><span>Once <wbr/>Listeners</span></a></li></ul></li><li><a href="#queued-processing-pattern"><span>Queued <wbr/>Processing <wbr/>Pattern</span></a></li><li><a href="#event-flow-through-system"><span>Event <wbr/>Flow <wbr/>Through <wbr/>System</span></a></li><li><ul><li><a href="#backtest-event-flow"><span>Backtest <wbr/>Event <wbr/>Flow</span></a></li><li><a href="#live-event-flow"><span>Live <wbr/>Event <wbr/>Flow</span></a></li><li><a href="#walker-event-flow"><span>Walker <wbr/>Event <wbr/>Flow</span></a></li></ul></li><li><a href="#event-contracts"><span>Event <wbr/>Contracts</span></a></li><li><ul><li><a href="#donecontract"><span>Done<wbr/>Contract</span></a></li><li><a href="#progresscontract"><span>Progress<wbr/>Contract</span></a></li><li><a href="#performancecontract"><span>Performance<wbr/>Contract</span></a></li><li><a href="#walkercontract"><span>Walker<wbr/>Contract</span></a></li></ul></li><li><a href="#integration-points"><span>Integration <wbr/>Points</span></a></li><li><ul><li><a href="#emitting-events-from-services"><span>Emitting <wbr/>Events from <wbr/>Services</span></a></li><li><a href="#using-listeners-in-application-code"><span>Using <wbr/>Listeners in <wbr/>Application <wbr/>Code</span></a></li></ul></li><li><a href="#markdown-service-integration"><span>Markdown <wbr/>Service <wbr/>Integration</span></a></li><li><a href="#event-system-summary-table"><span>Event <wbr/>System <wbr/>Summary <wbr/>Table</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
