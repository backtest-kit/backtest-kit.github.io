<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/44_performance-tracking | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_44_performance-tracking.html">design/44_performance-tracking</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="performance-tracking" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Performance Tracking<a href="#performance-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Performance tracking provides execution timing metrics for profiling strategy operations and identifying bottlenecks. The framework emits performance events during strategy execution, accumulates them per symbol-strategy pair, and calculates statistical metrics including average duration, percentiles, and wait times between operations.</p>
<p>This page covers performance event emission, event listening, statistics calculation, and report generation. For general event system architecture, see <a href="design_40_reporting-monitoring.html">9.1 Event Listeners</a>. For other monitoring capabilities, see <a href="design_40_reporting-monitoring.html">9.2 Markdown Reports</a> and <a href="design_40_reporting-monitoring.html">9.3 Statistics Models</a>.</p>
<hr>
<a id="performance-event-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Event Flow<a href="#performance-event-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following diagram illustrates how performance events flow from emission through the event system to storage and report generation.</p>
<p><img src="../media/44_performance-tracking_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="performancecontract-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">PerformanceContract Structure<a href="#performancecontract-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Performance events use the <code>PerformanceContract</code> type to capture timing information and context.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>metricType</code></td>
<td><code>PerformanceMetricType</code></td>
<td>Category of operation being measured (e.g., &quot;tick&quot;, &quot;getSignal&quot;, &quot;getCandles&quot;)</td>
</tr>
<tr>
<td><code>duration</code></td>
<td><code>number</code></td>
<td>Execution time in milliseconds</td>
</tr>
<tr>
<td><code>timestamp</code></td>
<td><code>number</code></td>
<td>Unix timestamp when operation completed</td>
</tr>
<tr>
<td><code>previousTimestamp</code></td>
<td><code>number | null</code></td>
<td>Timestamp of previous event of same metricType (for wait time calculation)</td>
</tr>
<tr>
<td><code>symbol</code></td>
<td><code>string | null</code></td>
<td>Trading pair symbol if operation is symbol-specific</td>
</tr>
<tr>
<td><code>strategyName</code></td>
<td><code>string | null</code></td>
<td>Strategy name if operation is strategy-specific</td>
</tr>
</tbody>
</table>
<p><strong>PerformanceMetricType</strong> is a string union representing operation categories:</p>
<ul>
<li>Framework typically uses values like: <code>&quot;tick&quot;</code>, <code>&quot;backtest&quot;</code>, <code>&quot;getSignal&quot;</code>, <code>&quot;getCandles&quot;</code>, <code>&quot;getAveragePrice&quot;</code></li>
<li>Custom strategies can emit custom metric types</li>
</ul>
<hr>
<a id="emitting-performance-events" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Emitting Performance Events<a href="#emitting-performance-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Performance events are emitted by calling <code>emit()</code> on the <code>performanceEmitter</code> Subject. The framework automatically emits events during strategy execution, but custom code can also emit events.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">performanceEmitter</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Emit a performance event</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">startTime</span><span class="hl-1"> = </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">();</span><br/><span class="hl-5">// ... perform operation ...</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">duration</span><span class="hl-1"> = </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() - </span><span class="hl-4">startTime</span><span class="hl-1">;</span><br/><br/><span class="hl-4">performanceEmitter</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">metricType:</span><span class="hl-1"> </span><span class="hl-2">&quot;custom_operation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">duration</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-4">previousTimestamp:</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">, </span><span class="hl-5">// Set if tracking wait times</span><br/><span class="hl-1">  </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The framework automatically emits events for:</p>
<ul>
<li><strong>tick operations</strong>: Each strategy tick execution</li>
<li><strong>backtest operations</strong>: Fast backtest processing</li>
<li><strong>getSignal calls</strong>: Signal generation timing</li>
<li><strong>getCandles calls</strong>: Data fetching timing</li>
<li><strong>getAveragePrice calls</strong>: VWAP calculation timing</li>
</ul>
<hr>
<a id="listening-to-performance-events" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Listening to Performance Events<a href="#listening-to-performance-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>listenPerformance()</code> function subscribes to performance events with queued async processing to ensure sequential execution.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenPerformance</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Subscribe to all performance events</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">unsubscribe</span><span class="hl-1"> = </span><span class="hl-0">listenPerformance</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">metricType</span><span class="hl-7">}</span><span class="hl-2">: </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">duration</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1"> &gt; </span><span class="hl-6">1000</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Slow operation detected: </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">metricType</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Later: stop listening</span><br/><span class="hl-0">unsubscribe</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>The callback receives a <code>PerformanceContract</code> object for each event. Events are processed sequentially even if the callback is async, preventing race conditions.</p>
<hr>
<a id="performancemarkdownservice-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">PerformanceMarkdownService Architecture<a href="#performancemarkdownservice-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following diagram shows the internal structure of <code>PerformanceMarkdownService</code> and how it manages storage.</p>
<p><img src="../media/44_performance-tracking_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Key characteristics:</strong></p>
<ol>
<li><strong>Memoization</strong>: Storage instances are cached per <code>symbol:strategyName</code> key using <code>functools-kit</code> <code>memoize</code></li>
<li><strong>FIFO Queue</strong>: Events are stored in reverse chronological order (newest first) with a 10,000 event limit</li>
<li><strong>Automatic Trimming</strong>: When capacity is exceeded, oldest events are removed</li>
<li><strong>Singleshot Init</strong>: Service initializes once and subscribes to <code>performanceEmitter</code></li>
</ol>
<hr>
<a id="statistics-calculation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Statistics Calculation<a href="#statistics-calculation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>getData()</code> method calculates comprehensive statistics grouped by <code>metricType</code>. The following table describes each metric:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Calculation</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>count</code></td>
<td>Number of events of this type</td>
<td>Volume of operations</td>
</tr>
<tr>
<td><code>totalDuration</code></td>
<td>Sum of all durations</td>
<td>Total time spent</td>
</tr>
<tr>
<td><code>avgDuration</code></td>
<td>Mean of durations</td>
<td>Average operation time</td>
</tr>
<tr>
<td><code>minDuration</code></td>
<td>Minimum duration</td>
<td>Best case performance</td>
</tr>
<tr>
<td><code>maxDuration</code></td>
<td>Maximum duration</td>
<td>Worst case performance</td>
</tr>
<tr>
<td><code>stdDev</code></td>
<td>Standard deviation of durations</td>
<td>Consistency measure</td>
</tr>
<tr>
<td><code>median</code></td>
<td>50th percentile</td>
<td>Typical performance</td>
</tr>
<tr>
<td><code>p95</code></td>
<td>95th percentile</td>
<td>High-load threshold</td>
</tr>
<tr>
<td><code>p99</code></td>
<td>99th percentile</td>
<td>Outlier threshold</td>
</tr>
<tr>
<td><code>avgWaitTime</code></td>
<td>Mean time between consecutive events</td>
<td>Operation frequency</td>
</tr>
<tr>
<td><code>minWaitTime</code></td>
<td>Minimum inter-event time</td>
<td>Peak frequency</td>
</tr>
<tr>
<td><code>maxWaitTime</code></td>
<td>Maximum inter-event time</td>
<td>Idle periods</td>
</tr>
</tbody>
</table>
<p><strong>Percentile Calculation:</strong></p>
<pre><code class="typescript"><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">percentile</span><span class="hl-1">(</span><span class="hl-4">sortedArray</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">[], </span><span class="hl-4">p</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">): </span><span class="hl-11">number</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">sortedArray</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-6">0</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">index</span><span class="hl-1"> = </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">ceil</span><span class="hl-1">((</span><span class="hl-4">sortedArray</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> * </span><span class="hl-4">p</span><span class="hl-1">) / </span><span class="hl-6">100</span><span class="hl-1">) - </span><span class="hl-6">1</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">sortedArray</span><span class="hl-1">[</span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">max</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-4">index</span><span class="hl-1">)];</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Wait Time Calculation:</strong></p>
<p>Wait times are computed using the <code>previousTimestamp</code> field:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">waitTime</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">timestamp</span><span class="hl-1"> - </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">previousTimestamp</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>This measures the interval between consecutive events of the same <code>metricType</code>, helping identify:</p>
<ul>
<li>Operation frequency patterns</li>
<li>Idle periods where no operations occur</li>
<li>Bottlenecks causing delays between operations</li>
</ul>
<hr>
<a id="performancestatisticsmodel-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">PerformanceStatisticsModel Structure<a href="#performancestatisticsmodel-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>getData()</code> method returns a <code>PerformanceStatisticsModel</code> object:</p>
<p><img src="../media/44_performance-tracking_2.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="using-the-performance-class" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Using the Performance Class<a href="#using-the-performance-class" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides a <code>Performance</code> class as the public API for accessing performance data. This class internally uses <code>PerformanceMarkdownService</code>.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Performance</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Get statistics for a symbol-strategy pair</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Performance</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total events: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalEvents</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total time: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalDuration</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Analyze each metric type</span><br/><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> [</span><span class="hl-8">metricType</span><span class="hl-1">, </span><span class="hl-8">metricStats</span><span class="hl-1">] </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-0">entries</span><span class="hl-1">(</span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">metricStats</span><span class="hl-1">)) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-14">\n</span><span class="hl-7">${</span><span class="hl-4">metricType</span><span class="hl-7">}</span><span class="hl-2">:`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Count: </span><span class="hl-7">${</span><span class="hl-4">metricStats</span><span class="hl-9">.</span><span class="hl-4">count</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Avg: </span><span class="hl-7">${</span><span class="hl-4">metricStats</span><span class="hl-9">.</span><span class="hl-4">avgDuration</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  P95: </span><span class="hl-7">${</span><span class="hl-4">metricStats</span><span class="hl-9">.</span><span class="hl-4">p95</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  P99: </span><span class="hl-7">${</span><span class="hl-4">metricStats</span><span class="hl-9">.</span><span class="hl-4">p99</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Identify bottlenecks</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">bottlenecks</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-0">values</span><span class="hl-1">(</span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">metricStats</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">sort</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">b</span><span class="hl-1">.</span><span class="hl-4">totalDuration</span><span class="hl-1"> - </span><span class="hl-4">a</span><span class="hl-1">.</span><span class="hl-4">totalDuration</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-6">3</span><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">Top 3 bottlenecks:&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">bottlenecks</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-4">metric</span><span class="hl-1">, </span><span class="hl-4">i</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">pct</span><span class="hl-1"> = (</span><span class="hl-4">metric</span><span class="hl-1">.</span><span class="hl-4">totalDuration</span><span class="hl-1"> / </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalDuration</span><span class="hl-1">) * </span><span class="hl-6">100</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">i</span><span class="hl-1">+</span><span class="hl-6">1</span><span class="hl-7">}</span><span class="hl-2">. </span><span class="hl-7">${</span><span class="hl-4">metric</span><span class="hl-9">.</span><span class="hl-4">metricType</span><span class="hl-7">}</span><span class="hl-2">: </span><span class="hl-7">${</span><span class="hl-4">pct</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">1</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="generating-performance-reports" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Generating Performance Reports<a href="#generating-performance-reports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>getReport()</code> method generates a formatted markdown report with statistics tables.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Performance</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Generate markdown report</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">markdown</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Performance</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">markdown</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Save report to filesystem</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Performance</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;./custom/path&quot;</span><span class="hl-1">);</span><br/><span class="hl-5">// Saves to: ./custom/path/my-strategy.md</span>
</code><button type="button">Copy</button></pre>

<p><strong>Report Structure:</strong></p>
<p>The generated markdown includes:</p>
<ol>
<li><strong>Header</strong>: Strategy name and summary statistics</li>
<li><strong>Time Distribution</strong>: Percentage breakdown by metric type</li>
<li><strong>Detailed Metrics Table</strong>: Comprehensive statistics for each operation</li>
<li><strong>Notes</strong>: Explanation of metrics (P95/P99, wait times)</li>
</ol>
<p><strong>Example Report Output:</strong></p>
<pre><code class="markdown"># Performance Report: my-strategy

**Total events:** 1,234
**Total execution time:** 45,678.92ms
**Number of metric types:** 5

## Time Distribution

- **tick**: 45.2% (20,642.13ms total)
- **getCandles**: 32.1% (14,652.84ms total)
- **getSignal**: 18.3% (8,359.21ms total)

## Detailed Metrics

| Metric | Count | Avg (ms) | Min (ms) | Max (ms) | Median (ms) | P95 (ms) | P99 (ms) | Std Dev |
|--------|-------|----------|----------|----------|-------------|----------|----------|---------|
| tick | 500 | 41.28 | 12.34 | 156.78 | 38.45 | 87.21 | 124.56 | 18.92 |
| getCandles | 150 | 97.69 | 45.12 | 234.56 | 89.23 | 178.34 | 212.45 | 42.18 |
| getSignal | 500 | 16.72 | 5.67 | 89.34 | 14.23 | 34.56 | 56.78 | 12.45 |

**Note:** All durations are in milliseconds. P95/P99 represent 95th and 99th percentile response times. Wait times show the interval between consecutive events of the same type.
</code><button type="button">Copy</button></pre>

<hr>
<a id="column-configuration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Column Configuration<a href="#column-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Performance report tables use the <code>ColumnModel</code> interface for customizable column formatting. Default columns are defined in <code>COLUMN_CONFIG.performance_columns</code>.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">COLUMN_CONFIG</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Use custom columns</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">customColumns</span><span class="hl-1"> = [</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;metric&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Operation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">stats</span><span class="hl-1">: </span><span class="hl-11">MetricStats</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">metricType</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;count&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Count&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">stats</span><span class="hl-1">: </span><span class="hl-11">MetricStats</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">count</span><span class="hl-1">.</span><span class="hl-0">toString</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;avgDuration&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Avg (ms)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">stats</span><span class="hl-1">: </span><span class="hl-11">MetricStats</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">avgDuration</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">2</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">report</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Performance</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">customColumns</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="clearing-performance-data" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Clearing Performance Data<a href="#clearing-performance-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>clear()</code> method removes accumulated performance data from memoized storage.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Performance</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Clear specific symbol-strategy pair</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Performance</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Clear all performance data</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Performance</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>Clearing is useful when:</p>
<ul>
<li>Starting a new backtest run with fresh metrics</li>
<li>Managing memory in long-running processes</li>
<li>Resetting data after configuration changes</li>
</ul>
<hr>
<a id="integration-with-strategy-execution" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Strategy Execution<a href="#integration-with-strategy-execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Performance tracking integrates seamlessly with the strategy execution pipeline. The framework automatically emits events at key execution points.</p>
<p><img src="../media/44_performance-tracking_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Typical metricType values emitted during execution:</strong></p>
<table>
<thead>
<tr>
<th>metricType</th>
<th>Emitted By</th>
<th>Measures</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tick</code></td>
<td><code>ClientStrategy.tick()</code></td>
<td>Complete tick cycle duration</td>
</tr>
<tr>
<td><code>backtest</code></td>
<td><code>ClientStrategy.backtest()</code></td>
<td>Fast backtest processing time</td>
</tr>
<tr>
<td><code>getSignal</code></td>
<td>Strategy execution</td>
<td>User's <code>getSignal()</code> function time</td>
</tr>
<tr>
<td><code>getCandles</code></td>
<td><code>ClientExchange.getCandles()</code></td>
<td>Candle data fetching time</td>
</tr>
<tr>
<td><code>getAveragePrice</code></td>
<td><code>ClientExchange.getAveragePrice()</code></td>
<td>VWAP calculation time</td>
</tr>
</tbody>
</table>
<p>Custom strategies can emit additional metric types by calling <code>performanceEmitter.emit()</code> directly.</p>
<hr>
<a id="safe-math-and-error-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Safe Math and Error Handling<a href="#safe-math-and-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Performance statistics use safe math checks to handle edge cases:</p>
<pre><code class="typescript"><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">): </span><span class="hl-11">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">typeof</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1"> !== </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-0">isNaN</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-0">isFinite</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">false</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>When calculations produce <code>NaN</code> or <code>Infinity</code> values:</p>
<ul>
<li>The unsafe values are preserved (not converted to null)</li>
<li>Report formatting handles these gracefully</li>
<li>Percentile calculations return 0 for empty arrays</li>
</ul>
<p>This ensures that performance reports remain stable even with:</p>
<ul>
<li>Zero-duration operations</li>
<li>Empty event lists</li>
<li>Division by zero scenarios</li>
</ul>
<hr>
<a id="storage-limits-and-memory-management" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Storage Limits and Memory Management<a href="#storage-limits-and-memory-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>PerformanceStorage</code> implements a fixed-size FIFO queue with a 10,000 event limit per symbol-strategy pair.</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">MAX_EVENTS</span><span class="hl-1"> = </span><span class="hl-6">10000</span><span class="hl-1">;</span><br/><br/><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">addEvent</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-4">PerformanceContract</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_events</span><span class="hl-1">.</span><span class="hl-0">unshift</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">);  </span><span class="hl-5">// Add to front</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_events</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-8">MAX_EVENTS</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_events</span><span class="hl-1">.</span><span class="hl-0">pop</span><span class="hl-1">();  </span><span class="hl-5">// Remove oldest</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Memory characteristics:</strong></p>
<ul>
<li><strong>Per-pair isolation</strong>: Each <code>symbol:strategyName</code> combination has independent storage</li>
<li><strong>Automatic trimming</strong>: Oldest events are discarded when capacity is reached</li>
<li><strong>Most recent first</strong>: Events are stored newest-first for efficient access</li>
<li><strong>Memoization</strong>: Storage instances are cached and reused</li>
</ul>
<p>For long-running live trading or extensive backtests, the 10,000 event limit prevents unbounded memory growth while retaining sufficient recent history for analysis.</p>
<hr>
<a id="example-bottleneck-detection-workflow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Example: Bottleneck Detection Workflow<a href="#example-bottleneck-detection-workflow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following example demonstrates a complete workflow for detecting and analyzing performance bottlenecks:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><br/><span class="hl-1">  </span><span class="hl-4">Backtest</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-4">Performance</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-4">listenPerformance</span><span class="hl-1"> </span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// 1. Monitor real-time performance</span><br/><span class="hl-0">listenPerformance</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1"> &gt; </span><span class="hl-6">100</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Slow operation: </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">metricType</span><span class="hl-7">}</span><span class="hl-2"> took </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">duration</span><span class="hl-7">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// 2. Run backtest</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">results</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// 3. Analyze performance statistics</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Performance</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// 4. Identify bottlenecks</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">sortedMetrics</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-0">values</span><span class="hl-1">(</span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">metricStats</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">sort</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">b</span><span class="hl-1">.</span><span class="hl-4">totalDuration</span><span class="hl-1"> - </span><span class="hl-4">a</span><span class="hl-1">.</span><span class="hl-4">totalDuration</span><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">Performance Analysis:&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total execution time: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalDuration</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total operations: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalEvents</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">Bottlenecks (by total time):&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">sortedMetrics</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-4">metric</span><span class="hl-1">, </span><span class="hl-4">index</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">percentage</span><span class="hl-1"> = (</span><span class="hl-4">metric</span><span class="hl-1">.</span><span class="hl-4">totalDuration</span><span class="hl-1"> / </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalDuration</span><span class="hl-1">) * </span><span class="hl-6">100</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">index</span><span class="hl-9"> </span><span class="hl-1">+</span><span class="hl-9"> </span><span class="hl-6">1</span><span class="hl-7">}</span><span class="hl-2">. </span><span class="hl-7">${</span><span class="hl-4">metric</span><span class="hl-9">.</span><span class="hl-4">metricType</span><span class="hl-7">}</span><span class="hl-2">: </span><span class="hl-7">${</span><span class="hl-4">percentage</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">1</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">% `</span><span class="hl-1"> +</span><br/><span class="hl-1">    </span><span class="hl-2">`(</span><span class="hl-7">${</span><span class="hl-4">metric</span><span class="hl-9">.</span><span class="hl-4">count</span><span class="hl-7">}</span><span class="hl-2"> calls, </span><span class="hl-7">${</span><span class="hl-4">metric</span><span class="hl-9">.</span><span class="hl-4">avgDuration</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">ms avg)`</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// 5. Check outliers (P99)</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">P99 Response Times:&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">sortedMetrics</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-4">metric</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">metric</span><span class="hl-1">.</span><span class="hl-4">p99</span><span class="hl-1"> &gt; </span><span class="hl-6">200</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">metric</span><span class="hl-9">.</span><span class="hl-4">metricType</span><span class="hl-7">}</span><span class="hl-2">: P99=</span><span class="hl-7">${</span><span class="hl-4">metric</span><span class="hl-9">.</span><span class="hl-4">p99</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">ms (high outlier)`</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// 6. Generate report</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Performance</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">Report saved to: ./dump/performance/my-strategy.md&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#performance-tracking"><span>Performance <wbr/>Tracking</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#performance-event-flow"><span>Performance <wbr/>Event <wbr/>Flow</span></a></li><li><a href="#performancecontract-structure"><span>Performance<wbr/>Contract <wbr/>Structure</span></a></li><li><a href="#emitting-performance-events"><span>Emitting <wbr/>Performance <wbr/>Events</span></a></li><li><a href="#listening-to-performance-events"><span>Listening to <wbr/>Performance <wbr/>Events</span></a></li><li><a href="#performancemarkdownservice-architecture"><span>Performance<wbr/>Markdown<wbr/>Service <wbr/>Architecture</span></a></li><li><a href="#statistics-calculation"><span>Statistics <wbr/>Calculation</span></a></li><li><a href="#performancestatisticsmodel-structure"><span>Performance<wbr/>Statistics<wbr/>Model <wbr/>Structure</span></a></li><li><a href="#using-the-performance-class"><span>Using the <wbr/>Performance <wbr/>Class</span></a></li><li><a href="#generating-performance-reports"><span>Generating <wbr/>Performance <wbr/>Reports</span></a></li><li><a href="#column-configuration"><span>Column <wbr/>Configuration</span></a></li><li><a href="#clearing-performance-data"><span>Clearing <wbr/>Performance <wbr/>Data</span></a></li><li><a href="#integration-with-strategy-execution"><span>Integration with <wbr/>Strategy <wbr/>Execution</span></a></li><li><a href="#safe-math-and-error-handling"><span>Safe <wbr/>Math and <wbr/>Error <wbr/>Handling</span></a></li><li><a href="#storage-limits-and-memory-management"><span>Storage <wbr/>Limits and <wbr/>Memory <wbr/>Management</span></a></li><li><a href="#example-bottleneck-detection-workflow"><span>Example: <wbr/>Bottleneck <wbr/>Detection <wbr/>Workflow</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
