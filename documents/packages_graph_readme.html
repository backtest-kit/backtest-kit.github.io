<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>packages/graph/readme | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="packages_graph_readme.html">packages/graph/readme</a></li></ul></div><div class="tsd-panel tsd-typography"><img src="https://github.com/tripolskypetr/backtest-kit/raw/refs/heads/master/assets/assignation.svg" height="45px" align="right">
<a id="ðŸ“Š-backtest-kitgraph" class="tsd-anchor"></a><h1 class="tsd-anchor-link">ðŸ“Š @backtest-kit/graph<a href="#ðŸ“Š-backtest-kitgraph" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><blockquote>
<p>Compose backtest-kit computations as a typed directed acyclic graph. Define source nodes that fetch market data and output nodes that compute derived values â€” then resolve the whole graph in topological order.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/tripolskypetr/backtest-kit/HEAD/assets/screenshots/screenshot8.png" alt="screenshot"></p>
<p><a href="https://deepwiki.com/tripolskypetr/backtest-kit"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>
<a href="https://npmjs.org/package/@backtest-kit/graph"><img src="https://img.shields.io/npm/v/@backtest-kit/graph.svg?style=flat-square" alt="npm"></a>
<a href=""><img src="https://img.shields.io/badge/TypeScript-5.0+-blue" alt="TypeScript"></a></p>
<p>ðŸ“š <strong><a href="https://backtest-kit.github.io/documents/example_02_first_backtest.html">Backtest Kit Docs</a></strong> | ðŸŒŸ <strong><a href="https://github.com/tripolskypetr/backtest-kit">GitHub</a></strong></p>
<a id="ðŸ”¥-multi-timeframe-pine-script-strategy" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ðŸ”¥ Multi-timeframe Pine Script strategy<a href="#ðŸ”¥-multi-timeframe-pine-script-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The graph below replicates a two-timeframe strategy: a 4h Pine Script acts as a trend filter, a 15m Pine Script generates the entry signal. <code>outputNode</code> combines them and returns <code>null</code> when the trend disagrees.</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">extract</span><span class="hl-2">, </span><span class="hl-6">run</span><span class="hl-2">, </span><span class="hl-6">toSignalDto</span><span class="hl-2">, </span><span class="hl-6">File</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;@backtest-kit/pinets&#39;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">addStrategySchema</span><span class="hl-2">, </span><span class="hl-6">Cache</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;backtest-kit&#39;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">randomString</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;functools-kit&#39;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">sourceNode</span><span class="hl-2">, </span><span class="hl-6">outputNode</span><span class="hl-2">, </span><span class="hl-6">resolve</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;@backtest-kit/graph&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// SourceNode â€” 4h trend filter, cached per candle interval</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">higherTimeframe</span><span class="hl-2"> = </span><span class="hl-1">sourceNode</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-6">Cache</span><span class="hl-2">.</span><span class="hl-1">fn</span><span class="hl-2">(</span><br/><span class="hl-2">        </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">            </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">plots</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-6">File</span><span class="hl-2">.</span><span class="hl-1">fromPath</span><span class="hl-2">(</span><span class="hl-4">&#39;timeframe_4h.pine&#39;</span><span class="hl-2">), {</span><br/><span class="hl-2">                </span><span class="hl-6">symbol</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">timeframe:</span><span class="hl-2"> </span><span class="hl-4">&#39;4h&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">limit:</span><span class="hl-2"> </span><span class="hl-7">100</span><span class="hl-2">,</span><br/><span class="hl-2">            });</span><br/><span class="hl-2">            </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-1">extract</span><span class="hl-2">(</span><span class="hl-6">plots</span><span class="hl-2">, {</span><br/><span class="hl-2">                </span><span class="hl-6">allowLong:</span><span class="hl-2">  </span><span class="hl-4">&#39;AllowLong&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">allowShort:</span><span class="hl-2"> </span><span class="hl-4">&#39;AllowShort&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">noTrades:</span><span class="hl-2">   </span><span class="hl-4">&#39;NoTrades&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">            });</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        { </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&#39;4h&#39;</span><span class="hl-2">, </span><span class="hl-1">key</span><span class="hl-6">:</span><span class="hl-2"> ([</span><span class="hl-6">symbol</span><span class="hl-2">]) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">symbol</span><span class="hl-2"> },</span><br/><span class="hl-2">    ),</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-0">// SourceNode â€” 15m entry signal, cached per candle interval</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">lowerTimeframe</span><span class="hl-2"> = </span><span class="hl-1">sourceNode</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-6">Cache</span><span class="hl-2">.</span><span class="hl-1">fn</span><span class="hl-2">(</span><br/><span class="hl-2">        </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">            </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">plots</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-6">File</span><span class="hl-2">.</span><span class="hl-1">fromPath</span><span class="hl-2">(</span><span class="hl-4">&#39;timeframe_15m.pine&#39;</span><span class="hl-2">), {</span><br/><span class="hl-2">                </span><span class="hl-6">symbol</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">timeframe:</span><span class="hl-2"> </span><span class="hl-4">&#39;15m&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">limit:</span><span class="hl-2"> </span><span class="hl-7">100</span><span class="hl-2">,</span><br/><span class="hl-2">            });</span><br/><span class="hl-2">            </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-1">extract</span><span class="hl-2">(</span><span class="hl-6">plots</span><span class="hl-2">, {</span><br/><span class="hl-2">                </span><span class="hl-6">position:</span><span class="hl-2">            </span><span class="hl-4">&#39;Signal&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">priceOpen:</span><span class="hl-2">           </span><span class="hl-4">&#39;Close&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2">     </span><span class="hl-4">&#39;TakeProfit&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">priceStopLoss:</span><span class="hl-2">       </span><span class="hl-4">&#39;StopLoss&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">minuteEstimatedTime:</span><span class="hl-2"> </span><span class="hl-4">&#39;EstimatedTime&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">            });</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        { </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&#39;15m&#39;</span><span class="hl-2">, </span><span class="hl-1">key</span><span class="hl-6">:</span><span class="hl-2"> ([</span><span class="hl-6">symbol</span><span class="hl-2">]) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">symbol</span><span class="hl-2"> },</span><br/><span class="hl-2">    ),</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-0">// OutputNode â€” applies MTF filter, returns ISignalDto or null</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">mtfSignal</span><span class="hl-2"> = </span><span class="hl-1">outputNode</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-3">async</span><span class="hl-2"> ([</span><span class="hl-6">higher</span><span class="hl-2">, </span><span class="hl-6">lower</span><span class="hl-2">]) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">higher</span><span class="hl-2">.</span><span class="hl-6">noTrades</span><span class="hl-2">) </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">lower</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-7">0</span><span class="hl-2">) </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">higher</span><span class="hl-2">.</span><span class="hl-6">allowShort</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">lower</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-7">1</span><span class="hl-2">) </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">higher</span><span class="hl-2">.</span><span class="hl-6">allowLong</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">lower</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === -</span><span class="hl-7">1</span><span class="hl-2">) </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><br/><span class="hl-2">        </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-1">toSignalDto</span><span class="hl-2">(</span><span class="hl-1">randomString</span><span class="hl-2">(), </span><span class="hl-6">lower</span><span class="hl-2">, </span><span class="hl-3">null</span><span class="hl-2">);</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-6">higherTimeframe</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">lowerTimeframe</span><span class="hl-2">,</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-1">addStrategySchema</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&#39;mtf_graph_strategy&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&#39;5m&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-1">getSignal</span><span class="hl-6">:</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-1">resolve</span><span class="hl-2">(</span><span class="hl-6">mtfSignal</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">actions:</span><span class="hl-2"> [</span><span class="hl-4">&#39;partial_profit_action&#39;</span><span class="hl-2">, </span><span class="hl-4">&#39;breakeven_action&#39;</span><span class="hl-2">],</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<p>The graph resolves both Pine Script nodes <strong>in parallel</strong> via <code>Promise.all</code>, then passes their typed results to <code>compute</code>. Replacing either timeframe script or adding a third filter node requires no changes to the strategy wiring.</p>
<a id="ðŸš€-installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ðŸš€ Installation<a href="#ðŸš€-installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-1">npm</span><span class="hl-2"> </span><span class="hl-4">install</span><span class="hl-2"> </span><span class="hl-4">@backtest-kit/graph</span><span class="hl-2"> </span><span class="hl-4">backtest-kit</span>
</code><button type="button">Copy</button></pre>

<a id="âœ¨-features" class="tsd-anchor"></a><h2 class="tsd-anchor-link">âœ¨ Features<a href="#âœ¨-features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>ðŸ“Š <strong>DAG execution</strong>: Nodes are resolved bottom-up in topological order with <code>Promise.all</code> parallelism</li>
<li>ðŸ”’ <strong>Type-safe values</strong>: TypeScript infers the return type of every node through the graph via generics</li>
<li>ðŸ§± <strong>Two APIs</strong>: Low-level <code>INode</code> for runtime/storage, high-level <code>TypedNode</code> + builders for authoring</li>
<li>ðŸ’¾ <strong>DB-ready serialization</strong>: <code>serialize</code> / <code>deserialize</code> convert the graph to a flat <code>IFlatNode[]</code> list with <code>id</code> / <code>nodeIds</code></li>
<li>ðŸ”Œ <strong>Context-aware fetch</strong>: <code>SourceNode.fetch</code> receives <code>(symbol, when, exchangeName)</code> from the execution context automatically</li>
</ul>
<a id="ðŸ“–-usage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ðŸ“– Usage<a href="#ðŸ“–-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="quick-start--builder-api" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Quick Start â€” builder API<a href="#quick-start--builder-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Use <code>sourceNode</code> and <code>outputNode</code> to define a typed computation graph. TypeScript infers the type of <code>values</code> in <code>compute</code> from the <code>nodes</code> passed to <code>outputNode</code>:</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">sourceNode</span><span class="hl-2">, </span><span class="hl-6">outputNode</span><span class="hl-2">, </span><span class="hl-6">resolve</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;@backtest-kit/graph&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// SourceNode&lt;number&gt; â€” fetch receives symbol, when, exchangeName from context</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">closePrice</span><span class="hl-2"> = </span><span class="hl-1">sourceNode</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">when</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&#39;1h&#39;</span><span class="hl-2">, </span><span class="hl-7">1</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">candles</span><span class="hl-2">[</span><span class="hl-7">0</span><span class="hl-2">].</span><span class="hl-6">close</span><span class="hl-2">; </span><span class="hl-0">// number</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// SourceNode&lt;number&gt;</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">volume</span><span class="hl-2"> = </span><span class="hl-1">sourceNode</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">when</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&#39;1h&#39;</span><span class="hl-2">, </span><span class="hl-7">1</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">candles</span><span class="hl-2">[</span><span class="hl-7">0</span><span class="hl-2">].</span><span class="hl-6">volume</span><span class="hl-2">; </span><span class="hl-0">// number</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// OutputNode&lt;[SourceNode&lt;number&gt;, SourceNode&lt;number&gt;], number&gt;</span><br/><span class="hl-0">// price and vol are automatically number</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">vwap</span><span class="hl-2"> = </span><span class="hl-1">outputNode</span><span class="hl-2">(</span><br/><span class="hl-2">    ([</span><span class="hl-6">price</span><span class="hl-2">, </span><span class="hl-6">vol</span><span class="hl-2">]) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">price</span><span class="hl-2"> * </span><span class="hl-6">vol</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">closePrice</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">volume</span><span class="hl-2">,</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-0">// Resolve inside a backtest-kit strategy</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">resolve</span><span class="hl-2">(</span><span class="hl-6">vwap</span><span class="hl-2">); </span><span class="hl-0">// Promise&lt;number&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="inline-anonymous-composition" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Inline anonymous composition<a href="#inline-anonymous-composition" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The entire graph can be defined as a single object literal.</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">NodeType</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;@backtest-kit/graph&#39;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">TypedNode</span><span class="hl-2">, </span><span class="hl-6">resolve</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;@backtest-kit/graph&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">signal</span><span class="hl-2">: </span><span class="hl-11">TypedNode</span><span class="hl-2"> = {</span><br/><span class="hl-2">    </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-6">NodeType</span><span class="hl-2">.</span><span class="hl-6">OutputNode</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">nodes:</span><span class="hl-2"> [</span><br/><span class="hl-2">        {</span><br/><span class="hl-2">            </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-6">NodeType</span><span class="hl-2">.</span><span class="hl-6">SourceNode</span><span class="hl-2">,</span><br/><span class="hl-2">            </span><span class="hl-1">fetch</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">when</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">                </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">plots</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-6">File</span><span class="hl-2">.</span><span class="hl-1">fromPath</span><span class="hl-2">(</span><span class="hl-4">&#39;timeframe_4h.pine&#39;</span><span class="hl-2">), { </span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">timeframe:</span><span class="hl-2"> </span><span class="hl-4">&#39;4h&#39;</span><span class="hl-2">, </span><span class="hl-6">limit:</span><span class="hl-2"> </span><span class="hl-7">100</span><span class="hl-2"> });</span><br/><span class="hl-2">                </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-1">extract</span><span class="hl-2">(</span><span class="hl-6">plots</span><span class="hl-2">, { </span><span class="hl-6">allowLong:</span><span class="hl-2"> </span><span class="hl-4">&#39;AllowLong&#39;</span><span class="hl-2">, </span><span class="hl-6">allowShort:</span><span class="hl-2"> </span><span class="hl-4">&#39;AllowShort&#39;</span><span class="hl-2">, </span><span class="hl-6">noTrades:</span><span class="hl-2"> </span><span class="hl-4">&#39;NoTrades&#39;</span><span class="hl-2"> });</span><br/><span class="hl-2">            },</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        {</span><br/><span class="hl-2">            </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-6">NodeType</span><span class="hl-2">.</span><span class="hl-6">SourceNode</span><span class="hl-2">,</span><br/><span class="hl-2">            </span><span class="hl-1">fetch</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">when</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">                </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">plots</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-6">File</span><span class="hl-2">.</span><span class="hl-1">fromPath</span><span class="hl-2">(</span><span class="hl-4">&#39;timeframe_15m.pine&#39;</span><span class="hl-2">), { </span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">timeframe:</span><span class="hl-2"> </span><span class="hl-4">&#39;15m&#39;</span><span class="hl-2">, </span><span class="hl-6">limit:</span><span class="hl-2"> </span><span class="hl-7">100</span><span class="hl-2"> });</span><br/><span class="hl-2">                </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-1">extract</span><span class="hl-2">(</span><span class="hl-6">plots</span><span class="hl-2">, { </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-4">&#39;Signal&#39;</span><span class="hl-2">, </span><span class="hl-6">priceOpen:</span><span class="hl-2"> </span><span class="hl-4">&#39;Close&#39;</span><span class="hl-2">, </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> </span><span class="hl-4">&#39;TakeProfit&#39;</span><span class="hl-2">, </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> </span><span class="hl-4">&#39;StopLoss&#39;</span><span class="hl-2"> });</span><br/><span class="hl-2">            },</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">    ],</span><br/><span class="hl-2">    </span><span class="hl-1">compute</span><span class="hl-6">:</span><span class="hl-2"> ([</span><span class="hl-6">higher</span><span class="hl-2">, </span><span class="hl-6">lower</span><span class="hl-2">]) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">higher</span><span class="hl-2">.</span><span class="hl-6">noTrades</span><span class="hl-2"> || </span><span class="hl-6">lower</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-7">0</span><span class="hl-2">) </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">higher</span><span class="hl-2">.</span><span class="hl-6">allowShort</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">lower</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-7">1</span><span class="hl-2">) </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">higher</span><span class="hl-2">.</span><span class="hl-6">allowLong</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">lower</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === -</span><span class="hl-7">1</span><span class="hl-2">) </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">        </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">lower</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2">;</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">};</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">resolve</span><span class="hl-2">(</span><span class="hl-6">signal</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<a id="mixed-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Mixed types<a href="#mixed-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>TypeScript correctly infers heterogeneous types by position in <code>nodes</code>:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">price</span><span class="hl-2"> = </span><span class="hl-1">sourceNode</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-7">42</span><span class="hl-2">);        </span><span class="hl-0">// SourceNode&lt;number&gt;</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">name</span><span class="hl-2">  = </span><span class="hl-1">sourceNode</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-4">&#39;BTCUSDT&#39;</span><span class="hl-2">); </span><span class="hl-0">// SourceNode&lt;string&gt;</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">flag</span><span class="hl-2">  = </span><span class="hl-1">sourceNode</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">);      </span><span class="hl-0">// SourceNode&lt;boolean&gt;</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> = </span><span class="hl-1">outputNode</span><span class="hl-2">(</span><br/><span class="hl-2">    ([</span><span class="hl-6">p</span><span class="hl-2">, </span><span class="hl-6">n</span><span class="hl-2">, </span><span class="hl-6">f</span><span class="hl-2">]) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-6">n</span><span class="hl-3">}</span><span class="hl-4">: </span><span class="hl-3">${</span><span class="hl-6">p</span><span class="hl-3">}</span><span class="hl-4"> (active: </span><span class="hl-3">${</span><span class="hl-6">f</span><span class="hl-3">}</span><span class="hl-4">)`</span><span class="hl-2">, </span><span class="hl-0">// p: number, n: string, f: boolean</span><br/><span class="hl-2">    </span><span class="hl-6">price</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">name</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">flag</span><span class="hl-2">,</span><br/><span class="hl-2">);</span><br/><span class="hl-0">// OutputNode&lt;[SourceNode&lt;number&gt;, SourceNode&lt;string&gt;, SourceNode&lt;boolean&gt;], string&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="using-inside-a-backtest-kit-strategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using inside a backtest-kit strategy<a href="#using-inside-a-backtest-kit-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">addStrategy</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;backtest-kit&#39;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">sourceNode</span><span class="hl-2">, </span><span class="hl-6">outputNode</span><span class="hl-2">, </span><span class="hl-6">resolve</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;@backtest-kit/graph&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">rsi</span><span class="hl-2"> = </span><span class="hl-1">sourceNode</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">when</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// ... compute RSI</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-7">55.2</span><span class="hl-2">;</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">signal</span><span class="hl-2"> = </span><span class="hl-1">outputNode</span><span class="hl-2">(</span><br/><span class="hl-2">    ([</span><span class="hl-6">rsiValue</span><span class="hl-2">]) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">rsiValue</span><span class="hl-2"> &lt; </span><span class="hl-7">30</span><span class="hl-2"> ? </span><span class="hl-7">1</span><span class="hl-2"> : </span><span class="hl-6">rsiValue</span><span class="hl-2"> &gt; </span><span class="hl-7">70</span><span class="hl-2"> ? -</span><span class="hl-7">1</span><span class="hl-2"> : </span><span class="hl-7">0</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">rsi</span><span class="hl-2">,</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-1">addStrategy</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&#39;graph-rsi&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&#39;1h&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">riskName:</span><span class="hl-2"> </span><span class="hl-4">&#39;demo&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-1">getSignal</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">direction</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">resolve</span><span class="hl-2">(</span><span class="hl-6">signal</span><span class="hl-2">); </span><span class="hl-0">// 1 | -1 | 0</span><br/><span class="hl-2">        </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">direction</span><span class="hl-2"> === </span><span class="hl-7">1</span><br/><span class="hl-2">            ? { </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-4">&#39;long&#39;</span><span class="hl-2">, ... }</span><br/><span class="hl-2">            : </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<a id="low-level-inode" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Low-level INode<a href="#low-level-inode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For manual graph construction without builders (e.g. after deserialization or in a DI container):</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">INode</span><span class="hl-2">, </span><span class="hl-6">Value</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;@backtest-kit/graph&#39;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> </span><span class="hl-6">NodeType</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;@backtest-kit/graph/enum/NodeType&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">priceNode</span><span class="hl-2">: </span><span class="hl-11">INode</span><span class="hl-2"> = {</span><br/><span class="hl-2">    </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-6">NodeType</span><span class="hl-2">.</span><span class="hl-6">SourceNode</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&#39;Close price&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-1">fetch</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">when</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-7">42</span><span class="hl-2">,</span><br/><span class="hl-2">};</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">outputNode</span><span class="hl-2">: </span><span class="hl-11">INode</span><span class="hl-2"> = {</span><br/><span class="hl-2">    </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-6">NodeType</span><span class="hl-2">.</span><span class="hl-6">OutputNode</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&#39;Doubled price&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">nodes:</span><span class="hl-2"> [</span><span class="hl-6">priceNode</span><span class="hl-2">],</span><br/><span class="hl-2">    </span><span class="hl-1">compute</span><span class="hl-6">:</span><span class="hl-2"> ([</span><span class="hl-6">price</span><span class="hl-2">]) </span><span class="hl-3">=&gt;</span><span class="hl-2"> (</span><span class="hl-6">price</span><span class="hl-2"> </span><span class="hl-5">as</span><span class="hl-2"> </span><span class="hl-11">number</span><span class="hl-2">) * </span><span class="hl-7">2</span><span class="hl-2">,</span><br/><span class="hl-2">};</span>
</code><button type="button">Copy</button></pre>

<blockquote>
<p><code>INode</code> has no generic parameters â€” <code>values</code> in <code>compute</code> is typed as <code>Value[]</code>. Use <code>TypedNode</code> and builders for full IntelliSense.</p>
</blockquote>
<a id="db-serialization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">DB serialization<a href="#db-serialization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>serialize</code> flattens the graph into an <code>IFlatNode[]</code> array, replacing object references in <code>nodes</code> with <code>nodeIds</code>. <code>deserialize</code> reconstructs the tree:</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">serialize</span><span class="hl-2">, </span><span class="hl-6">deserialize</span><span class="hl-2">, </span><span class="hl-6">IFlatNode</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;@backtest-kit/graph&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Graph â†’ flat array for DB</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">flat</span><span class="hl-2">: </span><span class="hl-11">IFlatNode</span><span class="hl-2">[] = </span><span class="hl-1">serialize</span><span class="hl-2">([</span><span class="hl-6">vwap</span><span class="hl-2">]);</span><br/><span class="hl-0">// [</span><br/><span class="hl-0">//   { id: &#39;abc&#39;, type: &#39;source_node&#39;, nodeIds: [] },            // closePrice</span><br/><span class="hl-0">//   { id: &#39;def&#39;, type: &#39;source_node&#39;, nodeIds: [] },            // volume</span><br/><span class="hl-0">//   { id: &#39;ghi&#39;, type: &#39;output_node&#39;, nodeIds: [&#39;abc&#39;, &#39;def&#39;] }, // vwap</span><br/><span class="hl-0">// ]</span><br/><br/><span class="hl-0">// Save to DB</span><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">db</span><span class="hl-2">.</span><span class="hl-1">collection</span><span class="hl-2">(</span><span class="hl-4">&#39;nodes&#39;</span><span class="hl-2">).</span><span class="hl-1">insertMany</span><span class="hl-2">(</span><span class="hl-6">flat</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Load from DB and reconstruct the graph</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">stored</span><span class="hl-2">: </span><span class="hl-11">IFlatNode</span><span class="hl-2">[] = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">db</span><span class="hl-2">.</span><span class="hl-1">collection</span><span class="hl-2">(</span><span class="hl-4">&#39;nodes&#39;</span><span class="hl-2">).</span><span class="hl-1">find</span><span class="hl-2">().</span><span class="hl-1">toArray</span><span class="hl-2">();</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">roots</span><span class="hl-2">: </span><span class="hl-11">INode</span><span class="hl-2">[] = </span><span class="hl-1">deserialize</span><span class="hl-2">(</span><span class="hl-6">stored</span><span class="hl-2">); </span><span class="hl-0">// nodes[] is wired up from nodeIds</span>
</code><button type="button">Copy</button></pre>

<blockquote>
<p><code>fetch</code> and <code>compute</code> are not stored in the DB â€” they must be restored on the application side after <code>deserialize</code>.</p>
</blockquote>
<a id="deepflat--traversal-utility" class="tsd-anchor"></a><h3 class="tsd-anchor-link">deepFlat â€” traversal utility<a href="#deepflat--traversal-utility" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>deepFlat</code> returns all nodes in topological order (dependencies before parents), deduplicated by reference:</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">deepFlat</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;@backtest-kit/graph&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">all</span><span class="hl-2"> = </span><span class="hl-1">deepFlat</span><span class="hl-2">([</span><span class="hl-6">vwap</span><span class="hl-2">]);</span><br/><span class="hl-0">// [closePrice, volume, vwap] â€” dependencies first</span><br/><br/><span class="hl-6">all</span><span class="hl-2">.</span><span class="hl-1">forEach</span><span class="hl-2">(</span><span class="hl-6">node</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">node</span><span class="hl-2">.</span><span class="hl-6">description</span><span class="hl-2">));</span>
</code><button type="button">Copy</button></pre>

<a id="ðŸ“‹-api-reference" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ðŸ“‹ API Reference<a href="#ðŸ“‹-api-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Export</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>sourceNode(fetch)</code></strong></td>
<td>Builder â€” creates a typed source node</td>
</tr>
<tr>
<td><strong><code>outputNode(compute, ...nodes)</code></strong></td>
<td>Builder â€” creates a typed output node, infers <code>values</code> types from <code>nodes</code></td>
</tr>
<tr>
<td><strong><code>resolve(node)</code></strong></td>
<td>Recursively resolves a node graph within backtest-kit execution context</td>
</tr>
<tr>
<td><strong><code>serialize(roots)</code></strong></td>
<td>Flattens a node tree into <code>IFlatNode[]</code> for DB storage</td>
</tr>
<tr>
<td><strong><code>deserialize(flat)</code></strong></td>
<td>Reconstructs a node tree from <code>IFlatNode[]</code>, returns root nodes</td>
</tr>
<tr>
<td><strong><code>deepFlat(nodes)</code></strong></td>
<td>Utility â€” returns all nodes in topological order (dependencies first)</td>
</tr>
<tr>
<td><strong><code>INode</code></strong></td>
<td>Base runtime interface (untyped, used internally and for serialization)</td>
</tr>
<tr>
<td><strong><code>TypedNode</code></strong></td>
<td>Discriminated union for authoring with full IntelliSense</td>
</tr>
<tr>
<td><strong><code>IFlatNode</code></strong></td>
<td>Serialized node shape for DB storage</td>
</tr>
<tr>
<td><strong><code>Value</code></strong></td>
<td><code>string | number | boolean | null</code></td>
</tr>
</tbody>
</table>
<a id="ðŸ¤-contribute" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ðŸ¤ Contribute<a href="#ðŸ¤-contribute" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Fork/PR on <a href="https://github.com/tripolskypetr/backtest-kit">GitHub</a>.</p>
<a id="ðŸ“œ-license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ðŸ“œ License<a href="#ðŸ“œ-license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>MIT Â© <a href="https://github.com/tripolskypetr">tripolskypetr</a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#ðŸ“Š-backtest-kitgraph"><span>ðŸ“Š @backtest-<wbr/>kit/graph</span></a><ul><li><a href="#ðŸ”¥-multi-timeframe-pine-script-strategy"><span>ðŸ”¥ <wbr/>Multi-<wbr/>timeframe <wbr/>Pine <wbr/>Script strategy</span></a></li><li><a href="#ðŸš€-installation"><span>ðŸš€ <wbr/>Installation</span></a></li><li><a href="#âœ¨-features"><span>âœ¨ <wbr/>Features</span></a></li><li><a href="#ðŸ“–-usage"><span>ðŸ“– <wbr/>Usage</span></a></li><li><ul><li><a href="#quick-start--builder-api"><span>Quick <wbr/>Start â€” builder API</span></a></li><li><a href="#inline-anonymous-composition"><span>Inline anonymous composition</span></a></li><li><a href="#mixed-types"><span>Mixed types</span></a></li><li><a href="#using-inside-a-backtest-kit-strategy"><span>Using inside a backtest-<wbr/>kit strategy</span></a></li><li><a href="#low-level-inode"><span>Low-<wbr/>level INode</span></a></li><li><a href="#db-serialization"><span>DB serialization</span></a></li><li><a href="#deepflat--traversal-utility"><span>deep<wbr/>Flat â€” traversal utility</span></a></li></ul></li><li><a href="#ðŸ“‹-api-reference"><span>ðŸ“‹ API <wbr/>Reference</span></a></li><li><a href="#ðŸ¤-contribute"><span>ðŸ¤ <wbr/>Contribute</span></a></li><li><a href="#ðŸ“œ-license"><span>ðŸ“œ <wbr/>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
