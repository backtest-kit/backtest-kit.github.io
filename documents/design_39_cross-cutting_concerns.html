<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/39_cross-cutting_concerns | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_39_cross-cutting_concerns.html">design/39_cross-cutting_concerns</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="cross-cutting-concerns" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Cross-Cutting Concerns<a href="#cross-cutting-concerns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This document describes the cross-cutting concerns that span all architectural layers of the backtest-kit framework. Cross-cutting concerns are system-wide capabilities that cannot be cleanly encapsulated within a single layer or component. These include logging, context management, persistence, and reporting mechanisms that are injected throughout the service stack.</p>
<p>For detailed information about specific concerns, see:</p>
<ul>
<li><strong>Logging System</strong>: <a href="design_40_logging_system.html">10.1</a></li>
<li><strong>Error Handling</strong>: <a href="design_41_error_handling.html">10.2</a></li>
<li><strong>Context Propagation Architecture</strong>: <a href="design_07_context_propagation.html">2.3</a></li>
<li><strong>Signal Persistence</strong>: <a href="design_26_signal_persistence.html">6.3</a></li>
<li><strong>Report Generation</strong>: <a href="design_36_reporting_and_analytics.html">9</a></li>
</ul>
<hr>
<a id="system-wide-concerns-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">System-Wide Concerns Overview<a href="#system-wide-concerns-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework implements four primary cross-cutting concerns:</p>
<table>
<thead>
<tr>
<th>Concern</th>
<th>Primary Service</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Logging</strong></td>
<td><code>LoggerService</code></td>
<td>Unified logging with automatic context enrichment</td>
</tr>
<tr>
<td><strong>Context Management</strong></td>
<td><code>ExecutionContextService</code><br/><code>MethodContextService</code></td>
<td>Implicit context propagation without explicit parameters</td>
</tr>
<tr>
<td><strong>Persistence</strong></td>
<td><code>PersistSignalAdapter</code></td>
<td>Crash-safe atomic storage for live trading</td>
</tr>
<tr>
<td><strong>Reporting</strong></td>
<td><code>BacktestMarkdownService</code><br/><code>LiveMarkdownService</code></td>
<td>Passive event accumulation and markdown generation</td>
</tr>
</tbody>
</table>
<hr>
<a id="cross-cutting-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Cross-Cutting Architecture<a href="#cross-cutting-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="diagram-cross-cutting-concerns-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Diagram: Cross-Cutting Concerns Integration<a href="#diagram-cross-cutting-concerns-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/39_Cross-Cutting_Concerns_0.svg" alt="Mermaid Diagram"></p>
<p>This diagram shows how cross-cutting concerns are injected (dashed lines) throughout the layered architecture, providing system-wide capabilities without creating tight coupling.</p>
<hr>
<a id="logging-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Logging System<a href="#logging-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="service-registration-and-injection" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Registration and Injection<a href="#service-registration-and-injection" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>LoggerService</code> is registered as a singleton in the dependency injection container and injected into nearly every service in the system.</p>
<p><strong>Registration:</strong>
<a href="">src/lib/core/provide.ts:24-26</a></p>
<pre><code class="typescript"><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">LoggerService</span><span class="hl-1">());</span>
</code><button type="button">Copy</button></pre>

<p><strong>Symbol Definition:</strong>
<a href="">src/lib/core/types.ts:1-3</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">baseServices</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">loggerService:</span><span class="hl-1"> </span><span class="hl-0">Symbol</span><span class="hl-1">(</span><span class="hl-2">&#39;loggerService&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><strong>Service Aggregator Export:</strong>
<a href="">src/lib/index.ts:29-31</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">baseServices</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">loggerService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">LoggerService</span><span class="hl-1">&gt;(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">),</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<a id="automatic-context-enrichment" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Automatic Context Enrichment<a href="#automatic-context-enrichment" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>LoggerService</code> automatically appends context information to all log messages without requiring explicit parameters. This is achieved by reading from <code>MethodContextService</code> and <code>ExecutionContextService</code>.</p>
<p><strong>Context Injection Pattern:</strong>
<a href="">src/lib/services/base/LoggerService.ts:41-71</a></p>
<table>
<thead>
<tr>
<th>Context Source</th>
<th>Contains</th>
<th>Availability</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MethodContextService</code></td>
<td><code>strategyName</code>, <code>exchangeName</code>, <code>frameName</code></td>
<td>Available within service call boundaries</td>
</tr>
<tr>
<td><code>ExecutionContextService</code></td>
<td><code>symbol</code>, <code>when</code>, <code>backtest</code></td>
<td>Available during tick execution</td>
</tr>
</tbody>
</table>
<p><strong>Log Method Implementation:</strong>
<a href="">src/lib/services/base/LoggerService.ts:79-86</a></p>
<p>The logger checks context availability using static methods:</p>
<ul>
<li><code>MethodContextService.hasContext()</code></li>
<li><code>ExecutionContextService.hasContext()</code></li>
</ul>
<p>If context exists, it is automatically appended to all log calls.</p>
<a id="default-no-op-logger" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Default No-Op Logger<a href="#default-no-op-logger" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>By default, the logger uses a no-op implementation that silently discards all messages:</p>
<p><a href="">src/lib/services/base/LoggerService.ts:15-28</a></p>
<p>Users configure a custom logger using <code>setLogger()</code>:
<a href="">src/lib/services/base/LoggerService.ts:138-140</a></p>
<a id="logger-interface" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Logger Interface<a href="#logger-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework expects loggers to implement the <code>ILogger</code> interface with four severity levels:</p>
<p><a href="">src/interfaces/Logger.interface.ts:6-30</a></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>log()</code></td>
<td>General-purpose messages</td>
</tr>
<tr>
<td><code>debug()</code></td>
<td>Detailed diagnostic information</td>
</tr>
<tr>
<td><code>info()</code></td>
<td>Informational updates</td>
</tr>
<tr>
<td><code>warn()</code></td>
<td>Potentially problematic situations</td>
</tr>
</tbody>
</table>
<hr>
<a id="context-management-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Management Services<a href="#context-management-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="diagram-context-service-architecture" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Diagram: Context Service Architecture<a href="#diagram-context-service-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/39_Cross-Cutting_Concerns_1.svg" alt="Mermaid Diagram"></p>
<a id="methodcontextservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">MethodContextService<a href="#methodcontextservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Stores routing keys that determine which strategy/exchange/frame instances to use:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strategyName</code></td>
<td><code>string</code></td>
<td>Identifies the active strategy</td>
</tr>
<tr>
<td><code>exchangeName</code></td>
<td><code>string</code></td>
<td>Identifies the active exchange</td>
</tr>
<tr>
<td><code>frameName</code></td>
<td><code>string</code></td>
<td>Identifies the active frame</td>
</tr>
</tbody>
</table>
<p>Set by connection services before routing calls to client instances.</p>
<a id="executioncontextservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ExecutionContextService<a href="#executioncontextservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Stores execution state during tick processing:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>symbol</code></td>
<td><code>string</code></td>
<td>Trading pair being processed</td>
</tr>
<tr>
<td><code>when</code></td>
<td><code>number</code></td>
<td>Current timestamp</td>
</tr>
<tr>
<td><code>backtest</code></td>
<td><code>boolean</code></td>
<td>Execution mode flag</td>
</tr>
</tbody>
</table>
<p>Set by logic services before each tick execution.</p>
<a id="context-lifecycle" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Lifecycle<a href="#context-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Registration Phase</strong>: Services registered in DI container</li>
<li><strong>Method Entry</strong>: <code>MethodContextService</code> set with routing keys</li>
<li><strong>Tick Execution</strong>: <code>ExecutionContextService</code> set with execution state</li>
<li><strong>Logging</strong>: Both contexts automatically read and appended</li>
<li><strong>Method Exit</strong>: Context automatically cleared by <code>di-scoped</code></li>
</ol>
<hr>
<a id="persistence-layer" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Persistence Layer<a href="#persistence-layer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>PersistSignalAdapter</code> provides crash-safe atomic file writes for live trading signal persistence. This ensures that on process restart, the system can recover the exact signal state without duplication or loss.</p>
<a id="key-characteristics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Key Characteristics<a href="#key-characteristics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Feature</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Atomicity</strong></td>
<td>Write to temp file, then atomic rename</td>
</tr>
<tr>
<td><strong>Crash Recovery</strong></td>
<td>State loaded from disk on restart</td>
</tr>
<tr>
<td><strong>Location</strong></td>
<td><code>./persist</code> directory</td>
</tr>
<tr>
<td><strong>Format</strong></td>
<td>JSON serialization of <code>ISignalDto</code></td>
</tr>
</tbody>
</table>
<a id="integration-with-clientstrategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Integration with ClientStrategy<a href="#integration-with-clientstrategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>ClientStrategy</code> calls <code>PersistSignalAdapter</code> at critical state transitions:</p>
<ol>
<li><strong>Signal Opened</strong>: Write full signal to disk before yielding result</li>
<li><strong>Signal Closed</strong>: Write <code>null</code> to disk to clear state</li>
<li><strong>System Restart</strong>: Load persisted signal from disk during initialization</li>
</ol>
<p>This ensures exactly-once signal semantics in production trading.</p>
<p><strong>Note:</strong> For detailed persistence mechanics, see <a href="design_26_signal_persistence.html">6.3</a> Signal Persistence.</p>
<hr>
<a id="reporting-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Reporting Services<a href="#reporting-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="service-specialization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Specialization<a href="#service-specialization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework provides two specialized markdown services:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Mode</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BacktestMarkdownService</code></td>
<td>Backtest</td>
<td>Accumulates closed signals for historical analysis</td>
</tr>
<tr>
<td><code>LiveMarkdownService</code></td>
<td>Live</td>
<td>Tracks opened/closed events for operational monitoring</td>
</tr>
</tbody>
</table>
<p><strong>Registration:</strong>
<a href="">src/lib/core/provide.ts:63-66</a></p>
<pre><code class="typescript"><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">backtestMarkdownService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">BacktestMarkdownService</span><span class="hl-1">());</span><br/><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">liveMarkdownService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">LiveMarkdownService</span><span class="hl-1">());</span>
</code><button type="button">Copy</button></pre>

<a id="passive-accumulation-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Passive Accumulation Pattern<a href="#passive-accumulation-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Markdown services observe signal events without affecting execution:</p>
<p><img src="../media/39_Cross-Cutting_Concerns_2.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="cross-cutting-integration-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Cross-Cutting Integration Patterns<a href="#cross-cutting-integration-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="pattern-1-constructor-injection" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 1: Constructor Injection<a href="#pattern-1-constructor-injection" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All services receive cross-cutting dependencies via constructor injection:</p>
<p><img src="../media/39_Cross-Cutting_Concerns_3.svg" alt="Mermaid Diagram"></p>
<p>Example from any service constructor:</p>
<pre><code class="typescript"><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">readonly</span><span class="hl-1"> </span><span class="hl-4">loggerService</span><span class="hl-1"> = </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">LoggerService</span><span class="hl-1">&gt;(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">);</span><br/><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">readonly</span><span class="hl-1"> </span><span class="hl-4">methodContextService</span><span class="hl-1"> = </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">TMethodContextService</span><span class="hl-1">&gt;(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">methodContextService</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="pattern-2-implicit-context-reading" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 2: Implicit Context Reading<a href="#pattern-2-implicit-context-reading" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Services read context implicitly without explicit parameters:</p>
<p><a href="">src/lib/services/base/LoggerService.ts:55-71</a></p>
<p>This eliminates parameter threading across the call stack.</p>
<a id="pattern-3-service-aggregation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 3: Service Aggregation<a href="#pattern-3-service-aggregation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All services, including cross-cutting concerns, are aggregated in the <code>backtest</code> object:</p>
<p><a href="">src/lib/index.ts:101-110</a></p>
<pre><code class="typescript"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">backtest</span><span class="hl-1"> = {</span><br/><span class="hl-1">  ...</span><span class="hl-4">baseServices</span><span class="hl-1">,        </span><span class="hl-5">// LoggerService</span><br/><span class="hl-1">  ...</span><span class="hl-4">contextServices</span><span class="hl-1">,     </span><span class="hl-5">// Execution/Method Context</span><br/><span class="hl-1">  ...</span><span class="hl-4">connectionServices</span><span class="hl-1">,  </span><span class="hl-5">// Connection routing</span><br/><span class="hl-1">  ...</span><span class="hl-4">schemaServices</span><span class="hl-1">,      </span><span class="hl-5">// Configuration registries</span><br/><span class="hl-1">  ...</span><span class="hl-4">globalServices</span><span class="hl-1">,      </span><span class="hl-5">// Context injection wrappers</span><br/><span class="hl-1">  ...</span><span class="hl-4">logicPrivateServices</span><span class="hl-1">,</span><span class="hl-5">// Execution orchestration</span><br/><span class="hl-1">  ...</span><span class="hl-4">logicPublicServices</span><span class="hl-1">, </span><span class="hl-5">// Public API</span><br/><span class="hl-1">  ...</span><span class="hl-4">markdownServices</span><span class="hl-1">,    </span><span class="hl-5">// Reporting</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>This provides a single import point for all framework capabilities.</p>
<a id="pattern-4-scoped-context-with-di-scoped" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 4: Scoped Context with di-scoped<a href="#pattern-4-scoped-context-with-di-scoped" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Context services use <code>di-scoped</code> for automatic cleanup:</p>
<ul>
<li>Context set at method entry</li>
<li>Context available throughout call stack</li>
<li>Context automatically cleared at method exit</li>
<li>No manual cleanup required</li>
</ul>
<hr>
<a id="service-registration-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Registration Flow<a href="#service-registration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="diagram-cross-cutting-services-in-di-container" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Diagram: Cross-Cutting Services in DI Container<a href="#diagram-cross-cutting-services-in-di-container" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/39_Cross-Cutting_Concerns_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Registration Order:</strong></p>
<ol>
<li>Base services (logger)</li>
<li>Context services (execution/method)</li>
<li>Connection services</li>
<li>Schema services</li>
<li>Global services</li>
<li>Logic services</li>
<li>Markdown services</li>
</ol>
<p>Each service category is registered in blocks within <a href="">src/lib/core/provide.ts:24-66</a>.</p>
<hr>
<a id="summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Summary<a href="#summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Cross-cutting concerns in backtest-kit are implemented as injected services that span all architectural layers:</p>
<table>
<thead>
<tr>
<th>Concern</th>
<th>Service(s)</th>
<th>Key Feature</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Logging</strong></td>
<td><code>LoggerService</code></td>
<td>Automatic context enrichment</td>
</tr>
<tr>
<td><strong>Context</strong></td>
<td><code>ExecutionContextService</code><br/><code>MethodContextService</code></td>
<td>Implicit propagation via di-scoped</td>
</tr>
<tr>
<td><strong>Persistence</strong></td>
<td><code>PersistSignalAdapter</code></td>
<td>Atomic writes for crash recovery</td>
</tr>
<tr>
<td><strong>Reporting</strong></td>
<td><code>BacktestMarkdownService</code><br/><code>LiveMarkdownService</code></td>
<td>Passive event accumulation</td>
</tr>
</tbody>
</table>
<p>These services are registered at startup, injected via constructor parameters, and accessed throughout the call stack without polluting business logic with cross-cutting concerns. The design enables clean separation of concerns while providing system-wide capabilities.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#cross-cutting-concerns"><span>Cross-<wbr/>Cutting <wbr/>Concerns</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#system-wide-concerns-overview"><span>System-<wbr/>Wide <wbr/>Concerns <wbr/>Overview</span></a></li><li><a href="#cross-cutting-architecture"><span>Cross-<wbr/>Cutting <wbr/>Architecture</span></a></li><li><ul><li><a href="#diagram-cross-cutting-concerns-integration"><span>Diagram: <wbr/>Cross-<wbr/>Cutting <wbr/>Concerns <wbr/>Integration</span></a></li></ul></li><li><a href="#logging-system"><span>Logging <wbr/>System</span></a></li><li><ul><li><a href="#service-registration-and-injection"><span>Service <wbr/>Registration and <wbr/>Injection</span></a></li><li><a href="#automatic-context-enrichment"><span>Automatic <wbr/>Context <wbr/>Enrichment</span></a></li><li><a href="#default-no-op-logger"><span>Default <wbr/>No-<wbr/>Op <wbr/>Logger</span></a></li><li><a href="#logger-interface"><span>Logger <wbr/>Interface</span></a></li></ul></li><li><a href="#context-management-services"><span>Context <wbr/>Management <wbr/>Services</span></a></li><li><ul><li><a href="#diagram-context-service-architecture"><span>Diagram: <wbr/>Context <wbr/>Service <wbr/>Architecture</span></a></li><li><a href="#methodcontextservice"><span>Method<wbr/>Context<wbr/>Service</span></a></li><li><a href="#executioncontextservice"><span>Execution<wbr/>Context<wbr/>Service</span></a></li><li><a href="#context-lifecycle"><span>Context <wbr/>Lifecycle</span></a></li></ul></li><li><a href="#persistence-layer"><span>Persistence <wbr/>Layer</span></a></li><li><ul><li><a href="#key-characteristics"><span>Key <wbr/>Characteristics</span></a></li><li><a href="#integration-with-clientstrategy"><span>Integration with <wbr/>Client<wbr/>Strategy</span></a></li></ul></li><li><a href="#reporting-services"><span>Reporting <wbr/>Services</span></a></li><li><ul><li><a href="#service-specialization"><span>Service <wbr/>Specialization</span></a></li><li><a href="#passive-accumulation-pattern"><span>Passive <wbr/>Accumulation <wbr/>Pattern</span></a></li></ul></li><li><a href="#cross-cutting-integration-patterns"><span>Cross-<wbr/>Cutting <wbr/>Integration <wbr/>Patterns</span></a></li><li><ul><li><a href="#pattern-1-constructor-injection"><span>Pattern 1: <wbr/>Constructor <wbr/>Injection</span></a></li><li><a href="#pattern-2-implicit-context-reading"><span>Pattern 2: <wbr/>Implicit <wbr/>Context <wbr/>Reading</span></a></li><li><a href="#pattern-3-service-aggregation"><span>Pattern 3: <wbr/>Service <wbr/>Aggregation</span></a></li><li><a href="#pattern-4-scoped-context-with-di-scoped"><span>Pattern 4: <wbr/>Scoped <wbr/>Context with di-<wbr/>scoped</span></a></li></ul></li><li><a href="#service-registration-flow"><span>Service <wbr/>Registration <wbr/>Flow</span></a></li><li><ul><li><a href="#diagram-cross-cutting-services-in-di-container"><span>Diagram: <wbr/>Cross-<wbr/>Cutting <wbr/>Services in DI <wbr/>Container</span></a></li></ul></li><li><a href="#summary"><span>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
