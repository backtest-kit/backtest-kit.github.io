<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/39_ccxt-integration | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_39_ccxt-integration.html">design/39_ccxt-integration</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="ccxt-integration" class="tsd-anchor"></a><h1 class="tsd-anchor-link">CCXT Integration<a href="#ccxt-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This document explains how Backtest Kit integrates with the CCXT library to fetch market data from cryptocurrency exchanges. CCXT (CryptoCurrency eXchange Trading) serves as the primary data source implementation for the framework, providing historical OHLCV (Open, High, Low, Close, Volume) candle data.</p>
<p>For information about defining custom exchange configurations, see <a href="design_36_exchanges-data-sources.html">Exchange Configuration</a>. For details on candle data structures and validation, see <a href="design_36_exchanges-data-sources.html">Candle Data &amp; Validation</a>.</p>
<hr>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>CCXT is a JavaScript/TypeScript library that provides a unified API for interacting with over 100+ cryptocurrency exchanges. Backtest Kit uses CCXT exclusively for <strong>data fetching</strong>, not for actual trading operations. The framework wraps CCXT's data fetching capabilities within the <code>IExchangeSchema</code> interface, providing a consistent interface regardless of the underlying exchange.</p>
<p><strong>Key Integration Points:</strong></p>
<ul>
<li><strong>Data Source</strong>: CCXT provides historical OHLCV candles via <code>fetchOHLCV</code></li>
<li><strong>Price Formatting</strong>: CCXT exchanges handle symbol-specific price precision</li>
<li><strong>Quantity Formatting</strong>: CCXT exchanges handle symbol-specific quantity precision</li>
<li><strong>No Trading</strong>: Backtest Kit does not use CCXT for order placement or account management</li>
</ul>
<hr>
<a id="architecture-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Integration<a href="#architecture-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="ccxt-in-the-exchange-layer" class="tsd-anchor"></a><h3 class="tsd-anchor-link">CCXT in the Exchange Layer<a href="#ccxt-in-the-exchange-layer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/39_ccxt-integration_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Data Flow:</strong></p>
<ol>
<li>User calls <code>addExchange()</code> with CCXT-based implementation</li>
<li>Schema stored in <code>ExchangeSchemaService</code></li>
<li><code>ClientExchange</code> instance created by <code>ExchangeConnectionService</code></li>
<li>Strategy calls <code>getCandles()</code> → triggers CCXT <code>fetchOHLCV()</code></li>
<li>CCXT returns nested arrays → mapped to <code>ICandleData</code> objects</li>
</ol>
<hr>
<a id="iexchangeschema-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">IExchangeSchema Implementation<a href="#iexchangeschema-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="required-methods" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Required Methods<a href="#required-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>IExchangeSchema</code> interface requires three methods when implementing CCXT integration:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
<th>CCXT Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getCandles</code></td>
<td>Fetch historical OHLCV data</td>
<td><code>exchange.fetchOHLCV()</code></td>
</tr>
<tr>
<td><code>formatPrice</code></td>
<td>Format price to exchange precision</td>
<td><code>exchange.priceToPrecision()</code> or custom</td>
</tr>
<tr>
<td><code>formatQuantity</code></td>
<td>Format quantity to exchange precision</td>
<td><code>exchange.amountToPrecision()</code> or custom</td>
</tr>
</tbody>
</table>
<a id="basic-ccxt-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic CCXT Implementation<a href="#basic-ccxt-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;ccxt&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addExchange</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;backtest-kit&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Fetch candles using CCXT</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">symbol</span><span class="hl-1">,           </span><span class="hl-5">// e.g., &quot;BTCUSDT&quot;</span><br/><span class="hl-1">      </span><span class="hl-4">interval</span><span class="hl-1">,         </span><span class="hl-5">// e.g., &quot;1m&quot;, &quot;5m&quot;, &quot;1h&quot;</span><br/><span class="hl-1">      </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(),  </span><span class="hl-5">// Unix timestamp in milliseconds</span><br/><span class="hl-1">      </span><span class="hl-4">limit</span><span class="hl-1">             </span><span class="hl-5">// Number of candles to fetch</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Map CCXT array format to ICandleData object format</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp</span><span class="hl-1">,  </span><span class="hl-5">// Unix timestamp (ms)</span><br/><span class="hl-1">      </span><span class="hl-4">open</span><span class="hl-1">,       </span><span class="hl-5">// Opening price</span><br/><span class="hl-1">      </span><span class="hl-4">high</span><span class="hl-1">,       </span><span class="hl-5">// Highest price</span><br/><span class="hl-1">      </span><span class="hl-4">low</span><span class="hl-1">,        </span><span class="hl-5">// Lowest price</span><br/><span class="hl-1">      </span><span class="hl-4">close</span><span class="hl-1">,      </span><span class="hl-5">// Closing price</span><br/><span class="hl-1">      </span><span class="hl-4">volume</span><span class="hl-1">      </span><span class="hl-5">// Trading volume</span><br/><span class="hl-1">    }));</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Format price (simple approach)</span><br/><span class="hl-1">  </span><span class="hl-0">formatPrice</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">price</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">2</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Format quantity (simple approach)</span><br/><span class="hl-1">  </span><span class="hl-0">formatQuantity</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">quantity</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">8</span><span class="hl-1">),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="data-format-mapping" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Data Format Mapping<a href="#data-format-mapping" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="ccxt-ohlcv-array-to-icandledata" class="tsd-anchor"></a><h3 class="tsd-anchor-link">CCXT OHLCV Array to ICandleData<a href="#ccxt-ohlcv-array-to-icandledata" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>CCXT returns OHLCV data as nested arrays with a specific structure. Backtest Kit requires object-based <code>ICandleData</code> format for easier manipulation and type safety.</p>
<p><img src="../media/39_ccxt-integration_1.svg" alt="Mermaid Diagram"></p>
<p><strong>CCXT Array Structure:</strong></p>
<pre><code><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-0">timestamp</span><span class="hl-1"> (</span><span class="hl-4">number</span><span class="hl-1">),  </span><span class="hl-5">// Index 0: Unix timestamp in milliseconds</span><br/><span class="hl-1">  </span><span class="hl-0">open</span><span class="hl-1"> (</span><span class="hl-4">number</span><span class="hl-1">),       </span><span class="hl-5">// Index 1: Opening price</span><br/><span class="hl-1">  </span><span class="hl-0">high</span><span class="hl-1"> (</span><span class="hl-4">number</span><span class="hl-1">),       </span><span class="hl-5">// Index 2: Highest price</span><br/><span class="hl-1">  </span><span class="hl-0">low</span><span class="hl-1"> (</span><span class="hl-4">number</span><span class="hl-1">),        </span><span class="hl-5">// Index 3: Lowest price</span><br/><span class="hl-1">  </span><span class="hl-0">close</span><span class="hl-1"> (</span><span class="hl-4">number</span><span class="hl-1">),      </span><span class="hl-5">// Index 4: Closing price</span><br/><span class="hl-1">  </span><span class="hl-0">volume</span><span class="hl-1"> (</span><span class="hl-4">number</span><span class="hl-1">)      </span><span class="hl-5">// Index 5: Trading volume</span><br/><span class="hl-1">]</span>
</code><button>Copy</button></pre>

<p><strong>ICandleData Object Structure:</strong></p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-13">ICandleData</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;  </span><span class="hl-5">// Unix timestamp in milliseconds</span><br/><span class="hl-1">  </span><span class="hl-4">open</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;       </span><span class="hl-5">// Opening price</span><br/><span class="hl-1">  </span><span class="hl-4">high</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;       </span><span class="hl-5">// Highest price</span><br/><span class="hl-1">  </span><span class="hl-4">low</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;        </span><span class="hl-5">// Lowest price</span><br/><span class="hl-1">  </span><span class="hl-4">close</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;      </span><span class="hl-5">// Closing price</span><br/><span class="hl-1">  </span><span class="hl-4">volume</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;     </span><span class="hl-5">// Trading volume</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="exchange-method-parameters" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Exchange Method Parameters<a href="#exchange-method-parameters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="getcandles-parameters" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getCandles Parameters<a href="#getcandles-parameters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>getCandles</code> method receives four parameters that must be passed to CCXT's <code>fetchOHLCV</code>:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
<th>CCXT Mapping</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>symbol</code></td>
<td><code>string</code></td>
<td>Trading pair (e.g., &quot;BTCUSDT&quot;)</td>
<td>Direct pass-through</td>
</tr>
<tr>
<td><code>interval</code></td>
<td><code>CandleInterval</code></td>
<td>Timeframe string (&quot;1m&quot;, &quot;5m&quot;, etc.)</td>
<td>Direct pass-through</td>
</tr>
<tr>
<td><code>since</code></td>
<td><code>Date</code></td>
<td>Start date for data range</td>
<td>Convert to <code>since.getTime()</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>number</code></td>
<td>Maximum candles to fetch</td>
<td>Direct pass-through</td>
</tr>
</tbody>
</table>
<p><strong>Important Notes:</strong></p>
<ul>
<li><strong>Timestamp Conversion</strong>: CCXT expects Unix timestamp in <strong>milliseconds</strong>, so use <code>since.getTime()</code> rather than <code>since</code></li>
<li><strong>Interval Format</strong>: CCXT uses strings like <code>&quot;1m&quot;</code>, <code>&quot;5m&quot;</code>, <code>&quot;1h&quot;</code>, <code>&quot;1d&quot;</code> - same as Backtest Kit's <code>CandleInterval</code> type</li>
<li><strong>Limit Behavior</strong>: Some exchanges have maximum limits (e.g., 1000 candles per request). CCXT handles pagination internally for some methods, but <code>fetchOHLCV</code> typically requires manual pagination</li>
</ul>
<a id="example-with-error-handling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example with Error Handling<a href="#example-with-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-10">getCandles</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">interval</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(),  </span><span class="hl-5">// Convert Date to Unix timestamp (ms)</span><br/><span class="hl-1">      </span><span class="hl-4">limit</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Validate data exists</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">ohlcv</span><span class="hl-1"> || </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-6">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`No candle data returned for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">open</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">high</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">low</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">close</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">volume</span><br/><span class="hl-1">    }));</span><br/><span class="hl-1">  } </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">`CCXT error fetching </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">:`</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="formatter-methods" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Formatter Methods<a href="#formatter-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="formatprice-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">formatPrice Implementation<a href="#formatprice-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>formatPrice</code> method converts numeric prices to exchange-specific precision strings. While a simple <code>toFixed()</code> approach works for testing, production implementations should use CCXT's precision helpers.</p>
<p><strong>Simple Approach (Testing):</strong></p>
<pre><code class="typescript"><span class="hl-10">formatPrice</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">price</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">2</span><span class="hl-1">)</span>
</code><button type="button">Copy</button></pre>

<p><strong>Production Approach (Using CCXT Precision):</strong></p>
<pre><code class="typescript"><span class="hl-10">formatPrice</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">loadMarkets</span><span class="hl-1">();  </span><span class="hl-5">// Load market metadata</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">priceToPrecision</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="formatquantity-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">formatQuantity Implementation<a href="#formatquantity-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>formatQuantity</code> method converts numeric quantities to exchange-specific precision strings.</p>
<p><strong>Simple Approach (Testing):</strong></p>
<pre><code class="typescript"><span class="hl-10">formatQuantity</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">quantity</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">8</span><span class="hl-1">)</span>
</code><button type="button">Copy</button></pre>

<p><strong>Production Approach (Using CCXT Precision):</strong></p>
<pre><code class="typescript"><span class="hl-10">formatQuantity</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">loadMarkets</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">amountToPrecision</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Caching Consideration:</strong>
Since <code>loadMarkets()</code> makes a network request, consider caching the exchange instance:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchangeCache</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Map</span><span class="hl-1">&lt;</span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-13">ccxt</span><span class="hl-1">.</span><span class="hl-13">Exchange</span><span class="hl-1">&gt;();</span><br/><br/><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">getExchange</span><span class="hl-1">(</span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">): </span><span class="hl-13">ccxt</span><span class="hl-1">.</span><span class="hl-13">Exchange</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">exchangeCache</span><span class="hl-1">.</span><span class="hl-0">has</span><span class="hl-1">(</span><span class="hl-4">exchangeName</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeCache</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-4">exchange</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">exchangeCache</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-4">exchangeName</span><span class="hl-1">)!;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-0">getExchange</span><span class="hl-1">(</span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// ... rest of implementation</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">formatPrice</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-0">getExchange</span><span class="hl-1">(</span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">loadMarkets</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">priceToPrecision</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">formatQuantity</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-0">getExchange</span><span class="hl-1">(</span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">loadMarkets</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">amountToPrecision</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="optimizer-template-generation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Optimizer Template Generation<a href="#optimizer-template-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="auto-generated-ccxt-code" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Auto-Generated CCXT Code<a href="#auto-generated-ccxt-code" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>OptimizerTemplateService</code> automatically generates CCXT integration code when creating strategy files. This ensures consistency across optimizer-generated strategies.</p>
<p><img src="../media/39_ccxt-integration_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Template Implementation:</strong></p>
<p>The <code>getExchangeTemplate</code> method in <code>src/lib/services/template/OptimizerTemplateService.ts:314-342</code> generates:</p>
<pre><code class="typescript"><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;${escapedExchangeName}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(), </span><span class="hl-4">limit</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">            </span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><br/><span class="hl-1">        }));</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">formatPrice</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">price</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">2</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-0">formatQuantity</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">quantity</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">8</span><span class="hl-1">),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Code Injection Protection</strong>: Uses <code>escapedExchangeName</code> to prevent malicious input <code>src/lib/services/template/OptimizerTemplateService.ts:324-326</code></li>
<li><strong>Hardcoded Binance</strong>: Currently generates Binance-specific code (could be parameterized in future)</li>
<li><strong>Simple Formatters</strong>: Uses basic <code>toFixed()</code> for price/quantity formatting</li>
</ul>
<hr>
<a id="multi-exchange-support" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Multi-Exchange Support<a href="#multi-exchange-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="using-different-ccxt-exchanges" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using Different CCXT Exchanges<a href="#using-different-ccxt-exchanges" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>CCXT supports 100+ exchanges. To use a different exchange, simply change the constructor:</p>
<pre><code class="typescript"><span class="hl-5">// Binance</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// Kraken</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">kraken</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// Coinbase Pro</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">coinbasepro</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// FTX (if available)</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">ftx</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="exchange-specific-configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Exchange-Specific Configuration<a href="#exchange-specific-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Some exchanges require API credentials even for public data:</p>
<pre><code class="typescript"><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&#39;kraken&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">kraken</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">apiKey:</span><span class="hl-1"> </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-8">KRAKEN_API_KEY</span><span class="hl-1">,       </span><span class="hl-5">// Optional for public data</span><br/><span class="hl-1">      </span><span class="hl-4">secret:</span><span class="hl-1"> </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-8">KRAKEN_SECRET</span><span class="hl-1">,        </span><span class="hl-5">// Optional for public data</span><br/><span class="hl-1">      </span><span class="hl-4">enableRateLimit:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">,                     </span><span class="hl-5">// Recommended</span><br/><span class="hl-1">      </span><span class="hl-4">timeout:</span><span class="hl-1"> </span><span class="hl-6">30000</span><span class="hl-1">                             </span><span class="hl-5">// 30 second timeout</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(), </span><span class="hl-4">limit</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><br/><span class="hl-1">    }));</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... formatters</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="handling-exchange-rate-limits" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Handling Exchange Rate Limits<a href="#handling-exchange-rate-limits" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>CCXT provides built-in rate limiting:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">enableRateLimit:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">,  </span><span class="hl-5">// Automatically throttle requests</span><br/><span class="hl-1">  </span><span class="hl-4">rateLimit:</span><span class="hl-1"> </span><span class="hl-6">1200</span><span class="hl-1">         </span><span class="hl-5">// Milliseconds between requests (optional)</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Backtest Considerations:</strong></p>
<ul>
<li>During backtests, <code>getCandles</code> may be called thousands of times</li>
<li>Enable <code>enableRateLimit</code> to avoid hitting exchange API limits</li>
<li>Consider implementing a caching layer for frequently accessed data</li>
<li>Use the framework's built-in candle buffering (handled by <code>ClientExchange</code>)</li>
</ul>
<hr>
<a id="common-patterns-and-best-practices" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Common Patterns and Best Practices<a href="#common-patterns-and-best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="pattern-1-singleton-exchange-instance" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 1: Singleton Exchange Instance<a href="#pattern-1-singleton-exchange-instance" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Create exchange instances once and reuse them:</p>
<pre><code class="typescript"><span class="hl-7">let</span><span class="hl-1"> </span><span class="hl-4">exchangeInstance</span><span class="hl-1">: </span><span class="hl-13">ccxt</span><span class="hl-1">.</span><span class="hl-13">Exchange</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1"> = </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">exchangeInstance</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">exchangeInstance</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">enableRateLimit:</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchangeInstance</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(), </span><span class="hl-4">limit</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><br/><span class="hl-1">    }));</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... formatters</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="pattern-2-symbol-normalization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 2: Symbol Normalization<a href="#pattern-2-symbol-normalization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Different exchanges use different symbol formats:</p>
<pre><code class="typescript"><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">normalizeSymbol</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">): </span><span class="hl-13">string</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Binance uses &quot;BTCUSDT&quot;, Kraken uses &quot;BTC/USDT&quot;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">exchangeName</span><span class="hl-1"> === </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">symbol</span><span class="hl-1">.</span><span class="hl-0">replace</span><span class="hl-1">(</span><span class="hl-2">&#39;/&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">);  </span><span class="hl-5">// BTC/USDT -&gt; BTCUSDT</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">exchangeName</span><span class="hl-1"> === </span><span class="hl-2">&#39;kraken&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">symbol</span><span class="hl-1">.</span><span class="hl-0">includes</span><span class="hl-1">(</span><span class="hl-2">&#39;/&#39;</span><span class="hl-1">) ? </span><span class="hl-4">symbol</span><span class="hl-1"> : </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-9">.</span><span class="hl-0">slice</span><span class="hl-9">(</span><span class="hl-6">0</span><span class="hl-9">, </span><span class="hl-1">-</span><span class="hl-6">4</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">/</span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-9">.</span><span class="hl-0">slice</span><span class="hl-9">(</span><span class="hl-1">-</span><span class="hl-6">4</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">symbol</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">normalizedSymbol</span><span class="hl-1"> = </span><span class="hl-0">normalizeSymbol</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// ... rest of implementation</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... formatters</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="pattern-3-error-recovery-with-retries" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 3: Error Recovery with Retries<a href="#pattern-3-error-recovery-with-retries" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Implement retry logic for network failures:</p>
<pre><code class="typescript"><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">fetchWithRetry</span><span class="hl-1">&lt;</span><span class="hl-13">T</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">  </span><span class="hl-0">fn</span><span class="hl-1">: () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">&lt;</span><span class="hl-13">T</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-4">retries</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> = </span><span class="hl-6">3</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">delay</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> = </span><span class="hl-6">1000</span><br/><span class="hl-1">): </span><span class="hl-13">Promise</span><span class="hl-1">&lt;</span><span class="hl-13">T</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fn</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">retries</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">(</span><span class="hl-4">resolve</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-0">setTimeout</span><span class="hl-1">(</span><span class="hl-4">resolve</span><span class="hl-1">, </span><span class="hl-4">delay</span><span class="hl-1">));</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">fetchWithRetry</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">, </span><span class="hl-4">retries</span><span class="hl-1"> - </span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-4">delay</span><span class="hl-1"> * </span><span class="hl-6">2</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">({ </span><span class="hl-4">enableRateLimit:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchWithRetry</span><span class="hl-1">(() </span><span class="hl-7">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(), </span><span class="hl-4">limit</span><span class="hl-1">)</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><br/><span class="hl-1">    }));</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... formatters</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="interval-mapping" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Interval Mapping<a href="#interval-mapping" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="supported-timeframes" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Supported Timeframes<a href="#supported-timeframes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>CCXT and Backtest Kit both use string-based interval notation. Common intervals:</p>
<table>
<thead>
<tr>
<th>Interval</th>
<th>Description</th>
<th>Typical Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&quot;1m&quot;</code></td>
<td>1 minute</td>
<td>High-frequency strategies</td>
</tr>
<tr>
<td><code>&quot;5m&quot;</code></td>
<td>5 minutes</td>
<td>Intraday trading</td>
</tr>
<tr>
<td><code>&quot;15m&quot;</code></td>
<td>15 minutes</td>
<td>Short-term analysis</td>
</tr>
<tr>
<td><code>&quot;1h&quot;</code></td>
<td>1 hour</td>
<td>Medium-term trends</td>
</tr>
<tr>
<td><code>&quot;4h&quot;</code></td>
<td>4 hours</td>
<td>Swing trading</td>
</tr>
<tr>
<td><code>&quot;1d&quot;</code></td>
<td>1 day</td>
<td>Long-term analysis</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Not all exchanges support all intervals. Check CCXT documentation for exchange-specific limitations.</p>
<a id="validating-interval-support" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validating Interval Support<a href="#validating-interval-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Load markets to check supported timeframes</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">loadMarkets</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">market</span><span class="hl-1"> = </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">market</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">market</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">market</span><span class="hl-1">.</span><span class="hl-4">timeframes</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">market</span><span class="hl-1">.</span><span class="hl-4">timeframes</span><span class="hl-1">.</span><span class="hl-0">includes</span><span class="hl-1">(</span><span class="hl-4">interval</span><span class="hl-1">)) {</span><br/><span class="hl-1">      </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-2">`Interval </span><span class="hl-7">${</span><span class="hl-4">interval</span><span class="hl-7">}</span><span class="hl-2"> not supported for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> on </span><span class="hl-7">${</span><span class="hl-4">exchange</span><span class="hl-9">.</span><span class="hl-4">name</span><span class="hl-7">}</span><span class="hl-2">`</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(), </span><span class="hl-4">limit</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><br/><span class="hl-1">    }));</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... formatters</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="testing-and-debugging" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Testing and Debugging<a href="#testing-and-debugging" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="logging-ccxt-requests" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Logging CCXT Requests<a href="#logging-ccxt-requests" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Enable verbose logging to debug data fetching issues:</p>
<pre><code class="typescript"><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">enableRateLimit:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">verbose:</span><span class="hl-1"> </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-8">DEBUG</span><span class="hl-1"> === </span><span class="hl-2">&#39;true&#39;</span><span class="hl-1">  </span><span class="hl-5">// Enable in .env</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Fetching </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> </span><span class="hl-7">${</span><span class="hl-4">interval</span><span class="hl-7">}</span><span class="hl-2"> from </span><span class="hl-7">${</span><span class="hl-4">since</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2">, limit=</span><span class="hl-7">${</span><span class="hl-4">limit</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(), </span><span class="hl-4">limit</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Received </span><span class="hl-7">${</span><span class="hl-4">ohlcv</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> candles`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><br/><span class="hl-1">    }));</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... formatters</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="validating-data-quality" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validating Data Quality<a href="#validating-data-quality" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Check for common data issues:</p>
<pre><code class="typescript"><span class="hl-10">getCandles</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(), </span><span class="hl-4">limit</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Validate data</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles</span><span class="hl-1"> = </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Check for invalid prices</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">open</span><span class="hl-1"> &lt;= </span><span class="hl-6">0</span><span class="hl-1"> || </span><span class="hl-4">high</span><span class="hl-1"> &lt;= </span><span class="hl-6">0</span><span class="hl-1"> || </span><span class="hl-4">low</span><span class="hl-1"> &lt;= </span><span class="hl-6">0</span><span class="hl-1"> || </span><span class="hl-4">close</span><span class="hl-1"> &lt;= </span><span class="hl-6">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Invalid prices for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> at </span><span class="hl-7">${</span><span class="hl-4">timestamp</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Check OHLC relationship</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">high</span><span class="hl-1"> &lt; </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">max</span><span class="hl-1">(</span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">) || </span><span class="hl-4">low</span><span class="hl-1"> &gt; </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">min</span><span class="hl-1">(</span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">)) {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`OHLC inconsistency for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> at </span><span class="hl-7">${</span><span class="hl-4">timestamp</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> { </span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1"> };</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">candles</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="common-issues-and-solutions" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Common Issues and Solutions<a href="#common-issues-and-solutions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="issue-1-rate-limit-exceeded" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Issue 1: Rate Limit Exceeded<a href="#issue-1-rate-limit-exceeded" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Problem:</strong> CCXT throws <code>RateLimitExceeded</code> error during backtests.</p>
<p><strong>Solution:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">enableRateLimit:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">,  </span><span class="hl-5">// Enable automatic throttling</span><br/><span class="hl-1">  </span><span class="hl-4">rateLimit:</span><span class="hl-1"> </span><span class="hl-6">2000</span><span class="hl-1">         </span><span class="hl-5">// Increase delay between requests</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="issue-2-missing-candles" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Issue 2: Missing Candles<a href="#issue-2-missing-candles" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Problem:</strong> CCXT returns fewer candles than requested <code>limit</code>.</p>
<p><strong>Explanation:</strong> Exchanges may not have data for the entire requested range, especially for recent listings or delisted pairs.</p>
<p><strong>Solution:</strong> Handle partial data gracefully:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(), </span><span class="hl-4">limit</span><span class="hl-1">);</span><br/><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &lt; </span><span class="hl-4">limit</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Only </span><span class="hl-7">${</span><span class="hl-4">ohlcv</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> of </span><span class="hl-7">${</span><span class="hl-4">limit</span><span class="hl-7">}</span><span class="hl-2"> candles available`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Framework handles incomplete data via anomaly detection (see page 8.2)</span><br/><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-5">/* ... */</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="issue-3-symbol-not-found" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Issue 3: Symbol Not Found<a href="#issue-3-symbol-not-found" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Problem:</strong> Exchange throws &quot;symbol not found&quot; error.</p>
<p><strong>Solution:</strong> Load markets first and validate symbol exists:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">loadMarkets</span><span class="hl-1">();</span><br/><br/><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-4">has</span><span class="hl-1">[</span><span class="hl-4">symbol</span><span class="hl-1">]) {</span><br/><span class="hl-1">  </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`Symbol </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> not found on </span><span class="hl-7">${</span><span class="hl-4">exchange</span><span class="hl-9">.</span><span class="hl-4">name</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="issue-4-timestamp-mismatch" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Issue 4: Timestamp Mismatch<a href="#issue-4-timestamp-mismatch" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Problem:</strong> Candle timestamps don't align with requested <code>since</code> date.</p>
<p><strong>Explanation:</strong> Exchanges return candles aligned to interval boundaries. Requesting data from <code>2024-01-01 14:23:00</code> with <code>1h</code> interval will return candles starting at <code>2024-01-01 14:00:00</code>.</p>
<p><strong>Solution:</strong> This is expected behavior. The framework's time execution engine handles alignment automatically.</p>
<hr>
<a id="integration-with-optimizer" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Optimizer<a href="#integration-with-optimizer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Optimizer system automatically generates CCXT integration code for strategy backtests. When you define an optimizer schema with <code>addOptimizer()</code>, the generated <code>.mjs</code> file includes a complete CCXT exchange configuration.</p>
<a id="generated-code-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Generated Code Structure<a href="#generated-code-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/39_ccxt-integration_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Generated Exchange Code:</strong></p>
<p>From <code>src/lib/services/template/OptimizerTemplateService.ts:314-342</code>, the optimizer generates:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;ccxt&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;abc123_exchange&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchange</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(), </span><span class="hl-4">limit</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">            </span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><br/><span class="hl-1">        }));</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">formatPrice</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">price</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">2</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-0">formatQuantity</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">quantity</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">8</span><span class="hl-1">),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Customizing Generated Exchange:</strong></p>
<p>To use a different exchange in generated code, override the <code>getExchangeTemplate</code> method:</p>
<pre><code class="typescript"><span class="hl-0">addOptimizer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-optimizer&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">// ... other config</span><br/><span class="hl-1">  </span><span class="hl-4">template:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">getExchangeTemplate</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`</span><br/><span class="hl-2">        addExchange({</span><br/><span class="hl-2">          exchangeName: &quot;</span><span class="hl-7">${</span><span class="hl-4">exchangeName</span><span class="hl-7">}</span><span class="hl-2">&quot;,</span><br/><span class="hl-2">          getCandles: async (symbol, interval, since, limit) =&gt; {</span><br/><span class="hl-2">            const exchange = new ccxt.kraken();  // Use Kraken instead</span><br/><span class="hl-2">            const ohlcv = await exchange.fetchOHLCV(symbol, interval, since.getTime(), limit);</span><br/><span class="hl-2">            return ohlcv.map(([timestamp, open, high, low, close, volume]) =&gt; ({</span><br/><span class="hl-2">              timestamp, open, high, low, close, volume</span><br/><span class="hl-2">            }));</span><br/><span class="hl-2">          },</span><br/><span class="hl-2">          formatPrice: async (symbol, price) =&gt; price.toFixed(2),</span><br/><span class="hl-2">          formatQuantity: async (symbol, quantity) =&gt; quantity.toFixed(8),</span><br/><span class="hl-2">        });</span><br/><span class="hl-2">      `</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Summary<a href="#summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>CCXT integration in Backtest Kit provides:</p>
<ol>
<li><strong>Unified Data Access</strong>: Single interface (<code>IExchangeSchema</code>) wraps CCXT's exchange-specific implementations</li>
<li><strong>Automatic Mapping</strong>: CCXT's array-based OHLCV data automatically mapped to framework's object-based <code>ICandleData</code></li>
<li><strong>Multi-Exchange Support</strong>: Easy switching between 100+ exchanges by changing constructor</li>
<li><strong>Optimizer Integration</strong>: Auto-generated CCXT code in optimizer-produced strategies</li>
<li><strong>Production Ready</strong>: Built-in rate limiting, error handling, and retry logic support</li>
</ol>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>CCXT is used <strong>only for data fetching</strong>, not trading</li>
<li>Always enable rate limiting with <code>enableRateLimit: true</code></li>
<li>Use <code>since.getTime()</code> to convert Date to milliseconds</li>
<li>Implement exchange instance caching for better performance</li>
<li>Override optimizer templates to customize generated exchange code</li>
</ul>
<p>For advanced exchange configuration patterns, see <a href="design_36_exchanges-data-sources.html">Exchange Configuration</a>. For data validation and anomaly detection, see <a href="design_36_exchanges-data-sources.html">Candle Data &amp; Validation</a>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#ccxt-integration"><span>CCXT <wbr/>Integration</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#architecture-integration"><span>Architecture <wbr/>Integration</span></a></li><li><ul><li><a href="#ccxt-in-the-exchange-layer"><span>CCXT in the <wbr/>Exchange <wbr/>Layer</span></a></li></ul></li><li><a href="#iexchangeschema-implementation"><span>IExchange<wbr/>Schema <wbr/>Implementation</span></a></li><li><ul><li><a href="#required-methods"><span>Required <wbr/>Methods</span></a></li><li><a href="#basic-ccxt-implementation"><span>Basic CCXT <wbr/>Implementation</span></a></li></ul></li><li><a href="#data-format-mapping"><span>Data <wbr/>Format <wbr/>Mapping</span></a></li><li><ul><li><a href="#ccxt-ohlcv-array-to-icandledata"><span>CCXT OHLCV <wbr/>Array to ICandle<wbr/>Data</span></a></li></ul></li><li><a href="#exchange-method-parameters"><span>Exchange <wbr/>Method <wbr/>Parameters</span></a></li><li><ul><li><a href="#getcandles-parameters"><span>get<wbr/>Candles <wbr/>Parameters</span></a></li><li><a href="#example-with-error-handling"><span>Example with <wbr/>Error <wbr/>Handling</span></a></li></ul></li><li><a href="#formatter-methods"><span>Formatter <wbr/>Methods</span></a></li><li><ul><li><a href="#formatprice-implementation"><span>format<wbr/>Price <wbr/>Implementation</span></a></li><li><a href="#formatquantity-implementation"><span>format<wbr/>Quantity <wbr/>Implementation</span></a></li></ul></li><li><a href="#optimizer-template-generation"><span>Optimizer <wbr/>Template <wbr/>Generation</span></a></li><li><ul><li><a href="#auto-generated-ccxt-code"><span>Auto-<wbr/>Generated CCXT <wbr/>Code</span></a></li></ul></li><li><a href="#multi-exchange-support"><span>Multi-<wbr/>Exchange <wbr/>Support</span></a></li><li><ul><li><a href="#using-different-ccxt-exchanges"><span>Using <wbr/>Different CCXT <wbr/>Exchanges</span></a></li><li><a href="#exchange-specific-configuration"><span>Exchange-<wbr/>Specific <wbr/>Configuration</span></a></li><li><a href="#handling-exchange-rate-limits"><span>Handling <wbr/>Exchange <wbr/>Rate <wbr/>Limits</span></a></li></ul></li><li><a href="#common-patterns-and-best-practices"><span>Common <wbr/>Patterns and <wbr/>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#pattern-1-singleton-exchange-instance"><span>Pattern 1: <wbr/>Singleton <wbr/>Exchange <wbr/>Instance</span></a></li><li><a href="#pattern-2-symbol-normalization"><span>Pattern 2: <wbr/>Symbol <wbr/>Normalization</span></a></li><li><a href="#pattern-3-error-recovery-with-retries"><span>Pattern 3: <wbr/>Error <wbr/>Recovery with <wbr/>Retries</span></a></li></ul></li><li><a href="#interval-mapping"><span>Interval <wbr/>Mapping</span></a></li><li><ul><li><a href="#supported-timeframes"><span>Supported <wbr/>Timeframes</span></a></li><li><a href="#validating-interval-support"><span>Validating <wbr/>Interval <wbr/>Support</span></a></li></ul></li><li><a href="#testing-and-debugging"><span>Testing and <wbr/>Debugging</span></a></li><li><ul><li><a href="#logging-ccxt-requests"><span>Logging CCXT <wbr/>Requests</span></a></li><li><a href="#validating-data-quality"><span>Validating <wbr/>Data <wbr/>Quality</span></a></li></ul></li><li><a href="#common-issues-and-solutions"><span>Common <wbr/>Issues and <wbr/>Solutions</span></a></li><li><ul><li><a href="#issue-1-rate-limit-exceeded"><span>Issue 1: <wbr/>Rate <wbr/>Limit <wbr/>Exceeded</span></a></li><li><a href="#issue-2-missing-candles"><span>Issue 2: <wbr/>Missing <wbr/>Candles</span></a></li><li><a href="#issue-3-symbol-not-found"><span>Issue 3: <wbr/>Symbol <wbr/>Not <wbr/>Found</span></a></li><li><a href="#issue-4-timestamp-mismatch"><span>Issue 4: <wbr/>Timestamp <wbr/>Mismatch</span></a></li></ul></li><li><a href="#integration-with-optimizer"><span>Integration with <wbr/>Optimizer</span></a></li><li><ul><li><a href="#generated-code-structure"><span>Generated <wbr/>Code <wbr/>Structure</span></a></li></ul></li><li><a href="#summary"><span>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
