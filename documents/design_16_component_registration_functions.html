<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/16_component_registration_functions | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_16_component_registration_functions.html">design/16_component_registration_functions</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="component-registration-functions" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Component Registration Functions<a href="#component-registration-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents the public API functions for registering and retrieving component schemas in the framework. These functions enable users to define strategies, exchanges, frames, risk profiles, sizing methods, and walkers that the framework uses during execution.</p>
<p>For conceptual information about component registration, see <a href="design_08_component_registration.html">Component Registration</a>. For detailed schema interfaces and their properties, see <a href="design_23_component_types.html">Component Types</a>.</p>
<hr>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides six registration functions (<code>add*</code>) and corresponding listing functions (<code>list*</code>) that manage component schemas:</p>
<table>
<thead>
<tr>
<th>Registration Function</th>
<th>Listing Function</th>
<th>Schema Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>addStrategy()</code></td>
<td><code>listStrategies()</code></td>
<td><code>IStrategySchema</code></td>
<td>Register signal generation logic</td>
</tr>
<tr>
<td><code>addExchange()</code></td>
<td><code>listExchanges()</code></td>
<td><code>IExchangeSchema</code></td>
<td>Register market data source</td>
</tr>
<tr>
<td><code>addFrame()</code></td>
<td><code>listFrames()</code></td>
<td><code>IFrameSchema</code></td>
<td>Register backtest timeframe</td>
</tr>
<tr>
<td><code>addRisk()</code></td>
<td><code>listRisks()</code></td>
<td><code>IRiskSchema</code></td>
<td>Register risk management rules</td>
</tr>
<tr>
<td><code>addSizing()</code></td>
<td><code>listSizings()</code></td>
<td><code>ISizingSchema</code></td>
<td>Register position sizing method</td>
</tr>
<tr>
<td><code>addWalker()</code></td>
<td><code>listWalkers()</code></td>
<td><code>IWalkerSchema</code></td>
<td>Register multi-strategy comparison</td>
</tr>
</tbody>
</table>
<p>All registration functions perform two operations:</p>
<ol>
<li><strong>Validation</strong>: Store schema in <code>*ValidationService</code> for runtime validation checks</li>
<li><strong>Storage</strong>: Store schema in <code>*SchemaService</code> for retrieval by name</li>
</ol>
<hr>
<a id="registration-flow-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Registration Flow Architecture<a href="#registration-flow-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/16_Component_Registration_Functions_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Registration Flow</strong>:</p>
<ol>
<li>User calls <code>addStrategy()</code>, <code>addExchange()</code>, etc. with schema object</li>
<li>Function logs operation via <code>backtest.loggerService</code></li>
<li>Schema stored in <code>*ValidationService</code> for runtime validation</li>
<li>Schema stored in <code>*SchemaService</code> for retrieval by name</li>
<li>During execution, <code>*ConnectionService</code> retrieves schema from <code>*SchemaService</code></li>
<li><code>Client*</code> class instantiated with retrieved schema</li>
</ol>
<hr>
<a id="service-architecture-mapping" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Architecture Mapping<a href="#service-architecture-mapping" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/16_Component_Registration_Functions_1.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="addstrategy" class="tsd-anchor"></a><h2 class="tsd-anchor-link">addStrategy()<a href="#addstrategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Registers a trading strategy schema defining signal generation logic, interval throttling, and lifecycle callbacks.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">addStrategy</span><span class="hl-1">(</span><span class="hl-4">strategySchema</span><span class="hl-1">: </span><span class="hl-10">IStrategySchema</span><span class="hl-1">): </span><span class="hl-10">void</span>
</code><button type="button">Copy</button></pre>

<p><strong>Parameters</strong>:</p>
<ul>
<li><code>strategySchema.strategyName</code> (string): Unique strategy identifier</li>
<li><code>strategySchema.interval</code> (SignalInterval): Throttling interval (&quot;1m&quot; | &quot;3m&quot; | &quot;5m&quot; | &quot;15m&quot; | &quot;30m&quot; | &quot;1h&quot;)</li>
<li><code>strategySchema.getSignal</code> (function): Async function returning <code>ISignalDto | null</code></li>
<li><code>strategySchema.riskName</code> (string, optional): Risk profile to use</li>
<li><code>strategySchema.callbacks</code> (object, optional): Lifecycle callbacks (onOpen, onClose, onTick, etc.)</li>
<li><code>strategySchema.note</code> (string, optional): Developer documentation</li>
</ul>
<p>For detailed <code>IStrategySchema</code> documentation, see <a href="design_24_strategy_schemas.html">Strategy Schemas</a>.</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;momentum-long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">candles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">, </span><span class="hl-8">20</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// Signal generation logic...</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-8">51000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-8">49000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-8">60</span><span class="hl-1">,</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onOpen</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal opened: </span><span class="hl-6">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Internal Flow</strong>:</p>
<ol>
<li>Log via <code>backtest.loggerService.info()</code></li>
<li>Store in <code>StrategyValidationService</code> via <code>addStrategy(name, schema)</code></li>
<li>Store in <code>StrategySchemaService</code> via <code>register(name, schema)</code></li>
</ol>
<hr>
<a id="liststrategies" class="tsd-anchor"></a><h2 class="tsd-anchor-link">listStrategies()<a href="#liststrategies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Returns array of all registered strategy schemas.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">listStrategies</span><span class="hl-1">(): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">IStrategySchema</span><span class="hl-1">[]&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Returns</strong>: Array of strategy schemas with all properties (strategyName, interval, getSignal, callbacks, etc.)</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">strategies</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">listStrategies</span><span class="hl-1">();</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">strategies</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">));</span><br/><span class="hl-5">// [&quot;momentum-long&quot;, &quot;mean-reversion&quot;, &quot;breakout-v2&quot;]</span>
</code><button type="button">Copy</button></pre>

<p><strong>Internal Flow</strong>: Delegates to <code>backtest.strategyValidationService.list()</code> which returns all registered schemas.</p>
<hr>
<a id="addexchange" class="tsd-anchor"></a><h2 class="tsd-anchor-link">addExchange()<a href="#addexchange" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Registers an exchange data source providing candle data, price formatting, and quantity formatting.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">addExchange</span><span class="hl-1">(</span><span class="hl-4">exchangeSchema</span><span class="hl-1">: </span><span class="hl-10">IExchangeSchema</span><span class="hl-1">): </span><span class="hl-10">void</span>
</code><button type="button">Copy</button></pre>

<p><strong>Parameters</strong>:</p>
<ul>
<li><code>exchangeSchema.exchangeName</code> (string): Unique exchange identifier</li>
<li><code>exchangeSchema.getCandles</code> (function): Fetch historical candle data</li>
<li><code>exchangeSchema.formatPrice</code> (function): Format price for exchange precision</li>
<li><code>exchangeSchema.formatQuantity</code> (function): Format quantity for exchange precision</li>
<li><code>exchangeSchema.callbacks</code> (object, optional): Lifecycle callbacks (onCandleData)</li>
<li><code>exchangeSchema.note</code> (string, optional): Developer documentation</li>
</ul>
<p>For detailed <code>IExchangeSchema</code> documentation, see <a href="design_25_exchange_schemas.html">Exchange Schemas</a>.</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance-spot&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Fetch from Binance API or database</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> [{</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">(),</span><br/><span class="hl-1">      </span><span class="hl-4">open:</span><span class="hl-1"> </span><span class="hl-8">50000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">high:</span><span class="hl-1"> </span><span class="hl-8">51000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">low:</span><span class="hl-1"> </span><span class="hl-8">49000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">close:</span><span class="hl-1"> </span><span class="hl-8">50500</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">volume:</span><span class="hl-1"> </span><span class="hl-8">100.5</span><span class="hl-1">,</span><br/><span class="hl-1">    }];</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">formatPrice</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">price</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-8">2</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">formatQuantity</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">quantity</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-8">8</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Internal Flow</strong>:</p>
<ol>
<li>Log via <code>backtest.loggerService.info()</code></li>
<li>Store in <code>ExchangeValidationService</code> via <code>addExchange(name, schema)</code></li>
<li>Store in <code>ExchangeSchemaService</code> via <code>register(name, schema)</code></li>
</ol>
<hr>
<a id="listexchanges" class="tsd-anchor"></a><h2 class="tsd-anchor-link">listExchanges()<a href="#listexchanges" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Returns array of all registered exchange schemas.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">listExchanges</span><span class="hl-1">(): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">IExchangeSchema</span><span class="hl-1">[]&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Returns</strong>: Array of exchange schemas with all properties (exchangeName, getCandles, formatPrice, formatQuantity, callbacks)</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">exchanges</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">listExchanges</span><span class="hl-1">();</span><br/><span class="hl-4">exchanges</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">(</span><span class="hl-4">ex</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Exchange: </span><span class="hl-6">${</span><span class="hl-4">ex</span><span class="hl-9">.</span><span class="hl-4">exchangeName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">ex</span><span class="hl-1">.</span><span class="hl-4">note</span><span class="hl-1">) </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Note: </span><span class="hl-6">${</span><span class="hl-4">ex</span><span class="hl-9">.</span><span class="hl-4">note</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="addframe" class="tsd-anchor"></a><h2 class="tsd-anchor-link">addFrame()<a href="#addframe" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Registers a timeframe generator for backtesting, defining start/end dates and interval for timestamp generation.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">addFrame</span><span class="hl-1">(</span><span class="hl-4">frameSchema</span><span class="hl-1">: </span><span class="hl-10">IFrameSchema</span><span class="hl-1">): </span><span class="hl-10">void</span>
</code><button type="button">Copy</button></pre>

<p><strong>Parameters</strong>:</p>
<ul>
<li><code>frameSchema.frameName</code> (string): Unique frame identifier</li>
<li><code>frameSchema.interval</code> (FrameInterval): Timeframe interval (&quot;1m&quot; | &quot;3m&quot; | &quot;5m&quot; | &quot;15m&quot; | &quot;30m&quot; | &quot;1h&quot; | &quot;2h&quot; | &quot;4h&quot; | &quot;6h&quot; | &quot;8h&quot; | &quot;12h&quot; | &quot;1d&quot; | &quot;3d&quot;)</li>
<li><code>frameSchema.startDate</code> (Date): Backtest period start (inclusive)</li>
<li><code>frameSchema.endDate</code> (Date): Backtest period end (inclusive)</li>
<li><code>frameSchema.callbacks</code> (object, optional): Lifecycle callbacks (onTimeframe)</li>
<li><code>frameSchema.note</code> (string, optional): Developer documentation</li>
</ul>
<p>For detailed <code>IFrameSchema</code> documentation, see <a href="design_26_frame_schemas.html">Frame Schemas</a>.</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;jan-2024&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-31T23:59:59Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onTimeframe</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">timeframe</span><span class="hl-1">, </span><span class="hl-4">start</span><span class="hl-1">, </span><span class="hl-4">end</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-6">${</span><span class="hl-4">timeframe</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> timestamps`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Internal Flow</strong>:</p>
<ol>
<li>Log via <code>backtest.loggerService.info()</code></li>
<li>Store in <code>FrameValidationService</code> via <code>addFrame(name, schema)</code></li>
<li>Store in <code>FrameSchemaService</code> via <code>register(name, schema)</code></li>
</ol>
<hr>
<a id="listframes" class="tsd-anchor"></a><h2 class="tsd-anchor-link">listFrames()<a href="#listframes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Returns array of all registered frame schemas.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">listFrames</span><span class="hl-1">(): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">IFrameSchema</span><span class="hl-1">[]&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Returns</strong>: Array of frame schemas with all properties (frameName, interval, startDate, endDate, callbacks)</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">frames</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">listFrames</span><span class="hl-1">();</span><br/><span class="hl-4">frames</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">(</span><span class="hl-4">frame</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Frame: </span><span class="hl-6">${</span><span class="hl-4">frame</span><span class="hl-9">.</span><span class="hl-4">frameName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Period: </span><span class="hl-6">${</span><span class="hl-4">frame</span><span class="hl-9">.</span><span class="hl-4">startDate</span><span class="hl-6">}</span><span class="hl-2"> to </span><span class="hl-6">${</span><span class="hl-4">frame</span><span class="hl-9">.</span><span class="hl-4">endDate</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Interval: </span><span class="hl-6">${</span><span class="hl-4">frame</span><span class="hl-9">.</span><span class="hl-4">interval</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="addrisk" class="tsd-anchor"></a><h2 class="tsd-anchor-link">addRisk()<a href="#addrisk" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Registers a risk management configuration with custom validation functions and portfolio-level position limits.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">addRisk</span><span class="hl-1">(</span><span class="hl-4">riskSchema</span><span class="hl-1">: </span><span class="hl-10">IRiskSchema</span><span class="hl-1">): </span><span class="hl-10">void</span>
</code><button type="button">Copy</button></pre>

<p><strong>Parameters</strong>:</p>
<ul>
<li><code>riskSchema.riskName</code> (string): Unique risk profile identifier</li>
<li><code>riskSchema.validations</code> (array): Custom validation functions with access to active positions</li>
<li><code>riskSchema.callbacks</code> (object, optional): Lifecycle callbacks (onRejected, onAllowed)</li>
<li><code>riskSchema.note</code> (string, optional): Developer documentation</li>
</ul>
<p>For detailed <code>IRiskSchema</code> documentation and validation patterns, see <a href="design_27_risk_schemas.html">Risk Schemas</a>.</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;advanced&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-0">validate</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1">, </span><span class="hl-4">activePositions</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">// Check portfolio-level constraints</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-8">10</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Max 10 concurrent positions&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Check correlation between active positions</span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">symbols</span><span class="hl-1"> = </span><span class="hl-4">activePositions</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">p</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">p</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-0">hasHighCorrelation</span><span class="hl-1">(</span><span class="hl-4">symbols</span><span class="hl-1">)) {</span><br/><span class="hl-1">          </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;High correlation between positions&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Limit concurrent positions and correlation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Quick validation without note</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">currentPrice</span><span class="hl-1"> &lt; </span><span class="hl-8">1000</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Price too low for this risk profile&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onRejected</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal rejected for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Internal Flow</strong>:</p>
<ol>
<li>Log via <code>backtest.loggerService.info()</code></li>
<li>Store in <code>RiskValidationService</code> via <code>addRisk(name, schema)</code></li>
<li>Store in <code>RiskSchemaService</code> via <code>register(name, schema)</code></li>
</ol>
<p><strong>Cross-Strategy Risk Sharing</strong>: Multiple strategies can reference the same <code>riskName</code>. The framework creates a single <code>ClientRisk</code> instance per <code>riskName</code>, enabling portfolio-level risk management across strategies.</p>
<hr>
<a id="listrisks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">listRisks()<a href="#listrisks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Returns array of all registered risk schemas.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">listRisks</span><span class="hl-1">(): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">IRiskSchema</span><span class="hl-1">[]&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Returns</strong>: Array of risk schemas with all properties (riskName, validations, callbacks)</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">risks</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">listRisks</span><span class="hl-1">();</span><br/><span class="hl-4">risks</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">(</span><span class="hl-4">risk</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Risk profile: </span><span class="hl-6">${</span><span class="hl-4">risk</span><span class="hl-9">.</span><span class="hl-4">riskName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Validations: </span><span class="hl-6">${</span><span class="hl-4">risk</span><span class="hl-9">.</span><span class="hl-4">validations</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="addsizing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">addSizing()<a href="#addsizing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Registers a position sizing configuration using fixed-percentage, Kelly Criterion, or ATR-based methods.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">addSizing</span><span class="hl-1">(</span><span class="hl-4">sizingSchema</span><span class="hl-1">: </span><span class="hl-10">ISizingSchema</span><span class="hl-1">): </span><span class="hl-10">void</span>
</code><button type="button">Copy</button></pre>

<p><strong>Parameters</strong> (discriminated union by <code>method</code>):</p>
<ul>
<li><code>sizingSchema.sizingName</code> (string): Unique sizing identifier</li>
<li><code>sizingSchema.method</code> (string): &quot;fixed-percentage&quot; | &quot;kelly-criterion&quot; | &quot;atr-based&quot;</li>
<li><code>sizingSchema.riskPercentage</code> (number, for fixed/ATR): Risk % per trade</li>
<li><code>sizingSchema.kellyMultiplier</code> (number, for Kelly): Fraction of Kelly to use (default: 0.25)</li>
<li><code>sizingSchema.atrMultiplier</code> (number, for ATR): ATR multiplier for stop distance (default: 2)</li>
<li><code>sizingSchema.maxPositionPercentage</code> (number, optional): Max position as % of account</li>
<li><code>sizingSchema.minPositionSize</code> (number, optional): Minimum position size</li>
<li><code>sizingSchema.maxPositionSize</code> (number, optional): Maximum position size</li>
<li><code>sizingSchema.callbacks</code> (object, optional): Lifecycle callbacks (onCalculate)</li>
<li><code>sizingSchema.note</code> (string, optional): Developer documentation</li>
</ul>
<p>For detailed <code>ISizingSchema</code> documentation, see <a href="design_28_sizing_schemas.html">Sizing Schemas</a>.</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-5">// Fixed percentage sizing</span><br/><span class="hl-0">addSizing</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">sizingName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative-fixed&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;fixed-percentage&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskPercentage:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionPercentage:</span><span class="hl-1"> </span><span class="hl-8">10</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Risk 1% per trade, max 10% per position&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Kelly Criterion sizing</span><br/><span class="hl-0">addSizing</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">sizingName:</span><span class="hl-1"> </span><span class="hl-2">&quot;kelly-quarter&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;kelly-criterion&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">kellyMultiplier:</span><span class="hl-1"> </span><span class="hl-8">0.25</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionPercentage:</span><span class="hl-1"> </span><span class="hl-8">20</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Quarter-Kelly with 20% position limit&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// ATR-based dynamic sizing</span><br/><span class="hl-0">addSizing</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">sizingName:</span><span class="hl-1"> </span><span class="hl-2">&quot;atr-dynamic&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;atr-based&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskPercentage:</span><span class="hl-1"> </span><span class="hl-8">2</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">atrMultiplier:</span><span class="hl-1"> </span><span class="hl-8">2</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onCalculate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">quantity</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Calculated </span><span class="hl-6">${</span><span class="hl-4">quantity</span><span class="hl-6">}</span><span class="hl-2"> for </span><span class="hl-6">${</span><span class="hl-4">params</span><span class="hl-9">.</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Internal Flow</strong>:</p>
<ol>
<li>Log via <code>backtest.loggerService.info()</code></li>
<li>Store in <code>SizingValidationService</code> via <code>addSizing(name, schema)</code></li>
<li>Store in <code>SizingSchemaService</code> via <code>register(name, schema)</code></li>
</ol>
<hr>
<a id="listsizings" class="tsd-anchor"></a><h2 class="tsd-anchor-link">listSizings()<a href="#listsizings" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Returns array of all registered sizing schemas.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">listSizings</span><span class="hl-1">(): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">ISizingSchema</span><span class="hl-1">[]&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Returns</strong>: Array of sizing schemas with all properties (method-specific parameters)</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">sizings</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">listSizings</span><span class="hl-1">();</span><br/><span class="hl-4">sizings</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">(</span><span class="hl-4">sizing</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Sizing: </span><span class="hl-6">${</span><span class="hl-4">sizing</span><span class="hl-9">.</span><span class="hl-4">sizingName</span><span class="hl-6">}</span><span class="hl-2"> (</span><span class="hl-6">${</span><span class="hl-4">sizing</span><span class="hl-9">.</span><span class="hl-4">method</span><span class="hl-6">}</span><span class="hl-2">)`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">sizing</span><span class="hl-1">.</span><span class="hl-4">method</span><span class="hl-1"> === </span><span class="hl-2">&quot;fixed-percentage&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Risk: </span><span class="hl-6">${</span><span class="hl-4">sizing</span><span class="hl-9">.</span><span class="hl-4">riskPercentage</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="addwalker" class="tsd-anchor"></a><h2 class="tsd-anchor-link">addWalker()<a href="#addwalker" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Registers a walker for multi-strategy comparison, executing backtests on multiple strategies and selecting the best by a specified metric.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">addWalker</span><span class="hl-1">(</span><span class="hl-4">walkerSchema</span><span class="hl-1">: </span><span class="hl-10">IWalkerSchema</span><span class="hl-1">): </span><span class="hl-10">void</span>
</code><button type="button">Copy</button></pre>

<p><strong>Parameters</strong>:</p>
<ul>
<li><code>walkerSchema.walkerName</code> (string): Unique walker identifier</li>
<li><code>walkerSchema.exchangeName</code> (string): Exchange to use for all strategies</li>
<li><code>walkerSchema.frameName</code> (string): Frame to use for all strategies</li>
<li><code>walkerSchema.strategies</code> (array): Array of strategy names to compare</li>
<li><code>walkerSchema.metric</code> (WalkerMetric): Optimization metric (&quot;sharpeRatio&quot; | &quot;annualizedSharpeRatio&quot; | &quot;winRate&quot; | &quot;totalPnl&quot; | &quot;certaintyRatio&quot; | &quot;avgPnl&quot; | &quot;expectedYearlyReturns&quot;)</li>
<li><code>walkerSchema.callbacks</code> (object, optional): Lifecycle callbacks (onStrategyComplete, onComplete)</li>
<li><code>walkerSchema.note</code> (string, optional): Developer documentation</li>
</ul>
<p>For detailed <code>IWalkerSchema</code> documentation, see <a href="design_29_walker_schemas.html">Walker Schemas</a>.</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-0">addWalker</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;llm-prompt-optimizer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance-spot&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;jan-2024&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategies:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;momentum-long-v1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;momentum-long-v2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;momentum-long-v3&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-4">metric:</span><span class="hl-1"> </span><span class="hl-2">&quot;sharpeRatio&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onStrategyComplete</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">, </span><span class="hl-4">metric</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">: Sharpe=</span><span class="hl-6">${</span><span class="hl-4">metric</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onComplete</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">results</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Best: </span><span class="hl-6">${</span><span class="hl-4">results</span><span class="hl-9">.</span><span class="hl-4">bestStrategy</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Internal Flow</strong>:</p>
<ol>
<li>Log via <code>backtest.loggerService.info()</code></li>
<li>Store in <code>WalkerValidationService</code> via <code>addWalker(name, schema)</code></li>
<li>Store in <code>WalkerSchemaService</code> via <code>register(name, schema)</code></li>
</ol>
<hr>
<a id="listwalkers" class="tsd-anchor"></a><h2 class="tsd-anchor-link">listWalkers()<a href="#listwalkers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Returns array of all registered walker schemas.</p>
<p><strong>Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">listWalkers</span><span class="hl-1">(): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">IWalkerSchema</span><span class="hl-1">[]&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Returns</strong>: Array of walker schemas with all properties (walkerName, strategies, metric, exchangeName, frameName)</p>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">walkers</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">listWalkers</span><span class="hl-1">();</span><br/><span class="hl-4">walkers</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">(</span><span class="hl-4">walker</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Walker: </span><span class="hl-6">${</span><span class="hl-4">walker</span><span class="hl-9">.</span><span class="hl-4">walkerName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Strategies: </span><span class="hl-6">${</span><span class="hl-4">walker</span><span class="hl-9">.</span><span class="hl-4">strategies</span><span class="hl-9">.</span><span class="hl-0">join</span><span class="hl-9">(</span><span class="hl-2">&quot;, &quot;</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Metric: </span><span class="hl-6">${</span><span class="hl-4">walker</span><span class="hl-9">.</span><span class="hl-4">metric</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="validation-service-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Service Pattern<a href="#validation-service-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All <code>*ValidationService</code> classes follow the same pattern for schema validation and memoization:</p>
<p><img src="../media/16_Component_Registration_Functions_2.svg" alt="Mermaid Diagram"></p>
<p><strong>ValidationService Responsibilities</strong>:</p>
<ol>
<li><strong>Registration-time storage</strong>: Store schemas in <code>Map&lt;name, schema&gt;</code> for validation</li>
<li><strong>Runtime validation</strong>: Validate schemas during execution (e.g., checking strategy exists)</li>
<li><strong>Listing</strong>: Return all registered schemas via <code>list()</code> method</li>
<li><strong>Memoization</strong>: Cache validation results to avoid redundant checks</li>
</ol>
<p><strong>Key Methods</strong>:</p>
<ul>
<li><code>add*(name: string, schema: I*Schema): void</code> - Store schema for validation</li>
<li><code>list(): Promise&lt;I*Schema[]&gt;</code> - Return all registered schemas</li>
<li><code>validate*(name: string): boolean</code> - Runtime check if schema exists (memoized)</li>
</ul>
<hr>
<a id="schema-service-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Schema Service Pattern<a href="#schema-service-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All <code>*SchemaService</code> classes follow the ToolRegistry pattern for schema storage and retrieval:</p>
<p><img src="../media/16_Component_Registration_Functions_3.svg" alt="Mermaid Diagram"></p>
<p><strong>SchemaService Responsibilities</strong>:</p>
<ol>
<li><strong>Storage</strong>: Store schemas in <code>ToolRegistry</code> (Map-based) by name</li>
<li><strong>Retrieval</strong>: Return schema by name via <code>get(name)</code></li>
<li><strong>Existence check</strong>: Check if schema exists via <code>has(name)</code></li>
</ol>
<p><strong>Key Methods</strong>:</p>
<ul>
<li><code>register(name: string, schema: I*Schema): void</code> - Store schema</li>
<li><code>get(name: string): I*Schema</code> - Retrieve schema (throws if not found)</li>
<li><code>has(name: string): boolean</code> - Check if schema exists</li>
</ul>
<p><strong>ToolRegistry Pattern</strong>: Each <code>SchemaService</code> extends a base <code>ToolRegistry</code> class that provides generic <code>Map&lt;name, schema&gt;</code> storage with get/has/register methods.</p>
<hr>
<a id="registration-vs-runtime-validation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Registration vs Runtime Validation<a href="#registration-vs-runtime-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework performs validation at two distinct phases:</p>
<table>
<thead>
<tr>
<th>Validation Phase</th>
<th>When</th>
<th>Where</th>
<th>What</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Registration</strong></td>
<td><code>add*()</code> call</td>
<td><code>*ValidationService.add*()</code></td>
<td>Stores schema for future validation</td>
</tr>
<tr>
<td><strong>Runtime</strong></td>
<td>Execution start</td>
<td><code>*ValidationService.validate*()</code></td>
<td>Checks schema exists (memoized)</td>
</tr>
</tbody>
</table>
<p><strong>Registration Phase</strong> (<a href="">src/function/add.ts:54-57</a>):</p>
<pre><code class="typescript"><span class="hl-5">// Store schema in ValidationService</span><br/><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategyValidationService</span><span class="hl-1">.</span><span class="hl-0">addStrategy</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">strategySchema</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategySchema</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Runtime Phase</strong> (used by <code>*GlobalService</code> classes):</p>
<pre><code class="typescript"><span class="hl-5">// Check if strategy was registered (memoized)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">isValid</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">strategyValidationService</span><span class="hl-1">.</span><span class="hl-0">validateStrategy</span><span class="hl-1">(</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">isValid</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`Strategy </span><span class="hl-6">${</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2"> not registered`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Memoization</strong>: Validation results are cached using <code>singlerun</code> from <code>functools-kit</code> to avoid repeated schema lookups during execution.</p>
<hr>
<a id="registration-error-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Registration Error Handling<a href="#registration-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Registration functions do not throw errors during the <code>add*()</code> call itself. Instead:</p>
<ol>
<li><strong>Immediate operations</strong>: Logging and storage always succeed</li>
<li><strong>Schema validation</strong>: Deferred until runtime execution</li>
<li><strong>Missing dependencies</strong>: Detected when execution attempts to retrieve schema</li>
</ol>
<p><strong>Example Error Flow</strong>:</p>
<pre><code class="typescript"><span class="hl-5">// This succeeds (no validation yet)</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;non-existent-risk&quot;</span><span class="hl-1">, </span><span class="hl-5">// &lt;-- Error not caught here</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({ </span><span class="hl-5">/* ... */</span><span class="hl-1"> }),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Error thrown here when ClientStrategy tries to get ClientRisk</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;jan-2024&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-5">// Error: Risk profile &quot;non-existent-risk&quot; not registered</span>
</code><button type="button">Copy</button></pre>

<p>This design allows:</p>
<ul>
<li><strong>Flexible registration order</strong>: Can register strategies before risks, exchanges before strategies, etc.</li>
<li><strong>Deferred validation</strong>: Schema existence checked only when needed</li>
<li><strong>Clear error messages</strong>: Runtime errors indicate exactly which component is missing</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#component-registration-functions"><span>Component <wbr/>Registration <wbr/>Functions</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#registration-flow-architecture"><span>Registration <wbr/>Flow <wbr/>Architecture</span></a></li><li><a href="#service-architecture-mapping"><span>Service <wbr/>Architecture <wbr/>Mapping</span></a></li><li><a href="#addstrategy"><span>add<wbr/>Strategy()</span></a></li><li><a href="#liststrategies"><span>list<wbr/>Strategies()</span></a></li><li><a href="#addexchange"><span>add<wbr/>Exchange()</span></a></li><li><a href="#listexchanges"><span>list<wbr/>Exchanges()</span></a></li><li><a href="#addframe"><span>add<wbr/>Frame()</span></a></li><li><a href="#listframes"><span>list<wbr/>Frames()</span></a></li><li><a href="#addrisk"><span>add<wbr/>Risk()</span></a></li><li><a href="#listrisks"><span>list<wbr/>Risks()</span></a></li><li><a href="#addsizing"><span>add<wbr/>Sizing()</span></a></li><li><a href="#listsizings"><span>list<wbr/>Sizings()</span></a></li><li><a href="#addwalker"><span>add<wbr/>Walker()</span></a></li><li><a href="#listwalkers"><span>list<wbr/>Walkers()</span></a></li><li><a href="#validation-service-pattern"><span>Validation <wbr/>Service <wbr/>Pattern</span></a></li><li><a href="#schema-service-pattern"><span>Schema <wbr/>Service <wbr/>Pattern</span></a></li><li><a href="#registration-vs-runtime-validation"><span>Registration vs <wbr/>Runtime <wbr/>Validation</span></a></li><li><a href="#registration-error-handling"><span>Registration <wbr/>Error <wbr/>Handling</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
