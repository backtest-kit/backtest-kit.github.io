<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/25_strategy-development | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_25_strategy-development.html">design/25_strategy-development</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="strategy-development" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Strategy Development<a href="#strategy-development" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This page provides a complete guide to developing trading strategies in Backtest Kit. It covers the fundamentals of strategy creation, signal generation logic, lifecycle callbacks, and integration with the framework's execution engine.</p>
<p>For information about risk management and validation rules, see <a href="design_31_risk-management.html">Risk Management</a>. For details on execution modes (backtest, live, walker), see <a href="design_20_execution-modes.html">Execution Modes</a>. For information on fetching and using market data, see <a href="design_36_exchanges-data-sources.html">Exchanges &amp; Data Sources</a>.</p>
<a id="strategy-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Strategy Overview<a href="#strategy-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>A <strong>strategy</strong> in Backtest Kit is a self-contained module that generates trading signals based on market data analysis. Strategies are registered via <code>addStrategy()</code> and executed through the time execution engine, which guarantees temporal consistency and prevents look-ahead bias.</p>
<a id="key-characteristics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Key Characteristics<a href="#key-characteristics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Characteristic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Signal Generation</strong></td>
<td>Strategies return <code>ISignalDto</code> objects with entry/exit prices and timeframes</td>
</tr>
<tr>
<td><strong>Temporal Context</strong></td>
<td>All data access is scoped to the current execution timestamp via <code>ExecutionContextService</code></td>
</tr>
<tr>
<td><strong>Interval Throttling</strong></td>
<td>Configurable minimum time between signal generation attempts</td>
</tr>
<tr>
<td><strong>Lifecycle Callbacks</strong></td>
<td>Optional hooks for signal events (onOpen, onClose, onActive, etc.)</td>
</tr>
<tr>
<td><strong>Risk Integration</strong></td>
<td>Optional risk profile binding for portfolio-level controls</td>
</tr>
<tr>
<td><strong>Mode Agnostic</strong></td>
<td>Same strategy code runs in backtest, live, and walker modes</td>
</tr>
</tbody>
</table>
<a id="strategy-development-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Strategy Development Flow<a href="#strategy-development-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/25_strategy-development_0.svg" alt="Mermaid Diagram"></p>
<a id="strategy-anatomy-core-components" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Strategy Anatomy: Core Components<a href="#strategy-anatomy-core-components" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="istrategyschema-interface" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IStrategySchema Interface<a href="#istrategyschema-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>IStrategySchema</code> interface defines the complete configuration for a trading strategy:</p>
<p><img src="../media/25_strategy-development_1.svg" alt="Mermaid Diagram"></p>
<a id="signal-data-transfer-object-isignaldto" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signal Data Transfer Object (ISignalDto)<a href="#signal-data-transfer-object-isignaldto" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>getSignal</code> function returns an <code>ISignalDto</code> with the following structure:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>string</td>
<td>Optional</td>
<td>Signal identifier (auto-generated if omitted)</td>
</tr>
<tr>
<td><code>position</code></td>
<td>&quot;long&quot; | &quot;short&quot;</td>
<td>Required</td>
<td>Trade direction</td>
</tr>
<tr>
<td><code>priceOpen</code></td>
<td>number</td>
<td>Optional</td>
<td>Entry price (if omitted, opens at current VWAP)</td>
</tr>
<tr>
<td><code>priceTakeProfit</code></td>
<td>number</td>
<td>Required</td>
<td>Take profit exit price</td>
</tr>
<tr>
<td><code>priceStopLoss</code></td>
<td>number</td>
<td>Required</td>
<td>Stop loss exit price</td>
</tr>
<tr>
<td><code>minuteEstimatedTime</code></td>
<td>number</td>
<td>Required</td>
<td>Maximum signal lifetime in minutes</td>
</tr>
<tr>
<td><code>note</code></td>
<td>string</td>
<td>Optional</td>
<td>Human-readable signal rationale</td>
</tr>
</tbody>
</table>
<a id="complete-working-example" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Complete Working Example<a href="#complete-working-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Below is a minimal but complete strategy that demonstrates all core concepts:</p>
<a id="basic-moving-average-crossover-strategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Moving Average Crossover Strategy<a href="#basic-moving-average-crossover-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addStrategy</span><span class="hl-1">, </span><span class="hl-4">getCandles</span><span class="hl-1">, </span><span class="hl-4">ISignalDto</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;backtest-kit&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;ma-crossover-basic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&#39;5m&#39;</span><span class="hl-1">, </span><span class="hl-5">// Check for signals every 5 minutes</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&#39;Simple MA crossover with 20/50 periods&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Core signal generation logic</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-11">Date</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">ISignalDto</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">&gt; </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Fetch historical candles (automatically scoped to &#39;when&#39; timestamp)</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">50</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">candles</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &lt; </span><span class="hl-6">50</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">; </span><span class="hl-5">// Insufficient data</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Calculate moving averages</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">closes</span><span class="hl-1"> = </span><span class="hl-4">candles</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">c</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">c</span><span class="hl-1">.</span><span class="hl-4">close</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ma20</span><span class="hl-1"> = </span><span class="hl-4">closes</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(-</span><span class="hl-6">20</span><span class="hl-1">).</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">a</span><span class="hl-1"> + </span><span class="hl-4">b</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-6">20</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ma50</span><span class="hl-1"> = </span><span class="hl-4">closes</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(-</span><span class="hl-6">50</span><span class="hl-1">).</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">a</span><span class="hl-1"> + </span><span class="hl-4">b</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-6">50</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">prevMa20</span><span class="hl-1"> = </span><span class="hl-4">closes</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(-</span><span class="hl-6">21</span><span class="hl-1">, -</span><span class="hl-6">1</span><span class="hl-1">).</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">a</span><span class="hl-1"> + </span><span class="hl-4">b</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-6">20</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">prevMa50</span><span class="hl-1"> = </span><span class="hl-4">closes</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(-</span><span class="hl-6">51</span><span class="hl-1">, -</span><span class="hl-6">1</span><span class="hl-1">).</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">a</span><span class="hl-1"> + </span><span class="hl-4">b</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-6">50</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">currentPrice</span><span class="hl-1"> = </span><span class="hl-4">closes</span><span class="hl-1">[</span><span class="hl-4">closes</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> - </span><span class="hl-6">1</span><span class="hl-1">];</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Bullish crossover: MA20 crosses above MA50</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">prevMa20</span><span class="hl-1"> &lt;= </span><span class="hl-4">prevMa50</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">ma20</span><span class="hl-1"> &gt; </span><span class="hl-4">ma50</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&#39;long&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-4">currentPrice</span><span class="hl-1"> * </span><span class="hl-6">1.02</span><span class="hl-1">, </span><span class="hl-5">// 2% profit target</span><br/><span class="hl-1">        </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-4">currentPrice</span><span class="hl-1"> * </span><span class="hl-6">0.99</span><span class="hl-1">,   </span><span class="hl-5">// 1% stop loss</span><br/><span class="hl-1">        </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-6">240</span><span class="hl-1">,             </span><span class="hl-5">// 4 hours max</span><br/><span class="hl-1">        </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">`MA20(</span><span class="hl-7">${</span><span class="hl-4">ma20</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">) &gt; MA50(</span><span class="hl-7">${</span><span class="hl-4">ma50</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">)`</span><br/><span class="hl-1">      };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Bearish crossover: MA20 crosses below MA50</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">prevMa20</span><span class="hl-1"> &gt;= </span><span class="hl-4">prevMa50</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">ma20</span><span class="hl-1"> &lt; </span><span class="hl-4">ma50</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&#39;short&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-4">currentPrice</span><span class="hl-1"> * </span><span class="hl-6">0.98</span><span class="hl-1">, </span><span class="hl-5">// 2% profit target</span><br/><span class="hl-1">        </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-4">currentPrice</span><span class="hl-1"> * </span><span class="hl-6">1.01</span><span class="hl-1">,   </span><span class="hl-5">// 1% stop loss</span><br/><span class="hl-1">        </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-6">240</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">`MA20(</span><span class="hl-7">${</span><span class="hl-4">ma20</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">) &lt; MA50(</span><span class="hl-7">${</span><span class="hl-4">ma50</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">)`</span><br/><span class="hl-1">      };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">; </span><span class="hl-5">// No signal conditions met</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Optional lifecycle callbacks</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onOpen</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[</span><span class="hl-7">${</span><span class="hl-4">backtest</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&#39;BT&#39;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">&#39;LIVE&#39;</span><span class="hl-7">}</span><span class="hl-2">] Signal opened:`</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">position</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onClose</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">priceClose</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[</span><span class="hl-7">${</span><span class="hl-4">backtest</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&#39;BT&#39;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">&#39;LIVE&#39;</span><span class="hl-7">}</span><span class="hl-2">] Signal closed:`</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="strategy-registration-and-execution-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Strategy Registration and Execution Flow<a href="#strategy-registration-and-execution-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="registration-via-addstrategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration via addStrategy()<a href="#registration-via-addstrategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/25_strategy-development_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Registration Process:</strong></p>
<ol>
<li><strong>Validation</strong> - <code>src/lib/services/validation/StrategyValidationService.ts</code> checks for duplicate strategy names</li>
<li><strong>Storage</strong> - <code>src/lib/services/schema/StrategySchemaService.ts</code> stores schema in immutable <code>ToolRegistry</code></li>
<li><strong>Memoization</strong> - <code>src/lib/services/connection/StrategyConnectionService.ts:120-151</code> creates cached <code>ClientStrategy</code> instances per symbol-strategy pair</li>
<li><strong>Execution</strong> - <code>src/client/ClientStrategy.ts</code> implements the <code>IStrategy</code> interface with <code>tick()</code> and <code>backtest()</code> methods</li>
</ol>
<a id="code-entity-mapping-strategy-execution-path" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Code Entity Mapping: Strategy Execution Path<a href="#code-entity-mapping-strategy-execution-path" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/25_strategy-development_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Code Entities:</strong></p>
<table>
<thead>
<tr>
<th>Code Entity</th>
<th>File Path</th>
<th>Role</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>addStrategy()</code></td>
<td>src/function/add.ts</td>
<td>Public API for strategy registration</td>
</tr>
<tr>
<td><code>StrategySchemaService</code></td>
<td>src/lib/services/schema/</td>
<td>Stores strategy schemas in ToolRegistry</td>
</tr>
<tr>
<td><code>StrategyConnectionService</code></td>
<td>src/lib/services/connection/</td>
<td>Memoizes and routes to ClientStrategy instances</td>
</tr>
<tr>
<td><code>ClientStrategy</code></td>
<td>src/client/ClientStrategy.ts</td>
<td>Core strategy execution logic</td>
</tr>
<tr>
<td><code>GET_SIGNAL_FN</code></td>
<td>src/client/ClientStrategy.ts:332-476</td>
<td>Wrapper calling user's getSignal with throttling</td>
</tr>
<tr>
<td><code>VALIDATE_SIGNAL_FN</code></td>
<td>src/client/ClientStrategy.ts:45-330</td>
<td>Multi-stage signal validation (TP/SL, prices, lifetime)</td>
</tr>
<tr>
<td><code>IStrategySchema.getSignal</code></td>
<td>User code</td>
<td>Developer-implemented signal generation logic</td>
</tr>
</tbody>
</table>
<a id="strategy-execution-tick-vs-backtest" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Strategy Execution: tick() vs backtest()<a href="#strategy-execution-tick-vs-backtest" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>ClientStrategy</code> implements two execution methods with different performance characteristics:</p>
<a id="tick-method---live-trading--step-by-step-backtest" class="tsd-anchor"></a><h3 class="tsd-anchor-link">tick() Method - Live Trading &amp; Step-by-Step Backtest<a href="#tick-method---live-trading--step-by-step-backtest" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/25_strategy-development_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Used by:</strong> Live.run(), Backtest.run() (minute-by-minute iteration)</p>
<a id="backtest-method---fast-historical-processing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">backtest() Method - Fast Historical Processing<a href="#backtest-method---fast-historical-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/25_strategy-development_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Used by:</strong> Backtest.run() (after signal opens, fast-forward through candles)</p>
<p><strong>Performance:</strong> Skips timeframes during active signal monitoring, processes only until signal closes</p>
<a id="signal-validation-validate_signal_fn" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Validation: VALIDATE_SIGNAL_FN<a href="#signal-validation-validate_signal_fn" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework performs comprehensive validation on all signals before they activate. This prevents invalid signals from entering the system and ensures trading logic integrity.</p>
<a id="validation-pipeline" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Pipeline<a href="#validation-pipeline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Validation Stage</th>
<th>Checks</th>
<th>Config Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Schema Validation</strong></td>
<td>Required fields present, correct types</td>
<td>N/A</td>
</tr>
<tr>
<td><strong>Price Positivity</strong></td>
<td>All prices &gt; 0, finite, not NaN/Infinity</td>
<td>N/A</td>
</tr>
<tr>
<td><strong>TP/SL Logic</strong></td>
<td>LONG: TP&gt;open&gt;SL, SHORT: SL&gt;open&gt;TP</td>
<td>N/A</td>
</tr>
<tr>
<td><strong>Immediate Closure Prevention</strong></td>
<td>Current price not already at TP/SL</td>
<td>N/A</td>
</tr>
<tr>
<td><strong>TP Distance</strong></td>
<td>TP far enough to cover fees + slippage</td>
<td><code>CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</code></td>
</tr>
<tr>
<td><strong>SL Distance (min)</strong></td>
<td>SL not too close (avoid instant stop-out)</td>
<td><code>CC_MIN_STOPLOSS_DISTANCE_PERCENT</code></td>
</tr>
<tr>
<td><strong>SL Distance (max)</strong></td>
<td>SL not too far (protect capital)</td>
<td><code>CC_MAX_STOPLOSS_DISTANCE_PERCENT</code></td>
</tr>
<tr>
<td><strong>Lifetime Limit</strong></td>
<td>Signal lifetime â‰¤ max configured minutes</td>
<td><code>CC_MAX_SIGNAL_LIFETIME_MINUTES</code></td>
</tr>
</tbody>
</table>
<p><strong>Default Configuration:</strong></p>
<ul>
<li><code>CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</code>: 0.2% (covers 0.1% fee + 0.1% slippage)</li>
<li><code>CC_MAX_SIGNAL_LIFETIME_MINUTES</code>: 10080 (7 days)</li>
</ul>
<a id="validation-error-examples" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Error Examples<a href="#validation-error-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Invalid: Take profit too close (won&#39;t cover trading costs)</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">position</span><span class="hl-1">: </span><span class="hl-2">&#39;long&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">priceOpen</span><span class="hl-1">: </span><span class="hl-6">50000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">priceTakeProfit</span><span class="hl-1">: </span><span class="hl-6">50050</span><span class="hl-1">,  </span><span class="hl-5">// Only 0.1% distance - REJECTED</span><br/><span class="hl-1">  </span><span class="hl-10">priceStopLoss</span><span class="hl-1">: </span><span class="hl-6">49900</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">minuteEstimatedTime</span><span class="hl-1">: </span><span class="hl-6">120</span><br/><span class="hl-1">}</span><br/><span class="hl-5">// Error: &quot;Long: TakeProfit too close to priceOpen (0.100%). Minimum distance: 0.200%&quot;</span><br/><br/><span class="hl-5">// Invalid: Immediate closure scenario</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">position</span><span class="hl-1">: </span><span class="hl-2">&#39;long&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">priceOpen</span><span class="hl-1">: </span><span class="hl-6">50000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">priceTakeProfit</span><span class="hl-1">: </span><span class="hl-6">51000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">priceStopLoss</span><span class="hl-1">: </span><span class="hl-6">50100</span><span class="hl-1">,    </span><span class="hl-5">// Current price at 50100 - REJECTED</span><br/><span class="hl-1">  </span><span class="hl-10">minuteEstimatedTime</span><span class="hl-1">: </span><span class="hl-6">120</span><br/><span class="hl-1">}</span><br/><span class="hl-5">// Error: &quot;Long immediate: currentPrice (50100) &lt;= priceOpen (50000). Signal would be immediately closed&quot;</span><br/><br/><span class="hl-5">// Invalid: Excessive lifetime</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">position</span><span class="hl-1">: </span><span class="hl-2">&#39;long&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">priceOpen</span><span class="hl-1">: </span><span class="hl-6">50000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">priceTakeProfit</span><span class="hl-1">: </span><span class="hl-6">51000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">priceStopLoss</span><span class="hl-1">: </span><span class="hl-6">49000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">minuteEstimatedTime</span><span class="hl-1">: </span><span class="hl-6">20160</span><span class="hl-1">  </span><span class="hl-5">// 14 days - REJECTED</span><br/><span class="hl-1">}</span><br/><span class="hl-5">// Error: &quot;minuteEstimatedTime too large (20160 minutes = 14.0 days). Maximum: 10080 minutes (7 days)&quot;</span>
</code><button type="button">Copy</button></pre>

<a id="scheduled-signals-delayed-entry" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Scheduled Signals: Delayed Entry<a href="#scheduled-signals-delayed-entry" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Strategies can create <strong>scheduled signals</strong> by specifying <code>priceOpen</code> in the returned <code>ISignalDto</code>. Scheduled signals wait for the market price to reach the entry point before activating.</p>
<a id="scheduled-signal-lifecycle" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Scheduled Signal Lifecycle<a href="#scheduled-signal-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/25_strategy-development_6.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Differences from Immediate Signals:</strong></p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Immediate Signal</th>
<th>Scheduled Signal</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>priceOpen</code> field</td>
<td>Omitted or = current VWAP</td>
<td>Explicitly set to target entry price</td>
</tr>
<tr>
<td>Persistence</td>
<td>Saved immediately on creation</td>
<td>NOT saved until activation</td>
</tr>
<tr>
<td>Cancellation</td>
<td>Cannot cancel (only close via TP/SL/time)</td>
<td>Can cancel before activation</td>
</tr>
<tr>
<td>Risk check timing</td>
<td>At creation</td>
<td>At activation (after priceOpen reached)</td>
</tr>
<tr>
<td>Timeout</td>
<td><code>minuteEstimatedTime</code> starts at open</td>
<td><code>CC_SCHEDULE_AWAIT_MINUTES</code> before activation</td>
</tr>
</tbody>
</table>
<a id="scheduled-signal-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Scheduled Signal Example<a href="#scheduled-signal-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;limit-entry-strategy&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&#39;5m&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-11">Date</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">currentPrice</span><span class="hl-1"> = </span><span class="hl-4">candles</span><span class="hl-1">[</span><span class="hl-4">candles</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> - </span><span class="hl-6">1</span><span class="hl-1">].</span><span class="hl-4">close</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Look for support level bounce</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">support</span><span class="hl-1"> = </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">min</span><span class="hl-1">(...</span><span class="hl-4">candles</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(-</span><span class="hl-6">10</span><span class="hl-1">).</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">c</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">c</span><span class="hl-1">.</span><span class="hl-4">low</span><span class="hl-1">));</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">currentPrice</span><span class="hl-1"> &gt; </span><span class="hl-4">support</span><span class="hl-1"> * </span><span class="hl-6">1.02</span><span class="hl-1">) { </span><span class="hl-5">// Price above support</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&#39;long&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">priceOpen:</span><span class="hl-1"> </span><span class="hl-4">support</span><span class="hl-1"> * </span><span class="hl-6">1.005</span><span class="hl-1">,  </span><span class="hl-5">// SCHEDULED: Wait for price to drop to support</span><br/><span class="hl-1">        </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-4">support</span><span class="hl-1"> * </span><span class="hl-6">1.03</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-4">support</span><span class="hl-1"> * </span><span class="hl-6">0.995</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-6">180</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">`Limit buy at support </span><span class="hl-7">${</span><span class="hl-4">support</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><br/><span class="hl-1">      };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Monitoring Logic:</strong> <code>src/client/ClientStrategy.ts:610-644</code> checks SL <strong>before</strong> priceOpen to prevent &quot;activate-and-immediately-cancel&quot; scenarios.</p>
<a id="best-practices" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Best Practices<a href="#best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="1-leverage-temporal-context" class="tsd-anchor"></a><h3 class="tsd-anchor-link">1. Leverage Temporal Context<a href="#1-leverage-temporal-context" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework automatically provides temporal context via <code>ExecutionContextService</code>. The <code>when</code> parameter in <code>getSignal()</code> represents the current execution time, and <code>getCandles()</code> returns data <strong>up to</strong> that timestamp.</p>
<p><strong>Correct:</strong></p>
<pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-11">Date</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// getCandles automatically scoped to &#39;when&#39; - no look-ahead bias possible</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">// candles[candles.length - 1].timestamp &lt;= when.getTime()</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Incorrect (but prevented by framework):</strong></p>
<pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-11">Date</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// This would be dangerous in other frameworks - but here it&#39;s safe!</span><br/><span class="hl-1">  </span><span class="hl-5">// getCandles CANNOT return future data relative to &#39;when&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">// Framework guarantees no look-ahead bias</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="2-choose-appropriate-interval-throttling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">2. Choose Appropriate Interval Throttling<a href="#2-choose-appropriate-interval-throttling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>interval</code> parameter determines minimum time between <code>getSignal()</code> calls. Choose based on strategy computation cost and market data requirements:</p>
<table>
<thead>
<tr>
<th>Strategy Type</th>
<th>Recommended Interval</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>Simple indicators (MA, RSI)</td>
<td>1m - 5m</td>
<td>Fast computation, frequent updates useful</td>
</tr>
<tr>
<td>Complex ML models</td>
<td>15m - 1h</td>
<td>Expensive computation, less frequent checks acceptable</td>
</tr>
<tr>
<td>News/sentiment analysis</td>
<td>5m - 30m</td>
<td>API rate limits, data freshness</td>
</tr>
<tr>
<td>High-frequency patterns</td>
<td>1m</td>
<td>Need rapid signal generation</td>
</tr>
</tbody>
</table>
<a id="3-handle-insufficient-data-gracefully" class="tsd-anchor"></a><h3 class="tsd-anchor-link">3. Handle Insufficient Data Gracefully<a href="#3-handle-insufficient-data-gracefully" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Always check for sufficient candle history before calculations:</p>
<pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-11">Date</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">candles</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &lt; </span><span class="hl-6">100</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">; </span><span class="hl-5">// Not enough data - skip this tick</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Safe to proceed with calculations</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="4-use-lifecycle-callbacks-for-monitoring" class="tsd-anchor"></a><h3 class="tsd-anchor-link">4. Use Lifecycle Callbacks for Monitoring<a href="#4-use-lifecycle-callbacks-for-monitoring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Callbacks provide observability into strategy execution without cluttering signal logic:</p>
<pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;monitored-strategy&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&#39;5m&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> { </span><span class="hl-5">/* ... */</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onOpen</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Log to monitoring service</span><br/><span class="hl-1">      </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&#39;Signal opened&#39;</span><span class="hl-1">, { </span><span class="hl-4">signal:</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">price:</span><span class="hl-1"> </span><span class="hl-4">currentPrice</span><span class="hl-1"> });</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Track unrealized PNL</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">pnl</span><span class="hl-1"> = </span><span class="hl-0">calculateUnrealizedPnl</span><span class="hl-1">(</span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">metrics</span><span class="hl-1">.</span><span class="hl-0">gauge</span><span class="hl-1">(</span><span class="hl-2">&#39;unrealized_pnl&#39;</span><span class="hl-1">, </span><span class="hl-4">pnl</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onClose</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">priceClose</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Log final outcome</span><br/><span class="hl-1">      </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&#39;Signal closed&#39;</span><span class="hl-1">, { </span><span class="hl-4">signal:</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">closePrice:</span><span class="hl-1"> </span><span class="hl-4">priceClose</span><span class="hl-1"> });</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onPartialProfit</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">revenuePercent</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Alert on milestone</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">revenuePercent</span><span class="hl-1"> &gt;= </span><span class="hl-6">10</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">alerts</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">`Signal </span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-7">}</span><span class="hl-2"> reached </span><span class="hl-7">${</span><span class="hl-4">revenuePercent</span><span class="hl-7">}</span><span class="hl-2">% profit`</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Available callbacks: <code>onTick</code>, <code>onOpen</code>, <code>onActive</code>, <code>onIdle</code>, <code>onClose</code>, <code>onSchedule</code>, <code>onCancel</code>, <code>onPartialProfit</code>, <code>onPartialLoss</code>, <code>onWrite</code></p>
<a id="5-integrate-risk-management" class="tsd-anchor"></a><h3 class="tsd-anchor-link">5. Integrate Risk Management<a href="#5-integrate-risk-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Bind risk profiles to strategies for portfolio-level controls:</p>
<pre><code class="typescript"><span class="hl-5">// Define risk profile (see Risk Management page)</span><br/><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;conservative&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-6">3</span><span class="hl-1">) </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Max 3 concurrent positions&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Bind to strategy</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-strategy&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&#39;5m&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;conservative&#39;</span><span class="hl-1">,  </span><span class="hl-5">// Single risk profile</span><br/><span class="hl-1">  </span><span class="hl-5">// OR</span><br/><span class="hl-1">  </span><span class="hl-4">riskList:</span><span class="hl-1"> [</span><span class="hl-2">&#39;conservative&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;size-limits&#39;</span><span class="hl-1">],  </span><span class="hl-5">// Multiple profiles</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> { </span><span class="hl-5">/* ... */</span><span class="hl-1"> }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="6-test-with-walker-mode" class="tsd-anchor"></a><h3 class="tsd-anchor-link">6. Test with Walker Mode<a href="#6-test-with-walker-mode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Use Walker mode to compare multiple strategy variants before live deployment:</p>
<pre><code class="typescript"><span class="hl-5">// Register strategy variants</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({ </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;ma-20-50&#39;</span><span class="hl-1">, </span><span class="hl-5">/* ... */</span><span class="hl-1"> });</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({ </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;ma-50-200&#39;</span><span class="hl-1">, </span><span class="hl-5">/* ... */</span><span class="hl-1"> });</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({ </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;ma-10-30&#39;</span><span class="hl-1">, </span><span class="hl-5">/* ... */</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// Compare them</span><br/><span class="hl-0">addWalker</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&#39;ma-comparison&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&#39;1-month-backtest&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategies:</span><span class="hl-1"> [</span><span class="hl-2">&#39;ma-20-50&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;ma-50-200&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;ma-10-30&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">metric:</span><span class="hl-1"> </span><span class="hl-2">&#39;sharpeRatio&#39;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&#39;BTCUSDT&#39;</span><span class="hl-1">, { </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&#39;ma-comparison&#39;</span><span class="hl-1"> });</span><br/><span class="hl-5">// Returns ranked results by Sharpe ratio</span>
</code><button type="button">Copy</button></pre>

<hr>
<p><strong>Related Pages:</strong></p>
<ul>
<li><a href="design_08_core-concepts.html">Signal Lifecycle</a> - Detailed signal state machine and transitions</li>
<li><a href="design_31_risk-management.html">Risk Management</a> - Portfolio limits and validation rules</li>
<li><a href="design_25_strategy-development.html">Multi-Timeframe Analysis</a> - Using multiple timeframes in strategies</li>
<li><a href="design_56_api-reference.html">getCandles API</a> - Data fetching reference</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#strategy-development"><span>Strategy <wbr/>Development</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#strategy-overview"><span>Strategy <wbr/>Overview</span></a></li><li><ul><li><a href="#key-characteristics"><span>Key <wbr/>Characteristics</span></a></li><li><a href="#strategy-development-flow"><span>Strategy <wbr/>Development <wbr/>Flow</span></a></li></ul></li><li><a href="#strategy-anatomy-core-components"><span>Strategy <wbr/>Anatomy: <wbr/>Core <wbr/>Components</span></a></li><li><ul><li><a href="#istrategyschema-interface"><span>IStrategy<wbr/>Schema <wbr/>Interface</span></a></li><li><a href="#signal-data-transfer-object-isignaldto"><span>Signal <wbr/>Data <wbr/>Transfer <wbr/>Object (ISignal<wbr/>Dto)</span></a></li></ul></li><li><a href="#complete-working-example"><span>Complete <wbr/>Working <wbr/>Example</span></a></li><li><ul><li><a href="#basic-moving-average-crossover-strategy"><span>Basic <wbr/>Moving <wbr/>Average <wbr/>Crossover <wbr/>Strategy</span></a></li></ul></li><li><a href="#strategy-registration-and-execution-flow"><span>Strategy <wbr/>Registration and <wbr/>Execution <wbr/>Flow</span></a></li><li><ul><li><a href="#registration-via-addstrategy"><span>Registration via add<wbr/>Strategy()</span></a></li><li><a href="#code-entity-mapping-strategy-execution-path"><span>Code <wbr/>Entity <wbr/>Mapping: <wbr/>Strategy <wbr/>Execution <wbr/>Path</span></a></li></ul></li><li><a href="#strategy-execution-tick-vs-backtest"><span>Strategy <wbr/>Execution: tick() vs backtest()</span></a></li><li><ul><li><a href="#tick-method---live-trading--step-by-step-backtest"><span>tick() <wbr/>Method -<wbr/> <wbr/>Live <wbr/>Trading &amp; <wbr/>Step-<wbr/>by-<wbr/>Step <wbr/>Backtest</span></a></li><li><a href="#backtest-method---fast-historical-processing"><span>backtest() <wbr/>Method -<wbr/> <wbr/>Fast <wbr/>Historical <wbr/>Processing</span></a></li></ul></li><li><a href="#signal-validation-validate_signal_fn"><span>Signal <wbr/>Validation: VALIDATE_<wbr/>SIGNAL_<wbr/>FN</span></a></li><li><ul><li><a href="#validation-pipeline"><span>Validation <wbr/>Pipeline</span></a></li><li><a href="#validation-error-examples"><span>Validation <wbr/>Error <wbr/>Examples</span></a></li></ul></li><li><a href="#scheduled-signals-delayed-entry"><span>Scheduled <wbr/>Signals: <wbr/>Delayed <wbr/>Entry</span></a></li><li><ul><li><a href="#scheduled-signal-lifecycle"><span>Scheduled <wbr/>Signal <wbr/>Lifecycle</span></a></li><li><a href="#scheduled-signal-example"><span>Scheduled <wbr/>Signal <wbr/>Example</span></a></li></ul></li><li><a href="#best-practices"><span>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#1-leverage-temporal-context"><span>1. <wbr/>Leverage <wbr/>Temporal <wbr/>Context</span></a></li><li><a href="#2-choose-appropriate-interval-throttling"><span>2. <wbr/>Choose <wbr/>Appropriate <wbr/>Interval <wbr/>Throttling</span></a></li><li><a href="#3-handle-insufficient-data-gracefully"><span>3. <wbr/>Handle <wbr/>Insufficient <wbr/>Data <wbr/>Gracefully</span></a></li><li><a href="#4-use-lifecycle-callbacks-for-monitoring"><span>4. <wbr/>Use <wbr/>Lifecycle <wbr/>Callbacks for <wbr/>Monitoring</span></a></li><li><a href="#5-integrate-risk-management"><span>5. <wbr/>Integrate <wbr/>Risk <wbr/>Management</span></a></li><li><a href="#6-test-with-walker-mode"><span>6. <wbr/>Test with <wbr/>Walker <wbr/>Mode</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
