<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/42_markdown-reports | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_42_markdown-reports.html">design/42_markdown-reports</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="markdown-reports" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Markdown Reports<a href="#markdown-reports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page covers the markdown report generation system in Backtest Kit. The framework provides eight specialized markdown services that accumulate event data, calculate statistics, and generate formatted reports. Each service exposes three methods: <code>getData()</code> for raw statistics, <code>getReport()</code> for markdown-formatted strings, and <code>dump()</code> for saving reports to disk.</p>
<p>For information about subscribing to the real-time events that feed these reports, see <a href="design_40_reporting-monitoring.html">Event Listeners</a>. For details about the statistical models and their calculated metrics, see <a href="design_40_reporting-monitoring.html">Statistics Models</a>.</p>
<a id="overview-of-markdown-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview of Markdown Services<a href="#overview-of-markdown-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides eight markdown service classes that follow a consistent architecture:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Purpose</th>
<th>Event Source</th>
<th>Storage Key</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BacktestMarkdownService</code></td>
<td>Closed backtest signals with PNL</td>
<td><code>signalBacktestEmitter</code></td>
<td><code>${symbol}:${strategyName}</code></td>
</tr>
<tr>
<td><code>LiveMarkdownService</code></td>
<td>All live events (idle, opened, active, closed)</td>
<td><code>signalLiveEmitter</code></td>
<td><code>${symbol}:${strategyName}</code></td>
</tr>
<tr>
<td><code>WalkerMarkdownService</code></td>
<td>Strategy comparison results</td>
<td><code>walkerEmitter</code></td>
<td><code>${walkerName}</code></td>
</tr>
<tr>
<td><code>PerformanceMarkdownService</code></td>
<td>Execution timing metrics</td>
<td><code>performanceEmitter</code></td>
<td><code>${symbol}:${strategyName}</code></td>
</tr>
<tr>
<td><code>HeatMarkdownService</code></td>
<td>Portfolio-wide symbol aggregation</td>
<td><code>signalEmitter</code></td>
<td><code>${strategyName}</code></td>
</tr>
<tr>
<td><code>ScheduleMarkdownService</code></td>
<td>Scheduled signal lifecycle</td>
<td><code>signalEmitter</code></td>
<td><code>${symbol}:${strategyName}</code></td>
</tr>
<tr>
<td><code>PartialMarkdownService</code></td>
<td>Partial profit/loss milestones</td>
<td><code>partialProfitSubject</code>, <code>partialLossSubject</code></td>
<td><code>${symbol}:${strategyName}</code></td>
</tr>
<tr>
<td><code>RiskMarkdownService</code></td>
<td>Risk rejection events</td>
<td><code>riskSubject</code></td>
<td><code>${symbol}:${strategyName}</code></td>
</tr>
</tbody>
</table>
<p>All services automatically subscribe to their respective emitters during initialization using the <code>singleshot</code> pattern to ensure one-time subscription.</p>
<a id="service-architecture-and-data-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Architecture and Data Flow<a href="#service-architecture-and-data-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/42_markdown-reports_0.svg" alt="Mermaid Diagram"></p>
<a id="common-api-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Common API Pattern<a href="#common-api-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Every markdown service exposes three methods via public API classes (Backtest, Live, Walker, Performance, Heat, Schedule, Partial, Risk):</p>
<a id="getdata" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getData()<a href="#getdata" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Returns raw statistical data as a typed model object without formatting:</p>
<pre><code class="typescript"><span class="hl-5">// Returns BacktestStatisticsModel</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">sharpeRatio</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">winRate</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalPnl</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Returns LiveStatisticsModel</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">liveStats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">liveStats</span><span class="hl-1">.</span><span class="hl-4">totalEvents</span><span class="hl-1">, </span><span class="hl-4">liveStats</span><span class="hl-1">.</span><span class="hl-4">eventList</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Returns WalkerStatisticsModel</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">walkerData</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-walker&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">walkerData</span><span class="hl-1">.</span><span class="hl-4">bestStrategy</span><span class="hl-1">, </span><span class="hl-4">walkerData</span><span class="hl-1">.</span><span class="hl-4">strategyResults</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="getreport" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getReport()<a href="#getreport" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Generates markdown-formatted report string with tables and statistics. Accepts optional custom column configuration:</p>
<pre><code class="typescript"><span class="hl-5">// Default columns</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">markdown</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Custom columns</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">customColumns</span><span class="hl-1"> = [</span><br/><span class="hl-1">  { </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;pnl&quot;</span><span class="hl-1">, </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;PNL&quot;</span><span class="hl-1">, </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">s</span><span class="hl-9">.</span><span class="hl-4">pnl</span><span class="hl-9">.</span><span class="hl-4">pnlPercentage</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">, </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1"> }</span><br/><span class="hl-1">];</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">customMarkdown</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">, </span><span class="hl-4">customColumns</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="dump" class="tsd-anchor"></a><h3 class="tsd-anchor-link">dump()<a href="#dump" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Saves report to disk as markdown file. Creates directory recursively if needed:</p>
<pre><code class="typescript"><span class="hl-5">// Save to default path: ./dump/backtest/my-strategy.md</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Custom path: ./reports/my-strategy.md</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;./reports&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Custom path and columns</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;./reports&quot;</span><span class="hl-1">, </span><span class="hl-4">customColumns</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="backtest-reports" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Backtest Reports<a href="#backtest-reports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>BacktestMarkdownService</code> accumulates closed backtest signals and calculates performance statistics.</p>
<a id="characteristics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Characteristics<a href="#characteristics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Event Source</strong>: <code>signalBacktestEmitter</code> (only <code>action === &quot;closed&quot;</code>)</li>
<li><strong>Storage</strong>: Memoized by <code>${symbol}:${strategyName}</code></li>
<li><strong>Max Events</strong>: 250 per symbol-strategy pair</li>
<li><strong>Default Path</strong>: <code>./dump/backtest/</code></li>
<li><strong>Model</strong>: <code>BacktestStatisticsModel</code></li>
</ul>
<a id="statistics-calculated" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Statistics Calculated<a href="#statistics-calculated" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Total signals, win/loss counts, win rate percentage</li>
<li>Average PNL, total PNL</li>
<li>Standard deviation</li>
<li>Sharpe ratio (daily and annualized via <code>sqrt(365)</code>)</li>
<li>Certainty ratio (average win / absolute average loss)</li>
<li>Expected yearly returns (based on average trade duration)</li>
</ul>
<a id="usage-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Usage Example<a href="#usage-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Run backtest</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Signal closed:&quot;</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Get raw statistics</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Sharpe Ratio:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">sharpeRatio</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Win Rate:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">winRate</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Generate markdown report</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">markdown</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">markdown</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Save to disk</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="report-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Report Structure<a href="#report-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Generated markdown includes:</p>
<ol>
<li>Title: <code># Backtest Report: {strategyName}</code></li>
<li>Markdown table with closed signals (default or custom columns)</li>
<li>Summary section:
<ul>
<li><code>**Total signals:** {totalSignals}</code></li>
<li><code>**Win rate:** {winRate}% ({winCount}W / {lossCount}L) (higher is better)</code></li>
<li><code>**Average PNL:** {avgPnl}% (higher is better)</code></li>
<li><code>**Total PNL:** {totalPnl}% (higher is better)</code></li>
<li><code>**Standard Deviation:** {stdDev}% (lower is better)</code></li>
<li><code>**Sharpe Ratio:** {sharpeRatio} (higher is better)</code></li>
<li><code>**Annualized Sharpe Ratio:** {annualizedSharpeRatio} (higher is better)</code></li>
<li><code>**Certainty Ratio:** {certaintyRatio} (higher is better)</code></li>
<li><code>**Expected Yearly Returns:** {expectedYearlyReturns}% (higher is better)</code></li>
</ul>
</li>
</ol>
<a id="live-trading-reports" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Live Trading Reports<a href="#live-trading-reports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>LiveMarkdownService</code> tracks all live trading events including idle states, signal openings, active monitoring, and closures.</p>
<a id="characteristics-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Characteristics<a href="#characteristics-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Event Source</strong>: <code>signalLiveEmitter</code> (all action types)</li>
<li><strong>Storage</strong>: Memoized by <code>${symbol}:${strategyName}</code></li>
<li><strong>Max Events</strong>: 250 per symbol-strategy pair</li>
<li><strong>Default Path</strong>: <code>./dump/live/</code></li>
<li><strong>Model</strong>: <code>LiveStatisticsModel</code></li>
</ul>
<a id="event-types-tracked" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Types Tracked<a href="#event-types-tracked" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Action</th>
<th>Description</th>
<th>Storage Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>idle</code></td>
<td>No active signal</td>
<td>Replaces last idle if no opened/active events follow</td>
</tr>
<tr>
<td><code>opened</code></td>
<td>Signal activated</td>
<td>Added to front</td>
</tr>
<tr>
<td><code>active</code></td>
<td>Position monitoring</td>
<td>Replaces last active with same signalId</td>
</tr>
<tr>
<td><code>closed</code></td>
<td>Position closed</td>
<td>Added to front, used for statistics</td>
</tr>
</tbody>
</table>
<a id="special-deduplication-logic" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Special Deduplication Logic<a href="#special-deduplication-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Idle event deduplication - prevents spam</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">canReplaceLastIdle</span><span class="hl-1"> = </span><span class="hl-4">lastIdleIndex</span><span class="hl-1"> !== -</span><span class="hl-6">1</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">  !</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-4">lastIdleIndex</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-0">some</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1"> || </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Active event deduplication - keeps latest state</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">lastActiveIndex</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-0">findLastIndex</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">signalId</span><span class="hl-1"> === </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="usage-example-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Usage Example<a href="#usage-example-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Start live trading</span><br/><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Query statistics (only closed events count toward metrics)</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Total events:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalEvents</span><span class="hl-1">);  </span><span class="hl-5">// All event types</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Closed signals:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalClosed</span><span class="hl-1">); </span><span class="hl-5">// Only closed</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Win rate:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">winRate</span><span class="hl-1">);           </span><span class="hl-5">// From closed only</span><br/><br/><span class="hl-5">// Generate report (shows ALL events in table)</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">markdown</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Save to disk</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="walker-comparison-reports" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Walker Comparison Reports<a href="#walker-comparison-reports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>WalkerMarkdownService</code> accumulates strategy comparison results and generates comparative analysis.</p>
<a id="characteristics-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Characteristics<a href="#characteristics-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Event Source</strong>: <code>walkerEmitter</code> (progress per strategy)</li>
<li><strong>Storage</strong>: Memoized by <code>${walkerName}</code></li>
<li><strong>Max Events</strong>: Unlimited (stores all strategy results)</li>
<li><strong>Default Path</strong>: <code>./dump/walker/</code></li>
<li><strong>Model</strong>: <code>WalkerStatisticsModel</code></li>
</ul>
<a id="data-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Data Structure<a href="#data-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The walker storage maintains:</p>
<ul>
<li><strong>Metadata</strong>: <code>totalStrategies</code>, <code>bestStrategy</code>, <code>bestMetric</code></li>
<li><strong>Best Strategy Stats</strong>: Full <code>BacktestStatisticsModel</code> for best performer</li>
<li><strong>Strategy Results Array</strong>: <code>IStrategyResult[]</code> with strategyName, stats, metricValue</li>
<li><strong>Signal List</strong>: All closed signals from all strategies combined</li>
</ul>
<a id="report-tables" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Report Tables<a href="#report-tables" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Walker reports generate two distinct tables:</p>
<p><strong>Strategy Comparison Table</strong> (default top 10):</p>
<ul>
<li>Sorted by metric value descending</li>
<li>Uses <code>walker_strategy_columns</code> from <code>COLUMN_CONFIG</code></li>
<li>Typically shows: Strategy, Metric Value, Trades, Win Rate, etc.</li>
</ul>
<p><strong>PNL Table</strong> (all signals):</p>
<ul>
<li>All closed signals from all strategies</li>
<li>Uses <code>walker_pnl_columns</code> from <code>COLUMN_CONFIG</code></li>
<li>Typically shows: Strategy, Signal ID, Symbol, Position, PNL, Close Reason, etc.</li>
</ul>
<a id="usage-example-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Usage Example<a href="#usage-example-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Run walker comparison</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">progress</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-walker&quot;</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">strategiesTested</span><span class="hl-7">}</span><span class="hl-2">/</span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">totalStrategies</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Best: </span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">bestStrategy</span><span class="hl-7">}</span><span class="hl-2"> (</span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">bestMetric</span><span class="hl-7">}</span><span class="hl-2">)`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Get results</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">results</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-walker&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Winner:&quot;</span><span class="hl-1">, </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-4">bestStrategy</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Metric:&quot;</span><span class="hl-1">, </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-4">bestMetric</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Generate report with both tables</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">markdown</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-walker&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Custom columns for strategy table</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stratCols</span><span class="hl-1"> = [</span><br/><span class="hl-1">  { </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;name&quot;</span><span class="hl-1">, </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Strategy&quot;</span><span class="hl-1">, </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">r</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1"> },</span><br/><span class="hl-1">  { </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;sharpe&quot;</span><span class="hl-1">, </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Sharpe&quot;</span><span class="hl-1">, </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">r</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">sharpeRatio</span><span class="hl-1">?.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">3</span><span class="hl-1">) ?? </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-1">, </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1"> }</span><br/><span class="hl-1">];</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">customMarkdown</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-walker&quot;</span><span class="hl-1">, </span><span class="hl-4">stratCols</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Save to disk</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-walker&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="report-structure-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Report Structure<a href="#report-structure-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-1"># </span><span class="hl-4">Walker</span><span class="hl-1"> </span><span class="hl-4">Comparison</span><span class="hl-1"> </span><span class="hl-10">Report</span><span class="hl-1">: {</span><span class="hl-4">walkerName</span><span class="hl-1">}</span><br/><br/><span class="hl-1">**</span><span class="hl-10">Symbol</span><span class="hl-1">:** {</span><span class="hl-4">symbol</span><span class="hl-1">}</span><br/><span class="hl-1">**</span><span class="hl-10">Exchange</span><span class="hl-1">:** {</span><span class="hl-4">exchangeName</span><span class="hl-1">}</span><br/><span class="hl-1">**</span><span class="hl-10">Frame</span><span class="hl-1">:** {</span><span class="hl-4">frameName</span><span class="hl-1">}</span><br/><span class="hl-1">**</span><span class="hl-4">Optimization</span><span class="hl-1"> </span><span class="hl-10">Metric</span><span class="hl-1">:** {</span><span class="hl-4">metric</span><span class="hl-1">}</span><br/><span class="hl-1">**</span><span class="hl-4">Strategies</span><span class="hl-1"> </span><span class="hl-10">Tested</span><span class="hl-1">:** {</span><span class="hl-4">totalStrategies</span><span class="hl-1">}</span><br/><br/><span class="hl-1">## </span><span class="hl-4">Best</span><span class="hl-1"> </span><span class="hl-10">Strategy</span><span class="hl-1">: {</span><span class="hl-4">bestStrategy</span><span class="hl-1">}</span><br/><br/><span class="hl-1">**</span><span class="hl-4">Best</span><span class="hl-1"> {</span><span class="hl-4">metric</span><span class="hl-1">}:** {</span><span class="hl-4">bestMetric</span><span class="hl-1">}</span><br/><span class="hl-1">**</span><span class="hl-4">Total</span><span class="hl-1"> </span><span class="hl-10">Signals</span><span class="hl-1">:** {</span><span class="hl-4">bestStrategySignals</span><span class="hl-1">}</span><br/><br/><span class="hl-1">## </span><span class="hl-4">Top</span><span class="hl-1"> </span><span class="hl-4">Strategies</span><span class="hl-1"> </span><span class="hl-4">Comparison</span><br/><br/><span class="hl-1">| </span><span class="hl-4">Strategy</span><span class="hl-1"> | </span><span class="hl-4">Metric</span><span class="hl-1"> | </span><span class="hl-4">Trades</span><span class="hl-1"> | ... |</span><br/><span class="hl-1">| --- | --- | --- | --- |</span><br/><span class="hl-1">| ... | ... | ... | ... |</span><br/><br/><span class="hl-1">## </span><span class="hl-4">All</span><span class="hl-1"> </span><span class="hl-0">Signals</span><span class="hl-1"> (</span><span class="hl-8">PNL</span><span class="hl-1"> </span><span class="hl-4">Table</span><span class="hl-1">)</span><br/><br/><span class="hl-1">| </span><span class="hl-4">Strategy</span><span class="hl-1"> | </span><span class="hl-4">Signal</span><span class="hl-1"> | </span><span class="hl-8">PNL</span><span class="hl-1"> | ... |</span><br/><span class="hl-1">| --- | --- | --- | --- |</span><br/><span class="hl-1">| ... | ... | ... | ... |</span><br/><br/><span class="hl-1">**</span><span class="hl-10">Note</span><span class="hl-1">:** </span><span class="hl-4">Higher</span><span class="hl-1"> </span><span class="hl-4">values</span><span class="hl-1"> </span><span class="hl-4">are</span><span class="hl-1"> </span><span class="hl-4">better</span><span class="hl-1"> </span><span class="hl-4">for</span><span class="hl-1"> </span><span class="hl-4">all</span><span class="hl-1"> </span><span class="hl-4">metrics</span><span class="hl-1"> </span><span class="hl-4">except</span><span class="hl-1"> </span><span class="hl-4">Standard</span><span class="hl-1"> </span><span class="hl-0">Deviation</span><span class="hl-1"> (</span><span class="hl-4">lower</span><span class="hl-1"> </span><span class="hl-4">is</span><span class="hl-1"> </span><span class="hl-4">better</span><span class="hl-1">).</span>
</code><button>Copy</button></pre>

<a id="specialized-report-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Specialized Report Services<a href="#specialized-report-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="performance-reports" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Performance Reports<a href="#performance-reports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>PerformanceMarkdownService</code> tracks execution timing for bottleneck identification.</p>
<p><strong>Key Details:</strong></p>
<ul>
<li>Event source: <code>performanceEmitter</code></li>
<li>Storage key: <code>${symbol}:${strategyName}</code></li>
<li>Max events: 10,000 (higher limit for granular profiling)</li>
<li>Default path: <code>./dump/performance/</code></li>
<li>Model: <code>PerformanceStatisticsModel</code></li>
</ul>
<p><strong>Metrics per operation type:</strong></p>
<ul>
<li>Count, total duration, average duration</li>
<li>Min/max duration</li>
<li>Standard deviation</li>
<li>Percentiles: Median, P95, P99</li>
<li>Wait times between consecutive operations</li>
</ul>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Performance</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Total time:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalDuration</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Metrics by type:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">metricStats</span><span class="hl-1">);</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Performance</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="heatmap-reports" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Heatmap Reports<a href="#heatmap-reports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>HeatMarkdownService</code> provides portfolio-wide aggregation across all symbols.</p>
<p><strong>Key Details:</strong></p>
<ul>
<li>Event source: <code>signalEmitter</code> (closed only)</li>
<li>Storage key: <code>${strategyName}</code> (single storage per strategy)</li>
<li>Max events: 250 per symbol within strategy</li>
<li>Default path: <code>./dump/heatmap/</code></li>
<li>Model: <code>HeatmapStatisticsModel</code></li>
</ul>
<p><strong>Per-Symbol Metrics:</strong></p>
<ul>
<li>Total PNL, Sharpe Ratio, Max Drawdown</li>
<li>Total trades, win/loss counts, win rate</li>
<li>Average PNL, Standard Deviation</li>
<li>Profit Factor, Average Win/Loss</li>
<li>Max Win/Loss Streaks, Expectancy</li>
</ul>
<p><strong>Portfolio Aggregates:</strong></p>
<ul>
<li>Total symbols count</li>
<li>Portfolio total PNL (sum across symbols)</li>
<li>Portfolio Sharpe Ratio (trade-weighted average)</li>
<li>Portfolio total trades</li>
</ul>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Heat</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Portfolio PNL:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">portfolioTotalPnl</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Symbols:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalSymbols</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Iterate per-symbol</span><br/><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">symbols</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">(</span><span class="hl-4">row</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">: </span><span class="hl-7">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">totalPnl</span><span class="hl-7">}</span><span class="hl-2">% (</span><span class="hl-7">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">totalTrades</span><span class="hl-7">}</span><span class="hl-2"> trades)`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Heat</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="schedule-reports" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schedule Reports<a href="#schedule-reports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>ScheduleMarkdownService</code> tracks scheduled signal lifecycle.</p>
<p><strong>Key Details:</strong></p>
<ul>
<li>Event source: <code>signalEmitter</code> (scheduled, opened, cancelled)</li>
<li>Storage key: <code>${symbol}:${strategyName}</code></li>
<li>Max events: 250</li>
<li>Default path: <code>./dump/schedule/</code></li>
<li>Model: <code>ScheduleStatisticsModel</code></li>
</ul>
<p><strong>Metrics:</strong></p>
<ul>
<li>Total scheduled/opened/cancelled counts</li>
<li>Cancellation rate: <code>(cancelled / scheduled) * 100</code></li>
<li>Activation rate: <code>(opened / scheduled) * 100</code></li>
<li>Average wait time for cancelled signals</li>
<li>Average activation time for opened signals</li>
</ul>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Schedule</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Cancellation rate:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">cancellationRate</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Avg activation:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">avgActivationTime</span><span class="hl-1">);</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Schedule</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="partial-reports" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Partial Reports<a href="#partial-reports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>PartialMarkdownService</code> tracks partial profit/loss milestone events.</p>
<p><strong>Key Details:</strong></p>
<ul>
<li>Event sources: <code>partialProfitSubject</code>, <code>partialLossSubject</code></li>
<li>Storage key: <code>${symbol}:${strategyName}</code></li>
<li>Max events: 250</li>
<li>Default path: <code>./dump/partial/</code></li>
<li>Model: <code>PartialStatisticsModel</code></li>
</ul>
<p><strong>Event Types:</strong></p>
<ul>
<li>Profit: +10%, +20%, +30%, etc.</li>
<li>Loss: 10%, 20%, 30%, etc.</li>
</ul>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Partial</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Profit events:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalProfit</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Loss events:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalLoss</span><span class="hl-1">);</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Partial</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="risk-reports" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Risk Reports<a href="#risk-reports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>RiskMarkdownService</code> tracks risk validation rejection events.</p>
<p><strong>Key Details:</strong></p>
<ul>
<li>Event source: <code>riskSubject</code></li>
<li>Storage key: <code>${symbol}:${strategyName}</code></li>
<li>Max events: 250</li>
<li>Default path: <code>./dump/risk/</code></li>
<li>Model: <code>RiskStatisticsModel</code></li>
</ul>
<p><strong>Metrics:</strong></p>
<ul>
<li>Total rejections</li>
<li>Rejections grouped by symbol</li>
<li>Rejections grouped by strategy</li>
</ul>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Risk</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Total rejections:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalRejections</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;By symbol:&quot;</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">bySymbol</span><span class="hl-1">);</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Risk</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="column-customization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Column Customization<a href="#column-customization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All report generation methods accept optional <code>Columns</code> parameter for fine-grained table formatting control.</p>
<a id="columnmodel-interface" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ColumnModel Interface<a href="#columnmodel-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">ColumnModel</span><span class="hl-1">&lt;</span><span class="hl-11">T</span><span class="hl-1"> </span><span class="hl-7">extends</span><span class="hl-1"> </span><span class="hl-11">object</span><span class="hl-1"> = </span><span class="hl-11">any</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-5">/** Unique column identifier */</span><br/><span class="hl-1">  </span><span class="hl-4">key</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">/** Display label for column header */</span><br/><span class="hl-1">  </span><span class="hl-4">label</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">/** Formatting function to convert data to string */</span><br/><span class="hl-1">  </span><span class="hl-0">format</span><span class="hl-1">: (</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-11">T</span><span class="hl-1">, </span><span class="hl-4">index</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">string</span><span class="hl-1"> | </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">string</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">/** Function to determine if column should be visible */</span><br/><span class="hl-1">  </span><span class="hl-0">isVisible</span><span class="hl-1">: () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">boolean</span><span class="hl-1"> | </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">boolean</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The <code>T</code> type parameter corresponds to the data model for each service:</p>
<ul>
<li>Backtest: <code>IStrategyTickResultClosed</code></li>
<li>Live: <code>TickEvent</code></li>
<li>Walker (strategy table): <code>IStrategyResult</code></li>
<li>Walker (PNL table): <code>SignalData</code></li>
<li>Performance: <code>MetricStats</code></li>
<li>Heatmap: <code>IHeatmapRow</code></li>
<li>Schedule: <code>ScheduledEvent</code></li>
<li>Partial: <code>PartialEvent</code></li>
<li>Risk: <code>RiskEvent</code></li>
</ul>
<a id="column-type-definitions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Column Type Definitions<a href="#column-type-definitions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/42_markdown-reports_1.svg" alt="Mermaid Diagram"></p>
<a id="custom-column-examples" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom Column Examples<a href="#custom-column-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Basic Backtest Columns:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">customColumns</span><span class="hl-1"> = [</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;id&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;ID&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;position&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Position&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">position</span><span class="hl-1">.</span><span class="hl-0">toUpperCase</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;pnl&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;PNL&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">pnl</span><span class="hl-9">.</span><span class="hl-4">pnlPercentage</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">report</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">, </span><span class="hl-4">customColumns</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Conditional Visibility:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">winColumn</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;bigWin&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Large Win&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &gt; </span><span class="hl-6">5</span><span class="hl-1"> ? </span><span class="hl-2">&quot;YES&quot;</span><span class="hl-1"> : </span><span class="hl-2">&quot;NO&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Could check environment, configuration, etc.</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-8">SHOW_WINS</span><span class="hl-1"> === </span><span class="hl-2">&quot;true&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><strong>Async Formatting:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">asyncColumn</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;formatted&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Formatted Price&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">index</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Can perform async operations</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">formatted</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">externalFormatter</span><span class="hl-1">(</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">priceOpen</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">formatted</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><strong>Walker Strategy Comparison:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">strategyColumns</span><span class="hl-1"> = [</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;sharpe&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Sharpe Ratio&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">sharpeRatio</span><span class="hl-1">?.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-6">3</span><span class="hl-1">) ?? </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;trades&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;Total Trades&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">totalSignals</span><span class="hl-1">.</span><span class="hl-0">toString</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-walker&quot;</span><span class="hl-1">, </span><span class="hl-4">strategyColumns</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="default-column-configuration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Default Column Configuration<a href="#default-column-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides default column configurations in <code>COLUMN_CONFIG</code>:</p>
<pre><code class="typescript"><span class="hl-5">// Default configurations used when no custom columns provided</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">COLUMN_CONFIG</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">backtest_columns:</span><span class="hl-1"> </span><span class="hl-4">Columns</span><span class="hl-1">[],</span><br/><span class="hl-1">  </span><span class="hl-4">live_columns:</span><span class="hl-1"> </span><span class="hl-4">Columns</span><span class="hl-1">[],</span><br/><span class="hl-1">  </span><span class="hl-4">walker_strategy_columns:</span><span class="hl-1"> </span><span class="hl-4">StrategyColumn</span><span class="hl-1">[],</span><br/><span class="hl-1">  </span><span class="hl-4">walker_pnl_columns:</span><span class="hl-1"> </span><span class="hl-4">PnlColumn</span><span class="hl-1">[],</span><br/><span class="hl-1">  </span><span class="hl-4">performance_columns:</span><span class="hl-1"> </span><span class="hl-4">Columns</span><span class="hl-1">[],</span><br/><span class="hl-1">  </span><span class="hl-4">heat_columns:</span><span class="hl-1"> </span><span class="hl-4">Columns</span><span class="hl-1">[],</span><br/><span class="hl-1">  </span><span class="hl-4">schedule_columns:</span><span class="hl-1"> </span><span class="hl-4">Columns</span><span class="hl-1">[],</span><br/><span class="hl-1">  </span><span class="hl-4">partial_columns:</span><span class="hl-1"> </span><span class="hl-4">Columns</span><span class="hl-1">[],</span><br/><span class="hl-1">  </span><span class="hl-4">risk_columns:</span><span class="hl-1"> </span><span class="hl-4">Columns</span><span class="hl-1">[]</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>All services reference these defaults:</p>
<pre><code class="typescript"><span class="hl-5">// Example from BacktestMarkdownService</span><br/><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">getReport</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-4">StrategyName</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">columns</span><span class="hl-1">: </span><span class="hl-4">Columns</span><span class="hl-1">[] = </span><span class="hl-8">COLUMN_CONFIG</span><span class="hl-1">.</span><span class="hl-4">backtest_columns</span><br/><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-5">// ...</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="report-storage-and-memory-management" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Report Storage and Memory Management<a href="#report-storage-and-memory-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="storage-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Storage Pattern<a href="#storage-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each service uses memoized storage instances to isolate data by unique keys:</p>
<pre><code class="typescript"><span class="hl-5">// Example from BacktestMarkdownService</span><br/><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">getStorage</span><span class="hl-1"> = </span><span class="hl-0">memoize</span><span class="hl-1">&lt;(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">ReportStorage</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">  ([</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">:</span><span class="hl-7">${</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">  () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">ReportStorage</span><span class="hl-1">()</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="memory-limits" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memory Limits<a href="#memory-limits" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Service</th>
<th>Max Events</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>Backtest</td>
<td>250</td>
<td>Balance history vs memory</td>
</tr>
<tr>
<td>Live</td>
<td>250</td>
<td>Balance history vs memory</td>
</tr>
<tr>
<td>Walker</td>
<td>Unlimited</td>
<td>All strategies needed for comparison</td>
</tr>
<tr>
<td>Performance</td>
<td>10,000</td>
<td>Granular profiling data</td>
</tr>
<tr>
<td>Heatmap</td>
<td>250 per symbol</td>
<td>Portfolio-wide aggregation</td>
</tr>
<tr>
<td>Schedule</td>
<td>250</td>
<td>Balance history vs memory</td>
</tr>
<tr>
<td>Partial</td>
<td>250</td>
<td>Balance history vs memory</td>
</tr>
<tr>
<td>Risk</td>
<td>250</td>
<td>Balance history vs memory</td>
</tr>
</tbody>
</table>
<a id="circular-buffer-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Circular Buffer Implementation<a href="#circular-buffer-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Storage uses unshift/pop pattern to maintain FIFO ordering:</p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-4">IStrategyTickResultClosed</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">unshift</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);  </span><span class="hl-5">// Add to front</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Trim from back if exceeded</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-8">MAX_EVENTS</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">pop</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="deduplication-strategies" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Deduplication Strategies<a href="#deduplication-strategies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Idle Events (Live):</strong></p>
<pre><code class="typescript"><span class="hl-5">// Replace last idle if no opened/active events follow</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">canReplaceLastIdle</span><span class="hl-1"> = </span><span class="hl-4">lastIdleIndex</span><span class="hl-1"> !== -</span><span class="hl-6">1</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">  !</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-4">lastIdleIndex</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-0">some</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1"> || </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">canReplaceLastIdle</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">[</span><span class="hl-4">lastIdleIndex</span><span class="hl-1">] = </span><span class="hl-4">newEvent</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Active Events (Live):</strong></p>
<pre><code class="typescript"><span class="hl-5">// Replace last active event with same signalId</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">lastActiveIndex</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-0">findLastIndex</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">signalId</span><span class="hl-1"> === </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">lastActiveIndex</span><span class="hl-1"> !== -</span><span class="hl-6">1</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">[</span><span class="hl-4">lastActiveIndex</span><span class="hl-1">] = </span><span class="hl-4">newEvent</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="clearing-storage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Clearing Storage<a href="#clearing-storage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All services provide <code>clear()</code> methods:</p>
<pre><code class="typescript"><span class="hl-5">// Clear specific key</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">service</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">({ </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// Clear all data</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">service</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// Clear by strategy (heatmap)</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">service</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Storage is automatically cleared at the start of each execution:</p>
<pre><code class="typescript"><span class="hl-5">// From Backtest.run()</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">backtestMarkdownService</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">scheduleMarkdownService</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1"> });</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="file-system-output" class="tsd-anchor"></a><h2 class="tsd-anchor-link">File System Output<a href="#file-system-output" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="directory-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Directory Structure<a href="#directory-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Default output paths organize reports by type:</p>
<pre><code><span class="hl-1">.</span><span class="hl-15">/dump/</span><br/><span class="hl-1"> </span><span class="hl-4">backtest</span><span class="hl-1">/{</span><span class="hl-4">strategyName</span><span class="hl-1">}.</span><span class="hl-4">md</span><br/><span class="hl-1"> </span><span class="hl-4">live</span><span class="hl-1">/{</span><span class="hl-4">strategyName</span><span class="hl-1">}.</span><span class="hl-4">md</span><br/><span class="hl-1"> </span><span class="hl-4">walker</span><span class="hl-1">/{</span><span class="hl-4">walkerName</span><span class="hl-1">}.</span><span class="hl-4">md</span><br/><span class="hl-1"> </span><span class="hl-4">performance</span><span class="hl-1">/{</span><span class="hl-4">strategyName</span><span class="hl-1">}.</span><span class="hl-4">md</span><br/><span class="hl-1"> </span><span class="hl-4">heatmap</span><span class="hl-1">/{</span><span class="hl-4">strategyName</span><span class="hl-1">}.</span><span class="hl-4">md</span><br/><span class="hl-1"> </span><span class="hl-4">schedule</span><span class="hl-1">/{</span><span class="hl-4">strategyName</span><span class="hl-1">}.</span><span class="hl-4">md</span><br/><span class="hl-1"> </span><span class="hl-4">partial</span><span class="hl-1">/{</span><span class="hl-4">symbol</span><span class="hl-1">}</span><span class="hl-4">_</span><span class="hl-1">{</span><span class="hl-4">strategyName</span><span class="hl-1">}.</span><span class="hl-4">md</span><br/><span class="hl-1"> </span><span class="hl-4">risk</span><span class="hl-1">/{</span><span class="hl-4">symbol</span><span class="hl-1">}</span><span class="hl-4">_</span><span class="hl-1">{</span><span class="hl-4">strategyName</span><span class="hl-1">}.</span><span class="hl-4">md</span>
</code><button>Copy</button></pre>

<a id="dump-implementation-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Dump Implementation Pattern<a href="#dump-implementation-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All <code>dump()</code> methods follow this pattern:</p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">dump</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-4">StrategyName</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">path</span><span class="hl-1"> = </span><span class="hl-2">&quot;./dump/backtest&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">columns</span><span class="hl-1">: </span><span class="hl-4">Columns</span><span class="hl-1">[] = </span><span class="hl-8">COLUMN_CONFIG</span><span class="hl-1">.</span><span class="hl-4">backtest_columns</span><br/><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  const </span><span class="hl-4">markdown</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">columns</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  try {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">dir</span><span class="hl-1"> = </span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-0">cwd</span><span class="hl-1">(), </span><span class="hl-4">path</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">mkdir</span><span class="hl-1">(</span><span class="hl-4">dir</span><span class="hl-1">, { </span><span class="hl-4">recursive:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">filename</span><span class="hl-1"> = </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2">.md`</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">filepath</span><span class="hl-1"> = </span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-4">dir</span><span class="hl-1">, </span><span class="hl-4">filename</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">writeFile</span><span class="hl-1">(</span><span class="hl-4">filepath</span><span class="hl-1">, </span><span class="hl-4">markdown</span><span class="hl-1">, </span><span class="hl-2">&quot;utf-8&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Backtest report saved: </span><span class="hl-7">${</span><span class="hl-4">filepath</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  } catch (error) {</span><br/><span class="hl-1">    console.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">`Failed to save markdown report:`</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Process:</p>
<ol>
<li>Generate markdown via <code>getReport()</code></li>
<li>Resolve absolute path from <code>process.cwd()</code></li>
<li>Create directory recursively (<code>mkdir</code> with <code>recursive: true</code>)</li>
<li>Write UTF-8 encoded file</li>
<li>Log success/failure to console</li>
</ol>
<a id="event-subscription-and-initialization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Subscription and Initialization<a href="#event-subscription-and-initialization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Services automatically subscribe to emitters during initialization using <code>singleshot</code>:</p>
<pre><code class="typescript"><span class="hl-4">protected</span><span class="hl-1"> </span><span class="hl-4">init</span><span class="hl-1"> = </span><span class="hl-0">singleshot</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;backtestMarkdownService init&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">signalBacktestEmitter</span><span class="hl-1">.</span><span class="hl-0">subscribe</span><span class="hl-1">(</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">tick</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The <code>tick()</code> method (private) processes incoming events:</p>
<pre><code class="typescript"><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-0">tick</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-11">IStrategyTickResult</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;backtestMarkdownService tick&quot;</span><span class="hl-1">, { </span><span class="hl-4">data</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> !== </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1">;  </span><span class="hl-5">// Backtest only processes closed signals</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">storage</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">getStorage</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">storage</span><span class="hl-1">.</span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>The <code>singleshot</code> wrapper ensures subscription happens only once, even if the service is accessed multiple times.</p>
<a id="safe-math-and-statistics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Safe Math and Statistics<a href="#safe-math-and-statistics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All services implement safe math checks to handle edge cases gracefully:</p>
<a id="isunsafe-helper" class="tsd-anchor"></a><h3 class="tsd-anchor-link">isUnsafe() Helper<a href="#isunsafe-helper" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">): </span><span class="hl-11">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">typeof</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1"> !== </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-0">isNaN</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-0">isFinite</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">false</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="null-value-handling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Null Value Handling<a href="#null-value-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Statistics calculations check each metric:</p>
<pre><code class="typescript"><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">signalList:</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">totalSignals</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">winCount</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">lossCount</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">winRate:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">winRate</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">winRate</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">avgPnl:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">avgPnl</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">avgPnl</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">totalPnl:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">totalPnl</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">totalPnl</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">stdDev:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">stdDev</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">stdDev</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">sharpeRatio:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">sharpeRatio</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">sharpeRatio</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">annualizedSharpeRatio:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">annualizedSharpeRatio</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">annualizedSharpeRatio</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">certaintyRatio:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">certaintyRatio</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">certaintyRatio</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">expectedYearlyReturns:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">expectedYearlyReturns</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">expectedYearlyReturns</span><span class="hl-1">,</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<a id="report-display" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Report Display<a href="#report-display" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Null values display as &quot;N/A&quot;:</p>
<pre><code class="typescript"><span class="hl-2">`**Average PNL:** </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">avgPnl</span><span class="hl-9"> </span><span class="hl-1">===</span><span class="hl-9"> </span><span class="hl-7">null</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">avgPnl</span><span class="hl-9"> </span><span class="hl-1">&gt;</span><span class="hl-9"> </span><span class="hl-6">0</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;+&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">&quot;&quot;</span><span class="hl-7">}${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">avgPnl</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-7">}</span><span class="hl-2">`</span>
</code><button type="button">Copy</button></pre>

<p>This ensures reports are always readable even with insufficient data or calculation edge cases.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#markdown-reports"><span>Markdown <wbr/>Reports</span></a><ul><li><a href="#overview-of-markdown-services"><span>Overview of <wbr/>Markdown <wbr/>Services</span></a></li><li><a href="#service-architecture-and-data-flow"><span>Service <wbr/>Architecture and <wbr/>Data <wbr/>Flow</span></a></li><li><a href="#common-api-pattern"><span>Common API <wbr/>Pattern</span></a></li><li><ul><li><a href="#getdata"><span>get<wbr/>Data()</span></a></li><li><a href="#getreport"><span>get<wbr/>Report()</span></a></li><li><a href="#dump"><span>dump()</span></a></li></ul></li><li><a href="#backtest-reports"><span>Backtest <wbr/>Reports</span></a></li><li><ul><li><a href="#characteristics"><span>Characteristics</span></a></li><li><a href="#statistics-calculated"><span>Statistics <wbr/>Calculated</span></a></li><li><a href="#usage-example"><span>Usage <wbr/>Example</span></a></li><li><a href="#report-structure"><span>Report <wbr/>Structure</span></a></li></ul></li><li><a href="#live-trading-reports"><span>Live <wbr/>Trading <wbr/>Reports</span></a></li><li><ul><li><a href="#characteristics-1"><span>Characteristics</span></a></li><li><a href="#event-types-tracked"><span>Event <wbr/>Types <wbr/>Tracked</span></a></li><li><a href="#special-deduplication-logic"><span>Special <wbr/>Deduplication <wbr/>Logic</span></a></li><li><a href="#usage-example-1"><span>Usage <wbr/>Example</span></a></li></ul></li><li><a href="#walker-comparison-reports"><span>Walker <wbr/>Comparison <wbr/>Reports</span></a></li><li><ul><li><a href="#characteristics-2"><span>Characteristics</span></a></li><li><a href="#data-structure"><span>Data <wbr/>Structure</span></a></li><li><a href="#report-tables"><span>Report <wbr/>Tables</span></a></li><li><a href="#usage-example-2"><span>Usage <wbr/>Example</span></a></li><li><a href="#report-structure-1"><span>Report <wbr/>Structure</span></a></li></ul></li><li><a href="#specialized-report-services"><span>Specialized <wbr/>Report <wbr/>Services</span></a></li><li><ul><li><a href="#performance-reports"><span>Performance <wbr/>Reports</span></a></li><li><a href="#heatmap-reports"><span>Heatmap <wbr/>Reports</span></a></li><li><a href="#schedule-reports"><span>Schedule <wbr/>Reports</span></a></li><li><a href="#partial-reports"><span>Partial <wbr/>Reports</span></a></li><li><a href="#risk-reports"><span>Risk <wbr/>Reports</span></a></li></ul></li><li><a href="#column-customization"><span>Column <wbr/>Customization</span></a></li><li><ul><li><a href="#columnmodel-interface"><span>Column<wbr/>Model <wbr/>Interface</span></a></li><li><a href="#column-type-definitions"><span>Column <wbr/>Type <wbr/>Definitions</span></a></li><li><a href="#custom-column-examples"><span>Custom <wbr/>Column <wbr/>Examples</span></a></li></ul></li><li><a href="#default-column-configuration"><span>Default <wbr/>Column <wbr/>Configuration</span></a></li><li><a href="#report-storage-and-memory-management"><span>Report <wbr/>Storage and <wbr/>Memory <wbr/>Management</span></a></li><li><ul><li><a href="#storage-pattern"><span>Storage <wbr/>Pattern</span></a></li><li><a href="#memory-limits"><span>Memory <wbr/>Limits</span></a></li><li><a href="#circular-buffer-implementation"><span>Circular <wbr/>Buffer <wbr/>Implementation</span></a></li><li><a href="#deduplication-strategies"><span>Deduplication <wbr/>Strategies</span></a></li><li><a href="#clearing-storage"><span>Clearing <wbr/>Storage</span></a></li></ul></li><li><a href="#file-system-output"><span>File <wbr/>System <wbr/>Output</span></a></li><li><ul><li><a href="#directory-structure"><span>Directory <wbr/>Structure</span></a></li><li><a href="#dump-implementation-pattern"><span>Dump <wbr/>Implementation <wbr/>Pattern</span></a></li></ul></li><li><a href="#event-subscription-and-initialization"><span>Event <wbr/>Subscription and <wbr/>Initialization</span></a></li><li><a href="#safe-math-and-statistics"><span>Safe <wbr/>Math and <wbr/>Statistics</span></a></li><li><ul><li><a href="#isunsafe-helper"><span>is<wbr/>Unsafe() <wbr/>Helper</span></a></li><li><a href="#null-value-handling"><span>Null <wbr/>Value <wbr/>Handling</span></a></li><li><a href="#report-display"><span>Report <wbr/>Display</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
