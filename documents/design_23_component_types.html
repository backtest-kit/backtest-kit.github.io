<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/23_component_types | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_23_component_types.html">design/23_component_types</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="component-types" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Component Types<a href="#component-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Component types define the schema interfaces for all registerable components in the backtest-kit framework. Each component type represents a distinct architectural concern: strategies define signal generation logic, exchanges provide market data, frames specify backtesting periods, risk profiles enforce portfolio constraints, sizing algorithms calculate position quantities, walkers orchestrate strategy comparisons, and optimizers generate AI-powered strategies. All components are registered via <code>add*</code> functions that validate schemas and store them in corresponding schema services for dependency injection.</p>
<p>For information about how these components are instantiated and connected at runtime, see <a href="design_38_service_layer.html">Service Layer</a>. For details on the registration and validation process, see <a href="design_08_component_registration.html">Component Registration</a>. For the public API signatures of registration functions, see <a href="design_16_component_registration_functions.html">Component Registration Functions</a>.</p>
<hr>
<a id="component-type-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Component Type Architecture<a href="#component-type-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework organizes components into seven distinct types, each registered through a dedicated function and validated by a corresponding service. All schemas follow a consistent pattern: a required <code>name</code> field for unique identification, optional <code>note</code> field for documentation, required configuration parameters specific to the component type, and optional <code>callbacks</code> object for lifecycle hooks.</p>
<p><img src="../media/23_Component_Types_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="schema-interface-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Schema Interface Pattern<a href="#schema-interface-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All component schemas share a common structural pattern with three tiers of fields: identification (unique name), configuration (component-specific parameters), and hooks (optional lifecycle callbacks). The name field serves as the primary key in schema services, configuration fields define component behavior, and callbacks enable event-driven integration with external systems.</p>
<table>
<thead>
<tr>
<th>Field Category</th>
<th>Purpose</th>
<th>Common Fields</th>
<th>Component-Specific</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Identification</strong></td>
<td>Unique component reference</td>
<td><code>*Name: string</code> (strategyName, exchangeName, etc.)</td>
<td>Required for all types</td>
</tr>
<tr>
<td><strong>Documentation</strong></td>
<td>Developer annotations</td>
<td><code>note?: string</code></td>
<td>Optional for all types</td>
</tr>
<tr>
<td><strong>Configuration</strong></td>
<td>Component behavior</td>
<td>Varies by type</td>
<td>Required, type-specific validation</td>
</tr>
<tr>
<td><strong>Lifecycle Hooks</strong></td>
<td>Event callbacks</td>
<td><code>callbacks?: Partial&lt;I*Callbacks&gt;</code></td>
<td>Optional, type-specific events</td>
</tr>
</tbody>
</table>
<hr>
<a id="registration-and-validation-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Registration and Validation Flow<a href="#registration-and-validation-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Component registration follows a three-phase pipeline: user code calls an <code>add*</code> function with a schema object, the function delegates to a validation service that applies 10-30 validation rules depending on component type, and upon successful validation the schema is stored in a schema service for later retrieval by connection services during execution.</p>
<p><img src="../media/23_Component_Types_1.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="strategy-schemas-istrategyschema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Strategy Schemas (IStrategySchema)<a href="#strategy-schemas-istrategyschema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Strategy schemas define signal generation logic through a required <code>getSignal</code> function that returns trading signals or null. The schema specifies signal generation interval for throttling, optional risk profile reference for portfolio-level constraints, and lifecycle callbacks that fire on signal state transitions (idle, scheduled, opened, active, closed, cancelled).</p>
<a id="interface-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interface Structure<a href="#interface-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IStrategySchema</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">StrategyName</span><span class="hl-1">;           </span><span class="hl-5">// Unique identifier (string)</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;                        </span><span class="hl-5">// Optional documentation</span><br/><span class="hl-1">  </span><span class="hl-4">interval</span><span class="hl-1">: </span><span class="hl-10">SignalInterval</span><span class="hl-1">;             </span><span class="hl-5">// &quot;1m&quot; | &quot;3m&quot; | &quot;5m&quot; | &quot;15m&quot; | &quot;30m&quot; | &quot;1h&quot;</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">ISignalDto</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks</span><span class="hl-1">?: </span><span class="hl-10">Partial</span><span class="hl-1">&lt;</span><span class="hl-10">IStrategyCallbacks</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-4">riskName</span><span class="hl-1">?: </span><span class="hl-10">RiskName</span><span class="hl-1">;                  </span><span class="hl-5">// Optional risk profile reference</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">SignalInterval</span><span class="hl-1"> = </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;3m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;30m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">StrategyName</span><span class="hl-1"> = </span><span class="hl-10">string</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key Fields:</strong></p>
<ul>
<li><strong><code>strategyName</code></strong>: Primary key for strategy lookup in <code>StrategySchemaService</code>. Must be unique across all registered strategies.</li>
<li><strong><code>interval</code></strong>: Minimum time between <code>getSignal()</code> calls. Enforced by <code>ClientStrategy._lastSignalTimestamp</code> to prevent signal spam. Converted to milliseconds via <code>INTERVAL_MINUTES</code> lookup table.</li>
<li><strong><code>getSignal</code></strong>: Core signal generation function. Returns <code>ISignalDto</code> with prices and timing, or <code>null</code> if no opportunity. If <code>priceOpen</code> is provided in the returned DTO, creates a scheduled signal waiting for price activation; if omitted, opens immediately at current VWAP.</li>
<li><strong><code>riskName</code></strong>: Optional reference to <code>IRiskSchema</code> for portfolio-level risk management. If provided, <code>ClientRisk.checkSignal()</code> is called before signal creation and activation.</li>
<li><strong><code>callbacks</code></strong>: Optional hooks for signal lifecycle events (see callback diagram below).</li>
</ul>
<a id="signal-dto-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signal DTO Structure<a href="#signal-dto-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>ISignalDto</code> object returned by <code>getSignal()</code> is transformed into <code>ISignalRow</code> with additional metadata before storage. The framework auto-generates <code>id</code> (UUID v4), sets <code>priceOpen</code> to current VWAP if omitted, injects <code>symbol</code>/<code>exchangeName</code>/<code>strategyName</code> from context, and records <code>scheduledAt</code>/<code>pendingAt</code> timestamps.</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ISignalDto</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;                          </span><span class="hl-5">// Optional (auto-generated UUID v4)</span><br/><span class="hl-1">  </span><span class="hl-4">position</span><span class="hl-1">: </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;short&quot;</span><span class="hl-1">;           </span><span class="hl-5">// Trade direction</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;                        </span><span class="hl-5">// Human-readable signal reason</span><br/><span class="hl-1">  </span><span class="hl-4">priceOpen</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;                   </span><span class="hl-5">// Entry price (if provided â†’ scheduled signal)</span><br/><span class="hl-1">  </span><span class="hl-4">priceTakeProfit</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;              </span><span class="hl-5">// TP target (must be &gt; priceOpen for long)</span><br/><span class="hl-1">  </span><span class="hl-4">priceStopLoss</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;                </span><span class="hl-5">// SL exit (must be &lt; priceOpen for long)</span><br/><span class="hl-1">  </span><span class="hl-4">minuteEstimatedTime</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;          </span><span class="hl-5">// Max signal lifetime before time_expired</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ISignalRow</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-10">ISignalDto</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;                           </span><span class="hl-5">// Required after transformation</span><br/><span class="hl-1">  </span><span class="hl-4">priceOpen</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;                    </span><span class="hl-5">// Required after transformation</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">ExchangeName</span><span class="hl-1">;           </span><span class="hl-5">// Injected from context</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">StrategyName</span><span class="hl-1">;           </span><span class="hl-5">// Injected from context</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;                       </span><span class="hl-5">// Injected from context</span><br/><span class="hl-1">  </span><span class="hl-4">scheduledAt</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;                  </span><span class="hl-5">// Signal creation timestamp (ms)</span><br/><span class="hl-1">  </span><span class="hl-4">pendingAt</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;                    </span><span class="hl-5">// Activation timestamp (ms)</span><br/><span class="hl-1">  </span><span class="hl-4">_isScheduled</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">;                </span><span class="hl-5">// Internal marker for scheduled signals</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Validation Rules (30+ checks):</strong></p>
<ol>
<li><strong>Required fields:</strong> <code>position</code>, <code>priceTakeProfit</code>, <code>priceStopLoss</code>, <code>minuteEstimatedTime</code></li>
<li><strong>NaN/Infinity protection:</strong> All prices must be finite numbers</li>
<li><strong>Positive prices:</strong> All prices must be &gt; 0</li>
<li><strong>Long position logic:</strong> <code>priceTakeProfit &gt; priceOpen &gt; priceStopLoss</code></li>
<li><strong>Short position logic:</strong> <code>priceStopLoss &gt; priceOpen &gt; priceTakeProfit</code></li>
<li><strong>Edge case protection:</strong> For immediate signals, <code>currentPrice</code> must not have breached SL/TP</li>
<li><strong>Micro-profit prevention:</strong> TP distance must exceed <code>CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</code> (default 0.3%) to cover trading fees</li>
<li><strong>Extreme SL protection:</strong> SL distance must not exceed <code>CC_MAX_STOPLOSS_DISTANCE_PERCENT</code> (default 20%)</li>
<li><strong>Time limits:</strong> <code>minuteEstimatedTime</code> must not exceed <code>CC_MAX_SIGNAL_LIFETIME_MINUTES</code> (default 1440 = 1 day)</li>
</ol>
<a id="strategy-lifecycle-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Strategy Lifecycle Callbacks<a href="#strategy-lifecycle-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Strategy callbacks fire at eight distinct lifecycle points, providing hooks for logging, monitoring, and custom business logic. All callbacks receive the <code>backtest</code> boolean flag to distinguish between historical simulation and live trading.</p>
<p><img src="../media/23_Component_Types_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Callback Interface:</strong></p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IStrategyCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onTick</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">: </span><span class="hl-10">IStrategyTickResult</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onIdle</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onSchedule</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">IScheduledSignalRow</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onOpen</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">ISignalRow</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onActive</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">ISignalRow</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onPartialProfit</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">ISignalRow</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">revenuePercent</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onPartialLoss</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">ISignalRow</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">lossPercent</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onClose</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">ISignalRow</span><span class="hl-1">, </span><span class="hl-4">priceClose</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onCancel</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">IScheduledSignalRow</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onWrite</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">ISignalRow</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Callback Invocation Points:</strong></p>
<ul>
<li><strong><code>onTick</code></strong>: Called at the end of every <code>tick()</code> call with the discriminated union result (<code>IStrategyTickResult</code>). Use for comprehensive state tracking.</li>
<li><strong><code>onIdle</code></strong>: Fired when no active signal exists and <code>getSignal()</code> returns null.</li>
<li><strong><code>onSchedule</code></strong>: Triggered when <code>getSignal()</code> returns a signal with <code>priceOpen</code> specified. Signal is written to persistence layer (live mode only).</li>
<li><strong><code>onOpen</code></strong>: Called when signal opens (either immediate open or scheduled signal activation). Occurs after risk validation and persistence write.</li>
<li><strong><code>onActive</code></strong>: Fires on every tick while monitoring an active position (between open and close). Useful for real-time monitoring dashboards.</li>
<li><strong><code>onPartialProfit</code></strong>: Emitted when unrealized profit crosses 10%/20%/30%/...100% thresholds. Deduplicated via <code>ClientPartial</code> state tracking.</li>
<li><strong><code>onPartialLoss</code></strong>: Emitted when unrealized loss crosses -10%/-20%/-30%/...-100% thresholds. Deduplicated via <code>ClientPartial</code> state tracking.</li>
<li><strong><code>onClose</code></strong>: Triggered when signal closes with <code>closeReason</code> (&quot;take_profit&quot; | &quot;stop_loss&quot; | &quot;time_expired&quot;) and calculated PnL. Signal is removed from persistence layer.</li>
<li><strong><code>onCancel</code></strong>: Fires when scheduled signal is cancelled without opening (timeout or pre-activation SL breach).</li>
<li><strong><code>onWrite</code></strong>: Low-level hook called whenever signal state is persisted (open) or cleared (close/cancel). Used for testing persistence layer.</li>
</ul>
<a id="registration-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Example<a href="#registration-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addStrategy</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;rsi-oversold-long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Buy when RSI &lt; 30, sell at +2% TP or -1% SL&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">rsi</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">calculateRSI</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">, </span><span class="hl-8">14</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">rsi</span><span class="hl-1"> &gt;= </span><span class="hl-8">30</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">null</span><span class="hl-1">; </span><span class="hl-5">// No signal</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">currentPrice</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCurrentPrice</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">`RSI oversold: </span><span class="hl-6">${</span><span class="hl-4">rsi</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-4">currentPrice</span><span class="hl-1"> * </span><span class="hl-8">1.02</span><span class="hl-1">,  </span><span class="hl-5">// +2%</span><br/><span class="hl-1">      </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-4">currentPrice</span><span class="hl-1"> * </span><span class="hl-8">0.99</span><span class="hl-1">,     </span><span class="hl-5">// -1%</span><br/><span class="hl-1">      </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-8">120</span><span class="hl-1">,               </span><span class="hl-5">// 2 hours</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onOpen</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[OPEN] </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2"> </span><span class="hl-6">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">position</span><span class="hl-6">}</span><span class="hl-2"> @ </span><span class="hl-6">${</span><span class="hl-4">currentPrice</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onClose</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">priceClose</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[CLOSE] </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2"> @ </span><span class="hl-6">${</span><span class="hl-4">priceClose</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="exchange-schemas-iexchangeschema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Exchange Schemas (IExchangeSchema)<a href="#exchange-schemas-iexchangeschema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Exchange schemas provide market data access through three required functions: <code>getCandles</code> for historical OHLCV data, <code>formatPrice</code> for exchange-specific price precision, and <code>formatQuantity</code> for lot size formatting. Exchanges integrate with CCXT libraries, databases, or custom REST APIs to supply candle data for backtesting and VWAP calculation.</p>
<a id="interface-structure-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interface Structure<a href="#interface-structure-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IExchangeSchema</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">ExchangeName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">: </span><span class="hl-10">CandleInterval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">ICandleData</span><span class="hl-1">[]&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">formatQuantity</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">formatPrice</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks</span><span class="hl-1">?: </span><span class="hl-10">Partial</span><span class="hl-1">&lt;</span><span class="hl-10">IExchangeCallbacks</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">CandleInterval</span><span class="hl-1"> = </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;3m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;30m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;2h&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;4h&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;6h&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;8h&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">ExchangeName</span><span class="hl-1"> = </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ICandleData</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;  </span><span class="hl-5">// Unix milliseconds</span><br/><span class="hl-1">  </span><span class="hl-4">open</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">high</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">low</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">close</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">volume</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key Fields:</strong></p>
<ul>
<li><strong><code>exchangeName</code></strong>: Primary key for exchange lookup in <code>ExchangeSchemaService</code>. Used to route candle requests to correct data source.</li>
<li><strong><code>getCandles</code></strong>: Core data fetching function. Must return array of <code>ICandleData</code> sorted by timestamp ascending. Called by <code>ClientExchange.getCandles()</code> with retry logic (<code>CC_GET_CANDLES_RETRY_COUNT</code> = 3 attempts, <code>CC_GET_CANDLES_RETRY_DELAY_MS</code> = 5000ms delay).</li>
<li><strong><code>formatPrice</code></strong>: Exchange-specific price formatting (e.g., 2 decimals for BTC/USDT, 8 decimals for alts). Used when displaying prices in reports.</li>
<li><strong><code>formatQuantity</code></strong>: Lot size formatting based on exchange rules (e.g., minimum quantity = 0.001 BTC). Used for position sizing display.</li>
<li><strong><code>callbacks.onCandleData</code></strong>: Optional hook called after successful candle fetch. Receives <code>symbol</code>, <code>interval</code>, <code>since</code>, <code>limit</code>, and fetched <code>data</code> array.</li>
</ul>
<a id="candle-data-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Candle Data Flow<a href="#candle-data-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>ClientExchange</code> wraps the schema's <code>getCandles</code> function with additional logic: anomaly detection filters out incomplete candles with near-zero prices, retry logic handles transient API failures, and execution context determines whether to fetch backward (past candles) or forward (future candles for backtest fast-forward).</p>
<p><img src="../media/23_Component_Types_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Anomaly Detection Logic:</strong></p>
<p>The framework applies price anomaly detection to filter incomplete candles from Binance API responses. Candles with prices below <code>median / CC_GET_CANDLES_PRICE_ANOMALY_THRESHOLD_FACTOR</code> (default 1000x deviation) are rejected. This catches incomplete candles with $0.01-$1 prices when median is $20k-$100k.</p>
<a id="exchange-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Exchange Callbacks<a href="#exchange-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IExchangeCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onCandleData</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">: </span><span class="hl-10">CandleInterval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">ICandleData</span><span class="hl-1">[]) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong><code>onCandleData</code></strong>: Called after successful candle fetch but before anomaly detection. Receives all parameters passed to <code>getCandles</code> plus the returned data array. Useful for logging, caching, or monitoring data source health.</p>
<a id="registration-example-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Example<a href="#registration-example-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addExchange</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;ccxt&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">binance</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-4">ccxt</span><span class="hl-1">.</span><span class="hl-0">binance</span><span class="hl-1">({ </span><span class="hl-4">enableRateLimit:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> });</span><br/><br/><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance-spot&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Binance spot market via CCXT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">ohlcv</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">binance</span><span class="hl-1">.</span><span class="hl-0">fetchOHLCV</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">(), </span><span class="hl-4">limit</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">ohlcv</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(([</span><span class="hl-4">timestamp</span><span class="hl-1">, </span><span class="hl-4">open</span><span class="hl-1">, </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-4">volume</span><span class="hl-1">]) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">open</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">high</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">low</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">close</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">volume</span><span class="hl-1">,</span><br/><span class="hl-1">    }));</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">formatPrice</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">market</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">binance</span><span class="hl-1">.</span><span class="hl-0">loadMarkets</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">precision</span><span class="hl-1"> = </span><span class="hl-4">market</span><span class="hl-1">[</span><span class="hl-4">symbol</span><span class="hl-1">].</span><span class="hl-4">precision</span><span class="hl-1">.</span><span class="hl-4">price</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">price</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-4">precision</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">formatQuantity</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">market</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">binance</span><span class="hl-1">.</span><span class="hl-0">loadMarkets</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">precision</span><span class="hl-1"> = </span><span class="hl-4">market</span><span class="hl-1">[</span><span class="hl-4">symbol</span><span class="hl-1">].</span><span class="hl-4">precision</span><span class="hl-1">.</span><span class="hl-4">amount</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">quantity</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-4">precision</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onCandleData</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Fetched </span><span class="hl-6">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> </span><span class="hl-6">${</span><span class="hl-4">interval</span><span class="hl-6">}</span><span class="hl-2"> candles for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="frame-schemas-iframeschema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Frame Schemas (IFrameSchema)<a href="#frame-schemas-iframeschema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frame schemas define backtesting time periods by specifying <code>startDate</code>, <code>endDate</code>, and <code>interval</code> for timeframe generation. The framework generates an array of <code>Date</code> objects spaced by the interval, which <code>BacktestLogicPrivateService</code> iterates through when calling <code>ClientStrategy.tick()</code> for each timestamp.</p>
<a id="interface-structure-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interface Structure<a href="#interface-structure-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IFrameSchema</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-10">FrameName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">interval</span><span class="hl-1">: </span><span class="hl-10">FrameInterval</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">startDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">endDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks</span><span class="hl-1">?: </span><span class="hl-10">Partial</span><span class="hl-1">&lt;</span><span class="hl-10">IFrameCallbacks</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">FrameInterval</span><span class="hl-1"> = </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;3m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;30m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;2h&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;4h&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;6h&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;8h&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;12h&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;1d&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;3d&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">FrameName</span><span class="hl-1"> = </span><span class="hl-10">string</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key Fields:</strong></p>
<ul>
<li><strong><code>frameName</code></strong>: Primary key for frame lookup in <code>FrameSchemaService</code>. Used by backtest and walker modes to retrieve timeframe generators.</li>
<li><strong><code>interval</code></strong>: Spacing between generated timestamps. Converted to milliseconds and added iteratively from <code>startDate</code> to <code>endDate</code>.</li>
<li><strong><code>startDate</code></strong>: Inclusive start of backtest period. First generated timestamp.</li>
<li><strong><code>endDate</code></strong>: Inclusive end of backtest period. Last generated timestamp (may be truncated to align with interval).</li>
<li><strong><code>callbacks.onTimeframe</code></strong>: Optional hook called after timeframe array generation. Receives the complete array, start/end dates, and interval.</li>
</ul>
<a id="timeframe-generation-logic" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Timeframe Generation Logic<a href="#timeframe-generation-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>ClientFrame.getTimeframe()</code> generates timestamps by starting at <code>startDate</code> and incrementing by <code>interval</code> milliseconds until exceeding <code>endDate</code>. The resulting array is chronologically ordered and used by <code>BacktestLogicPrivateService</code> for sequential strategy execution.</p>
<p><img src="../media/23_Component_Types_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Interval to Milliseconds Conversion:</strong></p>
<table>
<thead>
<tr>
<th>Interval</th>
<th>Milliseconds</th>
<th>Duration</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&quot;1m&quot;</code></td>
<td>60,000</td>
<td>1 minute</td>
</tr>
<tr>
<td><code>&quot;5m&quot;</code></td>
<td>300,000</td>
<td>5 minutes</td>
</tr>
<tr>
<td><code>&quot;15m&quot;</code></td>
<td>900,000</td>
<td>15 minutes</td>
</tr>
<tr>
<td><code>&quot;1h&quot;</code></td>
<td>3,600,000</td>
<td>1 hour</td>
</tr>
<tr>
<td><code>&quot;1d&quot;</code></td>
<td>86,400,000</td>
<td>1 day</td>
</tr>
</tbody>
</table>
<a id="frame-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Frame Callbacks<a href="#frame-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IFrameCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onTimeframe</span><span class="hl-1">: (</span><span class="hl-4">timeframe</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">[], </span><span class="hl-4">startDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">: </span><span class="hl-10">FrameInterval</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong><code>onTimeframe</code></strong>: Called once after timeframe array generation. Receives the complete array of timestamps, the original start/end dates, and the interval. Useful for logging timeframe size or validating date ranges before backtest execution.</p>
<a id="registration-example-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Example<a href="#registration-example-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addFrame</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;2024-q1-1h&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Q1 2024 backtest with 1-hour intervals&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-03-31T23:59:59Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onTimeframe</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">timeframe</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-6">${</span><span class="hl-4">timeframe</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> timestamps`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`First: </span><span class="hl-6">${</span><span class="hl-4">timeframe</span><span class="hl-9">[</span><span class="hl-8">0</span><span class="hl-9">].</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Last: </span><span class="hl-6">${</span><span class="hl-4">timeframe</span><span class="hl-9">[</span><span class="hl-4">timeframe</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-9"> </span><span class="hl-1">-</span><span class="hl-9"> </span><span class="hl-8">1</span><span class="hl-9">].</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="risk-schemas-iriskschema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Risk Schemas (IRiskSchema)<a href="#risk-schemas-iriskschema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Risk schemas enforce portfolio-level constraints through custom validation functions that execute before signal creation and activation. Each validation receives the current risk check parameters (symbol, strategy, price, timestamp) plus portfolio state (active position count, active positions array) and throws errors to reject signals that violate risk rules.</p>
<a id="interface-structure-3" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interface Structure<a href="#interface-structure-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskSchema</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">riskName</span><span class="hl-1">: </span><span class="hl-10">RiskName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks</span><span class="hl-1">?: </span><span class="hl-10">Partial</span><span class="hl-1">&lt;</span><span class="hl-10">IRiskCallbacks</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-4">validations</span><span class="hl-1">: (</span><span class="hl-10">IRiskValidation</span><span class="hl-1"> | </span><span class="hl-10">IRiskValidationFn</span><span class="hl-1">)[];</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">RiskName</span><span class="hl-1"> = </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskValidation</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">validate</span><span class="hl-1">: </span><span class="hl-10">IRiskValidationFn</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskValidationFn</span><span class="hl-1"> {</span><br/><span class="hl-1">  (</span><span class="hl-4">payload</span><span class="hl-1">: </span><span class="hl-10">IRiskValidationPayload</span><span class="hl-1">): </span><span class="hl-10">void</span><span class="hl-1"> | </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">void</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskValidationPayload</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-10">IRiskCheckArgs</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">activePositionCount</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">activePositions</span><span class="hl-1">: </span><span class="hl-10">IRiskActivePosition</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskCheckArgs</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">StrategyName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">ExchangeName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskActivePosition</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">signal</span><span class="hl-1">: </span><span class="hl-10">ISignalRow</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">openTimestamp</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key Fields:</strong></p>
<ul>
<li><strong><code>riskName</code></strong>: Primary key for risk lookup in <code>RiskSchemaService</code>. Referenced by <code>IStrategySchema.riskName</code> to link strategies to risk profiles.</li>
<li><strong><code>validations</code></strong>: Array of validation functions or objects. Each is executed sequentially during <code>ClientRisk.checkSignal()</code>. If any throws, signal is rejected.</li>
<li><strong><code>callbacks.onRejected</code></strong>: Optional hook called when a signal fails risk validation. Receives symbol and risk check parameters.</li>
<li><strong><code>callbacks.onAllowed</code></strong>: Optional hook called when a signal passes all risk validations.</li>
</ul>
<a id="validation-execution-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Execution Flow<a href="#validation-execution-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>ClientRisk.checkSignal()</code> is called twice per signal lifecycle: once before <code>getSignal()</code> (pre-generation check) and once at scheduled signal activation (pre-open check). Each validation in the <code>validations</code> array is executed sequentially with access to current portfolio state via <code>PersistRiskAdapter</code>.</p>
<p><img src="../media/23_Component_Types_5.svg" alt="Mermaid Diagram"></p>
<a id="active-position-tracking" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Active Position Tracking<a href="#active-position-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>ClientRisk</code> maintains a registry of active positions via <code>PersistRiskAdapter</code> (live mode) or in-memory Map (backtest mode). Positions are added via <code>addSignal()</code> when signals open and removed via <code>removeSignal()</code> when signals close. The active positions array is injected into validation payloads, enabling cross-strategy portfolio analysis.</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskActivePosition</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">signal</span><span class="hl-1">: </span><span class="hl-10">ISignalRow</span><span class="hl-1">;         </span><span class="hl-5">// Complete signal data (prices, TP/SL, etc.)</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;       </span><span class="hl-5">// Strategy that owns this position</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;       </span><span class="hl-5">// Exchange for this position</span><br/><span class="hl-1">  </span><span class="hl-4">openTimestamp</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;      </span><span class="hl-5">// When position opened (ms)</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Position Lifecycle:</strong></p>
<ol>
<li><strong>Add:</strong> <code>ClientStrategy.OPEN_NEW_PENDING_SIGNAL_FN()</code> calls <code>risk.addSignal()</code> after signal opens</li>
<li><strong>Validate:</strong> Custom validations access <code>payload.activePositions</code> during <code>checkSignal()</code></li>
<li><strong>Remove:</strong> <code>ClientStrategy.CLOSE_PENDING_SIGNAL_FN()</code> calls <code>risk.removeSignal()</code> after signal closes</li>
</ol>
<a id="risk-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Risk Callbacks<a href="#risk-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onRejected</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-10">IRiskCheckArgs</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onAllowed</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-10">IRiskCheckArgs</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Callbacks:</strong></p>
<ul>
<li><strong><code>onRejected</code></strong>: Fired when any validation throws an error. Receives symbol and original check parameters (includes currentPrice, timestamp).</li>
<li><strong><code>onAllowed</code></strong>: Fired when all validations pass. Receives symbol and check parameters.</li>
</ul>
<a id="registration-example-3" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Example<a href="#registration-example-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addRisk</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;portfolio-limit-5&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Maximum 5 concurrent positions across all strategies&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-0">validate</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-8">5</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Maximum 5 concurrent positions reached&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Basic position count limit&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">activePositions</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Check symbol exposure</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">symbolPositions</span><span class="hl-1"> = </span><span class="hl-4">activePositions</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">p</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">p</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1"> === </span><span class="hl-4">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">symbolPositions</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt;= </span><span class="hl-8">2</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`Maximum 2 positions per symbol (</span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2"> already has </span><span class="hl-6">${</span><span class="hl-4">symbolPositions</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2">)`</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-5">// Check portfolio drawdown</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">portfolio</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getPortfolioState</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">portfolio</span><span class="hl-1">.</span><span class="hl-4">drawdown</span><span class="hl-1"> &gt; </span><span class="hl-8">15</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`Portfolio drawdown </span><span class="hl-6">${</span><span class="hl-4">portfolio</span><span class="hl-9">.</span><span class="hl-4">drawdown</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">% exceeds 15% limit`</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onRejected</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[RISK REJECT] </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2"> for </span><span class="hl-6">${</span><span class="hl-4">params</span><span class="hl-9">.</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onAllowed</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[RISK ALLOW] </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2"> for </span><span class="hl-6">${</span><span class="hl-4">params</span><span class="hl-9">.</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="sizing-schemas-isizingschema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Sizing Schemas (ISizingSchema)<a href="#sizing-schemas-isizingschema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Sizing schemas calculate position quantities using three algorithms: fixed-percentage (risk a fixed % of account per trade), kelly-criterion (optimal bet sizing based on win rate), or ATR-based (size positions based on volatility). Each method requires different configuration parameters in a discriminated union structure.</p>
<a id="interface-structure-4" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interface Structure<a href="#interface-structure-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">ISizingSchema</span><span class="hl-1"> = </span><br/><span class="hl-1">  | </span><span class="hl-10">ISizingSchemaFixedPercentage</span><span class="hl-1"> </span><br/><span class="hl-1">  | </span><span class="hl-10">ISizingSchemaKellyCriterion</span><span class="hl-1"> </span><br/><span class="hl-1">  | </span><span class="hl-10">ISizingSchemaATRBased</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Fixed percentage method</span><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ISizingSchemaFixedPercentage</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">sizingName</span><span class="hl-1">: </span><span class="hl-10">SizingName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">method</span><span class="hl-1">: </span><span class="hl-2">&quot;fixed-percentage&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">riskPercentage</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;           </span><span class="hl-5">// % of account to risk per trade</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionPercentage</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;   </span><span class="hl-5">// Optional max position size</span><br/><span class="hl-1">  </span><span class="hl-4">minPositionSize</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionSize</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks</span><span class="hl-1">?: </span><span class="hl-10">Partial</span><span class="hl-1">&lt;</span><span class="hl-10">ISizingCallbacks</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Kelly Criterion method</span><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ISizingSchemaKellyCriterion</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">sizingName</span><span class="hl-1">: </span><span class="hl-10">SizingName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">method</span><span class="hl-1">: </span><span class="hl-2">&quot;kelly-criterion&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">kellyMultiplier</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;         </span><span class="hl-5">// Default 0.25 (quarter-kelly)</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionPercentage</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">minPositionSize</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionSize</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks</span><span class="hl-1">?: </span><span class="hl-10">Partial</span><span class="hl-1">&lt;</span><span class="hl-10">ISizingCallbacks</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// ATR-based method</span><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ISizingSchemaATRBased</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">sizingName</span><span class="hl-1">: </span><span class="hl-10">SizingName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">method</span><span class="hl-1">: </span><span class="hl-2">&quot;atr-based&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">riskPercentage</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">atrMultiplier</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;           </span><span class="hl-5">// Default 2.0</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionPercentage</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">minPositionSize</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionSize</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks</span><span class="hl-1">?: </span><span class="hl-10">Partial</span><span class="hl-1">&lt;</span><span class="hl-10">ISizingCallbacks</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">SizingName</span><span class="hl-1"> = </span><span class="hl-10">string</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key Fields:</strong></p>
<ul>
<li><strong><code>sizingName</code></strong>: Primary key for sizing lookup in <code>SizingSchemaService</code>.</li>
<li><strong><code>method</code></strong>: Discriminator field determines which algorithm to use. Each method requires different parameters.</li>
<li><strong><code>riskPercentage</code></strong>: For fixed-percentage and ATR-based. Percentage of account to risk per trade (e.g., 2 = risk 2% per trade).</li>
<li><strong><code>kellyMultiplier</code></strong>: For Kelly Criterion. Reduces full Kelly size to prevent over-leveraging (0.25 = quarter-Kelly). Formula: <code>position = kellyMultiplier Ã— (winRate - (1 - winRate) / (avgWin / avgLoss))</code>.</li>
<li><strong><code>atrMultiplier</code></strong>: For ATR-based. Multiplies ATR to set stop loss distance. Larger values = wider stops = smaller positions.</li>
<li><strong><code>maxPositionPercentage</code></strong>: Optional cap on position size as percentage of account balance.</li>
<li><strong><code>minPositionSize</code>/<code>maxPositionSize</code></strong>: Optional absolute quantity limits.</li>
</ul>
<a id="position-sizing-algorithms" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Position Sizing Algorithms<a href="#position-sizing-algorithms" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The three sizing methods optimize for different objectives: fixed-percentage maintains consistent risk per trade, Kelly Criterion maximizes long-term growth rate based on historical win rate, and ATR-based adjusts position size inversely to market volatility.</p>
<p><img src="../media/23_Component_Types_6.svg" alt="Mermaid Diagram"></p>
<p><strong>Algorithm Details:</strong></p>
<ol>
<li>
<p><strong>Fixed Percentage:</strong></p>
<ul>
<li>Risk amount = <code>accountBalance Ã— (riskPercentage / 100)</code></li>
<li>Position = <code>riskAmount / (priceOpen - priceStopLoss)</code> for long</li>
<li>Simple, predictable risk per trade</li>
</ul>
</li>
<li>
<p><strong>Kelly Criterion:</strong></p>
<ul>
<li>Requires historical win rate and profit factor</li>
<li>Formula: <code>kelly = (winRate Ã— avgWin - lossRate Ã— avgLoss) / avgWin</code></li>
<li>Position = <code>kellyMultiplier Ã— kelly Ã— accountBalance / currentPrice</code></li>
<li>Optimal for maximizing long-term growth</li>
</ul>
</li>
<li>
<p><strong>ATR-Based:</strong></p>
<ul>
<li>Calculates Average True Range from recent candles</li>
<li>Stop distance = <code>ATR Ã— atrMultiplier</code></li>
<li>Position = <code>(accountBalance Ã— riskPercentage) / stopDistance</code></li>
<li>Adapts to volatility: smaller positions in volatile markets</li>
</ul>
</li>
</ol>
<a id="sizing-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Sizing Callbacks<a href="#sizing-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ISizingCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onCalculate</span><span class="hl-1">: (</span><span class="hl-4">quantity</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-10">ISizingCalculateParams</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ISizingCalculateParams</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">accountBalance</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">signal</span><span class="hl-1">: </span><span class="hl-10">ISignalRow</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong><code>onCalculate</code></strong>: Called after position quantity calculation but before formatting. Receives the raw quantity and calculation parameters. Useful for logging, monitoring, or external position tracking.</p>
<a id="registration-example-4" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Example<a href="#registration-example-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addSizing</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Fixed percentage sizing</span><br/><span class="hl-0">addSizing</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">sizingName:</span><span class="hl-1"> </span><span class="hl-2">&quot;fixed-2pct&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;fixed-percentage&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskPercentage:</span><span class="hl-1"> </span><span class="hl-8">2</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionPercentage:</span><span class="hl-1"> </span><span class="hl-8">10</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">minPositionSize:</span><span class="hl-1"> </span><span class="hl-8">0.001</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onCalculate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">quantity</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Position size: </span><span class="hl-6">${</span><span class="hl-4">quantity</span><span class="hl-6">}</span><span class="hl-2"> </span><span class="hl-6">${</span><span class="hl-4">params</span><span class="hl-9">.</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Kelly Criterion sizing</span><br/><span class="hl-0">addSizing</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">sizingName:</span><span class="hl-1"> </span><span class="hl-2">&quot;quarter-kelly&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;kelly-criterion&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">kellyMultiplier:</span><span class="hl-1"> </span><span class="hl-8">0.25</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionPercentage:</span><span class="hl-1"> </span><span class="hl-8">15</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// ATR-based sizing</span><br/><span class="hl-0">addSizing</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">sizingName:</span><span class="hl-1"> </span><span class="hl-2">&quot;atr-volatility&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;atr-based&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskPercentage:</span><span class="hl-1"> </span><span class="hl-8">1.5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">atrMultiplier:</span><span class="hl-1"> </span><span class="hl-8">2</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionPercentage:</span><span class="hl-1"> </span><span class="hl-8">12</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="walker-schemas-iwalkerschema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Walker Schemas (IWalkerSchema)<a href="#walker-schemas-iwalkerschema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Walker schemas orchestrate strategy comparison by running multiple strategies through the same backtest frame and ranking them by a specified metric (sharpeRatio, winRate, avgPnl, etc.). The walker executes strategies serially, collects performance statistics, and identifies the best-performing strategy based on the configured metric.</p>
<a id="interface-structure-5" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interface Structure<a href="#interface-structure-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IWalkerSchema</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName</span><span class="hl-1">: </span><span class="hl-10">WalkerName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">ExchangeName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-10">FrameName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategies</span><span class="hl-1">: </span><span class="hl-10">StrategyName</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">metric</span><span class="hl-1">?: </span><span class="hl-10">WalkerMetric</span><span class="hl-1">;              </span><span class="hl-5">// Default: &quot;sharpeRatio&quot;</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks</span><span class="hl-1">?: </span><span class="hl-10">Partial</span><span class="hl-1">&lt;</span><span class="hl-10">IWalkerCallbacks</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">WalkerName</span><span class="hl-1"> = </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">WalkerMetric</span><span class="hl-1"> = </span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;sharpeRatio&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;winRate&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;avgPnl&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;totalPnl&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;certaintyRatio&quot;</span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;maxDrawdown&quot;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key Fields:</strong></p>
<ul>
<li><strong><code>walkerName</code></strong>: Primary key for walker lookup in <code>WalkerSchemaService</code>.</li>
<li><strong><code>exchangeName</code></strong>: Exchange to use for all strategy backtests. Must be registered via <code>addExchange()</code>.</li>
<li><strong><code>frameName</code></strong>: Frame to use for all strategy backtests. Must be registered via <code>addFrame()</code>.</li>
<li><strong><code>strategies</code></strong>: Array of strategy names to compare. Each must be registered via <code>addStrategy()</code>.</li>
<li><strong><code>metric</code></strong>: Performance metric for ranking. Default is <code>&quot;sharpeRatio&quot;</code>. Extracted from <code>BacktestStatistics</code> after each strategy completes.</li>
<li><strong><code>callbacks</code></strong>: Optional hooks for progress tracking and results.</li>
</ul>
<a id="walker-execution-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Walker Execution Flow<a href="#walker-execution-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>WalkerLogicPrivateService</code> iterates through the strategies array sequentially, running a full backtest for each and collecting performance metrics. After all strategies complete, the walker identifies the best strategy by comparing metric values and emits the final results.</p>
<p><img src="../media/23_Component_Types_7.svg" alt="Mermaid Diagram"></p>
<a id="performance-metrics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Performance Metrics<a href="#performance-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Walker compares strategies using one of six performance metrics extracted from <code>BacktestStatistics</code>:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Description</th>
<th>Formula</th>
<th>Optimization Goal</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>sharpeRatio</strong></td>
<td>Risk-adjusted return</td>
<td><code>(avgReturn - riskFreeRate) / stdDevReturn</code></td>
<td>Maximize (higher = better)</td>
</tr>
<tr>
<td><strong>winRate</strong></td>
<td>Percentage of winning trades</td>
<td><code>winningTrades / totalTrades Ã— 100</code></td>
<td>Maximize</td>
</tr>
<tr>
<td><strong>avgPnl</strong></td>
<td>Average profit per trade</td>
<td><code>totalPnl / totalTrades</code></td>
<td>Maximize</td>
</tr>
<tr>
<td><strong>totalPnl</strong></td>
<td>Cumulative profit</td>
<td><code>sum(all signal PnLs)</code></td>
<td>Maximize</td>
</tr>
<tr>
<td><strong>certaintyRatio</strong></td>
<td>Win consistency</td>
<td><code>winRate Ã— avgWin / avgLoss</code></td>
<td>Maximize</td>
</tr>
<tr>
<td><strong>maxDrawdown</strong></td>
<td>Largest peak-to-trough decline</td>
<td><code>max((peak - trough) / peak)</code></td>
<td>Minimize (invert for comparison)</td>
</tr>
</tbody>
</table>
<p><strong>Default Metric:</strong> <code>&quot;sharpeRatio&quot;</code> is used if no metric is specified in the schema. Sharpe ratio balances returns against volatility, making it suitable for most strategy comparisons.</p>
<a id="walker-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Walker Callbacks<a href="#walker-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IWalkerCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onStrategyComplete</span><span class="hl-1">: (</span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">: </span><span class="hl-10">BacktestStatistics</span><span class="hl-1">, </span><span class="hl-4">metric</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onComplete</span><span class="hl-1">: (</span><span class="hl-4">results</span><span class="hl-1">: </span><span class="hl-10">WalkerStatistics</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">WalkerStatistics</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">bestStrategy</span><span class="hl-1">: </span><span class="hl-10">StrategyName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">bestMetric</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">metric</span><span class="hl-1">: </span><span class="hl-10">WalkerMetric</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">results</span><span class="hl-1">: </span><span class="hl-10">Array</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">StrategyName</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">stats</span><span class="hl-1">: </span><span class="hl-10">BacktestStatistics</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">metricValue</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  }&gt;;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Callbacks:</strong></p>
<ul>
<li><strong><code>onStrategyComplete</code></strong>: Fired after each strategy backtest completes. Receives strategy name, symbol, full statistics object, and extracted metric value. Useful for progress tracking.</li>
<li><strong><code>onComplete</code></strong>: Fired once after all strategies complete. Receives complete results including best strategy identification and all strategy metrics.</li>
</ul>
<a id="registration-example-5" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Example<a href="#registration-example-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addWalker</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addWalker</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;rsi-parameter-sweep&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Compare RSI strategies with different oversold thresholds&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance-spot&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;2024-q1-1h&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategies:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;rsi-20-oversold&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;rsi-25-oversold&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;rsi-30-oversold&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;rsi-35-oversold&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-4">metric:</span><span class="hl-1"> </span><span class="hl-2">&quot;sharpeRatio&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onStrategyComplete</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">, </span><span class="hl-4">metric</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">: Sharpe </span><span class="hl-6">${</span><span class="hl-4">metric</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">3</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">, Win Rate </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">winRate</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">1</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onComplete</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">results</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-11">\n</span><span class="hl-2">Best strategy: </span><span class="hl-6">${</span><span class="hl-4">results</span><span class="hl-9">.</span><span class="hl-4">bestStrategy</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Best Sharpe: </span><span class="hl-6">${</span><span class="hl-4">results</span><span class="hl-9">.</span><span class="hl-4">bestMetric</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">3</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-5">// Rank all strategies</span><br/><span class="hl-1">      </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-4">results</span><br/><span class="hl-1">        .</span><span class="hl-0">sort</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">b</span><span class="hl-1">.</span><span class="hl-4">metricValue</span><span class="hl-1"> - </span><span class="hl-4">a</span><span class="hl-1">.</span><span class="hl-4">metricValue</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-4">r</span><span class="hl-1">, </span><span class="hl-4">i</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">i</span><span class="hl-9"> </span><span class="hl-1">+</span><span class="hl-9"> </span><span class="hl-8">1</span><span class="hl-6">}</span><span class="hl-2">. </span><span class="hl-6">${</span><span class="hl-4">r</span><span class="hl-9">.</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">: </span><span class="hl-6">${</span><span class="hl-4">r</span><span class="hl-9">.</span><span class="hl-4">metricValue</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">3</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="optimizer-schemas-ioptimizerschema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Optimizer Schemas (IOptimizerSchema)<a href="#optimizer-schemas-ioptimizerschema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Optimizer schemas generate AI-powered trading strategies by collecting multi-timeframe market data from specified sources, building LLM conversation histories with the fetched data, generating strategy prompts via <code>getPrompt()</code>, and assembling complete executable backtest code using template methods. The optimizer produces a standalone <code>.mjs</code> file containing exchange configuration, frame definitions, multiple AI-generated strategies, and walker comparison logic.</p>
<a id="interface-structure-6" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interface Structure<a href="#interface-structure-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IOptimizerSchema</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName</span><span class="hl-1">: </span><span class="hl-10">OptimizerName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTrain</span><span class="hl-1">: </span><span class="hl-10">IOptimizerRange</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTest</span><span class="hl-1">: </span><span class="hl-10">IOptimizerRange</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">source</span><span class="hl-1">: (</span><span class="hl-10">IOptimizerSourceFn</span><span class="hl-1"> | </span><span class="hl-10">IOptimizerSource</span><span class="hl-1">)[];</span><br/><span class="hl-1">  </span><span class="hl-0">getPrompt</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">messages</span><span class="hl-1">: </span><span class="hl-10">IOptimizerMessage</span><span class="hl-1">[]) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-4">template</span><span class="hl-1">?: </span><span class="hl-10">Partial</span><span class="hl-1">&lt;</span><span class="hl-10">IOptimizerTemplate</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks</span><span class="hl-1">?: </span><span class="hl-10">Partial</span><span class="hl-1">&lt;</span><span class="hl-10">IOptimizerCallbacks</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">OptimizerName</span><span class="hl-1"> = </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IOptimizerRange</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">startDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">endDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IOptimizerSourceFn</span><span class="hl-1"> {</span><br/><span class="hl-1">  (</span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-10">IOptimizerSourceParams</span><span class="hl-1">): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">any</span><span class="hl-1">[]&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IOptimizerSource</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">fetch</span><span class="hl-1">: </span><span class="hl-10">IOptimizerSourceFn</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">user</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">any</span><span class="hl-1">[], </span><span class="hl-4">sourceName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">assistant</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">any</span><span class="hl-1">[], </span><span class="hl-4">sourceName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IOptimizerSourceParams</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">startDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">endDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">limit</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">offset</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IOptimizerMessage</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">role</span><span class="hl-1">: </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;assistant&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">content</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key Fields:</strong></p>
<ul>
<li><strong><code>optimizerName</code></strong>: Primary key for optimizer lookup in <code>OptimizerSchemaService</code>.</li>
<li><strong><code>rangeTrain</code></strong>: Array of training date ranges. Each generates a separate strategy variant by analyzing that period's market data. Used for walk-forward validation.</li>
<li><strong><code>rangeTest</code></strong>: Testing date range for strategy validation. Used in the generated walker to evaluate strategies on out-of-sample data.</li>
<li><strong><code>source</code></strong>: Array of data sources (functions or source objects). Each source fetches historical data (candles, indicators, backtest results) for inclusion in LLM conversation. Sources can be simple functions or objects with custom user/assistant message formatters.</li>
<li><strong><code>getPrompt</code></strong>: Strategy generation function. Receives symbol and complete conversation history (all user/assistant messages from all sources across all training ranges). Returns a prompt string that the generated strategy will use to query the LLM at runtime.</li>
<li><strong><code>template</code></strong>: Optional template overrides. Allows customizing the generated code (imports, helpers, strategy logic, walker configuration). Merges with default templates from <code>OptimizerTemplateService</code>.</li>
<li><strong><code>callbacks</code></strong>: Optional hooks for monitoring data collection, code generation, and file export.</li>
</ul>
<a id="data-collection-pipeline" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Data Collection Pipeline<a href="#data-collection-pipeline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The optimizer iterates through training ranges and sources in nested loops: for each training range, it fetches data from each source (with pagination support), formats the data into user/assistant message pairs, and appends to the conversation history. After collecting all data, it calls <code>getPrompt()</code> with the complete message history to generate a strategy prompt for that training range.</p>
<p><img src="../media/23_Component_Types_8.svg" alt="Mermaid Diagram"></p>
<p><strong>Pagination Logic:</strong></p>
<p>Sources are fetched with pagination to handle large datasets. The optimizer starts with <code>offset = 0</code>, <code>limit = 1000</code>, and repeatedly calls the source function until the returned data length is less than <code>limit</code>, indicating no more data. All fetched pages are concatenated and passed to message formatters.</p>
<a id="code-generation-pipeline" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Code Generation Pipeline<a href="#code-generation-pipeline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>After data collection, the optimizer assembles a complete standalone backtest script by calling 11 template methods in sequence. Each method generates a code section (imports, helpers, configurations, launcher), which are concatenated into a final string and written to disk.</p>
<p><strong>Template Method Sequence:</strong></p>
<ol>
<li><strong><code>getTopBanner(symbol)</code></strong>: Imports and constants (<code>import { addStrategy, addExchange, ... }</code>)</li>
<li><strong><code>getJsonDumpTemplate()</code></strong>: <code>dumpJson()</code> helper for writing results to file</li>
<li><strong><code>getTextTemplate()</code></strong>: <code>text()</code> LLM helper for natural language queries</li>
<li><strong><code>getJsonTemplate()</code></strong>: <code>json()</code> LLM helper for structured JSON extraction</li>
<li><strong><code>getExchangeTemplate(symbol, exchangeName)</code></strong>: <code>addExchange()</code> call with CCXT configuration</li>
<li><strong><code>getFrameTemplate(range)</code> (for each rangeTrain)</strong>: <code>addFrame()</code> calls for training periods</li>
<li><strong><code>getFrameTemplate(rangeTest)</code></strong>: <code>addFrame()</code> call for test period</li>
<li><strong><code>getStrategyTemplate(strategyName, interval, prompt)</code> (for each strategy)</strong>: <code>addStrategy()</code> calls with LLM integration</li>
<li><strong><code>getWalkerTemplate(strategies, metric)</code></strong>: <code>addWalker()</code> call for strategy comparison</li>
<li><strong><code>getLauncherTemplate(walkerName)</code></strong>: <code>Walker.background()</code> call with event listeners</li>
<li><strong>Custom template overrides</strong> (if provided in schema)</li>
</ol>
<p><strong>Generated Code Structure:</strong></p>
<pre><code class="javascript"><span class="hl-5">// 1. Imports and constants</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addStrategy</span><span class="hl-1">, </span><span class="hl-4">addExchange</span><span class="hl-1">, </span><span class="hl-4">addFrame</span><span class="hl-1">, </span><span class="hl-4">addWalker</span><span class="hl-1">, </span><span class="hl-4">Walker</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">symbol</span><span class="hl-1"> = </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// 2-4. Helper functions</span><br/><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">dumpJson</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">filename</span><span class="hl-1">) { </span><span class="hl-5">/* ... */</span><span class="hl-1"> }</span><br/><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">text</span><span class="hl-1">(</span><span class="hl-4">prompt</span><span class="hl-1">) { </span><span class="hl-5">/* LLM call via Ollama */</span><span class="hl-1"> }</span><br/><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">json</span><span class="hl-1">(</span><span class="hl-4">prompt</span><span class="hl-1">) { </span><span class="hl-5">/* LLM call via Ollama */</span><span class="hl-1"> }</span><br/><br/><span class="hl-5">// 5. Exchange configuration</span><br/><span class="hl-0">addExchange</span><span class="hl-1">({ </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">, </span><span class="hl-5">/* ... */</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// 6-7. Frame configurations</span><br/><span class="hl-0">addFrame</span><span class="hl-1">({ </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;train-1&quot;</span><span class="hl-1">, </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01&quot;</span><span class="hl-1">), </span><span class="hl-5">/* ... */</span><span class="hl-1"> });</span><br/><span class="hl-0">addFrame</span><span class="hl-1">({ </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test&quot;</span><span class="hl-1">, </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-03-01&quot;</span><span class="hl-1">), </span><span class="hl-5">/* ... */</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// 8. Strategy configurations (one per training range)</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;llm-strategy-1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">analysis</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">text</span><span class="hl-1">(</span><span class="hl-2">&quot;Analyze market and suggest entry...&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">signal</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">json</span><span class="hl-1">(</span><span class="hl-2">&quot;Extract signal parameters...&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// 9. Walker configuration</span><br/><span class="hl-0">addWalker</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;llm-comparison&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategies:</span><span class="hl-1"> [</span><span class="hl-2">&quot;llm-strategy-1&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;llm-strategy-2&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;llm-strategy-3&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">metric:</span><span class="hl-1"> </span><span class="hl-2">&quot;sharpeRatio&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// 10. Launcher with event listeners</span><br/><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, { </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;llm-comparison&quot;</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<a id="optimizer-template-customization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Optimizer Template Customization<a href="#optimizer-template-customization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>template</code> field allows overriding individual template methods while keeping others at their defaults. Templates are merged with <code>OptimizerTemplateService</code> defaults using object spread.</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IOptimizerTemplate</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">getTopBanner</span><span class="hl-1">?: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">getJsonDumpTemplate</span><span class="hl-1">?: () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">getTextTemplate</span><span class="hl-1">?: () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">getJsonTemplate</span><span class="hl-1">?: () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">getExchangeTemplate</span><span class="hl-1">?: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">getFrameTemplate</span><span class="hl-1">?: (</span><span class="hl-4">range</span><span class="hl-1">: </span><span class="hl-10">IOptimizerRange</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">getStrategyTemplate</span><span class="hl-1">?: (</span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">prompt</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">getWalkerTemplate</span><span class="hl-1">?: (</span><span class="hl-4">strategies</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">[], </span><span class="hl-4">metric</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">getLauncherTemplate</span><span class="hl-1">?: (</span><span class="hl-4">walkerName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-0">addOptimizer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;custom-template&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">// ... other fields</span><br/><span class="hl-1">  </span><span class="hl-4">template:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">getTopBanner</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><br/><span class="hl-2">      import { addStrategy } from &quot;backtest-kit&quot;;</span><br/><span class="hl-2">      import { myCustomHelper } from &quot;./helpers.js&quot;;</span><br/><span class="hl-2">      const SYMBOL = &quot;</span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">&quot;;</span><br/><span class="hl-2">    `</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">getStrategyTemplate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">prompt</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><br/><span class="hl-2">      addStrategy({</span><br/><span class="hl-2">        strategyName: &quot;</span><span class="hl-6">${</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">&quot;,</span><br/><span class="hl-2">        interval: &quot;</span><span class="hl-6">${</span><span class="hl-4">interval</span><span class="hl-6">}</span><span class="hl-2">&quot;,</span><br/><span class="hl-2">        getSignal: async (symbol, when) =&gt; {</span><br/><span class="hl-2">          return await myCustomHelper(symbol, when, &quot;</span><span class="hl-6">${</span><span class="hl-4">prompt</span><span class="hl-6">}</span><span class="hl-2">&quot;);</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">      });</span><br/><span class="hl-2">    `</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="optimizer-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Optimizer Callbacks<a href="#optimizer-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IOptimizerCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onData</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">strategyData</span><span class="hl-1">: </span><span class="hl-10">Array</span><span class="hl-1">&lt;{ </span><span class="hl-4">rangeTrain</span><span class="hl-1">: </span><span class="hl-10">IOptimizerRange</span><span class="hl-1">; </span><span class="hl-4">prompt</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1"> }&gt;) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onCode</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">code</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onDump</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">filepath</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onSourceData</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">sourceName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-10">any</span><span class="hl-1">[], </span><span class="hl-4">startDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Callbacks:</strong></p>
<ul>
<li><strong><code>onData</code></strong>: Called after data collection completes. Receives symbol and array of generated strategies (one per training range) with prompts.</li>
<li><strong><code>onCode</code></strong>: Called after code generation completes. Receives symbol and full generated code string before file write.</li>
<li><strong><code>onDump</code></strong>: Called after file write completes. Receives symbol and output file path.</li>
<li><strong><code>onSourceData</code></strong>: Called after each source fetch completes. Receives symbol, source name, fetched data array, and date range. Useful for monitoring data collection progress.</li>
</ul>
<a id="registration-example-6" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Example<a href="#registration-example-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addOptimizer</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addOptimizer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;llm-multi-timeframe&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Generate strategies by analyzing 1h, 30m, 15m, 1m data&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">rangeTrain:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Bull market training&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-31&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Bear market training&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-02-01&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-02-28&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">rangeTest:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Out-of-sample validation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-03-01&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-03-31&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">source:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-5">// Simple function source (fetches 1h candles)</span><br/><span class="hl-1">    </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Object source with custom formatters</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;technical-indicators&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">fetch</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchIndicators</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1">);</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">user</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">sourceName</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`Analyze these </span><span class="hl-6">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> indicator readings for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">:</span><span class="hl-11">\n</span><span class="hl-6">${</span><span class="hl-0">formatIndicators</span><span class="hl-9">(</span><span class="hl-4">data</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">assistant</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">sourceName</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`Indicators analyzed. Key observations: RSI shows oversold conditions in </span><span class="hl-6">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-0">filter</span><span class="hl-9">(</span><span class="hl-4">d</span><span class="hl-9"> </span><span class="hl-6">=&gt;</span><span class="hl-9"> </span><span class="hl-4">d</span><span class="hl-9">.</span><span class="hl-4">rsi</span><span class="hl-9"> </span><span class="hl-1">&lt;</span><span class="hl-9"> </span><span class="hl-8">30</span><span class="hl-9">).</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> periods.`</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">getPrompt</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">messages</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Build comprehensive prompt from conversation history</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">marketAnalysis</span><span class="hl-1"> = </span><span class="hl-4">messages</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">m</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">m</span><span class="hl-1">.</span><span class="hl-4">role</span><span class="hl-1"> === </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">).</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">m</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">m</span><span class="hl-1">.</span><span class="hl-4">content</span><span class="hl-1">).</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-11">\n\n</span><span class="hl-2">&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`</span><br/><span class="hl-2">      Based on this multi-timeframe analysis for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">:</span><br/><span class="hl-2">      </span><span class="hl-6">${</span><span class="hl-4">marketAnalysis</span><span class="hl-6">}</span><br/><span class="hl-2">      </span><br/><span class="hl-2">      Generate a trading strategy that:</span><br/><span class="hl-2">      1. Identifies optimal entry points for LONG positions</span><br/><span class="hl-2">      2. Sets realistic take-profit targets (2-5%)</span><br/><span class="hl-2">      3. Uses tight stop-losses (0.5-1%)</span><br/><span class="hl-2">      </span><br/><span class="hl-2">      Return analysis with entry conditions and exit rules.</span><br/><span class="hl-2">    `</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onSourceData</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">sourceName</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Fetched </span><span class="hl-6">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> rows from </span><span class="hl-6">${</span><span class="hl-4">sourceName</span><span class="hl-6">}</span><span class="hl-2"> for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onData</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyData</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-6">${</span><span class="hl-4">strategyData</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> strategies for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onCode</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">code</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-6">${</span><span class="hl-4">code</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> characters of code`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onDump</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">filepath</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Saved to </span><span class="hl-6">${</span><span class="hl-4">filepath</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="component-type-relationships" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Component Type Relationships<a href="#component-type-relationships" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Component types form a dependency graph where strategies reference exchanges and risk profiles, walkers reference strategies and frames, and optimizers generate complete component configurations. The framework enforces referential integrity at registration time by validating that referenced component names exist in their respective schema services.</p>
<p><img src="../media/23_Component_Types_9.svg" alt="Mermaid Diagram"></p>
<p><strong>Dependency Rules:</strong></p>
<ol>
<li><strong>Strategy â†’ Risk (optional)</strong>: If <code>strategy.riskName</code> is provided, must reference an existing <code>IRiskSchema</code> via <code>RiskSchemaService.get(riskName)</code>.</li>
<li><strong>Walker â†’ Strategy (required)</strong>: All entries in <code>walker.strategies[]</code> must reference existing <code>IStrategySchema</code> instances.</li>
<li><strong>Walker â†’ Exchange (required)</strong>: <code>walker.exchangeName</code> must reference an existing <code>IExchangeSchema</code>.</li>
<li><strong>Walker â†’ Frame (required)</strong>: <code>walker.frameName</code> must reference an existing <code>IFrameSchema</code>.</li>
<li><strong>Optimizer â†’ All</strong>: Optimizer generates all component types. Generated code includes <code>addStrategy</code>, <code>addExchange</code>, <code>addFrame</code>, <code>addWalker</code> calls.</li>
</ol>
<p><strong>Validation Timing:</strong></p>
<ul>
<li><strong>Registration</strong>: Component name uniqueness is validated by schema services (throws if duplicate name).</li>
<li><strong>Execution</strong>: Referential integrity is validated by connection services (throws if referenced component doesn't exist).</li>
<li><strong>Walker</strong>: Strategy/exchange/frame existence is validated by <code>WalkerValidationService</code> before execution.</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#component-types"><span>Component <wbr/>Types</span></a><ul><li><a href="#component-type-architecture"><span>Component <wbr/>Type <wbr/>Architecture</span></a></li><li><a href="#schema-interface-pattern"><span>Schema <wbr/>Interface <wbr/>Pattern</span></a></li><li><a href="#registration-and-validation-flow"><span>Registration and <wbr/>Validation <wbr/>Flow</span></a></li><li><a href="#strategy-schemas-istrategyschema"><span>Strategy <wbr/>Schemas (IStrategy<wbr/>Schema)</span></a></li><li><ul><li><a href="#interface-structure"><span>Interface <wbr/>Structure</span></a></li><li><a href="#signal-dto-structure"><span>Signal DTO <wbr/>Structure</span></a></li><li><a href="#strategy-lifecycle-callbacks"><span>Strategy <wbr/>Lifecycle <wbr/>Callbacks</span></a></li><li><a href="#registration-example"><span>Registration <wbr/>Example</span></a></li></ul></li><li><a href="#exchange-schemas-iexchangeschema"><span>Exchange <wbr/>Schemas (IExchange<wbr/>Schema)</span></a></li><li><ul><li><a href="#interface-structure-1"><span>Interface <wbr/>Structure</span></a></li><li><a href="#candle-data-flow"><span>Candle <wbr/>Data <wbr/>Flow</span></a></li><li><a href="#exchange-callbacks"><span>Exchange <wbr/>Callbacks</span></a></li><li><a href="#registration-example-1"><span>Registration <wbr/>Example</span></a></li></ul></li><li><a href="#frame-schemas-iframeschema"><span>Frame <wbr/>Schemas (IFrame<wbr/>Schema)</span></a></li><li><ul><li><a href="#interface-structure-2"><span>Interface <wbr/>Structure</span></a></li><li><a href="#timeframe-generation-logic"><span>Timeframe <wbr/>Generation <wbr/>Logic</span></a></li><li><a href="#frame-callbacks"><span>Frame <wbr/>Callbacks</span></a></li><li><a href="#registration-example-2"><span>Registration <wbr/>Example</span></a></li></ul></li><li><a href="#risk-schemas-iriskschema"><span>Risk <wbr/>Schemas (IRisk<wbr/>Schema)</span></a></li><li><ul><li><a href="#interface-structure-3"><span>Interface <wbr/>Structure</span></a></li><li><a href="#validation-execution-flow"><span>Validation <wbr/>Execution <wbr/>Flow</span></a></li><li><a href="#active-position-tracking"><span>Active <wbr/>Position <wbr/>Tracking</span></a></li><li><a href="#risk-callbacks"><span>Risk <wbr/>Callbacks</span></a></li><li><a href="#registration-example-3"><span>Registration <wbr/>Example</span></a></li></ul></li><li><a href="#sizing-schemas-isizingschema"><span>Sizing <wbr/>Schemas (ISizing<wbr/>Schema)</span></a></li><li><ul><li><a href="#interface-structure-4"><span>Interface <wbr/>Structure</span></a></li><li><a href="#position-sizing-algorithms"><span>Position <wbr/>Sizing <wbr/>Algorithms</span></a></li><li><a href="#sizing-callbacks"><span>Sizing <wbr/>Callbacks</span></a></li><li><a href="#registration-example-4"><span>Registration <wbr/>Example</span></a></li></ul></li><li><a href="#walker-schemas-iwalkerschema"><span>Walker <wbr/>Schemas (IWalker<wbr/>Schema)</span></a></li><li><ul><li><a href="#interface-structure-5"><span>Interface <wbr/>Structure</span></a></li><li><a href="#walker-execution-flow"><span>Walker <wbr/>Execution <wbr/>Flow</span></a></li><li><a href="#performance-metrics"><span>Performance <wbr/>Metrics</span></a></li><li><a href="#walker-callbacks"><span>Walker <wbr/>Callbacks</span></a></li><li><a href="#registration-example-5"><span>Registration <wbr/>Example</span></a></li></ul></li><li><a href="#optimizer-schemas-ioptimizerschema"><span>Optimizer <wbr/>Schemas (IOptimizer<wbr/>Schema)</span></a></li><li><ul><li><a href="#interface-structure-6"><span>Interface <wbr/>Structure</span></a></li><li><a href="#data-collection-pipeline"><span>Data <wbr/>Collection <wbr/>Pipeline</span></a></li><li><a href="#code-generation-pipeline"><span>Code <wbr/>Generation <wbr/>Pipeline</span></a></li><li><a href="#optimizer-template-customization"><span>Optimizer <wbr/>Template <wbr/>Customization</span></a></li><li><a href="#optimizer-callbacks"><span>Optimizer <wbr/>Callbacks</span></a></li><li><a href="#registration-example-6"><span>Registration <wbr/>Example</span></a></li></ul></li><li><a href="#component-type-relationships"><span>Component <wbr/>Type <wbr/>Relationships</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
