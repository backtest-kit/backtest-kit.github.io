<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/29_multi-timeframe-analysis | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_29_multi-timeframe-analysis.html">design/29_multi-timeframe-analysis</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="multi-timeframe-analysis" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Multi-Timeframe Analysis<a href="#multi-timeframe-analysis" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This page explains how strategies can use <code>getCandles()</code> with different timeframe intervals to build comprehensive market analysis. Multi-timeframe analysis allows strategies to examine price action across multiple time scales (e.g., 1-minute, 15-minute, 1-hour) within a single signal generation function, enabling more robust trading decisions.</p>
<p>For general strategy development concepts, see <a href="design_25_strategy-development.html">Strategy Development</a>. For the underlying temporal execution model that makes multi-timeframe analysis safe from look-ahead bias, see <a href="design_08_core-concepts.html">Time Execution Engine</a> and <a href="design_08_core-concepts.html">Execution Contexts</a>. For signal generation basics, see <a href="design_25_strategy-development.html">Signal Generation (getSignal)</a>.</p>
<hr>
<a id="getcandles-api-reference" class="tsd-anchor"></a><h2 class="tsd-anchor-link">getCandles API Reference<a href="#getcandles-api-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>getCandles()</code> function is the primary interface for fetching historical candle data within strategies. It automatically respects the current execution timestamp to prevent look-ahead bias.</p>
<a id="function-signature" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Function Signature<a href="#function-signature" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-4">ICandleData</span><span class="hl-1">[]&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="parameters" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Parameters<a href="#parameters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
<th>Example Values</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>symbol</code></td>
<td><code>string</code></td>
<td>Trading pair identifier</td>
<td><code>&quot;BTCUSDT&quot;</code>, <code>&quot;ETHUSDT&quot;</code></td>
</tr>
<tr>
<td><code>interval</code></td>
<td><code>string</code></td>
<td>Candle timeframe</td>
<td><code>&quot;1m&quot;</code>, <code>&quot;5m&quot;</code>, <code>&quot;15m&quot;</code>, <code>&quot;30m&quot;</code>, <code>&quot;1h&quot;</code>, <code>&quot;4h&quot;</code>, <code>&quot;1d&quot;</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>number</code></td>
<td>Maximum number of candles (most recent first)</td>
<td><code>60</code>, <code>100</code>, <code>200</code></td>
</tr>
</tbody>
</table>
<a id="return-type" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Return Type<a href="#return-type" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Returns <code>Promise&lt;ICandleData[]&gt;</code> where <code>ICandleData</code> contains:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>timestamp</code></td>
<td><code>number</code></td>
<td>Candle open time (Unix milliseconds)</td>
</tr>
<tr>
<td><code>open</code></td>
<td><code>number</code></td>
<td>Opening price</td>
</tr>
<tr>
<td><code>high</code></td>
<td><code>number</code></td>
<td>Highest price</td>
</tr>
<tr>
<td><code>low</code></td>
<td><code>number</code></td>
<td>Lowest price</td>
</tr>
<tr>
<td><code>close</code></td>
<td><code>number</code></td>
<td>Closing price</td>
</tr>
<tr>
<td><code>volume</code></td>
<td><code>number</code></td>
<td>Trading volume</td>
</tr>
</tbody>
</table>
<a id="temporal-context-guarantees" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Temporal Context Guarantees<a href="#temporal-context-guarantees" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Critical</strong>: <code>getCandles()</code> always returns candles with <code>timestamp &lt;= currentExecutionTime</code>. This architectural constraint makes look-ahead bias <strong>architecturally impossible</strong>:</p>
<ul>
<li>✅ Backtest mode: Returns only candles up to current iteration timestamp</li>
<li>✅ Live mode: Returns only completed candles (never in-progress candles)</li>
<li>✅ Multi-timeframe: All intervals automatically synchronized to same point in time</li>
<li>✅ Same code: Identical behavior between backtest and live trading</li>
</ul>
<hr>
<a id="multi-timeframe-strategy-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Multi-Timeframe Strategy Pattern<a href="#multi-timeframe-strategy-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="basic-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Example<a href="#basic-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The most common pattern is to fetch multiple timeframes in the <code>getSignal</code> function and combine their analysis:</p>
<pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;multi-tf-strategy&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&#39;5m&#39;</span><span class="hl-1">,  </span><span class="hl-5">// Signal generation throttle (separate from analysis timeframes)</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Fetch multiple timeframes</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles1h</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);   </span><span class="hl-5">// Last 24 hours</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles15m</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1">, </span><span class="hl-6">48</span><span class="hl-1">); </span><span class="hl-5">// Last 12 hours</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles5m</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">, </span><span class="hl-6">60</span><span class="hl-1">);   </span><span class="hl-5">// Last 5 hours</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles1m</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">, </span><span class="hl-6">60</span><span class="hl-1">);   </span><span class="hl-5">// Last 1 hour</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Analyze higher timeframe for trend</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">hourlyTrend</span><span class="hl-1"> = </span><span class="hl-0">analyzeTrend</span><span class="hl-1">(</span><span class="hl-4">candles1h</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Analyze medium timeframe for momentum</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">momentum</span><span class="hl-1"> = </span><span class="hl-0">calculateMomentum</span><span class="hl-1">(</span><span class="hl-4">candles15m</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Use lower timeframes for entry precision</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">entrySignal</span><span class="hl-1"> = </span><span class="hl-0">findEntry</span><span class="hl-1">(</span><span class="hl-4">candles5m</span><span class="hl-1">, </span><span class="hl-4">candles1m</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Combine analysis from all timeframes</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">hourlyTrend</span><span class="hl-1"> === </span><span class="hl-2">&#39;bullish&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">momentum</span><span class="hl-1"> &gt; </span><span class="hl-6">0.5</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">entrySignal</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&#39;long&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-4">entrySignal</span><span class="hl-1">.</span><span class="hl-4">tp</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-4">entrySignal</span><span class="hl-1">.</span><span class="hl-4">sl</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-6">120</span><span class="hl-1">,</span><br/><span class="hl-1">      };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">; </span><span class="hl-5">// No signal</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="timeframe-relationship-diagram" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Timeframe Relationship Diagram<a href="#timeframe-relationship-diagram" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/29_multi-timeframe-analysis_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="execution-context-and-temporal-safety" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Execution Context and Temporal Safety<a href="#execution-context-and-temporal-safety" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="how-temporal-context-propagates" class="tsd-anchor"></a><h3 class="tsd-anchor-link">How Temporal Context Propagates<a href="#how-temporal-context-propagates" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework uses Node.js <code>AsyncLocalStorage</code> (via <code>di-scoped</code> library) to propagate temporal context without explicit parameter passing. This ensures <code>getCandles()</code> always knows the &quot;current time&quot; regardless of call depth.</p>
<p><img src="../media/29_multi-timeframe-analysis_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Key insight</strong>: The <code>when</code> timestamp is set once at the start of each tick, then automatically available throughout the call stack. User code never needs to pass or track timestamps manually.</p>
<a id="temporal-filtering-in-code" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Temporal Filtering in Code<a href="#temporal-filtering-in-code" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The temporal filtering happens at the exchange service layer. When <code>getCandles()</code> is called, the exchange service reads the current execution timestamp from context and filters results:</p>
<ol>
<li><strong>BacktestLogicPrivateService</strong> (backtest mode) or <strong>LiveLogicPrivateService</strong> (live mode) sets <code>executionContextService.context.when</code> at the start of each tick</li>
<li>User's <code>getSignal</code> function calls <code>getCandles(symbol, interval, limit)</code></li>
<li><strong>ExchangeCoreService.getCandles()</strong> reads <code>executionContextService.context.when</code></li>
<li><strong>ClientExchange.getCandles()</strong> fetches raw candles from exchange</li>
<li>Framework filters: <code>candles.filter(c =&gt; c.timestamp &lt;= context.when)</code></li>
<li>Returns only historical candles to user code</li>
</ol>
<hr>
<a id="common-multi-timeframe-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Common Multi-Timeframe Patterns<a href="#common-multi-timeframe-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="pattern-1-trend-momentum-entry-hierarchy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 1: Trend-Momentum-Entry Hierarchy<a href="#pattern-1-trend-momentum-entry-hierarchy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Use Case</strong>: Confirm trend on higher timeframe, validate momentum on medium timeframe, time entry on lower timeframe.</p>
<table>
<thead>
<tr>
<th>Timeframe</th>
<th>Purpose</th>
<th>Typical Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>1h</code> or <code>4h</code></td>
<td><strong>Trend direction</strong></td>
<td>Moving averages, trend lines, support/resistance</td>
</tr>
<tr>
<td><code>15m</code> or <code>30m</code></td>
<td><strong>Momentum confirmation</strong></td>
<td>RSI, MACD, volume patterns</td>
</tr>
<tr>
<td><code>5m</code> or <code>1m</code></td>
<td><strong>Entry timing</strong></td>
<td>Candlestick patterns, precise entry points</td>
</tr>
</tbody>
</table>
<pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles4h</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;4h&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);  </span><span class="hl-5">// 4 days of trend</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles15m</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1">, </span><span class="hl-6">48</span><span class="hl-1">); </span><span class="hl-5">// 12 hours momentum</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles5m</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">, </span><span class="hl-6">60</span><span class="hl-1">);  </span><span class="hl-5">// 5 hours entry</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Higher TF: Is major trend bullish?</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ema50_4h</span><span class="hl-1"> = </span><span class="hl-0">calculateEMA</span><span class="hl-1">(</span><span class="hl-4">candles4h</span><span class="hl-1">, </span><span class="hl-6">50</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">trendBullish</span><span class="hl-1"> = </span><span class="hl-4">candles4h</span><span class="hl-1">[</span><span class="hl-6">0</span><span class="hl-1">].</span><span class="hl-4">close</span><span class="hl-1"> &gt; </span><span class="hl-4">ema50_4h</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Medium TF: Is momentum building?</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">rsi15m</span><span class="hl-1"> = </span><span class="hl-0">calculateRSI</span><span class="hl-1">(</span><span class="hl-4">candles15m</span><span class="hl-1">, </span><span class="hl-6">14</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">momentumGood</span><span class="hl-1"> = </span><span class="hl-4">rsi15m</span><span class="hl-1"> &gt; </span><span class="hl-6">50</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">rsi15m</span><span class="hl-1"> &lt; </span><span class="hl-6">70</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Lower TF: Is there a bullish engulfing pattern?</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">entryPattern</span><span class="hl-1"> = </span><span class="hl-0">isBullishEngulfing</span><span class="hl-1">(</span><span class="hl-4">candles5m</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">trendBullish</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">momentumGood</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">entryPattern</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> { </span><span class="hl-5">/* signal */</span><span class="hl-1"> };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="pattern-2-multi-timeframe-supportresistance" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 2: Multi-Timeframe Support/Resistance<a href="#pattern-2-multi-timeframe-supportresistance" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Use Case</strong>: Identify key levels across multiple timeframes for stronger support/resistance zones.</p>
<pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles1d</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1d&quot;</span><span class="hl-1">, </span><span class="hl-6">30</span><span class="hl-1">);  </span><span class="hl-5">// Monthly levels</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles1h</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">); </span><span class="hl-5">// Weekly levels</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles5m</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">, </span><span class="hl-6">60</span><span class="hl-1">);  </span><span class="hl-5">// Intraday levels</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Find support/resistance on each timeframe</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">dailyLevels</span><span class="hl-1"> = </span><span class="hl-0">findKeyLevels</span><span class="hl-1">(</span><span class="hl-4">candles1d</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">hourlyLevels</span><span class="hl-1"> = </span><span class="hl-0">findKeyLevels</span><span class="hl-1">(</span><span class="hl-4">candles1h</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">currentPrice</span><span class="hl-1"> = </span><span class="hl-4">candles5m</span><span class="hl-1">[</span><span class="hl-6">0</span><span class="hl-1">].</span><span class="hl-4">close</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Strong level = appears on multiple timeframes</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">strongSupport</span><span class="hl-1"> = </span><span class="hl-0">findConvergence</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">dailyLevels</span><span class="hl-1">.</span><span class="hl-4">support</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">hourlyLevels</span><span class="hl-1">.</span><span class="hl-4">support</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">currentPrice</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">strongSupport</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">isPriceNearLevel</span><span class="hl-1">(</span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">strongSupport</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&#39;long&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-4">strongSupport</span><span class="hl-1"> * </span><span class="hl-6">0.98</span><span class="hl-1">, </span><span class="hl-5">// Just below support</span><br/><span class="hl-1">      </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-4">currentPrice</span><span class="hl-1"> * </span><span class="hl-6">1.02</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-6">240</span><span class="hl-1">,</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="pattern-3-divergence-detection" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 3: Divergence Detection<a href="#pattern-3-divergence-detection" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Use Case</strong>: Detect momentum divergence between price and indicators across timeframes.</p>
<pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles1h</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">50</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles15m</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Price making lower lows on 1h</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">priceLowerLows</span><span class="hl-1"> = </span><span class="hl-0">isLowerLows</span><span class="hl-1">(</span><span class="hl-4">candles1h</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// RSI making higher lows on 15m (bullish divergence)</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">rsi15m</span><span class="hl-1"> = </span><span class="hl-0">calculateRSI</span><span class="hl-1">(</span><span class="hl-4">candles15m</span><span class="hl-1">, </span><span class="hl-6">14</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">rsiHigherLows</span><span class="hl-1"> = </span><span class="hl-0">isHigherLows</span><span class="hl-1">(</span><span class="hl-4">rsi15m</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Bullish divergence: price down, indicator up</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">priceLowerLows</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">rsiHigherLows</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> { </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&#39;long&#39;</span><span class="hl-1">, </span><span class="hl-5">/* ... */</span><span class="hl-1"> };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="performance-and-caching" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance and Caching<a href="#performance-and-caching" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="candle-data-caching" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Candle Data Caching<a href="#candle-data-caching" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework automatically caches candle data per execution context to avoid redundant exchange API calls:</p>
<ul>
<li><strong>Within single tick</strong>: Multiple <code>getCandles()</code> calls with same <code>(symbol, interval, limit)</code> return cached results</li>
<li><strong>Across ticks</strong>: Cache is cleared between ticks to ensure fresh data</li>
<li><strong>Memoization key</strong>: <code>${symbol}:${interval}:${limit}</code></li>
</ul>
<a id="performance-best-practices" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Performance Best Practices<a href="#performance-best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Practice</th>
<th>Rationale</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Store candles in variables</strong></td>
<td>Avoid redundant async calls</td>
<td><code>const candles1h = await getCandles(...); /* reuse */</code></td>
</tr>
<tr>
<td><strong>Request appropriate limit</strong></td>
<td>Balance between data sufficiency and performance</td>
<td>Use 100 candles for SMA(50), not 1000</td>
</tr>
<tr>
<td><strong>Use standard intervals</strong></td>
<td>Leverage exchange's native timeframes</td>
<td>Prefer <code>&quot;1h&quot;</code> over custom aggregations</td>
</tr>
<tr>
<td><strong>Avoid nested loops</strong></td>
<td>Minimize computational complexity</td>
<td>Pre-calculate indicators, don't recalculate per candle</td>
</tr>
</tbody>
</table>
<a id="rate-limiting-considerations-live-mode" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Rate Limiting Considerations (Live Mode)<a href="#rate-limiting-considerations-live-mode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>In live trading mode, <code>getCandles()</code> makes real API calls to exchanges. Be aware of:</p>
<ul>
<li><strong>Exchange rate limits</strong>: Most exchanges limit API calls (e.g., 1200/min for Binance)</li>
<li><strong>Strategy interval setting</strong>: Use appropriate <code>interval</code> in strategy schema to throttle <code>getSignal</code> calls (see <a href="design_25_strategy-development.html">Interval Throttling</a>)</li>
<li><strong>Candle limit parameter</strong>: Larger limits may hit rate limits faster</li>
<li><strong>Multiple symbols</strong>: Each symbol makes separate API calls</li>
</ul>
<hr>
<a id="data-flow-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Data Flow Architecture<a href="#data-flow-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="end-to-end-data-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">End-to-End Data Flow<a href="#end-to-end-data-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/29_multi-timeframe-analysis_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Key components</strong>:</p>
<ul>
<li><strong>ExecutionContextService</strong>: Provides temporal boundary (<code>when</code> timestamp)</li>
<li><strong>MethodContextService</strong>: Provides exchange routing (<code>exchangeName</code>)</li>
<li><strong>ExchangeCoreService</strong>: Orchestrates candle fetching with context</li>
<li><strong>ClientExchange</strong>: Implements actual data retrieval and filtering</li>
<li><strong>Memoization</strong>: Caches results by <code>symbol:interval:limit</code> key</li>
</ul>
<hr>
<a id="interval-throttling-vs-analysis-timeframes" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Interval Throttling vs Analysis Timeframes<a href="#interval-throttling-vs-analysis-timeframes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>Important distinction</strong>: The <code>interval</code> parameter in strategy schema (see <a href="design_25_strategy-development.html">Interval Throttling</a>) controls <strong>how often <code>getSignal</code> is called</strong>, while <code>getCandles()</code> timeframe parameters control <strong>what data is analyzed</strong>.</p>
<table>
<thead>
<tr>
<th>Concept</th>
<th>Purpose</th>
<th>Location</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Strategy interval</strong></td>
<td>Throttles signal generation frequency</td>
<td><code>IStrategySchema.interval</code></td>
<td><code>interval: '5m'</code> → getSignal called every 5 minutes</td>
</tr>
<tr>
<td><strong>Analysis timeframes</strong></td>
<td>Specifies candle data granularity</td>
<td><code>getCandles()</code> calls</td>
<td><code>getCandles(symbol, &quot;1h&quot;, 24)</code> → Hourly candles</td>
</tr>
</tbody>
</table>
<a id="example-configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example Configuration<a href="#example-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;example&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&#39;5m&#39;</span><span class="hl-1">,  </span><span class="hl-5">// getSignal called every 5 minutes (throttle)</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// But analyze multiple timeframes when called</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles1h</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles15m</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1">, </span><span class="hl-6">48</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles5m</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">, </span><span class="hl-6">60</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// ... analysis logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>In this example:</p>
<ul>
<li>✅ <code>getSignal</code> is called <strong>at most</strong> once every 5 minutes (strategy throttle)</li>
<li>✅ When called, it analyzes 1-hour, 15-minute, AND 5-minute candles</li>
<li>✅ All timeframes automatically synchronized to same execution timestamp</li>
</ul>
<hr>
<a id="error-handling-and-edge-cases" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Error Handling and Edge Cases<a href="#error-handling-and-edge-cases" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="insufficient-historical-data" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Insufficient Historical Data<a href="#insufficient-historical-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When <code>limit</code> exceeds available historical data, <code>getCandles()</code> returns fewer candles than requested:</p>
<pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1d&quot;</span><span class="hl-1">, </span><span class="hl-6">365</span><span class="hl-1">); </span><span class="hl-5">// Request 1 year</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// May return fewer if exchange doesn&#39;t have 1 year history</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">candles</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &lt; </span><span class="hl-6">100</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Not enough data for analysis</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Safe to proceed</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">sma100</span><span class="hl-1"> = </span><span class="hl-0">calculateSMA</span><span class="hl-1">(</span><span class="hl-4">candles</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">// ...</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="incomplete-candles-live-mode" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Incomplete Candles (Live Mode)<a href="#incomplete-candles-live-mode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>In live trading, the current candle is <strong>never included</strong> in results - only completed candles are returned:</p>
<ul>
<li>Current time: <code>2025-01-15 14:32:15</code></li>
<li>Fetching <code>getCandles(symbol, &quot;15m&quot;, 10)</code></li>
<li>Returns candles ending at: <code>2025-01-15 14:30:00</code> (last completed 15-minute candle)</li>
<li><strong>Excludes</strong> in-progress candle from <code>14:30:00</code> to <code>14:45:00</code></li>
</ul>
<p>This ensures identical behavior between backtest and live modes.</p>
<a id="timeframe-alignment" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Timeframe Alignment<a href="#timeframe-alignment" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Different timeframes may not always align perfectly. For example:</p>
<ul>
<li>1-hour candles: <code>12:00</code>, <code>13:00</code>, <code>14:00</code></li>
<li>5-minute candles: <code>12:00</code>, <code>12:05</code>, <code>12:10</code>, ..., <code>12:55</code>, <code>13:00</code></li>
</ul>
<p>The framework handles this automatically - all intervals are aligned to their natural boundaries.</p>
<hr>
<a id="testing-multi-timeframe-strategies" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Testing Multi-Timeframe Strategies<a href="#testing-multi-timeframe-strategies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="backtest-mode-benefits" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Mode Benefits<a href="#backtest-mode-benefits" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Multi-timeframe strategies are particularly well-suited for backtesting because:</p>
<ol>
<li><strong>Deterministic</strong>: Same execution timestamp across all <code>getCandles()</code> calls</li>
<li><strong>Fast iteration</strong>: Test years of data in seconds</li>
<li><strong>No API limits</strong>: Historical data loaded once, no rate limiting</li>
<li><strong>Reproducible</strong>: Exact same results every run</li>
</ol>
<a id="example-test-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example Test Pattern<a href="#example-test-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Backtest</span><span class="hl-1">, </span><span class="hl-4">addStrategy</span><span class="hl-1">, </span><span class="hl-4">addExchange</span><span class="hl-1">, </span><span class="hl-4">addFrame</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;backtest-kit&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Configure strategy with multiple timeframes</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;test-multi-tf&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&#39;5m&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles1h</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles5m</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">, </span><span class="hl-6">60</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Test: candles should be aligned to same execution time</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">latest1h</span><span class="hl-1"> = </span><span class="hl-4">candles1h</span><span class="hl-1">[</span><span class="hl-6">0</span><span class="hl-1">].</span><span class="hl-4">timestamp</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">latest5m</span><span class="hl-1"> = </span><span class="hl-4">candles5m</span><span class="hl-1">[</span><span class="hl-6">0</span><span class="hl-1">].</span><span class="hl-4">timestamp</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Both should be &lt;= current execution time</span><br/><span class="hl-1">    </span><span class="hl-5">// latest5m may be more recent than latest1h (finer granularity)</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// ... strategy logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Run backtest</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">event</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&#39;BTCUSDT&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;test-multi-tf&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&#39;binance&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&#39;1d-test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&#39;closed&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Signal closed:&#39;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="best-practices-summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Best Practices Summary<a href="#best-practices-summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="✅-do" class="tsd-anchor"></a><h3 class="tsd-anchor-link">✅ Do<a href="#✅-do" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Analyze higher timeframes first</strong>: Establish context before drilling down</li>
<li><strong>Use consistent intervals</strong>: Stick to standard intervals (<code>1m</code>, <code>5m</code>, <code>15m</code>, <code>1h</code>, <code>4h</code>, <code>1d</code>)</li>
<li><strong>Cache results</strong>: Store <code>getCandles()</code> results in variables, don't call repeatedly</li>
<li><strong>Handle insufficient data</strong>: Check <code>candles.length</code> before calculating indicators</li>
<li><strong>Document timeframe choices</strong>: Comment why each timeframe is used</li>
</ol>
<a id="❌-dont" class="tsd-anchor"></a><h3 class="tsd-anchor-link">❌ Don't<a href="#❌-dont" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Don't mix backtest/live logic</strong>: Same <code>getSignal</code> function for both modes</li>
<li><strong>Don't assume candle count</strong>: Always validate <code>candles.length &gt;= requiredLength</code></li>
<li><strong>Don't ignore temporal alignment</strong>: Trust framework's automatic synchronization</li>
<li><strong>Don't make excessive API calls</strong>: Minimize <code>getCandles()</code> calls in live mode</li>
<li><strong>Don't try to access future data</strong>: Framework prevents this, but don't attempt workarounds</li>
</ol>
<a id="performance-checklist" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Performance Checklist<a href="#performance-checklist" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>[ ] Strategy <code>interval</code> appropriately throttles signal generation</li>
<li>[ ] Candle <code>limit</code> parameters are sufficient but not excessive</li>
<li>[ ] Results stored in variables to avoid redundant calls</li>
<li>[ ] Indicators pre-calculated outside loops</li>
<li>[ ] Rate limiting considered for live trading</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#multi-timeframe-analysis"><span>Multi-<wbr/>Timeframe <wbr/>Analysis</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#getcandles-api-reference"><span>get<wbr/>Candles API <wbr/>Reference</span></a></li><li><ul><li><a href="#function-signature"><span>Function <wbr/>Signature</span></a></li><li><a href="#parameters"><span>Parameters</span></a></li><li><a href="#return-type"><span>Return <wbr/>Type</span></a></li><li><a href="#temporal-context-guarantees"><span>Temporal <wbr/>Context <wbr/>Guarantees</span></a></li></ul></li><li><a href="#multi-timeframe-strategy-pattern"><span>Multi-<wbr/>Timeframe <wbr/>Strategy <wbr/>Pattern</span></a></li><li><ul><li><a href="#basic-example"><span>Basic <wbr/>Example</span></a></li><li><a href="#timeframe-relationship-diagram"><span>Timeframe <wbr/>Relationship <wbr/>Diagram</span></a></li></ul></li><li><a href="#execution-context-and-temporal-safety"><span>Execution <wbr/>Context and <wbr/>Temporal <wbr/>Safety</span></a></li><li><ul><li><a href="#how-temporal-context-propagates"><span>How <wbr/>Temporal <wbr/>Context <wbr/>Propagates</span></a></li><li><a href="#temporal-filtering-in-code"><span>Temporal <wbr/>Filtering in <wbr/>Code</span></a></li></ul></li><li><a href="#common-multi-timeframe-patterns"><span>Common <wbr/>Multi-<wbr/>Timeframe <wbr/>Patterns</span></a></li><li><ul><li><a href="#pattern-1-trend-momentum-entry-hierarchy"><span>Pattern 1: <wbr/>Trend-<wbr/>Momentum-<wbr/>Entry <wbr/>Hierarchy</span></a></li><li><a href="#pattern-2-multi-timeframe-supportresistance"><span>Pattern 2: <wbr/>Multi-<wbr/>Timeframe <wbr/>Support/<wbr/>Resistance</span></a></li><li><a href="#pattern-3-divergence-detection"><span>Pattern 3: <wbr/>Divergence <wbr/>Detection</span></a></li></ul></li><li><a href="#performance-and-caching"><span>Performance and <wbr/>Caching</span></a></li><li><ul><li><a href="#candle-data-caching"><span>Candle <wbr/>Data <wbr/>Caching</span></a></li><li><a href="#performance-best-practices"><span>Performance <wbr/>Best <wbr/>Practices</span></a></li><li><a href="#rate-limiting-considerations-live-mode"><span>Rate <wbr/>Limiting <wbr/>Considerations (<wbr/>Live <wbr/>Mode)</span></a></li></ul></li><li><a href="#data-flow-architecture"><span>Data <wbr/>Flow <wbr/>Architecture</span></a></li><li><ul><li><a href="#end-to-end-data-flow"><span>End-<wbr/>to-<wbr/>End <wbr/>Data <wbr/>Flow</span></a></li></ul></li><li><a href="#interval-throttling-vs-analysis-timeframes"><span>Interval <wbr/>Throttling vs <wbr/>Analysis <wbr/>Timeframes</span></a></li><li><ul><li><a href="#example-configuration"><span>Example <wbr/>Configuration</span></a></li></ul></li><li><a href="#error-handling-and-edge-cases"><span>Error <wbr/>Handling and <wbr/>Edge <wbr/>Cases</span></a></li><li><ul><li><a href="#insufficient-historical-data"><span>Insufficient <wbr/>Historical <wbr/>Data</span></a></li><li><a href="#incomplete-candles-live-mode"><span>Incomplete <wbr/>Candles (<wbr/>Live <wbr/>Mode)</span></a></li><li><a href="#timeframe-alignment"><span>Timeframe <wbr/>Alignment</span></a></li></ul></li><li><a href="#testing-multi-timeframe-strategies"><span>Testing <wbr/>Multi-<wbr/>Timeframe <wbr/>Strategies</span></a></li><li><ul><li><a href="#backtest-mode-benefits"><span>Backtest <wbr/>Mode <wbr/>Benefits</span></a></li><li><a href="#example-test-pattern"><span>Example <wbr/>Test <wbr/>Pattern</span></a></li></ul></li><li><a href="#best-practices-summary"><span>Best <wbr/>Practices <wbr/>Summary</span></a></li><li><ul><li><a href="#✅-do"><span>✅ <wbr/>Do</span></a></li><li><a href="#❌-dont"><span>❌ <wbr/>Don&#39;t</span></a></li><li><a href="#performance-checklist"><span>Performance <wbr/>Checklist</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
