<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/14_architecture-deep-dive | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_14_architecture-deep-dive.html">design/14_architecture-deep-dive</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="architecture-deep-dive" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Architecture Deep Dive<a href="#architecture-deep-dive" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This document provides a detailed technical exploration of Backtest Kit's internal architecture, focusing on the dependency injection system, service layer organization, context propagation mechanisms, and architectural patterns. This material is intended for developers who need to understand the framework's internal design, extend its functionality, or troubleshoot complex issues.</p>
<p>For information about the public API and usage patterns, see <a href="design_04_getting-started.html">Getting Started</a>. For details on strategy development and signal generation, see <a href="design_25_strategy-development.html">Strategy Development</a>. For client-layer implementation specifics, see <a href="design_14_architecture-deep-dive.html">Client Layer</a>.</p>
<a id="the-dependency-injection-container" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Dependency Injection Container<a href="#the-dependency-injection-container" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Kit implements a custom dependency injection container using Symbol-based tokens for type-safe service resolution. The DI system consists of three core components:</p>
<ol>
<li><strong>TYPES Registry</strong> - Symbol-based tokens for each service</li>
<li><strong>Service Providers</strong> - Factory functions that instantiate services</li>
<li><strong>Service Injectors</strong> - Lazy dependency resolution functions</li>
<li><strong>Backtest Aggregator</strong> - Central object exposing all services</li>
</ol>
<a id="types-symbol-registry" class="tsd-anchor"></a><h3 class="tsd-anchor-link">TYPES Symbol Registry<a href="#types-symbol-registry" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework defines unique Symbol tokens for each service, organized by category. These symbols serve as dependency injection keys that prevent naming collisions and enable type-safe resolution.</p>
<p><strong>TYPES Symbol Structure</strong></p>
<p><img src="../media/14_architecture-deep-dive_0.svg" alt="Mermaid Diagram"></p>
<a id="service-provider-registration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Provider Registration<a href="#service-provider-registration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Service factories are registered via the <code>provide()</code> function, which associates each TYPES symbol with a constructor function. The registration happens in <code>src/lib/core/provide.ts</code>, organized by service category.</p>
<p><strong>Service Registration Pattern</strong></p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Registration Example</th>
<th>Constructor</th>
</tr>
</thead>
<tbody>
<tr>
<td>Base Services</td>
<td><code>provide(TYPES.loggerService, () =&gt; new LoggerService())</code></td>
<td><code>LoggerService</code></td>
</tr>
<tr>
<td>Context Services</td>
<td><code>provide(TYPES.executionContextService, () =&gt; new ExecutionContextService())</code></td>
<td><code>ExecutionContextService</code></td>
</tr>
<tr>
<td>Schema Services</td>
<td><code>provide(TYPES.strategySchemaService, () =&gt; new StrategySchemaService())</code></td>
<td><code>StrategySchemaService</code></td>
</tr>
<tr>
<td>Validation Services</td>
<td><code>provide(TYPES.strategyValidationService, () =&gt; new StrategyValidationService())</code></td>
<td><code>StrategyValidationService</code></td>
</tr>
<tr>
<td>Connection Services</td>
<td><code>provide(TYPES.strategyConnectionService, () =&gt; new StrategyConnectionService())</code></td>
<td><code>StrategyConnectionService</code></td>
</tr>
<tr>
<td>Core Services</td>
<td><code>provide(TYPES.strategyCoreService, () =&gt; new StrategyCoreService())</code></td>
<td><code>StrategyCoreService</code></td>
</tr>
<tr>
<td>Command Services</td>
<td><code>provide(TYPES.backtestCommandService, () =&gt; new BacktestCommandService())</code></td>
<td><code>BacktestCommandService</code></td>
</tr>
<tr>
<td>Logic Private Services</td>
<td><code>provide(TYPES.backtestLogicPrivateService, () =&gt; new BacktestLogicPrivateService())</code></td>
<td><code>BacktestLogicPrivateService</code></td>
</tr>
<tr>
<td>Logic Public Services</td>
<td><code>provide(TYPES.backtestLogicPublicService, () =&gt; new BacktestLogicPublicService())</code></td>
<td><code>BacktestLogicPublicService</code></td>
</tr>
<tr>
<td>Markdown Services</td>
<td><code>provide(TYPES.backtestMarkdownService, () =&gt; new BacktestMarkdownService())</code></td>
<td><code>BacktestMarkdownService</code></td>
</tr>
<tr>
<td>Template Services</td>
<td><code>provide(TYPES.optimizerTemplateService, () =&gt; new OptimizerTemplateService())</code></td>
<td><code>OptimizerTemplateService</code></td>
</tr>
</tbody>
</table>
<a id="service-injection-and-the-backtest-aggregator" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Injection and the Backtest Aggregator<a href="#service-injection-and-the-backtest-aggregator" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>inject()</code> function performs lazy dependency resolution. Services are instantiated only when first accessed, enabling circular dependency resolution and reducing initialization overhead.</p>
<p>The <code>backtest</code> object aggregates all injected services into a single namespace, providing a centralized access point for the entire service layer.</p>
<p><strong>Backtest Object Structure</strong></p>
<p><img src="../media/14_architecture-deep-dive_1.svg" alt="Mermaid Diagram"></p>
<p>The aggregation structure allows services to access other services through the same namespace:</p>
<pre><code class="typescript"><span class="hl-5">// Inside a service class</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">strategySchema</span><span class="hl-1"> = </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategySchemaService</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">logger</span><span class="hl-1"> = </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">context</span><span class="hl-1"> = </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">executionContextService</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<a id="service-layer-organization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Layer Organization<a href="#service-layer-organization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The service layer is organized into 11 distinct categories, each with specific responsibilities. This categorization enforces separation of concerns and prevents circular dependencies through careful layering.</p>
<a id="service-category-overview" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Category Overview<a href="#service-category-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Category</th>
<th>Purpose</th>
<th>Key Characteristics</th>
<th>Example Services</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Base Services</strong></td>
<td>Fundamental services used throughout the system</td>
<td>No dependencies on other services</td>
<td><code>LoggerService</code></td>
</tr>
<tr>
<td><strong>Context Services</strong></td>
<td>Ambient context propagation using <code>di-scoped</code></td>
<td>Provide implicit context without explicit parameters</td>
<td><code>ExecutionContextService</code>, <code>MethodContextService</code></td>
</tr>
<tr>
<td><strong>Schema Services</strong></td>
<td>Configuration storage using <code>ToolRegistry</code> pattern</td>
<td>Immutable schema registration and retrieval</td>
<td><code>StrategySchemaService</code>, <code>ExchangeSchemaService</code></td>
</tr>
<tr>
<td><strong>Validation Services</strong></td>
<td>Runtime existence checks with memoization</td>
<td>Fast repeated validation through caching</td>
<td><code>StrategyValidationService</code>, <code>ExchangeValidationService</code></td>
</tr>
<tr>
<td><strong>Connection Services</strong></td>
<td>Memoized client instance factories</td>
<td>Cache clients by unique keys to prevent redundant instantiation</td>
<td><code>StrategyConnectionService</code>, <code>ExchangeConnectionService</code></td>
</tr>
<tr>
<td><strong>Core Services</strong></td>
<td>Business logic orchestration</td>
<td>Coordinate execution flow and delegate to clients</td>
<td><code>StrategyCoreService</code>, <code>ExchangeCoreService</code></td>
</tr>
<tr>
<td><strong>Global Services</strong></td>
<td>Shared state management across strategies</td>
<td>Manage portfolio-wide concerns</td>
<td><code>RiskGlobalService</code>, <code>PartialGlobalService</code></td>
</tr>
<tr>
<td><strong>Logic Private Services</strong></td>
<td>Internal async generator implementations</td>
<td>Stream results with backpressure control</td>
<td><code>BacktestLogicPrivateService</code>, <code>LiveLogicPrivateService</code></td>
</tr>
<tr>
<td><strong>Logic Public Services</strong></td>
<td>External API wrappers for logic services</td>
<td>Public interface delegation to private implementations</td>
<td><code>BacktestLogicPublicService</code>, <code>LiveLogicPublicService</code></td>
</tr>
<tr>
<td><strong>Command Services</strong></td>
<td>Top-level API entry points</td>
<td>Handle validation and delegate to logic services</td>
<td><code>BacktestCommandService</code>, <code>LiveCommandService</code></td>
</tr>
<tr>
<td><strong>Markdown Services</strong></td>
<td>Event-driven report generation</td>
<td>Subscribe to emitters, accumulate data, generate reports</td>
<td><code>BacktestMarkdownService</code>, <code>LiveMarkdownService</code></td>
</tr>
<tr>
<td><strong>Template Services</strong></td>
<td>Code generation for optimizer</td>
<td>Generate executable strategy code from schemas</td>
<td><code>OptimizerTemplateService</code></td>
</tr>
</tbody>
</table>
<a id="service-dependency-layers" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Dependency Layers<a href="#service-dependency-layers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The service architecture follows a strict layering principle to prevent circular dependencies. Lower layers have no knowledge of higher layers.</p>
<p><strong>Service Dependency Hierarchy</strong></p>
<p><img src="../media/14_architecture-deep-dive_2.svg" alt="Mermaid Diagram"></p>
<a id="service-category-implementation-details" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Category Implementation Details<a href="#service-category-implementation-details" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each service category follows specific patterns and conventions:</p>
<p><strong>1. Base Services</strong> - Provide fundamental capabilities without dependencies:</p>
<pre><code class="typescript"><span class="hl-5">// LoggerService has no dependencies</span><br/><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-11">LoggerService</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">topic</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, ...</span><span class="hl-4">args</span><span class="hl-1">: </span><span class="hl-11">any</span><span class="hl-1">[]): </span><span class="hl-11">void</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">debug</span><span class="hl-1">(</span><span class="hl-4">topic</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, ...</span><span class="hl-4">args</span><span class="hl-1">: </span><span class="hl-11">any</span><span class="hl-1">[]): </span><span class="hl-11">void</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-4">topic</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, ...</span><span class="hl-4">args</span><span class="hl-1">: </span><span class="hl-11">any</span><span class="hl-1">[]): </span><span class="hl-11">void</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-4">topic</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, ...</span><span class="hl-4">args</span><span class="hl-1">: </span><span class="hl-11">any</span><span class="hl-1">[]): </span><span class="hl-11">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>2. Context Services</strong> - Use <code>di-scoped</code> for context propagation:</p>
<ul>
<li><code>ExecutionContextService</code> contains: <code>{ symbol, when, backtest }</code></li>
<li><code>MethodContextService</code> contains: <code>{ strategyName, exchangeName, frameName }</code></li>
<li>Both extend <code>di-scoped.IScopedClassRun</code> for <code>runInContext()</code> method</li>
</ul>
<p><strong>3. Schema Services</strong> - Implement registry pattern with <code>ToolRegistry</code>:</p>
<ul>
<li><code>register(name: string, schema: ISchema): void</code></li>
<li><code>get(name: string): ISchema</code></li>
<li><code>has(name: string): boolean</code></li>
<li><code>list(): ISchema[]</code></li>
</ul>
<p><strong>4. Validation Services</strong> - Provide memoized existence checks:</p>
<ul>
<li><code>addStrategy(name: string, schema: ISchema): void</code> (validates no duplicates)</li>
<li><code>strategyExists(name: string): boolean</code> (memoized)</li>
<li><code>list(): ISchema[]</code> (returns all schemas)</li>
</ul>
<p><strong>5. Connection Services</strong> - Create and cache client instances:</p>
<ul>
<li>Use <code>functools-kit</code> <code>memoize()</code> decorator</li>
<li>Cache key: unique identifier (e.g., <code>strategyName</code>, <code>exchangeName</code>)</li>
<li>Return cached instance on subsequent calls with same key</li>
</ul>
<p><strong>6. Core Services</strong> - Orchestrate execution:</p>
<ul>
<li>Retrieve clients from connection services</li>
<li>Delegate method calls to client instances</li>
<li>Handle execution context propagation</li>
</ul>
<p><strong>7. Global Services</strong> - Manage shared state:</p>
<ul>
<li>Track portfolio-wide metrics</li>
<li>Coordinate cross-strategy concerns</li>
<li>Provide centralized state access</li>
</ul>
<p><strong>8. Logic Private Services</strong> - Implement async generators:</p>
<ul>
<li><code>async *run(symbol: string)</code> yields results progressively</li>
<li>Handle timeframe iteration (backtest) or infinite loop (live)</li>
<li>Skip frames based on signal state</li>
</ul>
<p><strong>9. Logic Public Services</strong> - Wrap private implementations:</p>
<ul>
<li>Validate parameters before delegation</li>
<li>Provide public-facing API surface</li>
<li>Simplify complex private logic</li>
</ul>
<p><strong>10. Command Services</strong> - Entry points for public API:</p>
<ul>
<li>Validate all required schemas exist</li>
<li>Set up contexts via <code>MethodContextService</code></li>
<li>Delegate to logic services</li>
</ul>
<p><strong>11. Markdown Services</strong> - Generate reports from events:</p>
<ul>
<li>Subscribe to relevant emitters</li>
<li>Accumulate events in <code>ReportStorage</code></li>
<li>Calculate statistics on demand</li>
<li>Generate formatted markdown tables</li>
</ul>
<a id="context-propagation-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Propagation Architecture<a href="#context-propagation-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Kit uses the <code>di-scoped</code> library to propagate ambient context throughout the execution stack without explicit parameter passing. This approach eliminates parameter drilling while maintaining type safety.</p>
<a id="context-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Services<a href="#context-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Two context services provide different levels of ambient information:</p>
<p><strong>ExecutionContextService</strong> - Runtime execution parameters:</p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IExecutionContext</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;        </span><span class="hl-5">// Trading pair (e.g., &quot;BTCUSDT&quot;)</span><br/><span class="hl-1">    </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-11">Date</span><span class="hl-1">;           </span><span class="hl-5">// Current timestamp for operation</span><br/><span class="hl-1">    </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-11">boolean</span><span class="hl-1">;    </span><span class="hl-5">// true = backtest mode, false = live mode</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>MethodContextService</strong> - Schema routing information:</p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IMethodContext</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-11">ExchangeName</span><span class="hl-1">;   </span><span class="hl-5">// Which exchange schema to use</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">StrategyName</span><span class="hl-1">;   </span><span class="hl-5">// Which strategy schema to use</span><br/><span class="hl-1">    </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-11">FrameName</span><span class="hl-1">;         </span><span class="hl-5">// Which frame schema to use (empty for live)</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="context-propagation-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Propagation Flow<a href="#context-propagation-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/14_architecture-deep-dive_3.svg" alt="Mermaid Diagram"></p>
<a id="context-access-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Access Pattern<a href="#context-access-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Services access context through the context services without receiving context as parameters:</p>
<pre><code class="typescript"><span class="hl-5">// Inside StrategyCoreService</span><br/><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-11">StrategyCoreService</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">tick</span><span class="hl-1">() {</span><br/><span class="hl-1">        </span><span class="hl-5">// Access execution context (symbol, when, backtest)</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">execCtx</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">executionContextService</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> { </span><span class="hl-8">symbol</span><span class="hl-1">, </span><span class="hl-8">when</span><span class="hl-1">, </span><span class="hl-8">backtest</span><span class="hl-1"> } = </span><span class="hl-4">execCtx</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Access method context (strategyName, exchangeName, frameName)</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">methodCtx</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">methodContextService</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> { </span><span class="hl-8">strategyName</span><span class="hl-1">, </span><span class="hl-8">exchangeName</span><span class="hl-1"> } = </span><span class="hl-4">methodCtx</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Use contexts without explicit parameters</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">strategy</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">strategyConnectionService</span><span class="hl-1">.</span><span class="hl-0">getStrategy</span><span class="hl-1">(</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">strategy</span><span class="hl-1">.</span><span class="hl-0">tick</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The <code>di-scoped</code> library manages context scope boundaries:</p>
<ul>
<li><code>runInContext(callback, context)</code> - Execute callback with specific context</li>
<li><code>runAsyncIterator(generator, context)</code> - Execute async generator with context</li>
<li>Context automatically available to all code within callback/generator scope</li>
</ul>
<a id="memoization-strategy" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Memoization Strategy<a href="#memoization-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Connection services use memoization to cache client instances, preventing redundant instantiation and improving performance. This pattern is critical for maintaining consistent state across multiple calls.</p>
<a id="connection-service-memoization-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Connection Service Memoization Pattern<a href="#connection-service-memoization-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>StrategyConnectionService Example</strong></p>
<p><img src="../media/14_architecture-deep-dive_4.svg" alt="Mermaid Diagram"></p>
<a id="memoization-benefits" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoization Benefits<a href="#memoization-benefits" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Benefit</th>
<th>Description</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Performance</strong></td>
<td>Avoids repeated instantiation of expensive client objects</td>
<td>Reduces CPU and memory overhead</td>
</tr>
<tr>
<td><strong>State Consistency</strong></td>
<td>Same instance returned for same key ensures consistent state</td>
<td>Prevents duplicate signals, maintains accurate tracking</td>
</tr>
<tr>
<td><strong>Memory Efficiency</strong></td>
<td>Single instance per unique key rather than per call</td>
<td>Reduces memory footprint for long-running processes</td>
</tr>
<tr>
<td><strong>Deterministic Behavior</strong></td>
<td>Predictable instance resolution simplifies debugging</td>
<td>Easier to reason about system state</td>
</tr>
</tbody>
</table>
<a id="memoization-cache-keys" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoization Cache Keys<a href="#memoization-cache-keys" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Different connection services use different cache key strategies:</p>
<table>
<thead>
<tr>
<th>Connection Service</th>
<th>Cache Key</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>StrategyConnectionService</code></td>
<td><code>strategyName</code></td>
<td><code>&quot;my-strategy&quot;</code></td>
</tr>
<tr>
<td><code>ExchangeConnectionService</code></td>
<td><code>exchangeName</code></td>
<td><code>&quot;binance&quot;</code></td>
</tr>
<tr>
<td><code>FrameConnectionService</code></td>
<td><code>frameName</code></td>
<td><code>&quot;1d-backtest&quot;</code></td>
</tr>
<tr>
<td><code>RiskConnectionService</code></td>
<td><code>riskName</code></td>
<td><code>&quot;conservative&quot;</code></td>
</tr>
<tr>
<td><code>PartialConnectionService</code></td>
<td><code>symbol</code></td>
<td><code>&quot;BTCUSDT&quot;</code></td>
</tr>
<tr>
<td><code>OptimizerConnectionService</code></td>
<td><code>optimizerName</code></td>
<td><code>&quot;llm-generator&quot;</code></td>
</tr>
</tbody>
</table>
<a id="implementation-details" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Implementation Details<a href="#implementation-details" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Connection services implement a consistent pattern:</p>
<ol>
<li><strong>Schema Retrieval</strong> - Get schema from schema service</li>
<li><strong>Parameter Assembly</strong> - Build client constructor parameters</li>
<li><strong>Client Instantiation</strong> - Create new client with parameters</li>
<li><strong>Memoized Getter</strong> - Cache instance by unique key</li>
</ol>
<p>Example pseudo-pattern:</p>
<pre><code class="typescript"><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-11">ConnectionService</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Memoized getter (implemented via functools-kit memoize decorator)</span><br/><span class="hl-1">    </span><span class="hl-0">getClient</span><span class="hl-1">(</span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">schema</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">schemaService</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-4">name</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">createClient</span><span class="hl-1">(</span><span class="hl-4">schema</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Factory method (non-memoized)</span><br/><span class="hl-1">    </span><span class="hl-7">private</span><span class="hl-1"> </span><span class="hl-0">createClient</span><span class="hl-1">(</span><span class="hl-4">schema</span><span class="hl-1">: </span><span class="hl-11">ISchema</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Client</span><span class="hl-1">({</span><br/><span class="hl-1">            ...</span><span class="hl-4">schema</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">logger:</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">execution:</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">executionContextService</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">// ... other dependencies</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="service-dependency-graph" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Dependency Graph<a href="#service-dependency-graph" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The service layer exhibits a carefully designed dependency structure that avoids circular dependencies while enabling rich functionality. Dependencies flow from lower layers to higher layers, with context services providing cross-cutting concerns.</p>
<a id="key-service-dependencies" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Key Service Dependencies<a href="#key-service-dependencies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Command Service Dependencies</strong></p>
<p><img src="../media/14_architecture-deep-dive_5.svg" alt="Mermaid Diagram"></p>
<a id="cross-service-communication-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Cross-Service Communication Patterns<a href="#cross-service-communication-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Services communicate through well-defined patterns:</p>
<p><strong>1. Direct Dependency Injection</strong></p>
<ul>
<li>Service A injects Service B via TYPES symbol</li>
<li>Service A calls methods on Service B</li>
<li>Example: <code>StrategyCoreService</code> → <code>StrategyConnectionService</code></li>
</ul>
<p><strong>2. Context-Based Communication</strong></p>
<ul>
<li>Services read ambient context without direct coupling</li>
<li>Example: All services access <code>ExecutionContextService.context</code></li>
</ul>
<p><strong>3. Event-Based Communication</strong></p>
<ul>
<li>Services emit events to subjects</li>
<li>Other services subscribe to subjects</li>
<li>Example: <code>ClientStrategy</code> emits to <code>signalEmitter</code>, <code>MarkdownService</code> subscribes</li>
</ul>
<p><strong>4. Schema Registry Pattern</strong></p>
<ul>
<li>Services store configurations in schema services</li>
<li>Other services retrieve configurations by name</li>
<li>Example: <code>StrategySchemaService.register()</code> → <code>StrategyConnectionService.get()</code></li>
</ul>
<a id="acyclic-dependency-enforcement" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Acyclic Dependency Enforcement<a href="#acyclic-dependency-enforcement" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The architecture prevents circular dependencies through:</p>
<table>
<thead>
<tr>
<th>Mechanism</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Layered Architecture</strong></td>
<td>Higher layers depend on lower layers, never reverse</td>
<td>Command → Logic → Core → Connection</td>
</tr>
<tr>
<td><strong>Context Services</strong></td>
<td>Provide cross-cutting concerns without coupling</td>
<td>Services access context without depending on setter</td>
</tr>
<tr>
<td><strong>Event System</strong></td>
<td>Decouple producers from consumers</td>
<td>Strategy emits signal, markdown subscribes (no direct dependency)</td>
</tr>
<tr>
<td><strong>Registry Pattern</strong></td>
<td>Schemas stored centrally, accessed by name</td>
<td>Strategy registers schema, connection service retrieves it</td>
</tr>
</tbody>
</table>
<p><strong>Dependency Flow Direction</strong></p>
<p><img src="../media/14_architecture-deep-dive_6.svg" alt="Mermaid Diagram"></p>
<a id="initialization-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Initialization Flow<a href="#initialization-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework initialization follows a specific sequence to ensure all services are properly configured before execution begins.</p>
<a id="initialization-sequence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Initialization Sequence<a href="#initialization-sequence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/14_architecture-deep-dive_7.svg" alt="Mermaid Diagram"></p>
<a id="lazy-dependency-resolution" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Lazy Dependency Resolution<a href="#lazy-dependency-resolution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Services are instantiated only when first accessed, not during module import. This enables:</p>
<ol>
<li><strong>Circular Dependency Handling</strong> - Services can depend on each other if resolution is lazy</li>
<li><strong>Reduced Startup Time</strong> - Only used services are instantiated</li>
<li><strong>Memory Efficiency</strong> - Unused services never allocate memory</li>
<li><strong>Configuration Flexibility</strong> - Services can be configured before first use</li>
</ol>
<p><strong>Lazy Resolution Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">// src/lib/index.ts</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-2">&quot;./core/provide&quot;</span><span class="hl-1">;  </span><span class="hl-5">// Registers all factories (no instantiation)</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">inject</span><span class="hl-1">, </span><span class="hl-4">init</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;./core/di&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Services are injected but not yet instantiated</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">backtest</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">loggerService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">),  </span><span class="hl-5">// Returns getter function</span><br/><span class="hl-1">    </span><span class="hl-4">strategyCoreService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">strategyCoreService</span><span class="hl-1">),  </span><span class="hl-5">// Returns getter function</span><br/><span class="hl-1">    </span><span class="hl-5">// ... all other services</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">init</span><span class="hl-1">();  </span><span class="hl-5">// Initialize DI container</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> { </span><span class="hl-4">backtest</span><span class="hl-1"> };  </span><span class="hl-5">// Export service accessors</span><br/><br/><span class="hl-5">// When backtest.loggerService is first accessed:</span><br/><span class="hl-5">// 1. DI container calls factory: () =&gt; new LoggerService()</span><br/><span class="hl-5">// 2. Instance is cached for future access</span><br/><span class="hl-5">// 3. Same instance returned on subsequent access</span>
</code><button type="button">Copy</button></pre>

<a id="service-access-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Access Patterns<a href="#service-access-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Access Pattern</th>
<th>Use Case</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Direct Property Access</strong></td>
<td>Internal service communication</td>
<td><code>this.loggerService.log(...)</code></td>
</tr>
<tr>
<td><strong>inject() Function</strong></td>
<td>Service injection in constructors</td>
<td><code>inject(TYPES.loggerService)</code></td>
</tr>
<tr>
<td><strong>backtest Object</strong></td>
<td>External API implementation</td>
<td><code>backtest.strategySchemaService.get(name)</code></td>
</tr>
</tbody>
</table>
<a id="type-safety-and-intellisense" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Type Safety and IntelliSense<a href="#type-safety-and-intellisense" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework maintains full TypeScript type safety across the entire service layer through carefully designed type exports and declarations.</p>
<a id="service-type-exports" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Type Exports<a href="#service-type-exports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>types.d.ts</code> file declares all service interfaces and their relationships, enabling IDE IntelliSense and compile-time type checking:</p>
<pre><code class="typescript"><span class="hl-5">// Context service types</span><br/><span class="hl-7">declare</span><span class="hl-1"> </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ExecutionContextService</span><span class="hl-1">: (</span><span class="hl-3">new</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">readonly</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">: </span><span class="hl-11">IExecutionContext</span><span class="hl-1">;</span><br/><span class="hl-1">}) &amp; </span><span class="hl-11">IScopedClassRun</span><span class="hl-1">&lt;[</span><span class="hl-10">context</span><span class="hl-1">: </span><span class="hl-11">IExecutionContext</span><span class="hl-1">]&gt;;</span><br/><br/><span class="hl-7">type</span><span class="hl-1"> </span><span class="hl-11">TExecutionContextService</span><span class="hl-1"> = </span><span class="hl-11">InstanceType</span><span class="hl-1">&lt;</span><span class="hl-7">typeof</span><span class="hl-1"> </span><span class="hl-4">ExecutionContextService</span><span class="hl-1">&gt;;</span>
</code><button type="button">Copy</button></pre>

<a id="type-flow-through-layers" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Type Flow Through Layers<a href="#type-flow-through-layers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/14_architecture-deep-dive_8.svg" alt="Mermaid Diagram"></p>
<p>Full type safety is maintained from user-facing API through internal service layer to client implementations, ensuring compile-time error detection and rich IDE support.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#architecture-deep-dive"><span>Architecture <wbr/>Deep <wbr/>Dive</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#the-dependency-injection-container"><span>The <wbr/>Dependency <wbr/>Injection <wbr/>Container</span></a></li><li><ul><li><a href="#types-symbol-registry"><span>TYPES <wbr/>Symbol <wbr/>Registry</span></a></li><li><a href="#service-provider-registration"><span>Service <wbr/>Provider <wbr/>Registration</span></a></li><li><a href="#service-injection-and-the-backtest-aggregator"><span>Service <wbr/>Injection and the <wbr/>Backtest <wbr/>Aggregator</span></a></li></ul></li><li><a href="#service-layer-organization"><span>Service <wbr/>Layer <wbr/>Organization</span></a></li><li><ul><li><a href="#service-category-overview"><span>Service <wbr/>Category <wbr/>Overview</span></a></li><li><a href="#service-dependency-layers"><span>Service <wbr/>Dependency <wbr/>Layers</span></a></li><li><a href="#service-category-implementation-details"><span>Service <wbr/>Category <wbr/>Implementation <wbr/>Details</span></a></li></ul></li><li><a href="#context-propagation-architecture"><span>Context <wbr/>Propagation <wbr/>Architecture</span></a></li><li><ul><li><a href="#context-services"><span>Context <wbr/>Services</span></a></li><li><a href="#context-propagation-flow"><span>Context <wbr/>Propagation <wbr/>Flow</span></a></li><li><a href="#context-access-pattern"><span>Context <wbr/>Access <wbr/>Pattern</span></a></li></ul></li><li><a href="#memoization-strategy"><span>Memoization <wbr/>Strategy</span></a></li><li><ul><li><a href="#connection-service-memoization-pattern"><span>Connection <wbr/>Service <wbr/>Memoization <wbr/>Pattern</span></a></li><li><a href="#memoization-benefits"><span>Memoization <wbr/>Benefits</span></a></li><li><a href="#memoization-cache-keys"><span>Memoization <wbr/>Cache <wbr/>Keys</span></a></li><li><a href="#implementation-details"><span>Implementation <wbr/>Details</span></a></li></ul></li><li><a href="#service-dependency-graph"><span>Service <wbr/>Dependency <wbr/>Graph</span></a></li><li><ul><li><a href="#key-service-dependencies"><span>Key <wbr/>Service <wbr/>Dependencies</span></a></li><li><a href="#cross-service-communication-patterns"><span>Cross-<wbr/>Service <wbr/>Communication <wbr/>Patterns</span></a></li><li><a href="#acyclic-dependency-enforcement"><span>Acyclic <wbr/>Dependency <wbr/>Enforcement</span></a></li></ul></li><li><a href="#initialization-flow"><span>Initialization <wbr/>Flow</span></a></li><li><ul><li><a href="#initialization-sequence"><span>Initialization <wbr/>Sequence</span></a></li><li><a href="#lazy-dependency-resolution"><span>Lazy <wbr/>Dependency <wbr/>Resolution</span></a></li><li><a href="#service-access-patterns"><span>Service <wbr/>Access <wbr/>Patterns</span></a></li></ul></li><li><a href="#type-safety-and-intellisense"><span>Type <wbr/>Safety and <wbr/>Intelli<wbr/>Sense</span></a></li><li><ul><li><a href="#service-type-exports"><span>Service <wbr/>Type <wbr/>Exports</span></a></li><li><a href="#type-flow-through-layers"><span>Type <wbr/>Flow <wbr/>Through <wbr/>Layers</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
