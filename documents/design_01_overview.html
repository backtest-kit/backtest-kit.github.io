<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/01_overview | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_01_overview.html">design/01_overview</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="overview" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This document provides a high-level introduction to Backtest Kit, a production-ready TypeScript framework for building and testing trading strategies. It covers the framework's purpose, key architectural principles, and system organization. For practical usage examples, see <a href="design_04_getting-started.html">Getting Started</a>. For detailed architectural patterns, see <a href="design_14_architecture-deep-dive.html">Architecture Deep Dive</a>.</p>
<a id="what-is-backtest-kit" class="tsd-anchor"></a><h2 class="tsd-anchor-link">What is Backtest Kit?<a href="#what-is-backtest-kit" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Kit is a TypeScript framework for backtesting and live trading strategies on crypto markets and forex. It enables developers to write trading strategies once and run them identically in historical simulation (backtest) and real-time trading (live) environments without code changes.</p>
<p>The framework treats market data as an <strong>async stream of time</strong>, processing each timestamp sequentially to architecturally prevent look-ahead bias. Strategies receive temporal context automatically through Node.js <code>AsyncLocalStorage</code>, ensuring they can only access historical data up to the current execution timestamp.</p>
<p><strong>Key Characteristics:</strong></p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Language</strong></td>
<td>TypeScript 5.0+</td>
</tr>
<tr>
<td><strong>Runtime</strong></td>
<td>Node.js with async generators</td>
</tr>
<tr>
<td><strong>Architecture</strong></td>
<td>Clean architecture with dependency injection</td>
</tr>
<tr>
<td><strong>State Management</strong></td>
<td>Crash-safe atomic persistence</td>
</tr>
<tr>
<td><strong>Execution Model</strong></td>
<td>Event-driven with streaming results</td>
</tr>
<tr>
<td><strong>Data Access</strong></td>
<td>Context-aware temporal queries</td>
</tr>
</tbody>
</table>
<a id="core-problems-solved" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Problems Solved<a href="#core-problems-solved" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="1-look-ahead-bias-prevention" class="tsd-anchor"></a><h3 class="tsd-anchor-link">1. Look-Ahead Bias Prevention<a href="#1-look-ahead-bias-prevention" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Traditional backtesting frameworks allow strategies to accidentally access future data, invalidating test results. Backtest Kit makes look-ahead bias <strong>architecturally impossible</strong> by using <code>ExecutionContextService</code> to propagate temporal context through all data access operations.</p>
<p>When <code>getCandles()</code> is called, it automatically retrieves only data up to the current backtest timestamp using <code>async_hooks</code> context propagation. The same code runs identically in live mode, where &quot;current time&quot; is <code>new Date()</code>.</p>
<a id="2-crash-safe-live-trading" class="tsd-anchor"></a><h3 class="tsd-anchor-link">2. Crash-Safe Live Trading<a href="#2-crash-safe-live-trading" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Live trading systems must recover state after crashes without data loss or duplicate trades. Backtest Kit implements atomic persistence through <code>PersistSignalAdapter</code>, which writes signal state to disk synchronously only for opened positions. If the process crashes, <code>waitForInit()</code> restores the active signal on restart.</p>
<a id="3-production-code-validation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">3. Production-Code Validation<a href="#3-production-code-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Strategies require rigorous validation before risking capital. Backtest Kit enforces multi-stage validation through <code>GLOBAL_CONFIG</code> parameters that check take-profit/stop-loss logic, price sanity, risk/reward ratios, and portfolio limits. Invalid signals are rejected before execution.</p>
<a id="4-mode-agnostic-strategy-development" class="tsd-anchor"></a><h3 class="tsd-anchor-link">4. Mode-Agnostic Strategy Development<a href="#4-mode-agnostic-strategy-development" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Developers should write strategy logic once, not maintain separate codebases for backtest and live environments. Backtest Kit achieves this through:</p>
<ul>
<li>Shared <code>ClientStrategy</code> implementation for both modes</li>
<li>Context-aware <code>getCandles()</code> that works in any execution mode</li>
<li>Identical signal validation and lifecycle management</li>
<li>Same event system for monitoring</li>
</ul>
<a id="key-architectural-principles" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Key Architectural Principles<a href="#key-architectural-principles" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="time-execution-engine" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Time Execution Engine<a href="#time-execution-engine" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Backtest Kit is fundamentally a <strong>time execution engine</strong>, not a data processing library. The framework processes market data as an <strong>async stream of time</strong>, advancing through historical or real-time timestamps sequentially.</p>
<p><img src="../media/01_overview_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Temporal Context Propagation:</strong></p>
<p>The framework uses <code>di-scoped</code> library to propagate two context objects through the execution stack:</p>
<table>
<thead>
<tr>
<th>Context Service</th>
<th>Properties</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ExecutionContextService</code></td>
<td><code>symbol</code>, <code>when</code>, <code>backtest</code></td>
<td>Temporal boundaries for data access</td>
</tr>
<tr>
<td><code>MethodContextService</code></td>
<td><code>strategyName</code>, <code>exchangeName</code>, <code>frameName</code></td>
<td>Schema identifiers for configuration</td>
</tr>
</tbody>
</table>
<p>When <code>BacktestLogicPrivateService</code> or <code>LiveLogicPrivateService</code> executes, they wrap each tick in context:</p>
<pre><code class="typescript"><span class="hl-4">ExecutionContextService</span><span class="hl-1">.</span><span class="hl-0">runInContext</span><span class="hl-1">(() </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">MethodContextService</span><span class="hl-1">.</span><span class="hl-0">runInContext</span><span class="hl-1">(() </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Strategy code executes here with ambient context</span><br/><span class="hl-1">    </span><span class="hl-4">strategyCoreService</span><span class="hl-1">.</span><span class="hl-0">tick</span><span class="hl-1">();</span><br/><span class="hl-1">  }, { </span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-4">frameName</span><span class="hl-1"> });</span><br/><span class="hl-1">}, { </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">, </span><span class="hl-4">backtest:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<a id="crash-safe-persistence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Crash-Safe Persistence<a href="#crash-safe-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Live trading requires atomic state persistence to recover from crashes without data corruption or duplicate trades. Backtest Kit implements this through several layers:</p>
<p><img src="../media/01_overview_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Persistence Strategy:</strong></p>
<table>
<thead>
<tr>
<th>State</th>
<th>Action</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Scheduled</strong></td>
<td>Not persisted</td>
<td>Ephemeral, can be regenerated</td>
</tr>
<tr>
<td><strong>Opened</strong></td>
<td>Written atomically</td>
<td>Must survive crashes</td>
</tr>
<tr>
<td><strong>Active</strong></td>
<td>Updated on changes</td>
<td>Track TP/SL modifications</td>
</tr>
<tr>
<td><strong>Closed</strong></td>
<td>Deleted immediately</td>
<td>No longer needed</td>
</tr>
</tbody>
</table>
<p>The <code>PersistBase</code> abstract class can be extended for custom storage backends (Redis, MongoDB) by implementing <code>readSignalData()</code>, <code>writeSignalData()</code>, and <code>deleteSignalData()</code> methods.</p>
<a id="signal-lifecycle-state-machine" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signal Lifecycle State Machine<a href="#signal-lifecycle-state-machine" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All trading signals follow a deterministic state machine with discriminated union types for type safety:</p>
<p><img src="../media/01_overview_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Type-Safe State Representation:</strong></p>
<p>The <code>IStrategyTickResult</code> discriminated union ensures compile-time correctness:</p>
<pre><code class="typescript"><span class="hl-7">type</span><span class="hl-1"> </span><span class="hl-13">IStrategyTickResult</span><span class="hl-1"> = </span><br/><span class="hl-1">  | { </span><span class="hl-4">action</span><span class="hl-1">: </span><span class="hl-2">&quot;idle&quot;</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> }</span><br/><span class="hl-1">  | { </span><span class="hl-4">action</span><span class="hl-1">: </span><span class="hl-2">&quot;scheduled&quot;</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">: </span><span class="hl-13">IScheduledSignalRow</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> }</span><br/><span class="hl-1">  | { </span><span class="hl-4">action</span><span class="hl-1">: </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">: </span><span class="hl-13">ISignalRow</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> }</span><br/><span class="hl-1">  | { </span><span class="hl-4">action</span><span class="hl-1">: </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">: </span><span class="hl-13">ISignalRow</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> }</span><br/><span class="hl-1">  | { </span><span class="hl-4">action</span><span class="hl-1">: </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">: </span><span class="hl-13">ISignalRow</span><span class="hl-1">, </span><span class="hl-4">closeReason</span><span class="hl-1">: </span><span class="hl-13">CloseReason</span><span class="hl-1">, ... }</span><br/><span class="hl-1">  | { </span><span class="hl-4">action</span><span class="hl-1">: </span><span class="hl-2">&quot;cancelled&quot;</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">: </span><span class="hl-13">IScheduledSignalRow</span><span class="hl-1">, ... };</span>
</code><button type="button">Copy</button></pre>

<p>This eliminates optional field bugs and enables exhaustive pattern matching in TypeScript.</p>
<a id="event-driven-architecture" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event-Driven Architecture<a href="#event-driven-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All execution modes emit events through RxJS <code>Subject</code> instances, enabling real-time monitoring, logging, and report generation without blocking strategy execution:</p>
<p><img src="../media/01_overview_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Event Processing Guarantees:</strong></p>
<p>All event listeners use <code>functools-kit</code> <code>queued</code> wrapper to ensure sequential processing even when callback functions contain async operations. This prevents race conditions during high-frequency event emission.</p>
<a id="system-architecture-layers" class="tsd-anchor"></a><h2 class="tsd-anchor-link">System Architecture Layers<a href="#system-architecture-layers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Kit follows clean architecture principles with clear separation between business logic, orchestration, and infrastructure concerns:</p>
<p><img src="../media/01_overview_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Layer Responsibilities:</strong></p>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Components</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Public API</strong></td>
<td><code>addStrategy()</code>, <code>Backtest</code>, <code>Live</code>, <code>Walker</code> classes</td>
<td>User-facing interface, parameter validation</td>
</tr>
<tr>
<td><strong>Command Services</strong></td>
<td><code>BacktestCommandService</code>, <code>LiveCommandService</code>, <code>WalkerCommandService</code></td>
<td>DI wrappers, validation orchestration</td>
</tr>
<tr>
<td><strong>Logic Services</strong></td>
<td><code>BacktestLogicPrivateService</code>, <code>LiveLogicPrivateService</code></td>
<td>Async generator orchestration, timeframe iteration</td>
</tr>
<tr>
<td><strong>Core Services</strong></td>
<td><code>StrategyCoreService</code>, <code>ExchangeCoreService</code>, <code>FrameCoreService</code></td>
<td>Business logic coordination, context management</td>
</tr>
<tr>
<td><strong>Connection Services</strong></td>
<td><code>StrategyConnectionService</code>, <code>ExchangeConnectionService</code></td>
<td>Memoized client factories, routing operations</td>
</tr>
<tr>
<td><strong>Client Layer</strong></td>
<td><code>ClientStrategy</code>, <code>ClientExchange</code>, <code>ClientFrame</code></td>
<td>Pure business logic, prototype methods for memory efficiency</td>
</tr>
<tr>
<td><strong>Schema Services</strong></td>
<td><code>StrategySchemaService</code>, <code>ExchangeSchemaService</code></td>
<td>Configuration storage using ToolRegistry pattern</td>
</tr>
<tr>
<td><strong>Persistence</strong></td>
<td><code>PersistSignalAdapter</code>, <code>PersistBase</code></td>
<td>Crash-safe atomic file writes, pluggable storage backends</td>
</tr>
</tbody>
</table>
<a id="dependency-injection-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Dependency Injection Architecture<a href="#dependency-injection-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Kit uses a custom dependency injection system built on <code>di-kit</code> with Symbol-based tokens. All services are instantiated through a central container and accessed via the <code>backtest</code> object:</p>
<p><img src="../media/01_overview_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Service Categories:</strong></p>
<p>The framework organizes services into 11 categories:</p>
<ol>
<li><strong>Base Services</strong>: <code>LoggerService</code> for centralized logging</li>
<li><strong>Context Services</strong>: <code>ExecutionContextService</code>, <code>MethodContextService</code> for ambient context</li>
<li><strong>Schema Services</strong>: Registry pattern for immutable configuration storage</li>
<li><strong>Validation Services</strong>: Memoized existence checks for schema names</li>
<li><strong>Connection Services</strong>: Memoized factory pattern for client instances</li>
<li><strong>Core Services</strong>: Business logic orchestration</li>
<li><strong>Global Services</strong>: Shared state management</li>
<li><strong>Logic Services</strong>: Async generator implementation (Public/Private split)</li>
<li><strong>Command Services</strong>: Top-level public API wrappers</li>
<li><strong>Markdown Services</strong>: Event-driven report generation</li>
<li><strong>Template Services</strong>: Code generation for LLM integration</li>
</ol>
<a id="execution-modes-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Execution Modes Overview<a href="#execution-modes-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Kit provides three execution modes that share the same core strategy logic but differ in orchestration:</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>File</th>
<th>Purpose</th>
<th>Duration</th>
<th>State Persistence</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Backtest</strong></td>
<td><code>BacktestLogicPrivateService</code></td>
<td>Historical simulation</td>
<td>Finite (startDate → endDate)</td>
<td>None (in-memory only)</td>
</tr>
<tr>
<td><strong>Live</strong></td>
<td><code>LiveLogicPrivateService</code></td>
<td>Real-time trading</td>
<td>Infinite (until stopped)</td>
<td>Atomic file writes for crash recovery</td>
</tr>
<tr>
<td><strong>Walker</strong></td>
<td><code>WalkerLogicPrivateService</code></td>
<td>Strategy comparison</td>
<td>Finite (sequential backtests)</td>
<td>None (collects results in-memory)</td>
</tr>
</tbody>
</table>
<p><strong>Execution Flow Comparison:</strong></p>
<p><img src="../media/01_overview_6.svg" alt="Mermaid Diagram"></p>
<p>All three modes call the same <code>StrategyCoreService.tick()</code> method, ensuring identical signal generation and validation logic across environments.</p>
<a id="technology-stack" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Technology Stack<a href="#technology-stack" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Kit relies on a minimal set of production dependencies to maintain stability and reduce external risks:</p>
<table>
<thead>
<tr>
<th>Dependency</th>
<th>Version</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>di-kit</strong></td>
<td>^1.0.18</td>
<td>Dependency injection container with Symbol tokens</td>
</tr>
<tr>
<td><strong>di-scoped</strong></td>
<td>^1.0.20</td>
<td>Async context propagation using AsyncLocalStorage</td>
</tr>
<tr>
<td><strong>functools-kit</strong></td>
<td>^1.0.94</td>
<td>Functional utilities (memoization, queued processing, singleshot)</td>
</tr>
<tr>
<td><strong>get-moment-stamp</strong></td>
<td>^1.1.1</td>
<td>Timestamp formatting utilities</td>
</tr>
</tbody>
</table>
<p><strong>Peer Dependencies:</strong></p>
<p>The framework requires TypeScript 5.0+ as a peer dependency. Users must also install:</p>
<ul>
<li><strong>ccxt</strong> (or custom exchange adapter) for market data</li>
<li><strong>ollama</strong> (optional) for LLM-powered strategy generation</li>
<li><strong>uuid</strong> for signal ID generation</li>
</ul>
<p><strong>Zero Vendor Lock-In:</strong></p>
<p>Unlike cloud-based platforms (QuantConnect, etc.), Backtest Kit is fully self-hosted with no external API dependencies. All execution, data processing, and persistence occur in your environment.</p>
<a id="data-flow-summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Data Flow Summary<a href="#data-flow-summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework follows a consistent data flow pattern regardless of execution mode:</p>
<ol>
<li><strong>Configuration Phase</strong>: User calls <code>addExchange()</code>, <code>addStrategy()</code>, <code>addFrame()</code>, <code>addRisk()</code> to register schemas</li>
<li><strong>Validation Phase</strong>: <code>ValidationServices</code> check schema name existence and perform shallow validation</li>
<li><strong>Execution Initiation</strong>: User calls <code>Backtest.run()</code>, <code>Live.run()</code>, or <code>Walker.run()</code> with symbol and context</li>
<li><strong>Context Setup</strong>: <code>ExecutionContextService</code> and <code>MethodContextService</code> wrap the execution</li>
<li><strong>Client Instantiation</strong>: <code>ConnectionServices</code> create memoized <code>ClientStrategy</code>, <code>ClientExchange</code>, <code>ClientRisk</code> instances</li>
<li><strong>Signal Generation</strong>: <code>ClientStrategy.tick()</code> calls user-defined <code>getSignal()</code> function</li>
<li><strong>Validation Pipeline</strong>: Multi-stage validation checks TP/SL logic, prices, risk limits</li>
<li><strong>Signal Processing</strong>: State machine transitions (idle → scheduled → opened → active → closed)</li>
<li><strong>Event Emission</strong>: Emit to <code>signalEmitter</code>, <code>signalBacktestEmitter</code>, <code>signalLiveEmitter</code></li>
<li><strong>Report Generation</strong>: <code>MarkdownServices</code> accumulate events and calculate statistics</li>
</ol>
<a id="key-interfaces-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Key Interfaces Overview<a href="#key-interfaces-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework exposes several critical interfaces for user interaction:</p>
<table>
<thead>
<tr>
<th>Interface</th>
<th>Purpose</th>
<th>Example Properties</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IStrategySchema</code></td>
<td>Strategy definition</td>
<td><code>strategyName</code>, <code>interval</code>, <code>getSignal</code>, <code>callbacks</code>, <code>riskName</code></td>
</tr>
<tr>
<td><code>IExchangeSchema</code></td>
<td>Exchange adapter</td>
<td><code>exchangeName</code>, <code>getCandles</code>, <code>formatPrice</code>, <code>formatQuantity</code></td>
</tr>
<tr>
<td><code>IFrameSchema</code></td>
<td>Timeframe specification</td>
<td><code>frameName</code>, <code>interval</code>, <code>startDate</code>, <code>endDate</code></td>
</tr>
<tr>
<td><code>IRiskSchema</code></td>
<td>Risk validation rules</td>
<td><code>riskName</code>, <code>validations[]</code></td>
</tr>
<tr>
<td><code>ISignalDto</code></td>
<td>Signal specification</td>
<td><code>position</code>, <code>priceOpen</code>, <code>priceTakeProfit</code>, <code>priceStopLoss</code></td>
</tr>
<tr>
<td><code>IStrategyTickResult</code></td>
<td>Tick result union</td>
<td><code>action: &quot;idle&quot; | &quot;opened&quot; | &quot;active&quot; | &quot;closed&quot; | ...</code></td>
</tr>
</tbody>
</table>
<p>The discriminated union pattern for <code>IStrategyTickResult</code> ensures type-safe pattern matching:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">strategy</span><span class="hl-1">.</span><span class="hl-0">tick</span><span class="hl-1">();</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">// TypeScript knows result.signal, result.closeReason exist</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#overview"><span>Overview</span></a><ul><li><a href="#what-is-backtest-kit"><span>What is <wbr/>Backtest <wbr/>Kit?</span></a></li><li><a href="#core-problems-solved"><span>Core <wbr/>Problems <wbr/>Solved</span></a></li><li><ul><li><a href="#1-look-ahead-bias-prevention"><span>1. <wbr/>Look-<wbr/>Ahead <wbr/>Bias <wbr/>Prevention</span></a></li><li><a href="#2-crash-safe-live-trading"><span>2. <wbr/>Crash-<wbr/>Safe <wbr/>Live <wbr/>Trading</span></a></li><li><a href="#3-production-code-validation"><span>3. <wbr/>Production-<wbr/>Code <wbr/>Validation</span></a></li><li><a href="#4-mode-agnostic-strategy-development"><span>4. <wbr/>Mode-<wbr/>Agnostic <wbr/>Strategy <wbr/>Development</span></a></li></ul></li><li><a href="#key-architectural-principles"><span>Key <wbr/>Architectural <wbr/>Principles</span></a></li><li><ul><li><a href="#time-execution-engine"><span>Time <wbr/>Execution <wbr/>Engine</span></a></li><li><a href="#crash-safe-persistence"><span>Crash-<wbr/>Safe <wbr/>Persistence</span></a></li><li><a href="#signal-lifecycle-state-machine"><span>Signal <wbr/>Lifecycle <wbr/>State <wbr/>Machine</span></a></li><li><a href="#event-driven-architecture"><span>Event-<wbr/>Driven <wbr/>Architecture</span></a></li></ul></li><li><a href="#system-architecture-layers"><span>System <wbr/>Architecture <wbr/>Layers</span></a></li><li><a href="#dependency-injection-architecture"><span>Dependency <wbr/>Injection <wbr/>Architecture</span></a></li><li><a href="#execution-modes-overview"><span>Execution <wbr/>Modes <wbr/>Overview</span></a></li><li><a href="#technology-stack"><span>Technology <wbr/>Stack</span></a></li><li><a href="#data-flow-summary"><span>Data <wbr/>Flow <wbr/>Summary</span></a></li><li><a href="#key-interfaces-overview"><span>Key <wbr/>Interfaces <wbr/>Overview</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
