<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>example/07_llm_trading | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="example_07_llm_trading.html">example/07_llm_trading</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="llm-trading-with-structured-json-output" class="tsd-anchor"></a><h1 class="tsd-anchor-link">LLM Trading with Structured JSON Output<a href="#llm-trading-with-structured-json-output" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This advanced guide explains how to use large language models (LLM) directly in trading strategies to generate signals in real-time. You will learn how to set up Ollama for structured JSON output and integrate AI analysis into the trading decision-making process.</p>
<a id="what-is-llm-trading" class="tsd-anchor"></a><h2 class="tsd-anchor-link">What is LLM Trading?<a href="#what-is-llm-trading" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>LLM trading is an approach where a large language model analyzes market data and generates trading signals in real-time. Unlike traditional strategies with fixed rules, LLMs can adapt their analysis to changing market conditions.</p>
<a id="benefits-of-llm-trading" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Benefits of LLM Trading<a href="#benefits-of-llm-trading" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Adaptability</strong> - the model can account for market context and nuances</li>
<li><strong>Multi-factor Analysis</strong> - simultaneous analysis of dozens of indicators</li>
<li><strong>Continuous Learning</strong> - ability to fine-tune on new data</li>
<li><strong>Explainability</strong> - the model can explain the reasons for its decisions</li>
<li><strong>Fast Adaptation</strong> - easily change strategy through prompts</li>
</ul>
<hr>
<a id="llm-trading-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">LLM Trading Architecture<a href="#llm-trading-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/07-llm-trading_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="setting-up-ollama-for-structured-output" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Setting Up Ollama for Structured Output<a href="#setting-up-ollama-for-structured-output" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="step-1-installation-and-setup" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Step 1: Installation and Setup<a href="#step-1-installation-and-setup" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="bash"><span class="hl-0"># Install Ollama (if not already installed)</span><br/><span class="hl-0"># Windows</span><br/><span class="hl-1">winget</span><span class="hl-2"> </span><span class="hl-4">install</span><span class="hl-2"> </span><span class="hl-4">Ollama.Ollama</span><br/><br/><span class="hl-0"># macOS</span><br/><span class="hl-1">brew</span><span class="hl-2"> </span><span class="hl-4">install</span><span class="hl-2"> </span><span class="hl-4">ollama</span><br/><br/><span class="hl-0"># Linux</span><br/><span class="hl-1">curl</span><span class="hl-2"> </span><span class="hl-3">-fsSL</span><span class="hl-2"> </span><span class="hl-4">https://ollama.ai/install.sh</span><span class="hl-2"> | </span><span class="hl-1">sh</span>
</code><button type="button">Copy</button></pre>

<pre><code class="bash"><span class="hl-0"># Start the server</span><br/><span class="hl-1">ollama</span><span class="hl-2"> </span><span class="hl-4">serve</span><br/><br/><span class="hl-0"># Install deepseek-v3.1 model (recommended for trading)</span><br/><span class="hl-1">ollama</span><span class="hl-2"> </span><span class="hl-4">pull</span><span class="hl-2"> </span><span class="hl-4">deepseek-v3.1</span>
</code><button type="button">Copy</button></pre>

<a id="step-2-environment-variables-setup" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Step 2: Environment Variables Setup<a href="#step-2-environment-variables-setup" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="bash"><span class="hl-0"># .env file</span><br/><span class="hl-6">OLLAMA_HOST</span><span class="hl-2">=</span><span class="hl-4">http://localhost:11434</span><br/><span class="hl-6">OLLAMA_MODEL</span><span class="hl-2">=</span><span class="hl-4">deepseek-v3.1</span><br/><br/><span class="hl-0"># For cloud Ollama</span><br/><span class="hl-6">OLLAMA_API_KEY</span><span class="hl-2">=</span><span class="hl-4">your_api_key_here</span><br/><span class="hl-6">OLLAMA_HOST</span><span class="hl-2">=</span><span class="hl-4">https://ollama.com</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="function-for-structured-json-output" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Function for Structured JSON Output<a href="#function-for-structured-json-output" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="basic-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Implementation<a href="#basic-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">Ollama</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;ollama&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">json</span><span class="hl-2">(</span><span class="hl-6">messages</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">ollama</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Ollama</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">host:</span><span class="hl-2"> </span><span class="hl-6">process</span><span class="hl-2">.</span><span class="hl-6">env</span><span class="hl-2">.</span><span class="hl-8">OLLAMA_HOST</span><span class="hl-2"> || </span><span class="hl-4">&quot;http://localhost:11434&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  });</span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">response</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">ollama</span><span class="hl-2">.</span><span class="hl-1">chat</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">model:</span><span class="hl-2"> </span><span class="hl-6">process</span><span class="hl-2">.</span><span class="hl-6">env</span><span class="hl-2">.</span><span class="hl-8">OLLAMA_MODEL</span><span class="hl-2"> || </span><span class="hl-4">&quot;deepseek-v3.1&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">messages:</span><span class="hl-2"> [</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;system&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-6">content:</span><span class="hl-2"> [</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;Analyze the trading strategy and return a trading signal.&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;POSITION OPENING RULES:&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;1. POSITION TYPES:&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - position=&#39;wait&#39;: no clear signal, wait for better conditions&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - position=&#39;long&#39;: bullish signal, price will rise&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - position=&#39;short&#39;: bearish signal, price will fall&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;2. ENTRY PRICE (priceOpen):&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - Can be current market price for immediate entry&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - Can be pending price for entry when level is reached&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - Specify optimal entry price according to technical analysis&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;3. EXIT LEVELS:&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - LONG: priceTakeProfit &gt; priceOpen &gt; priceStopLoss&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - SHORT: priceStopLoss &gt; priceOpen &gt; priceTakeProfit&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - Levels must have technical justification (Fibonacci, S/R, Bollinger)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;4. TIME FRAMES:&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - minuteEstimatedTime: forecast time to TP (max 360 minutes)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;   - Calculation based on ATR, ADX, MACD, Momentum, Slope&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        ].</span><span class="hl-1">join</span><span class="hl-2">(</span><span class="hl-4">&quot;</span><span class="hl-14">\n</span><span class="hl-4">&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      ...</span><span class="hl-6">messages</span><span class="hl-2">,</span><br/><span class="hl-2">    ],</span><br/><span class="hl-2">    </span><span class="hl-6">format:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;object&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">properties:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-6">position:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;string&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">enum:</span><span class="hl-2"> [</span><span class="hl-4">&quot;wait&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;long&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;short&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Trade decision: wait (no signal), long (buy), or short (sell)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">note:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;string&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Professional trading recommendation with price levels&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">priceOpen:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Entry price (current market price or limit order price)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Take profit target price&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Stop loss exit price&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">minuteEstimatedTime:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Expected time to reach TP in minutes (max 360)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-6">required:</span><span class="hl-2"> [</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;position&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;note&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;priceOpen&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;priceTakeProfit&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;priceStopLoss&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;minuteEstimatedTime&quot;</span><br/><span class="hl-2">      ],</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  });</span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">jsonResponse</span><span class="hl-2"> = </span><span class="hl-8">JSON</span><span class="hl-2">.</span><span class="hl-1">parse</span><span class="hl-2">(</span><span class="hl-6">response</span><span class="hl-2">.</span><span class="hl-6">message</span><span class="hl-2">.</span><span class="hl-6">content</span><span class="hl-2">.</span><span class="hl-1">trim</span><span class="hl-2">());</span><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">jsonResponse</span><span class="hl-2">;</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-5">export</span><span class="hl-2"> </span><span class="hl-5">default</span><span class="hl-2"> </span><span class="hl-6">json</span><span class="hl-2">;</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="multi-timeframe-analysis" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Multi-Timeframe Analysis<a href="#multi-timeframe-analysis" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="pattern-for-analyzing-different-timeframes" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern for Analyzing Different Timeframes<a href="#pattern-for-analyzing-different-timeframes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">getCandles</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">json</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;./utils/json.mjs&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">analyzeMultipleTimeframes</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">messages</span><span class="hl-2"> = [];</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// 1. Fetch data from different timeframes using context-aware getCandles</span><br/><span class="hl-2">  </span><span class="hl-0">// Automatically receives backtest or live data via async hooks</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles1h</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1h&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles15m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;15m&quot;</span><span class="hl-2">, </span><span class="hl-7">48</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles5m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">, </span><span class="hl-7">60</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles1m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1m&quot;</span><span class="hl-2">, </span><span class="hl-7">60</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// 2. 1-hour trend analysis</span><br/><span class="hl-2">  </span><span class="hl-6">messages</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">`Analyze 1-hour candles for </span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-14">\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">        </span><span class="hl-1">formatCandles</span><span class="hl-2">(</span><span class="hl-6">candles1h</span><span class="hl-2">) +</span><br/><span class="hl-2">        </span><span class="hl-4">`</span><span class="hl-14">\n\n</span><span class="hl-4">Determine the main trend (uptrend/downtrend/sideways).`</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;assistant&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">&quot;1h trend analyzed. Main trend and key support/resistance levels identified.&quot;</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  );</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// 3. 15-minute trend analysis</span><br/><span class="hl-2">  </span><span class="hl-6">messages</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">`Analyze 15-minute candles for </span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-14">\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">        </span><span class="hl-1">formatCandles</span><span class="hl-2">(</span><span class="hl-6">candles15m</span><span class="hl-2">) +</span><br/><span class="hl-2">        </span><span class="hl-4">`</span><span class="hl-14">\n\n</span><span class="hl-4">Determine short-term trend and indicator divergences.`</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;assistant&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">&quot;15m trend analyzed. Short-term patterns identified.&quot;</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  );</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// 4. 5-minute trend analysis</span><br/><span class="hl-2">  </span><span class="hl-6">messages</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">`Analyze 5-minute candles for </span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-14">\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">        </span><span class="hl-1">formatCandles</span><span class="hl-2">(</span><span class="hl-6">candles5m</span><span class="hl-2">) +</span><br/><span class="hl-2">        </span><span class="hl-4">`</span><span class="hl-14">\n\n</span><span class="hl-4">Determine entry points based on indicators.`</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;assistant&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">&quot;5m trend analyzed. Potential entry points identified.&quot;</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  );</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// 5. 1-minute microstructure analysis</span><br/><span class="hl-2">  </span><span class="hl-6">messages</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">`Analyze 1-minute candles for </span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-14">\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">        </span><span class="hl-1">formatCandles</span><span class="hl-2">(</span><span class="hl-6">candles1m</span><span class="hl-2">) +</span><br/><span class="hl-2">        </span><span class="hl-4">`</span><span class="hl-14">\n\n</span><span class="hl-4">Determine optimal entry price and exit levels.`</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;assistant&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">&quot;1m microstructure analyzed. Ready to generate signal.&quot;</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  );</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// 6. Final request for signal generation</span><br/><span class="hl-2">  </span><span class="hl-6">messages</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">content:</span><span class="hl-2"> [</span><br/><span class="hl-2">      </span><span class="hl-4">`Based on all analyzed timeframes, generate a trading signal for </span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">.`</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;Consider:&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;1. Main trend from 1h&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;2. Short-term patterns from 15m and 5m&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;3. Precise entry price from 1m&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;4. Technical support/resistance levels&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;5. Risk/reward ratio minimum 1:2&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    ].</span><span class="hl-1">join</span><span class="hl-2">(</span><span class="hl-4">&quot;</span><span class="hl-14">\n</span><span class="hl-4">&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">  });</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Generate structured JSON signal</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">signal</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">json</span><span class="hl-2">(</span><span class="hl-6">messages</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">;</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">formatCandles</span><span class="hl-2">(</span><span class="hl-6">candles</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">candles</span><span class="hl-2">.</span><span class="hl-1">map</span><span class="hl-2">((</span><span class="hl-6">candle</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">date</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Date</span><span class="hl-2">(</span><span class="hl-6">candle</span><span class="hl-2">.</span><span class="hl-6">timestamp</span><span class="hl-2">).</span><span class="hl-1">toISOString</span><span class="hl-2">();</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-6">date</span><span class="hl-3">}</span><span class="hl-4"> | O:</span><span class="hl-3">${</span><span class="hl-6">candle</span><span class="hl-9">.</span><span class="hl-6">open</span><span class="hl-3">}</span><span class="hl-4"> H:</span><span class="hl-3">${</span><span class="hl-6">candle</span><span class="hl-9">.</span><span class="hl-6">high</span><span class="hl-3">}</span><span class="hl-4"> L:</span><span class="hl-3">${</span><span class="hl-6">candle</span><span class="hl-9">.</span><span class="hl-6">low</span><span class="hl-3">}</span><span class="hl-4"> C:</span><span class="hl-3">${</span><span class="hl-6">candle</span><span class="hl-9">.</span><span class="hl-6">close</span><span class="hl-3">}</span><span class="hl-4"> V:</span><span class="hl-3">${</span><span class="hl-6">candle</span><span class="hl-9">.</span><span class="hl-6">volume</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">;</span><br/><span class="hl-2">  }).</span><span class="hl-1">join</span><span class="hl-2">(</span><span class="hl-4">&#39;</span><span class="hl-14">\n</span><span class="hl-4">&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="integration-with-backtest-kit" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Backtest-Kit<a href="#integration-with-backtest-kit" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="complete-strategy-with-llm" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Complete Strategy with LLM<a href="#complete-strategy-with-llm" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">addStrategy</span><span class="hl-2">, </span><span class="hl-6">Backtest</span><span class="hl-2">, </span><span class="hl-6">getCandles</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">json</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;./utils/json.mjs&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Register LLM strategy</span><br/><span class="hl-1">addStrategy</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;llm-trading-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-1">getSignal</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">messages</span><span class="hl-2"> = [];</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// 1. Load data from various timeframes using context-aware getCandles</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles1h</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1h&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles15m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;15m&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles5m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles1m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1m&quot;</span><span class="hl-2">, </span><span class="hl-7">30</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// 2. Calculate indicators</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">indicators</span><span class="hl-2"> = </span><span class="hl-1">calculateIndicators</span><span class="hl-2">(</span><span class="hl-6">candles5m</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// 3. Form context for LLM</span><br/><span class="hl-2">    </span><span class="hl-6">messages</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">`Analysis of </span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-14">\n\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">        </span><span class="hl-4">`## 1-hour trend:</span><span class="hl-14">\n</span><span class="hl-3">${</span><span class="hl-1">formatTrendAnalysis</span><span class="hl-9">(</span><span class="hl-6">candles1h</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-14">\n\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">        </span><span class="hl-4">`## 15-minute trend:</span><span class="hl-14">\n</span><span class="hl-3">${</span><span class="hl-1">formatTrendAnalysis</span><span class="hl-9">(</span><span class="hl-6">candles15m</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-14">\n\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">        </span><span class="hl-4">`## 5-minute data with indicators:</span><span class="hl-14">\n</span><span class="hl-3">${</span><span class="hl-1">formatIndicators</span><span class="hl-9">(</span><span class="hl-6">indicators</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-14">\n\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">        </span><span class="hl-4">`## 1-minute microstructure:</span><span class="hl-14">\n</span><span class="hl-3">${</span><span class="hl-1">formatMicrostructure</span><span class="hl-9">(</span><span class="hl-6">candles1m</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-14">\n\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">        </span><span class="hl-4">`Current price: </span><span class="hl-3">${</span><span class="hl-6">candles5m</span><span class="hl-9">[</span><span class="hl-6">candles5m</span><span class="hl-9">.</span><span class="hl-6">length</span><span class="hl-9"> </span><span class="hl-2">-</span><span class="hl-9"> </span><span class="hl-7">1</span><span class="hl-9">].</span><span class="hl-6">close</span><span class="hl-3">}</span><span class="hl-4">`</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// 4. Generate structured signal</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">signal</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">json</span><span class="hl-2">(</span><span class="hl-6">messages</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// 5. Validation and return</span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-4">&quot;wait&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;  </span><span class="hl-0">// No signal</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceOpen:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceTakeProfit</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceStopLoss</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">minuteEstimatedTime:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">minuteEstimatedTime</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">timestamp:</span><span class="hl-2"> </span><span class="hl-6">Date</span><span class="hl-2">.</span><span class="hl-1">now</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">note:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">note</span><span class="hl-2">,  </span><span class="hl-0">// Additional information from LLM</span><br/><span class="hl-2">    };</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Run backtest</span><br/><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;llm-trading-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-4">&quot;binance&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">frameName:</span><span class="hl-2"> </span><span class="hl-4">&quot;december-2025&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">})) {</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">result</span><span class="hl-2">.</span><span class="hl-6">action</span><span class="hl-2"> === </span><span class="hl-4">&quot;closed&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Signal closed: </span><span class="hl-3">${</span><span class="hl-6">result</span><span class="hl-9">.</span><span class="hl-6">closeReason</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`PNL: </span><span class="hl-3">${</span><span class="hl-6">result</span><span class="hl-9">.</span><span class="hl-6">pnl</span><span class="hl-9">.</span><span class="hl-6">pnlPercentage</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Note: </span><span class="hl-3">${</span><span class="hl-6">result</span><span class="hl-9">.</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">note</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="advanced-json-schema-for-trading-signals" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Advanced JSON Schema for Trading Signals<a href="#advanced-json-schema-for-trading-signals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="detailed-schema-with-additional-fields" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Detailed Schema with Additional Fields<a href="#detailed-schema-with-additional-fields" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">jsonAdvanced</span><span class="hl-2">(</span><span class="hl-6">messages</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">ollama</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Ollama</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">host:</span><span class="hl-2"> </span><span class="hl-6">process</span><span class="hl-2">.</span><span class="hl-6">env</span><span class="hl-2">.</span><span class="hl-8">OLLAMA_HOST</span><span class="hl-2"> || </span><span class="hl-4">&quot;http://localhost:11434&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  });</span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">response</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">ollama</span><span class="hl-2">.</span><span class="hl-1">chat</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">model:</span><span class="hl-2"> </span><span class="hl-6">process</span><span class="hl-2">.</span><span class="hl-6">env</span><span class="hl-2">.</span><span class="hl-8">OLLAMA_MODEL</span><span class="hl-2"> || </span><span class="hl-4">&quot;deepseek-v3.1&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">messages</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">format:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;object&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">properties:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-6">position:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;string&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">enum:</span><span class="hl-2"> [</span><span class="hl-4">&quot;wait&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;long&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;short&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Position direction&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">confidence:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">minimum:</span><span class="hl-2"> </span><span class="hl-7">0</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">maximum:</span><span class="hl-2"> </span><span class="hl-7">100</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Signal confidence (0-100%)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">priceOpen:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Entry price&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Take profit price&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Stop loss price&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">minuteEstimatedTime:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">minimum:</span><span class="hl-2"> </span><span class="hl-7">1</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">maximum:</span><span class="hl-2"> </span><span class="hl-7">360</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Expected time to TP in minutes&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">reasoning:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;string&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Decision rationale&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">technicalLevels:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;object&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">properties:</span><span class="hl-2"> {</span><br/><span class="hl-2">            </span><span class="hl-6">support:</span><span class="hl-2"> {</span><br/><span class="hl-2">              </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;array&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">              </span><span class="hl-6">items:</span><span class="hl-2"> { </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2"> },</span><br/><span class="hl-2">              </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Support levels&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">            },</span><br/><span class="hl-2">            </span><span class="hl-6">resistance:</span><span class="hl-2"> {</span><br/><span class="hl-2">              </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;array&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">              </span><span class="hl-6">items:</span><span class="hl-2"> { </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2"> },</span><br/><span class="hl-2">              </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Resistance levels&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">            },</span><br/><span class="hl-2">          },</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Technical levels&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">indicators:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;object&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">properties:</span><span class="hl-2"> {</span><br/><span class="hl-2">            </span><span class="hl-6">rsi:</span><span class="hl-2"> { </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">, </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;RSI value&quot;</span><span class="hl-2"> },</span><br/><span class="hl-2">            </span><span class="hl-6">macd:</span><span class="hl-2"> { </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;string&quot;</span><span class="hl-2">, </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;MACD state (bullish/bearish)&quot;</span><span class="hl-2"> },</span><br/><span class="hl-2">            </span><span class="hl-6">trend:</span><span class="hl-2"> { </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;string&quot;</span><span class="hl-2">, </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Main trend&quot;</span><span class="hl-2"> },</span><br/><span class="hl-2">            </span><span class="hl-6">volume:</span><span class="hl-2"> { </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;string&quot;</span><span class="hl-2">, </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Volume analysis&quot;</span><span class="hl-2"> },</span><br/><span class="hl-2">          },</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Indicator states&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">riskReward:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Risk/reward ratio&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        </span><span class="hl-6">marketContext:</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-6">type:</span><span class="hl-2"> </span><span class="hl-4">&quot;string&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">enum:</span><span class="hl-2"> [</span><span class="hl-4">&quot;trending&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;ranging&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;volatile&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;breakout&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">          </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-4">&quot;Market context&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-6">required:</span><span class="hl-2"> [</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;position&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;confidence&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;priceOpen&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;priceTakeProfit&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;priceStopLoss&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;minuteEstimatedTime&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;reasoning&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;riskReward&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;marketContext&quot;</span><br/><span class="hl-2">      ],</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  });</span><br/><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-8">JSON</span><span class="hl-2">.</span><span class="hl-1">parse</span><span class="hl-2">(</span><span class="hl-6">response</span><span class="hl-2">.</span><span class="hl-6">message</span><span class="hl-2">.</span><span class="hl-6">content</span><span class="hl-2">.</span><span class="hl-1">trim</span><span class="hl-2">());</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="indicator-processing-for-llm" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Indicator Processing for LLM<a href="#indicator-processing-for-llm" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="helper-functions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Helper Functions<a href="#helper-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">RSI</span><span class="hl-2">, </span><span class="hl-6">MACD</span><span class="hl-2">, </span><span class="hl-6">BollingerBands</span><span class="hl-2">, </span><span class="hl-6">ADX</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;technicalindicators&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">calculateIndicators</span><span class="hl-2">(</span><span class="hl-6">candles</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">closes</span><span class="hl-2"> = </span><span class="hl-6">candles</span><span class="hl-2">.</span><span class="hl-1">map</span><span class="hl-2">(</span><span class="hl-6">c</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">c</span><span class="hl-2">.</span><span class="hl-6">close</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">highs</span><span class="hl-2"> = </span><span class="hl-6">candles</span><span class="hl-2">.</span><span class="hl-1">map</span><span class="hl-2">(</span><span class="hl-6">c</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">c</span><span class="hl-2">.</span><span class="hl-6">high</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">lows</span><span class="hl-2"> = </span><span class="hl-6">candles</span><span class="hl-2">.</span><span class="hl-1">map</span><span class="hl-2">(</span><span class="hl-6">c</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">c</span><span class="hl-2">.</span><span class="hl-6">low</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">rsi:</span><span class="hl-2"> </span><span class="hl-8">RSI</span><span class="hl-2">.</span><span class="hl-1">calculate</span><span class="hl-2">({ </span><span class="hl-6">period:</span><span class="hl-2"> </span><span class="hl-7">14</span><span class="hl-2">, </span><span class="hl-6">values:</span><span class="hl-2"> </span><span class="hl-6">closes</span><span class="hl-2"> }),</span><br/><span class="hl-2">    </span><span class="hl-6">macd:</span><span class="hl-2"> </span><span class="hl-8">MACD</span><span class="hl-2">.</span><span class="hl-1">calculate</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">values:</span><span class="hl-2"> </span><span class="hl-6">closes</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">fastPeriod:</span><span class="hl-2"> </span><span class="hl-7">12</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">slowPeriod:</span><span class="hl-2"> </span><span class="hl-7">26</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">signalPeriod:</span><span class="hl-2"> </span><span class="hl-7">9</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">SimpleMAOscillator:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">SimpleMASignal:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">    </span><span class="hl-6">bb:</span><span class="hl-2"> </span><span class="hl-6">BollingerBands</span><span class="hl-2">.</span><span class="hl-1">calculate</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">period:</span><span class="hl-2"> </span><span class="hl-7">20</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">values:</span><span class="hl-2"> </span><span class="hl-6">closes</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">stdDev:</span><span class="hl-2"> </span><span class="hl-7">2</span><span class="hl-2">,</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">    </span><span class="hl-6">adx:</span><span class="hl-2"> </span><span class="hl-8">ADX</span><span class="hl-2">.</span><span class="hl-1">calculate</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">high:</span><span class="hl-2"> </span><span class="hl-6">highs</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">low:</span><span class="hl-2"> </span><span class="hl-6">lows</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">close:</span><span class="hl-2"> </span><span class="hl-6">closes</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">period:</span><span class="hl-2"> </span><span class="hl-7">14</span><span class="hl-2">,</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">  };</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">formatIndicators</span><span class="hl-2">(</span><span class="hl-6">indicators</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">latest</span><span class="hl-2"> = {</span><br/><span class="hl-2">    </span><span class="hl-6">rsi:</span><span class="hl-2"> </span><span class="hl-6">indicators</span><span class="hl-2">.</span><span class="hl-6">rsi</span><span class="hl-2">[</span><span class="hl-6">indicators</span><span class="hl-2">.</span><span class="hl-6">rsi</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">],</span><br/><span class="hl-2">    </span><span class="hl-6">macd:</span><span class="hl-2"> </span><span class="hl-6">indicators</span><span class="hl-2">.</span><span class="hl-6">macd</span><span class="hl-2">[</span><span class="hl-6">indicators</span><span class="hl-2">.</span><span class="hl-6">macd</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">],</span><br/><span class="hl-2">    </span><span class="hl-6">bb:</span><span class="hl-2"> </span><span class="hl-6">indicators</span><span class="hl-2">.</span><span class="hl-6">bb</span><span class="hl-2">[</span><span class="hl-6">indicators</span><span class="hl-2">.</span><span class="hl-6">bb</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">],</span><br/><span class="hl-2">    </span><span class="hl-6">adx:</span><span class="hl-2"> </span><span class="hl-6">indicators</span><span class="hl-2">.</span><span class="hl-6">adx</span><span class="hl-2">[</span><span class="hl-6">indicators</span><span class="hl-2">.</span><span class="hl-6">adx</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">],</span><br/><span class="hl-2">  };</span><br/><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> [</span><br/><span class="hl-2">    </span><span class="hl-4">`RSI(14): </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">rsi</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">) </span><span class="hl-2">||</span><span class="hl-9"> </span><span class="hl-4">&#39;N/A&#39;</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`MACD: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">macd</span><span class="hl-9">?.</span><span class="hl-8">MACD</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">4</span><span class="hl-9">) </span><span class="hl-2">||</span><span class="hl-9"> </span><span class="hl-4">&#39;N/A&#39;</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`MACD Signal: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">macd</span><span class="hl-9">?.</span><span class="hl-6">signal</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">4</span><span class="hl-9">) </span><span class="hl-2">||</span><span class="hl-9"> </span><span class="hl-4">&#39;N/A&#39;</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`MACD Histogram: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">macd</span><span class="hl-9">?.</span><span class="hl-6">histogram</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">4</span><span class="hl-9">) </span><span class="hl-2">||</span><span class="hl-9"> </span><span class="hl-4">&#39;N/A&#39;</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`BB Upper: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">bb</span><span class="hl-9">?.</span><span class="hl-6">upper</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">) </span><span class="hl-2">||</span><span class="hl-9"> </span><span class="hl-4">&#39;N/A&#39;</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`BB Middle: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">bb</span><span class="hl-9">?.</span><span class="hl-6">middle</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">) </span><span class="hl-2">||</span><span class="hl-9"> </span><span class="hl-4">&#39;N/A&#39;</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`BB Lower: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">bb</span><span class="hl-9">?.</span><span class="hl-6">lower</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">) </span><span class="hl-2">||</span><span class="hl-9"> </span><span class="hl-4">&#39;N/A&#39;</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`ADX: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">adx</span><span class="hl-9">?.</span><span class="hl-6">adx</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">) </span><span class="hl-2">||</span><span class="hl-9"> </span><span class="hl-4">&#39;N/A&#39;</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`+DI: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">adx</span><span class="hl-9">?.</span><span class="hl-6">pdi</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">) </span><span class="hl-2">||</span><span class="hl-9"> </span><span class="hl-4">&#39;N/A&#39;</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`-DI: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">adx</span><span class="hl-9">?.</span><span class="hl-6">mdi</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">) </span><span class="hl-2">||</span><span class="hl-9"> </span><span class="hl-4">&#39;N/A&#39;</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">  ].</span><span class="hl-1">join</span><span class="hl-2">(</span><span class="hl-4">&#39;</span><span class="hl-14">\n</span><span class="hl-4">&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">formatTrendAnalysis</span><span class="hl-2">(</span><span class="hl-6">candles</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">closes</span><span class="hl-2"> = </span><span class="hl-6">candles</span><span class="hl-2">.</span><span class="hl-1">map</span><span class="hl-2">(</span><span class="hl-6">c</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">c</span><span class="hl-2">.</span><span class="hl-6">close</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">trend</span><span class="hl-2"> = </span><span class="hl-6">closes</span><span class="hl-2">[</span><span class="hl-6">closes</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">] &gt; </span><span class="hl-6">closes</span><span class="hl-2">[</span><span class="hl-7">0</span><span class="hl-2">] ? </span><span class="hl-4">&quot;Uptrend&quot;</span><span class="hl-2"> : </span><span class="hl-4">&quot;Downtrend&quot;</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">changePercent</span><span class="hl-2"> = ((</span><span class="hl-6">closes</span><span class="hl-2">[</span><span class="hl-6">closes</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">] - </span><span class="hl-6">closes</span><span class="hl-2">[</span><span class="hl-7">0</span><span class="hl-2">]) / </span><span class="hl-6">closes</span><span class="hl-2">[</span><span class="hl-7">0</span><span class="hl-2">] * </span><span class="hl-7">100</span><span class="hl-2">).</span><span class="hl-1">toFixed</span><span class="hl-2">(</span><span class="hl-7">2</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> [</span><br/><span class="hl-2">    </span><span class="hl-4">`Trend: </span><span class="hl-3">${</span><span class="hl-6">trend</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`Change: </span><span class="hl-3">${</span><span class="hl-6">changePercent</span><span class="hl-3">}</span><span class="hl-4">%`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`High: </span><span class="hl-3">${</span><span class="hl-6">Math</span><span class="hl-9">.</span><span class="hl-1">max</span><span class="hl-9">(</span><span class="hl-2">...</span><span class="hl-6">candles</span><span class="hl-9">.</span><span class="hl-1">map</span><span class="hl-9">(</span><span class="hl-6">c</span><span class="hl-9"> </span><span class="hl-3">=&gt;</span><span class="hl-9"> </span><span class="hl-6">c</span><span class="hl-9">.</span><span class="hl-6">high</span><span class="hl-9">)).</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`Low: </span><span class="hl-3">${</span><span class="hl-6">Math</span><span class="hl-9">.</span><span class="hl-1">min</span><span class="hl-9">(</span><span class="hl-2">...</span><span class="hl-6">candles</span><span class="hl-9">.</span><span class="hl-1">map</span><span class="hl-9">(</span><span class="hl-6">c</span><span class="hl-9"> </span><span class="hl-3">=&gt;</span><span class="hl-9"> </span><span class="hl-6">c</span><span class="hl-9">.</span><span class="hl-6">low</span><span class="hl-9">)).</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">  ].</span><span class="hl-1">join</span><span class="hl-2">(</span><span class="hl-4">&#39;</span><span class="hl-14">\n</span><span class="hl-4">&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">formatMicrostructure</span><span class="hl-2">(</span><span class="hl-6">candles</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">latest</span><span class="hl-2"> = </span><span class="hl-6">candles</span><span class="hl-2">[</span><span class="hl-6">candles</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">];</span><br/><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> [</span><br/><span class="hl-2">    </span><span class="hl-4">`Last candle:`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`Open: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">open</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`High: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">high</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`Low: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">low</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`Close: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">close</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`Volume: </span><span class="hl-3">${</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">volume</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`Body: </span><span class="hl-3">${</span><span class="hl-6">Math</span><span class="hl-9">.</span><span class="hl-1">abs</span><span class="hl-9">(</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">close</span><span class="hl-9"> </span><span class="hl-2">-</span><span class="hl-9"> </span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">open</span><span class="hl-9">).</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`Wick Upper: </span><span class="hl-3">${</span><span class="hl-9">(</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">high</span><span class="hl-9"> </span><span class="hl-2">-</span><span class="hl-9"> </span><span class="hl-6">Math</span><span class="hl-9">.</span><span class="hl-1">max</span><span class="hl-9">(</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">open</span><span class="hl-9">, </span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">close</span><span class="hl-9">)).</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">`Wick Lower: </span><span class="hl-3">${</span><span class="hl-9">(</span><span class="hl-6">Math</span><span class="hl-9">.</span><span class="hl-1">min</span><span class="hl-9">(</span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">open</span><span class="hl-9">, </span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">close</span><span class="hl-9">) </span><span class="hl-2">-</span><span class="hl-9"> </span><span class="hl-6">latest</span><span class="hl-9">.</span><span class="hl-6">low</span><span class="hl-9">).</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">  ].</span><span class="hl-1">join</span><span class="hl-2">(</span><span class="hl-4">&#39;</span><span class="hl-14">\n</span><span class="hl-4">&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="text-analysis-with-ollama" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Text Analysis with Ollama<a href="#text-analysis-with-ollama" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="function-for-text-analysis" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Function for Text Analysis<a href="#function-for-text-analysis" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">Ollama</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;ollama&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">text</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">messages</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">ollama</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Ollama</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">host:</span><span class="hl-2"> </span><span class="hl-6">process</span><span class="hl-2">.</span><span class="hl-6">env</span><span class="hl-2">.</span><span class="hl-8">OLLAMA_HOST</span><span class="hl-2"> || </span><span class="hl-4">&quot;http://localhost:11434&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  });</span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">response</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">ollama</span><span class="hl-2">.</span><span class="hl-1">chat</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">model:</span><span class="hl-2"> </span><span class="hl-4">&quot;deepseek-v3.1&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">think:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,  </span><span class="hl-0">// Enable reasoning mode</span><br/><span class="hl-2">    </span><span class="hl-6">messages:</span><span class="hl-2"> [</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;system&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-6">content:</span><span class="hl-2"> [</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;You are a professional trader with 10+ years of experience.&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;Analyze the market based on technical and fundamental factors.&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;Give specific recommendations with entry and exit levels.&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;**IMPORTANT**: Write only analysis, no greetings!&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        ].</span><span class="hl-1">join</span><span class="hl-2">(</span><span class="hl-4">&quot;</span><span class="hl-14">\n</span><span class="hl-4">&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;system&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">&quot;Reasoning: high&quot;</span><span class="hl-2">,  </span><span class="hl-0">// High level of reasoning</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      ...</span><span class="hl-6">messages</span><span class="hl-2">,</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-6">content:</span><span class="hl-2"> [</span><br/><span class="hl-2">          </span><span class="hl-4">`What conditions should I buy/sell </span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4"> under?`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;Analyze:&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;1. Support/resistance levels&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;2. Entry points for LONG/SHORT positions&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;3. Recommended risk/reward ratio&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;4. Preferred direction (LONG or SHORT)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;Provide fundamental analysis with strategic recommendation.&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        ].</span><span class="hl-1">join</span><span class="hl-2">(</span><span class="hl-4">&quot;</span><span class="hl-14">\n</span><span class="hl-4">&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    ],</span><br/><span class="hl-2">  });</span><br/><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">response</span><span class="hl-2">.</span><span class="hl-6">message</span><span class="hl-2">.</span><span class="hl-6">content</span><span class="hl-2">.</span><span class="hl-1">trim</span><span class="hl-2">();</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Usage</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">analysis</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">text</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, [</span><br/><span class="hl-2">  {</span><br/><span class="hl-2">    </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">&quot;Current BTC price: $95,000. RSI: 65. MACD bullish.&quot;</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">]);</span><br/><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">analysis</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="logging-and-debugging-llm-signals" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Logging and Debugging LLM Signals<a href="#logging-and-debugging-llm-signals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="function-for-saving-history" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Function for Saving History<a href="#function-for-saving-history" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;fs/promises&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">dumpJson</span><span class="hl-2">(</span><span class="hl-6">signalId</span><span class="hl-2">, </span><span class="hl-6">messages</span><span class="hl-2">, </span><span class="hl-6">result</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">timestamp</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Date</span><span class="hl-2">().</span><span class="hl-1">toISOString</span><span class="hl-2">().</span><span class="hl-1">replace</span><span class="hl-2">(</span><span class="hl-15">/:/</span><span class="hl-3">g</span><span class="hl-2">, </span><span class="hl-4">&#39;-&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">filename</span><span class="hl-2"> = </span><span class="hl-4">`./logs/llm-signals/</span><span class="hl-3">${</span><span class="hl-6">signalId</span><span class="hl-3">}</span><span class="hl-4">_</span><span class="hl-3">${</span><span class="hl-6">timestamp</span><span class="hl-3">}</span><span class="hl-4">.json`</span><span class="hl-2">;</span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">logData</span><span class="hl-2"> = {</span><br/><span class="hl-2">    </span><span class="hl-6">signalId</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">timestamp</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">messages</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">result</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">metadata:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-6">model:</span><span class="hl-2"> </span><span class="hl-6">process</span><span class="hl-2">.</span><span class="hl-6">env</span><span class="hl-2">.</span><span class="hl-8">OLLAMA_MODEL</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">host:</span><span class="hl-2"> </span><span class="hl-6">process</span><span class="hl-2">.</span><span class="hl-6">env</span><span class="hl-2">.</span><span class="hl-8">OLLAMA_HOST</span><span class="hl-2">,</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  };</span><br/><br/><span class="hl-2">  </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2">.</span><span class="hl-1">mkdir</span><span class="hl-2">(</span><span class="hl-4">&quot;./logs/llm-signals&quot;</span><span class="hl-2">, { </span><span class="hl-6">recursive:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2"> });</span><br/><span class="hl-2">  </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2">.</span><span class="hl-1">writeFile</span><span class="hl-2">(</span><span class="hl-6">filename</span><span class="hl-2">, </span><span class="hl-8">JSON</span><span class="hl-2">.</span><span class="hl-1">stringify</span><span class="hl-2">(</span><span class="hl-6">logData</span><span class="hl-2">, </span><span class="hl-3">null</span><span class="hl-2">, </span><span class="hl-7">2</span><span class="hl-2">));</span><br/><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`LLM signal saved: </span><span class="hl-3">${</span><span class="hl-6">filename</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Usage in strategy</span><br/><span class="hl-1">addStrategy</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;llm-with-logging&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-1">getSignal</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">messages</span><span class="hl-2"> = </span><span class="hl-1">buildMessages</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">signal</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">json</span><span class="hl-2">(</span><span class="hl-6">messages</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// Save for debugging</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">dumpJson</span><span class="hl-2">(</span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">-</span><span class="hl-3">${</span><span class="hl-6">Date</span><span class="hl-9">.</span><span class="hl-1">now</span><span class="hl-9">()</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">, </span><span class="hl-6">messages</span><span class="hl-2">, </span><span class="hl-6">signal</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-4">&quot;wait&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">;</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="advanced-example-hybrid-strategy" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Advanced Example: Hybrid Strategy<a href="#advanced-example-hybrid-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="llm--traditional-indicators" class="tsd-anchor"></a><h3 class="tsd-anchor-link">LLM + Traditional Indicators<a href="#llm--traditional-indicators" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">addStrategy</span><span class="hl-2">, </span><span class="hl-6">getCandles</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">json</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;./utils/json.mjs&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">RSI</span><span class="hl-2">, </span><span class="hl-6">MACD</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;technicalindicators&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-1">addStrategy</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;hybrid-llm-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-1">getSignal</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// 1. Fetch data using context-aware getCandles</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles5m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">, </span><span class="hl-7">100</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">closes</span><span class="hl-2"> = </span><span class="hl-6">candles5m</span><span class="hl-2">.</span><span class="hl-1">map</span><span class="hl-2">(</span><span class="hl-6">c</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">c</span><span class="hl-2">.</span><span class="hl-6">close</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// 2. Calculate traditional indicators</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">rsi</span><span class="hl-2"> = </span><span class="hl-8">RSI</span><span class="hl-2">.</span><span class="hl-1">calculate</span><span class="hl-2">({ </span><span class="hl-6">period:</span><span class="hl-2"> </span><span class="hl-7">14</span><span class="hl-2">, </span><span class="hl-6">values:</span><span class="hl-2"> </span><span class="hl-6">closes</span><span class="hl-2"> });</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">macd</span><span class="hl-2"> = </span><span class="hl-8">MACD</span><span class="hl-2">.</span><span class="hl-1">calculate</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">values:</span><span class="hl-2"> </span><span class="hl-6">closes</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">fastPeriod:</span><span class="hl-2"> </span><span class="hl-7">12</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">slowPeriod:</span><span class="hl-2"> </span><span class="hl-7">26</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">signalPeriod:</span><span class="hl-2"> </span><span class="hl-7">9</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">SimpleMAOscillator:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">SimpleMASignal:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">currentRSI</span><span class="hl-2"> = </span><span class="hl-6">rsi</span><span class="hl-2">[</span><span class="hl-6">rsi</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">];</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">currentMACD</span><span class="hl-2"> = </span><span class="hl-6">macd</span><span class="hl-2">[</span><span class="hl-6">macd</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">];</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// 3. Quick condition filtering</span><br/><span class="hl-2">    </span><span class="hl-0">// If RSI in neutral zone and no clear trend - skip</span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">currentRSI</span><span class="hl-2"> &gt; </span><span class="hl-7">40</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">currentRSI</span><span class="hl-2"> &lt; </span><span class="hl-7">60</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">Math</span><span class="hl-2">.</span><span class="hl-1">abs</span><span class="hl-2">(</span><span class="hl-6">currentMACD</span><span class="hl-2">?.</span><span class="hl-8">MACD</span><span class="hl-2"> || </span><span class="hl-7">0</span><span class="hl-2">) &lt; </span><span class="hl-7">10</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;  </span><span class="hl-0">// Don&#39;t spend LLM tokens on unclear situations</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// 4. LLM analysis only for potential signals</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">messages</span><span class="hl-2"> = [</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">`Analysis of </span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-14">\n\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">          </span><span class="hl-4">`Current price: </span><span class="hl-3">${</span><span class="hl-6">closes</span><span class="hl-9">[</span><span class="hl-6">closes</span><span class="hl-9">.</span><span class="hl-6">length</span><span class="hl-9"> </span><span class="hl-2">-</span><span class="hl-9"> </span><span class="hl-7">1</span><span class="hl-9">]</span><span class="hl-3">}</span><span class="hl-14">\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">          </span><span class="hl-4">`RSI(14): </span><span class="hl-3">${</span><span class="hl-6">currentRSI</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-14">\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">          </span><span class="hl-4">`MACD: </span><span class="hl-3">${</span><span class="hl-6">currentMACD</span><span class="hl-9">?.</span><span class="hl-8">MACD</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">4</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-14">\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">          </span><span class="hl-4">`MACD Signal: </span><span class="hl-3">${</span><span class="hl-6">currentMACD</span><span class="hl-9">?.</span><span class="hl-6">signal</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">4</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-14">\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">          </span><span class="hl-4">`MACD Histogram: </span><span class="hl-3">${</span><span class="hl-6">currentMACD</span><span class="hl-9">?.</span><span class="hl-6">histogram</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">4</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-14">\n\n</span><span class="hl-4">`</span><span class="hl-2"> +</span><br/><span class="hl-2">          </span><span class="hl-4">`Last 20 candles:</span><span class="hl-14">\n</span><span class="hl-3">${</span><span class="hl-1">formatCandles</span><span class="hl-9">(</span><span class="hl-6">candles5m</span><span class="hl-9">.</span><span class="hl-1">slice</span><span class="hl-9">(</span><span class="hl-2">-</span><span class="hl-7">20</span><span class="hl-9">))</span><span class="hl-3">}</span><span class="hl-4">`</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    ];</span><br/><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">signal</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">json</span><span class="hl-2">(</span><span class="hl-6">messages</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// 5. Additional validation</span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-4">&quot;wait&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// Check LLM signal matches indicators</span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-4">&quot;long&quot;</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">currentRSI</span><span class="hl-2"> &gt; </span><span class="hl-7">70</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">warn</span><span class="hl-2">(</span><span class="hl-4">&quot;LLM recommends LONG, but RSI is overbought&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-4">&quot;short&quot;</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">currentRSI</span><span class="hl-2"> &lt; </span><span class="hl-7">30</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">warn</span><span class="hl-2">(</span><span class="hl-4">&quot;LLM recommends SHORT, but RSI is oversold&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceOpen:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceTakeProfit</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceStopLoss</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">minuteEstimatedTime:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">minuteEstimatedTime</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">timestamp:</span><span class="hl-2"> </span><span class="hl-6">Date</span><span class="hl-2">.</span><span class="hl-1">now</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">note:</span><span class="hl-2"> </span><span class="hl-4">`LLM: </span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">note</span><span class="hl-3">}</span><span class="hl-14">\n</span><span class="hl-4">RSI: </span><span class="hl-3">${</span><span class="hl-6">currentRSI</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-14">\n</span><span class="hl-4">MACD: </span><span class="hl-3">${</span><span class="hl-6">currentMACD</span><span class="hl-9">?.</span><span class="hl-8">MACD</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">4</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    };</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="token-cost-optimization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Token Cost Optimization<a href="#token-cost-optimization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="analysis-caching" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Analysis Caching<a href="#analysis-caching" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">analysisCache</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Map</span><span class="hl-2">();</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">CACHE_TTL</span><span class="hl-2"> = </span><span class="hl-7">60000</span><span class="hl-2">; </span><span class="hl-0">// 1 minute</span><br/><br/><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">getCachedAnalysis</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">timeframe</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">cacheKey</span><span class="hl-2"> = </span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">-</span><span class="hl-3">${</span><span class="hl-6">timeframe</span><span class="hl-3">}</span><span class="hl-4">-</span><span class="hl-3">${</span><span class="hl-6">Math</span><span class="hl-9">.</span><span class="hl-1">floor</span><span class="hl-9">(</span><span class="hl-6">Date</span><span class="hl-9">.</span><span class="hl-1">now</span><span class="hl-9">() </span><span class="hl-2">/</span><span class="hl-9"> </span><span class="hl-8">CACHE_TTL</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">;</span><br/><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">analysisCache</span><span class="hl-2">.</span><span class="hl-1">has</span><span class="hl-2">(</span><span class="hl-6">cacheKey</span><span class="hl-2">)) {</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Used cache for </span><span class="hl-3">${</span><span class="hl-6">cacheKey</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">analysisCache</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-6">cacheKey</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">analysis</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">performLLMAnalysis</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">timeframe</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-6">analysisCache</span><span class="hl-2">.</span><span class="hl-1">set</span><span class="hl-2">(</span><span class="hl-6">cacheKey</span><span class="hl-2">, </span><span class="hl-6">analysis</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Clear old cache</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">analysisCache</span><span class="hl-2">.</span><span class="hl-6">size</span><span class="hl-2"> &gt; </span><span class="hl-7">100</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">firstKey</span><span class="hl-2"> = </span><span class="hl-6">analysisCache</span><span class="hl-2">.</span><span class="hl-1">keys</span><span class="hl-2">().</span><span class="hl-1">next</span><span class="hl-2">().</span><span class="hl-6">value</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-6">analysisCache</span><span class="hl-2">.</span><span class="hl-1">delete</span><span class="hl-2">(</span><span class="hl-6">firstKey</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">analysis</span><span class="hl-2">;</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="request-batching" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Request Batching<a href="#request-batching" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">pendingRequests</span><span class="hl-2"> = [];</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">BATCH_SIZE</span><span class="hl-2"> = </span><span class="hl-7">5</span><span class="hl-2">;</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">BATCH_DELAY</span><span class="hl-2"> = </span><span class="hl-7">1000</span><span class="hl-2">; </span><span class="hl-0">// 1 second</span><br/><br/><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">batchLLMRequest</span><span class="hl-2">(</span><span class="hl-6">messages</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-11">Promise</span><span class="hl-2">((</span><span class="hl-6">resolve</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">pendingRequests</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">({ </span><span class="hl-6">messages</span><span class="hl-2">, </span><span class="hl-6">resolve</span><span class="hl-2"> });</span><br/><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">pendingRequests</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> &gt;= </span><span class="hl-8">BATCH_SIZE</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">processBatch</span><span class="hl-2">();</span><br/><span class="hl-2">    } </span><span class="hl-5">else</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-1">setTimeout</span><span class="hl-2">(</span><span class="hl-6">processBatch</span><span class="hl-2">, </span><span class="hl-8">BATCH_DELAY</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">processBatch</span><span class="hl-2">() {</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">pendingRequests</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> === </span><span class="hl-7">0</span><span class="hl-2">) </span><span class="hl-5">return</span><span class="hl-2">;</span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">batch</span><span class="hl-2"> = </span><span class="hl-6">pendingRequests</span><span class="hl-2">.</span><span class="hl-1">splice</span><span class="hl-2">(</span><span class="hl-7">0</span><span class="hl-2">, </span><span class="hl-8">BATCH_SIZE</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Parallel processing</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">results</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-11">Promise</span><span class="hl-2">.</span><span class="hl-1">all</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-6">batch</span><span class="hl-2">.</span><span class="hl-1">map</span><span class="hl-2">(({ </span><span class="hl-6">messages</span><span class="hl-2"> }) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-1">json</span><span class="hl-2">(</span><span class="hl-6">messages</span><span class="hl-2">))</span><br/><span class="hl-2">  );</span><br/><br/><span class="hl-2">  </span><span class="hl-6">batch</span><span class="hl-2">.</span><span class="hl-1">forEach</span><span class="hl-2">(({ </span><span class="hl-6">resolve</span><span class="hl-2"> }, </span><span class="hl-6">index</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-1">resolve</span><span class="hl-2">(</span><span class="hl-6">results</span><span class="hl-2">[</span><span class="hl-6">index</span><span class="hl-2">]);</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="complete-working-example" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Complete Working Example<a href="#complete-working-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">config</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;dotenv&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">setLogger</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">addExchange</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">addStrategy</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">addFrame</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">Backtest</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">listenSignalBacktest</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">getCandles</span><span class="hl-2">,</span><br/><span class="hl-2">} </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">json</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;./utils/json.mjs&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> </span><span class="hl-6">ccxt</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;ccxt&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">RSI</span><span class="hl-2">, </span><span class="hl-6">MACD</span><span class="hl-2">, </span><span class="hl-6">BollingerBands</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;technicalindicators&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Load environment variables</span><br/><span class="hl-1">config</span><span class="hl-2">();</span><br/><br/><span class="hl-0">// Setup logger</span><br/><span class="hl-1">setLogger</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">log:</span><span class="hl-2"> </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-6">log</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">debug:</span><span class="hl-2"> </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-6">debug</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">info:</span><span class="hl-2"> </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-6">info</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">warn:</span><span class="hl-2"> </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-6">warn</span><span class="hl-2">,</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Register exchange</span><br/><span class="hl-1">addExchange</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-4">&quot;binance&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-1">getCandles</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">interval</span><span class="hl-2">, </span><span class="hl-6">since</span><span class="hl-2">, </span><span class="hl-6">limit</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">exchange</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-6">ccxt</span><span class="hl-2">.</span><span class="hl-1">binance</span><span class="hl-2">();</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">ohlcv</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">exchange</span><span class="hl-2">.</span><span class="hl-1">fetchOHLCV</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-6">symbol</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">interval</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">since</span><span class="hl-2">.</span><span class="hl-1">getTime</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">limit</span><br/><span class="hl-2">    );</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">ohlcv</span><span class="hl-2">.</span><span class="hl-1">map</span><span class="hl-2">(([</span><span class="hl-6">timestamp</span><span class="hl-2">, </span><span class="hl-6">open</span><span class="hl-2">, </span><span class="hl-6">high</span><span class="hl-2">, </span><span class="hl-6">low</span><span class="hl-2">, </span><span class="hl-6">close</span><span class="hl-2">, </span><span class="hl-6">volume</span><span class="hl-2">]) </span><span class="hl-3">=&gt;</span><span class="hl-2"> ({</span><br/><span class="hl-2">      </span><span class="hl-6">timestamp</span><span class="hl-2">, </span><span class="hl-6">open</span><span class="hl-2">, </span><span class="hl-6">high</span><span class="hl-2">, </span><span class="hl-6">low</span><span class="hl-2">, </span><span class="hl-6">close</span><span class="hl-2">, </span><span class="hl-6">volume</span><br/><span class="hl-2">    }));</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-1">formatPrice</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">price</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">price</span><span class="hl-2">.</span><span class="hl-1">toFixed</span><span class="hl-2">(</span><span class="hl-7">2</span><span class="hl-2">),</span><br/><span class="hl-2">  </span><span class="hl-1">formatQuantity</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">quantity</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">quantity</span><span class="hl-2">.</span><span class="hl-1">toFixed</span><span class="hl-2">(</span><span class="hl-7">8</span><span class="hl-2">),</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Register LLM strategy</span><br/><span class="hl-1">addStrategy</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;llm-professional-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-1">getSignal</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// Load data using context-aware getCandles</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles1h</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1h&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles5m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">, </span><span class="hl-7">100</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">closes</span><span class="hl-2"> = </span><span class="hl-6">candles5m</span><span class="hl-2">.</span><span class="hl-1">map</span><span class="hl-2">(</span><span class="hl-6">c</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">c</span><span class="hl-2">.</span><span class="hl-6">close</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// Calculate indicators</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">rsi</span><span class="hl-2"> = </span><span class="hl-8">RSI</span><span class="hl-2">.</span><span class="hl-1">calculate</span><span class="hl-2">({ </span><span class="hl-6">period:</span><span class="hl-2"> </span><span class="hl-7">14</span><span class="hl-2">, </span><span class="hl-6">values:</span><span class="hl-2"> </span><span class="hl-6">closes</span><span class="hl-2"> });</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">macd</span><span class="hl-2"> = </span><span class="hl-8">MACD</span><span class="hl-2">.</span><span class="hl-1">calculate</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">values:</span><span class="hl-2"> </span><span class="hl-6">closes</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">fastPeriod:</span><span class="hl-2"> </span><span class="hl-7">12</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">slowPeriod:</span><span class="hl-2"> </span><span class="hl-7">26</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">signalPeriod:</span><span class="hl-2"> </span><span class="hl-7">9</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">SimpleMAOscillator:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">SimpleMASignal:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">bb</span><span class="hl-2"> = </span><span class="hl-6">BollingerBands</span><span class="hl-2">.</span><span class="hl-1">calculate</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">period:</span><span class="hl-2"> </span><span class="hl-7">20</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">values:</span><span class="hl-2"> </span><span class="hl-6">closes</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">stdDev:</span><span class="hl-2"> </span><span class="hl-7">2</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">currentPrice</span><span class="hl-2"> = </span><span class="hl-6">closes</span><span class="hl-2">[</span><span class="hl-6">closes</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">];</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">currentRSI</span><span class="hl-2"> = </span><span class="hl-6">rsi</span><span class="hl-2">[</span><span class="hl-6">rsi</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">];</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">currentMACD</span><span class="hl-2"> = </span><span class="hl-6">macd</span><span class="hl-2">[</span><span class="hl-6">macd</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">];</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">currentBB</span><span class="hl-2"> = </span><span class="hl-6">bb</span><span class="hl-2">[</span><span class="hl-6">bb</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> - </span><span class="hl-7">1</span><span class="hl-2">];</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// Form context for LLM</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">messages</span><span class="hl-2"> = [</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-6">content:</span><span class="hl-2"> [</span><br/><span class="hl-2">          </span><span class="hl-4">`# Trading Analysis </span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`## Current Market Situation`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`Price: $</span><span class="hl-3">${</span><span class="hl-6">currentPrice</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`## Technical Indicators (5m)`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`RSI(14): </span><span class="hl-3">${</span><span class="hl-6">currentRSI</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`MACD: </span><span class="hl-3">${</span><span class="hl-6">currentMACD</span><span class="hl-9">?.</span><span class="hl-8">MACD</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">4</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`MACD Signal: </span><span class="hl-3">${</span><span class="hl-6">currentMACD</span><span class="hl-9">?.</span><span class="hl-6">signal</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">4</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`MACD Histogram: </span><span class="hl-3">${</span><span class="hl-6">currentMACD</span><span class="hl-9">?.</span><span class="hl-6">histogram</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">4</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`Bollinger Upper: </span><span class="hl-3">${</span><span class="hl-6">currentBB</span><span class="hl-9">?.</span><span class="hl-6">upper</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`Bollinger Middle: </span><span class="hl-3">${</span><span class="hl-6">currentBB</span><span class="hl-9">?.</span><span class="hl-6">middle</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`Bollinger Lower: </span><span class="hl-3">${</span><span class="hl-6">currentBB</span><span class="hl-9">?.</span><span class="hl-6">lower</span><span class="hl-9">?.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`## 1-hour Trend`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-1">formatTrendAnalysis</span><span class="hl-2">(</span><span class="hl-6">candles1h</span><span class="hl-2">),</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">`## Last 10 Candles (5m)`</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-1">formatCandles</span><span class="hl-2">(</span><span class="hl-6">candles5m</span><span class="hl-2">.</span><span class="hl-1">slice</span><span class="hl-2">(-</span><span class="hl-7">10</span><span class="hl-2">)),</span><br/><span class="hl-2">        ].</span><span class="hl-1">join</span><span class="hl-2">(</span><span class="hl-4">&#39;</span><span class="hl-14">\n</span><span class="hl-4">&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    ];</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// Generate signal via LLM</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">signal</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">json</span><span class="hl-2">(</span><span class="hl-6">messages</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`</span><span class="hl-14">\n</span><span class="hl-4">LLM Analysis for </span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">:`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Position: </span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">position</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Note: </span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">note</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-4">&quot;wait&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceOpen:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceTakeProfit</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceStopLoss</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">minuteEstimatedTime:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">minuteEstimatedTime</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">timestamp:</span><span class="hl-2"> </span><span class="hl-6">Date</span><span class="hl-2">.</span><span class="hl-1">now</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">note:</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">note</span><span class="hl-2">,</span><br/><span class="hl-2">    };</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Register frame</span><br/><span class="hl-1">addFrame</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">frameName:</span><span class="hl-2"> </span><span class="hl-4">&quot;test-period&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">startDate:</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Date</span><span class="hl-2">(</span><span class="hl-4">&quot;2025-12-01&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">  </span><span class="hl-6">endDate:</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Date</span><span class="hl-2">(</span><span class="hl-4">&quot;2025-12-07&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Monitor signals</span><br/><span class="hl-1">listenSignalBacktest</span><span class="hl-2">((</span><span class="hl-6">event</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">event</span><span class="hl-2">.</span><span class="hl-6">action</span><span class="hl-2"> === </span><span class="hl-4">&quot;opened&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`</span><span class="hl-14">\n</span><span class="hl-4"> Position opened:`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`  Direction: </span><span class="hl-3">${</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">position</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`  Entry: </span><span class="hl-3">${</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceOpen</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`  TP: </span><span class="hl-3">${</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceTakeProfit</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`  SL: </span><span class="hl-3">${</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceStopLoss</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`  LLM Analysis: </span><span class="hl-3">${</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">note</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">event</span><span class="hl-2">.</span><span class="hl-6">action</span><span class="hl-2"> === </span><span class="hl-4">&quot;closed&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`</span><span class="hl-14">\n</span><span class="hl-4"> Position closed:`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`  Reason: </span><span class="hl-3">${</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">closeReason</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`  PNL: </span><span class="hl-3">${</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">pnl</span><span class="hl-9">.</span><span class="hl-6">pnlPercentage</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%`</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Run backtest</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">&quot;Starting LLM backtest...</span><span class="hl-14">\n</span><span class="hl-4">&quot;</span><span class="hl-2">);</span><br/><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">background</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;llm-professional-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-4">&quot;binance&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">frameName:</span><span class="hl-2"> </span><span class="hl-4">&quot;test-period&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">&quot;</span><span class="hl-14">\n</span><span class="hl-4">Backtest completed!&quot;</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="conclusion" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Conclusion<a href="#conclusion" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>LLM trading with structured JSON output opens new possibilities for creating adaptive trading systems. By combining the power of large language models with the reliability of traditional indicators, you can create strategies that adapt to changing market conditions.</p>
<p><strong>Key Benefits</strong>:</p>
<ul>
<li>Structured and validatable output</li>
<li>Adaptive analysis of market context</li>
<li>Multi-timeframe analysis</li>
<li>Explainable trading decisions</li>
<li>Easy strategy modification through prompts</li>
</ul>
<p><strong>Happy LLM Trading!</strong></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#llm-trading-with-structured-json-output"><span>LLM <wbr/>Trading with <wbr/>Structured JSON <wbr/>Output</span></a><ul><li><a href="#what-is-llm-trading"><span>What is LLM <wbr/>Trading?</span></a></li><li><ul><li><a href="#benefits-of-llm-trading"><span>Benefits of LLM <wbr/>Trading</span></a></li></ul></li><li><a href="#llm-trading-architecture"><span>LLM <wbr/>Trading <wbr/>Architecture</span></a></li><li><a href="#setting-up-ollama-for-structured-output"><span>Setting <wbr/>Up <wbr/>Ollama for <wbr/>Structured <wbr/>Output</span></a></li><li><ul><li><a href="#step-1-installation-and-setup"><span>Step 1: <wbr/>Installation and <wbr/>Setup</span></a></li><li><a href="#step-2-environment-variables-setup"><span>Step 2: <wbr/>Environment <wbr/>Variables <wbr/>Setup</span></a></li></ul></li><li><a href="#function-for-structured-json-output"><span>Function for <wbr/>Structured JSON <wbr/>Output</span></a></li><li><ul><li><a href="#basic-implementation"><span>Basic <wbr/>Implementation</span></a></li></ul></li><li><a href="#multi-timeframe-analysis"><span>Multi-<wbr/>Timeframe <wbr/>Analysis</span></a></li><li><ul><li><a href="#pattern-for-analyzing-different-timeframes"><span>Pattern for <wbr/>Analyzing <wbr/>Different <wbr/>Timeframes</span></a></li></ul></li><li><a href="#integration-with-backtest-kit"><span>Integration with <wbr/>Backtest-<wbr/>Kit</span></a></li><li><ul><li><a href="#complete-strategy-with-llm"><span>Complete <wbr/>Strategy with LLM</span></a></li></ul></li><li><a href="#advanced-json-schema-for-trading-signals"><span>Advanced JSON <wbr/>Schema for <wbr/>Trading <wbr/>Signals</span></a></li><li><ul><li><a href="#detailed-schema-with-additional-fields"><span>Detailed <wbr/>Schema with <wbr/>Additional <wbr/>Fields</span></a></li></ul></li><li><a href="#indicator-processing-for-llm"><span>Indicator <wbr/>Processing for LLM</span></a></li><li><ul><li><a href="#helper-functions"><span>Helper <wbr/>Functions</span></a></li></ul></li><li><a href="#text-analysis-with-ollama"><span>Text <wbr/>Analysis with <wbr/>Ollama</span></a></li><li><ul><li><a href="#function-for-text-analysis"><span>Function for <wbr/>Text <wbr/>Analysis</span></a></li></ul></li><li><a href="#logging-and-debugging-llm-signals"><span>Logging and <wbr/>Debugging LLM <wbr/>Signals</span></a></li><li><ul><li><a href="#function-for-saving-history"><span>Function for <wbr/>Saving <wbr/>History</span></a></li></ul></li><li><a href="#advanced-example-hybrid-strategy"><span>Advanced <wbr/>Example: <wbr/>Hybrid <wbr/>Strategy</span></a></li><li><ul><li><a href="#llm--traditional-indicators"><span>LLM + <wbr/>Traditional <wbr/>Indicators</span></a></li></ul></li><li><a href="#token-cost-optimization"><span>Token <wbr/>Cost <wbr/>Optimization</span></a></li><li><ul><li><a href="#analysis-caching"><span>Analysis <wbr/>Caching</span></a></li><li><a href="#request-batching"><span>Request <wbr/>Batching</span></a></li></ul></li><li><a href="#complete-working-example"><span>Complete <wbr/>Working <wbr/>Example</span></a></li><li><a href="#conclusion"><span>Conclusion</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
