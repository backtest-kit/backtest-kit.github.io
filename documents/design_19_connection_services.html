<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/19_connection_services | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_19_connection_services.html">design/19_connection_services</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="connection-services" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Connection Services<a href="#connection-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Connection Services form the routing layer within the Service Orchestration architecture, responsible for directing method calls to the appropriate client instances (ClientStrategy, ClientExchange, ClientFrame) based on runtime context. These services implement memoized factory patterns to ensure efficient instance reuse while maintaining clean separation between configuration registration and execution.</p>
<p>This document covers the three Connection Services: <code>StrategyConnectionService</code>, <code>ExchangeConnectionService</code>, and <code>FrameConnectionService</code>. For configuration registration mechanisms, see <a href="design_20_schema_services.html">Schema Services</a>. For the client implementations that Connection Services route to, see <a href="design_14_core_business_logic.html">Core Business Logic</a>. For the context services that enable routing, see <a href="design_07_context_propagation.html">Context Propagation</a>.</p>
<hr>
<a id="architecture-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Overview<a href="#architecture-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Connection Services act as intelligent routers that bridge the Service Orchestration Layer with the Business Logic Layer. Each Connection Service implements its corresponding interface (<code>IStrategy</code>, <code>IExchange</code>, <code>IFrame</code>) and delegates method calls to memoized client instances.</p>
<a id="connection-layer-architecture" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Connection Layer Architecture<a href="#connection-layer-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/19_Connection_Services_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="routing-mechanism" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Routing Mechanism<a href="#routing-mechanism" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Connection Services use <code>MethodContextService</code> to determine which client instance to route to at runtime. The context contains three routing keys:</p>
<table>
<thead>
<tr>
<th>Context Property</th>
<th>Purpose</th>
<th>Used By</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strategyName</code></td>
<td>Identifies which strategy schema to use</td>
<td>StrategyConnectionService</td>
</tr>
<tr>
<td><code>exchangeName</code></td>
<td>Identifies which exchange schema to use</td>
<td>ExchangeConnectionService</td>
</tr>
<tr>
<td><code>frameName</code></td>
<td>Identifies which frame schema to use</td>
<td>FrameConnectionService</td>
</tr>
</tbody>
</table>
<a id="context-based-routing-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context-Based Routing Flow<a href="#context-based-routing-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/19_Connection_Services_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Example:</strong> When <code>StrategyConnectionService.tick()</code> is called, it reads <code>methodContextService.context.strategyName</code> to determine which <code>ClientStrategy</code> instance to use.</p>
<hr>
<a id="memoization-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Memoization Pattern<a href="#memoization-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All three Connection Services use the <code>memoize</code> function from <code>functools-kit</code> to cache client instances. This pattern ensures:</p>
<ol>
<li><strong>Performance</strong>: Client instances are created once per schema name</li>
<li><strong>State preservation</strong>: Client instances maintain internal state across calls</li>
<li><strong>Memory efficiency</strong>: Automatic caching without manual cache management</li>
</ol>
<a id="memoization-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoization Structure<a href="#memoization-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Component</th>
<th>Cache Key</th>
<th>Cached Value</th>
<th>Lifecycle</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getStrategy()</code></td>
<td><code>strategyName</code> string</td>
<td><code>ClientStrategy</code> instance</td>
<td>Application lifetime</td>
</tr>
<tr>
<td><code>getExchange()</code></td>
<td><code>exchangeName</code> string</td>
<td><code>ClientExchange</code> instance</td>
<td>Application lifetime</td>
</tr>
<tr>
<td><code>getFrame()</code></td>
<td><code>frameName</code> string</td>
<td><code>ClientFrame</code> instance</td>
<td>Application lifetime</td>
</tr>
</tbody>
</table>
<a id="memoization-implementation-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoization Implementation Pattern<a href="#memoization-implementation-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/19_Connection_Services_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Example from StrategyConnectionService:</strong></p>
<p>The <code>getStrategy</code> method <a href="">src/lib/services/connection/StrategyConnectionService.ts:67-83</a> demonstrates this pattern:</p>
<ul>
<li><strong>Cache key function</strong>: <code>([strategyName]) =&gt; \</code>${strategyName}`` - Creates unique key from strategy name</li>
<li><strong>Factory function</strong>: Creates <code>new ClientStrategy()</code> with schema config from <code>StrategySchemaService</code></li>
<li><strong>First call</strong>: Creates instance, caches it, returns it</li>
<li><strong>Subsequent calls</strong>: Returns cached instance immediately</li>
</ul>
<hr>
<a id="strategyconnectionservice" class="tsd-anchor"></a><h2 class="tsd-anchor-link">StrategyConnectionService<a href="#strategyconnectionservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>StrategyConnectionService</code> implements the <code>IStrategy</code> interface and routes strategy operations to <code>ClientStrategy</code> instances. It is responsible for signal lifecycle management including tick evaluation, backtest execution, and event emission.</p>
<a id="dependency-injection" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Dependency Injection<a href="#dependency-injection" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The service injects five core dependencies:</p>
<p><img src="../media/19_Connection_Services_3.svg" alt="Mermaid Diagram"></p>
<a id="methods" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Methods<a href="#methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="tick" class="tsd-anchor"></a><h4 class="tsd-anchor-link">tick()<a href="#tick" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Routes live trading tick evaluation to the appropriate <code>ClientStrategy</code> instance.</p>
<p><strong>Execution flow:</strong></p>
<ol>
<li>Retrieves strategy name from <code>methodContextService.context.strategyName</code> <a href="">src/lib/services/connection/StrategyConnectionService.ts:95-97</a></li>
<li>Gets memoized <code>ClientStrategy</code> instance via <code>getStrategy()</code> <a href="">src/lib/services/connection/StrategyConnectionService.ts:95-97</a></li>
<li>Waits for strategy initialization with <code>waitForInit()</code> <a href="">src/lib/services/connection/StrategyConnectionService.ts:98</a></li>
<li>Calls <code>strategy.tick()</code> <a href="">src/lib/services/connection/StrategyConnectionService.ts:99</a></li>
<li>Emits result to event listeners <a href="">src/lib/services/connection/StrategyConnectionService.ts:100-108</a>:
<ul>
<li><code>signalBacktestEmitter</code> if in backtest mode</li>
<li><code>signalLiveEmitter</code> if in live mode</li>
<li><code>signalEmitter</code> always</li>
</ul>
</li>
</ol>
<p><strong>Returns:</strong> <code>Promise&lt;IStrategyTickResult&gt;</code> - Signal state (idle, opened, active, closed)</p>
<a id="backtest" class="tsd-anchor"></a><h4 class="tsd-anchor-link">backtest()<a href="#backtest" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Routes backtest simulation to the appropriate <code>ClientStrategy</code> instance with provided candle data.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>candles: ICandleData[]</code> - Historical candle data for fast-forward simulation</li>
</ul>
<p><strong>Execution flow:</strong></p>
<ol>
<li>Retrieves strategy name from context <a href="">src/lib/services/connection/StrategyConnectionService.ts:127-129</a></li>
<li>Gets memoized <code>ClientStrategy</code> instance <a href="">src/lib/services/connection/StrategyConnectionService.ts:127-129</a></li>
<li>Waits for strategy initialization <a href="">src/lib/services/connection/StrategyConnectionService.ts:130</a></li>
<li>Calls <code>strategy.backtest(candles)</code> <a href="">src/lib/services/connection/StrategyConnectionService.ts:131</a></li>
<li>Emits result to event listeners <a href="">src/lib/services/connection/StrategyConnectionService.ts:132-137</a></li>
</ol>
<p><strong>Returns:</strong> <code>Promise&lt;IStrategyBacktestResult&gt;</code> - Backtest outcome (signal or idle)</p>
<a id="event-emission" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Emission<a href="#event-emission" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>StrategyConnectionService</code> emits tick and backtest results to three event emitters <a href="">src/lib/services/connection/StrategyConnectionService.ts:17-21</a>:</p>
<table>
<thead>
<tr>
<th>Emitter</th>
<th>When</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>signalEmitter</code></td>
<td>All results</td>
<td>Generic signal observer</td>
</tr>
<tr>
<td><code>signalBacktestEmitter</code></td>
<td>Backtest mode only</td>
<td>Backtest-specific observers</td>
</tr>
<tr>
<td><code>signalLiveEmitter</code></td>
<td>Live mode only</td>
<td>Live trading observers</td>
</tr>
</tbody>
</table>
<hr>
<a id="exchangeconnectionservice" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ExchangeConnectionService<a href="#exchangeconnectionservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>ExchangeConnectionService</code> implements the <code>IExchange</code> interface and routes exchange operations to <code>ClientExchange</code> instances. It handles candle data fetching, price formatting, and VWAP calculation.</p>
<a id="dependency-injection-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Dependency Injection<a href="#dependency-injection-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/19_Connection_Services_4.svg" alt="Mermaid Diagram"></p>
<a id="methods-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Methods<a href="#methods-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="getcandles" class="tsd-anchor"></a><h4 class="tsd-anchor-link">getCandles()<a href="#getcandles" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Fetches historical candles backwards from <code>executionContextService.context.when</code>.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol: string</code> - Trading pair (e.g., &quot;BTCUSDT&quot;)</li>
<li><code>interval: CandleInterval</code> - Time interval (e.g., &quot;1h&quot;, &quot;1d&quot;)</li>
<li><code>limit: number</code> - Maximum candles to fetch</li>
</ul>
<p><strong>Implementation:</strong> <a href="">src/lib/services/connection/ExchangeConnectionService.ts:86-99</a></p>
<ul>
<li>Logs operation with parameters</li>
<li>Routes to <code>getExchange(exchangeName).getCandles()</code></li>
<li>Exchange name from <code>methodContextService.context.exchangeName</code></li>
</ul>
<p><strong>Returns:</strong> <code>Promise&lt;ICandleData[]&gt;</code> - Array of OHLCV candle data</p>
<a id="getnextcandles" class="tsd-anchor"></a><h4 class="tsd-anchor-link">getNextCandles()<a href="#getnextcandles" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Fetches future candles forward from <code>executionContextService.context.when</code> (backtest only).</p>
<p><strong>Parameters:</strong> Same as <code>getCandles()</code></p>
<p><strong>Implementation:</strong> <a href="">src/lib/services/connection/ExchangeConnectionService.ts:112-125</a></p>
<ul>
<li>Used for backtest fast-forward simulation</li>
<li>Routes to <code>getExchange(exchangeName).getNextCandles()</code></li>
</ul>
<p><strong>Returns:</strong> <code>Promise&lt;ICandleData[]&gt;</code> - Array of future candle data</p>
<a id="getaverageprice" class="tsd-anchor"></a><h4 class="tsd-anchor-link">getAveragePrice()<a href="#getaverageprice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Calculates Volume-Weighted Average Price (VWAP) for symbol.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol: string</code> - Trading pair</li>
</ul>
<p><strong>Implementation:</strong> <a href="">src/lib/services/connection/ExchangeConnectionService.ts:136-143</a></p>
<ul>
<li><strong>Live mode</strong>: Fetches real-time average from exchange API</li>
<li><strong>Backtest mode</strong>: Calculates VWAP from last 5 one-minute candles</li>
</ul>
<p><strong>Returns:</strong> <code>Promise&lt;number&gt;</code> - VWAP price</p>
<a id="formatprice" class="tsd-anchor"></a><h4 class="tsd-anchor-link">formatPrice()<a href="#formatprice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Formats price value according to exchange-specific precision rules.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol: string</code> - Trading pair</li>
<li><code>price: number</code> - Raw price value</li>
</ul>
<p><strong>Implementation:</strong> <a href="">src/lib/services/connection/ExchangeConnectionService.ts:154-162</a></p>
<ul>
<li>Routes to exchange-specific formatter</li>
<li>Ensures compliance with tick size requirements</li>
</ul>
<p><strong>Returns:</strong> <code>Promise&lt;string&gt;</code> - Formatted price string</p>
<a id="formatquantity" class="tsd-anchor"></a><h4 class="tsd-anchor-link">formatQuantity()<a href="#formatquantity" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Formats quantity value according to exchange-specific precision rules.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol: string</code> - Trading pair</li>
<li><code>quantity: number</code> - Raw quantity value</li>
</ul>
<p><strong>Implementation:</strong> <a href="">src/lib/services/connection/ExchangeConnectionService.ts:173-181</a></p>
<ul>
<li>Routes to exchange-specific formatter</li>
<li>Ensures compliance with lot size requirements</li>
</ul>
<p><strong>Returns:</strong> <code>Promise&lt;string&gt;</code> - Formatted quantity string</p>
<hr>
<a id="frameconnectionservice" class="tsd-anchor"></a><h2 class="tsd-anchor-link">FrameConnectionService<a href="#frameconnectionservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>FrameConnectionService</code> implements the <code>IFrame</code> interface and routes frame operations to <code>ClientFrame</code> instances. It manages backtest timeframe boundaries (start date, end date, interval).</p>
<a id="dependency-injection-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Dependency Injection<a href="#dependency-injection-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/19_Connection_Services_5.svg" alt="Mermaid Diagram"></p>
<a id="methods-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Methods<a href="#methods-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="gettimeframe" class="tsd-anchor"></a><h4 class="tsd-anchor-link">getTimeframe()<a href="#gettimeframe" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Retrieves backtest timeframe boundaries for symbol from registered frame schema.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol: string</code> - Trading pair (e.g., &quot;BTCUSDT&quot;)</li>
</ul>
<p><strong>Implementation:</strong> <a href="">src/lib/services/connection/FrameConnectionService.ts:75-82</a></p>
<ul>
<li>Routes to <code>getFrame(frameName).getTimeframe()</code></li>
<li>Frame name from <code>methodContextService.context.frameName</code></li>
<li>Returns <code>{ startDate: Date, endDate: Date }</code> from schema configuration</li>
</ul>
<p><strong>Returns:</strong> <code>Promise&lt;{ startDate: Date, endDate: Date }&gt;</code> - Timeframe boundaries</p>
<a id="live-mode-behavior" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live Mode Behavior<a href="#live-mode-behavior" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>In live trading mode, <code>frameName</code> is set to empty string <code>&quot;&quot;</code> <a href="">src/lib/services/connection/FrameConnectionService.ts:23</a> because there are no timeframe constraints. The <code>FrameConnectionService</code> is not used during live execution.</p>
<hr>
<a id="integration-points" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration Points<a href="#integration-points" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Connection Services integrate with multiple layers of the architecture, serving as the critical routing infrastructure.</p>
<a id="service-dependencies" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Dependencies<a href="#service-dependencies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/19_Connection_Services_6.svg" alt="Mermaid Diagram"></p>
<a id="data-flow-through-connection-layer" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Data Flow Through Connection Layer<a href="#data-flow-through-connection-layer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Source</th>
<th>Connection Service</th>
<th>Destination</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Logic Services</td>
<td>StrategyConnectionService</td>
<td>ClientStrategy</td>
<td>Signal evaluation and backtest</td>
</tr>
<tr>
<td>ClientStrategy</td>
<td>ExchangeConnectionService</td>
<td>ClientExchange</td>
<td>Candle data and VWAP</td>
</tr>
<tr>
<td>Logic Services</td>
<td>ExchangeConnectionService</td>
<td>ClientExchange</td>
<td>Price formatting</td>
</tr>
<tr>
<td>Logic Services</td>
<td>FrameConnectionService</td>
<td>ClientFrame</td>
<td>Timeframe generation</td>
</tr>
</tbody>
</table>
<a id="logging-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Logging Integration<a href="#logging-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All Connection Services inject <code>LoggerService</code> and log operations with context-enriched metadata <a href="">src/lib/services/connection/StrategyConnectionService.ts:45</a>, <a href="">src/lib/services/connection/ExchangeConnectionService.ts:39</a>, <a href="">src/lib/services/connection/FrameConnectionService.ts:33</a>:</p>
<ul>
<li><code>StrategyConnectionService</code>: Logs tick and backtest operations with candle counts</li>
<li><code>ExchangeConnectionService</code>: Logs all data fetching with symbol, interval, and limits</li>
<li><code>FrameConnectionService</code>: Logs timeframe retrieval with symbol</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#connection-services"><span>Connection <wbr/>Services</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#architecture-overview"><span>Architecture <wbr/>Overview</span></a></li><li><ul><li><a href="#connection-layer-architecture"><span>Connection <wbr/>Layer <wbr/>Architecture</span></a></li></ul></li><li><a href="#routing-mechanism"><span>Routing <wbr/>Mechanism</span></a></li><li><ul><li><a href="#context-based-routing-flow"><span>Context-<wbr/>Based <wbr/>Routing <wbr/>Flow</span></a></li></ul></li><li><a href="#memoization-pattern"><span>Memoization <wbr/>Pattern</span></a></li><li><ul><li><a href="#memoization-structure"><span>Memoization <wbr/>Structure</span></a></li><li><a href="#memoization-implementation-pattern"><span>Memoization <wbr/>Implementation <wbr/>Pattern</span></a></li></ul></li><li><a href="#strategyconnectionservice"><span>Strategy<wbr/>Connection<wbr/>Service</span></a></li><li><ul><li><a href="#dependency-injection"><span>Dependency <wbr/>Injection</span></a></li><li><a href="#methods"><span>Methods</span></a></li><li><ul><li><a href="#tick"><span>tick()</span></a></li><li><a href="#backtest"><span>backtest()</span></a></li></ul></li><li><a href="#event-emission"><span>Event <wbr/>Emission</span></a></li></ul></li><li><a href="#exchangeconnectionservice"><span>Exchange<wbr/>Connection<wbr/>Service</span></a></li><li><ul><li><a href="#dependency-injection-1"><span>Dependency <wbr/>Injection</span></a></li><li><a href="#methods-1"><span>Methods</span></a></li><li><ul><li><a href="#getcandles"><span>get<wbr/>Candles()</span></a></li><li><a href="#getnextcandles"><span>get<wbr/>Next<wbr/>Candles()</span></a></li><li><a href="#getaverageprice"><span>get<wbr/>Average<wbr/>Price()</span></a></li><li><a href="#formatprice"><span>format<wbr/>Price()</span></a></li><li><a href="#formatquantity"><span>format<wbr/>Quantity()</span></a></li></ul></li></ul></li><li><a href="#frameconnectionservice"><span>Frame<wbr/>Connection<wbr/>Service</span></a></li><li><ul><li><a href="#dependency-injection-2"><span>Dependency <wbr/>Injection</span></a></li><li><a href="#methods-2"><span>Methods</span></a></li><li><ul><li><a href="#gettimeframe"><span>get<wbr/>Timeframe()</span></a></li></ul></li><li><a href="#live-mode-behavior"><span>Live <wbr/>Mode <wbr/>Behavior</span></a></li></ul></li><li><a href="#integration-points"><span>Integration <wbr/>Points</span></a></li><li><ul><li><a href="#service-dependencies"><span>Service <wbr/>Dependencies</span></a></li><li><a href="#data-flow-through-connection-layer"><span>Data <wbr/>Flow <wbr/>Through <wbr/>Connection <wbr/>Layer</span></a></li><li><a href="#logging-integration"><span>Logging <wbr/>Integration</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
