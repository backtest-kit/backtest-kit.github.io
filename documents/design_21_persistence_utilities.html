<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/21_persistence_utilities | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_21_persistence_utilities.html">design/21_persistence_utilities</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="persistence-utilities" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Persistence Utilities<a href="#persistence-utilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents the persistence layer that enables crash-safe live trading in backtest-kit. The persistence utilities provide atomic file-based storage for trading state across four domains: signals, risk positions, scheduled signals, and partial profit/loss levels.</p>
<p>For details on crash recovery in live trading, see <a href="design_19_live_trading_api.html">Live Trading API</a>. For the client implementations that use these utilities, see <a href="design_32_client_implementations.html">Client Implementations</a>.</p>
<hr>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The persistence utilities form a <strong>critical differentiator</strong> for backtest-kit, enabling production-grade live trading with automatic crash recovery. The system ensures that no trading position is ever lost, even in catastrophic failure scenarios.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Atomic file writes</strong> using temp → rename pattern (all-or-nothing guarantee)</li>
<li><strong>Multi-domain persistence</strong> with isolated storage per entity type</li>
<li><strong>Custom adapter support</strong> for alternative backends (Redis, MongoDB, S3)</li>
<li><strong>Self-healing validation</strong> with automatic cleanup of corrupted files</li>
<li><strong>Memoized instances</strong> per entity for performance optimization</li>
</ul>
<p><strong>Four Persistence Domains:</strong></p>
<table>
<thead>
<tr>
<th>Domain</th>
<th>Purpose</th>
<th>File Location</th>
<th>Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Signal</strong></td>
<td>Active pending signals (open positions)</td>
<td><code>./dump/data/signal/{symbol}_{strategyName}/{symbol}.json</code></td>
<td><code>ISignalRow | null</code></td>
</tr>
<tr>
<td><strong>Risk</strong></td>
<td>Portfolio-wide active positions for limit enforcement</td>
<td><code>./dump/data/risk/{riskName}/positions.json</code></td>
<td><code>Array&lt;[string, IRiskActivePosition]&gt;</code></td>
</tr>
<tr>
<td><strong>Schedule</strong></td>
<td>Scheduled signals awaiting price activation (limit orders)</td>
<td><code>./dump/data/schedule/{symbol}_{strategyName}/{symbol}.json</code></td>
<td><code>IScheduledSignalRow | null</code></td>
</tr>
<tr>
<td><strong>Partial</strong></td>
<td>Profit/loss milestone levels reached per signal</td>
<td><code>./dump/data/partial/{symbol}_{strategyName}/levels.json</code></td>
<td><code>Record&lt;signalId, IPartialData&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Backtest vs Live Mode:</strong></p>
<ul>
<li><strong>Backtest</strong>: Persistence is <strong>disabled</strong> (purely in-memory for performance)</li>
<li><strong>Live</strong>: Persistence is <strong>enabled</strong> after every tick for crash recovery</li>
</ul>
<hr>
<a id="architecture-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Overview<a href="#architecture-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>Multi-Domain Persistence System</strong></p>
<p><img src="../media/21_Persistence_Utilities_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram 1: Multi-Domain Persistence Architecture</strong></p>
<p>Each domain has its own utility class and global singleton adapter. All four adapters extend <code>PersistBase</code> for consistent atomic write behavior. Client implementations call adapter methods, which delegate to memoized storage instances per entity (symbol, strategyName, riskName).</p>
<p><strong>Key Architectural Decisions:</strong></p>
<ul>
<li><strong>Separate files per entity</strong>: Parallel writes don't block each other</li>
<li><strong>Memoized storage instances</strong>: One <code>PersistBase</code> instance per entity prevents redundant I/O</li>
<li><strong>Atomic writes</strong>: Temp file pattern ensures no partial writes or corruption</li>
<li><strong>Domain isolation</strong>: Each domain has dedicated directory structure</li>
</ul>
<hr>
<a id="persistbase-abstract-class" class="tsd-anchor"></a><h2 class="tsd-anchor-link">PersistBase Abstract Class<a href="#persistbase-abstract-class" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>PersistBase</code> is the foundational abstract class providing file-based persistence with atomic writes, validation, and async generator support. All four utility classes extend <code>PersistBase</code>.</p>
<p><strong>Core Features:</strong></p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Implementation</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Atomic Writes</strong></td>
<td><code>writeFileAtomic</code> with temp → rename pattern</td>
<td>Prevents partial writes and corruption</td>
</tr>
<tr>
<td><strong>Auto-Validation</strong></td>
<td>JSON parsing on <code>waitForInit()</code></td>
<td>Self-healing cleanup of corrupted files</td>
</tr>
<tr>
<td><strong>Async Generators</strong></td>
<td><code>values()</code>, <code>keys()</code>, <code>filter()</code>, <code>take()</code></td>
<td>Memory-efficient iteration over large datasets</td>
</tr>
<tr>
<td><strong>Retry Logic</strong></td>
<td>5 attempts with 1-second delays</td>
<td>Handles filesystem race conditions</td>
</tr>
<tr>
<td><strong>Memoized Init</strong></td>
<td><code>singleshot</code> pattern</td>
<td>Ensures initialization happens exactly once</td>
</tr>
</tbody>
</table>
<p><strong>Type Definitions:</strong></p>
<pre><code class="typescript"><span class="hl-0">// Base interface for persisted entities</span><br/><span class="hl-3">interface</span><span class="hl-2"> </span><span class="hl-11">IEntity</span><span class="hl-2"> {}</span><br/><br/><span class="hl-0">// Entity identifier - string or number</span><br/><span class="hl-3">type</span><span class="hl-2"> </span><span class="hl-11">EntityId</span><span class="hl-2"> = </span><span class="hl-11">string</span><span class="hl-2"> | </span><span class="hl-11">number</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Persistence interface for CRUD operations</span><br/><span class="hl-3">interface</span><span class="hl-2"> </span><span class="hl-11">IPersistBase</span><span class="hl-2">&lt;</span><span class="hl-11">Entity</span><span class="hl-2"> </span><span class="hl-3">extends</span><span class="hl-2"> </span><span class="hl-11">IEntity</span><span class="hl-2"> | </span><span class="hl-11">null</span><span class="hl-2"> = </span><span class="hl-11">IEntity</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">  </span><span class="hl-1">waitForInit</span><span class="hl-2">(</span><span class="hl-6">initial</span><span class="hl-2">: </span><span class="hl-11">boolean</span><span class="hl-2">): </span><span class="hl-11">Promise</span><span class="hl-2">&lt;</span><span class="hl-11">void</span><span class="hl-2">&gt;;</span><br/><span class="hl-2">  </span><span class="hl-1">readValue</span><span class="hl-2">(</span><span class="hl-6">entityId</span><span class="hl-2">: </span><span class="hl-11">EntityId</span><span class="hl-2">): </span><span class="hl-11">Promise</span><span class="hl-2">&lt;</span><span class="hl-11">Entity</span><span class="hl-2">&gt;;</span><br/><span class="hl-2">  </span><span class="hl-1">hasValue</span><span class="hl-2">(</span><span class="hl-6">entityId</span><span class="hl-2">: </span><span class="hl-11">EntityId</span><span class="hl-2">): </span><span class="hl-11">Promise</span><span class="hl-2">&lt;</span><span class="hl-11">boolean</span><span class="hl-2">&gt;;</span><br/><span class="hl-2">  </span><span class="hl-1">writeValue</span><span class="hl-2">(</span><span class="hl-6">entityId</span><span class="hl-2">: </span><span class="hl-11">EntityId</span><span class="hl-2">, </span><span class="hl-6">entity</span><span class="hl-2">: </span><span class="hl-11">Entity</span><span class="hl-2">): </span><span class="hl-11">Promise</span><span class="hl-2">&lt;</span><span class="hl-11">void</span><span class="hl-2">&gt;;</span><br/><span class="hl-2">  </span><span class="hl-0">// ... plus removeValue, removeAll, values, keys, filter, take</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Constructor type for custom adapters</span><br/><span class="hl-3">type</span><span class="hl-2"> </span><span class="hl-11">TPersistBaseCtor</span><span class="hl-2">&lt;</span><span class="hl-11">EntityName</span><span class="hl-2"> </span><span class="hl-3">extends</span><span class="hl-2"> </span><span class="hl-11">string</span><span class="hl-2"> = </span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-11">Entity</span><span class="hl-2"> </span><span class="hl-3">extends</span><span class="hl-2"> </span><span class="hl-11">IEntity</span><span class="hl-2"> | </span><span class="hl-11">null</span><span class="hl-2"> = </span><span class="hl-11">IEntity</span><span class="hl-2">&gt; = </span><br/><span class="hl-2">  </span><span class="hl-5">new</span><span class="hl-2"> (</span><span class="hl-6">entityName</span><span class="hl-2">: </span><span class="hl-11">EntityName</span><span class="hl-2">, </span><span class="hl-6">baseDir</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-11">IPersistBase</span><span class="hl-2">&lt;</span><span class="hl-11">Entity</span><span class="hl-2">&gt;;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Constructor Signature:</strong></p>
<pre><code class="typescript"><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">PersistBase</span><span class="hl-2">(</span><br/><span class="hl-2">  </span><span class="hl-6">entityName</span><span class="hl-2">: </span><span class="hl-6">string</span><span class="hl-2">,        </span><span class="hl-0">// Unique entity type identifier (e.g., &quot;BTCUSDT_my-strategy&quot;)</span><br/><span class="hl-2">  </span><span class="hl-6">baseDir</span><span class="hl-2">: </span><span class="hl-6">string</span><span class="hl-2"> = </span><span class="hl-4">&quot;./dump/data&quot;</span><span class="hl-2">  </span><span class="hl-0">// Base directory for all entities</span><br/><span class="hl-2">)</span>
</code><button type="button">Copy</button></pre>

<p><strong>File Path Pattern:</strong></p>
<pre><code><span class="hl-2">{</span><span class="hl-6">baseDir</span><span class="hl-2">}/{</span><span class="hl-6">entityName</span><span class="hl-2">}/{</span><span class="hl-6">entityId</span><span class="hl-2">}.</span><span class="hl-6">json</span>
</code><button>Copy</button></pre>

<p>Example: <code>./dump/data/signal/BTCUSDT_my-strategy/BTCUSDT.json</code></p>
<hr>
<a id="atomic-write-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Atomic Write Pattern<a href="#atomic-write-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Crash-Safe File Writes Using Temp → Rename</strong></p>
<p><img src="../media/21_Persistence_Utilities_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram 2: Atomic Write Sequence Ensuring Crash Safety</strong></p>
<p>The atomic write pattern ensures that:</p>
<ol>
<li>Data is first written to a temporary file (<code>{file}.json.tmp</code>)</li>
<li><code>fsync()</code> forces disk write completion</li>
<li>OS-level atomic <code>rename()</code> operation moves temp to final location</li>
<li>If process crashes during steps 1-2, old file remains intact</li>
<li>If crash occurs after rename, new file is already in place</li>
</ol>
<p><strong>Implementation Reference:</strong></p>
<pre><code class="typescript"><span class="hl-0">// From writeFileAtomic utility</span><br/><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">writeFileAtomic</span><span class="hl-2">(</span><span class="hl-6">filePath</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-6">data</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-6">encoding</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">tmpPath</span><span class="hl-2"> = </span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-6">filePath</span><span class="hl-3">}</span><span class="hl-4">.tmp`</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2">.</span><span class="hl-1">writeFile</span><span class="hl-2">(</span><span class="hl-6">tmpPath</span><span class="hl-2">, </span><span class="hl-6">data</span><span class="hl-2">, </span><span class="hl-6">encoding</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">fsync</span><span class="hl-2">(</span><span class="hl-6">tmpPath</span><span class="hl-2">);  </span><span class="hl-0">// Ensure disk write</span><br/><span class="hl-2">  </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2">.</span><span class="hl-1">rename</span><span class="hl-2">(</span><span class="hl-6">tmpPath</span><span class="hl-2">, </span><span class="hl-6">filePath</span><span class="hl-2">);  </span><span class="hl-0">// Atomic operation</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="self-healing-validation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Self-Healing Validation<a href="#self-healing-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Auto-Cleanup of Corrupted Files on Initialization</strong></p>
<p><img src="../media/21_Persistence_Utilities_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram 3: Self-Healing Validation During Initialization</strong></p>
<p>On <code>waitForInit()</code>, <code>PersistBase</code> scans all existing files and validates their JSON structure. Corrupted files are automatically deleted with retry logic (5 attempts, 1-second delays) to handle filesystem race conditions.</p>
<p><strong>Validation Logic:</strong></p>
<pre><code class="typescript"><span class="hl-0">// From PersistBase.waitForInit</span><br/><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">key</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-1">keys</span><span class="hl-2">()) {</span><br/><span class="hl-2">  </span><span class="hl-5">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-1">readValue</span><span class="hl-2">(</span><span class="hl-6">key</span><span class="hl-2">);  </span><span class="hl-0">// Validates JSON parsing</span><br/><span class="hl-2">  } </span><span class="hl-5">catch</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// File is corrupted - delete it</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">retry</span><span class="hl-2">(</span><br/><span class="hl-2">      () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2">.</span><span class="hl-1">unlink</span><span class="hl-2">(</span><span class="hl-6">filePath</span><span class="hl-2">),</span><br/><span class="hl-2">      </span><span class="hl-8">BASE_UNLINK_RETRY_COUNT</span><span class="hl-2">,    </span><span class="hl-0">// 5 attempts</span><br/><span class="hl-2">      </span><span class="hl-8">BASE_UNLINK_RETRY_DELAY</span><span class="hl-2">      </span><span class="hl-0">// 1000ms delay</span><br/><span class="hl-2">    );</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="signal-persistence" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Persistence<a href="#signal-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>PersistSignalUtils</code> manages persistence of active pending signals for crash recovery in live trading. Each symbol-strategy pair maintains a single active signal at a time.</p>
<p><strong>Purpose:</strong> Store the currently active pending signal (open position) so that live trading can resume after crashes without losing track of open trades.</p>
<p><strong>Adapter Instance:</strong></p>
<pre><code class="typescript"><span class="hl-5">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">PersistSignalAdapter</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">PersistSignalUtils</span><span class="hl-2">();</span>
</code><button type="button">Copy</button></pre>

<p>Global singleton instance used by <code>ClientStrategy</code>.</p>
<p><strong>Data Type:</strong></p>
<pre><code class="typescript"><span class="hl-3">type</span><span class="hl-2"> </span><span class="hl-11">SignalData</span><span class="hl-2"> = </span><span class="hl-11">ISignalRow</span><span class="hl-2"> | </span><span class="hl-11">null</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// ISignalRow contains:</span><br/><span class="hl-0">// - id: string (signal identifier)</span><br/><span class="hl-0">// - position: &quot;long&quot; | &quot;short&quot;</span><br/><span class="hl-0">// - priceOpen: number</span><br/><span class="hl-0">// - priceTakeProfit: number</span><br/><span class="hl-0">// - priceStopLoss: number</span><br/><span class="hl-0">// - scheduledAt: number (timestamp)</span><br/><span class="hl-0">// - pendingAt: number (timestamp when position opened)</span><br/><span class="hl-0">// ... plus other signal metadata</span>
</code><button type="button">Copy</button></pre>

<p><strong>File Location:</strong></p>
<pre><code><span class="hl-2">./</span><span class="hl-6">dump</span><span class="hl-2">/</span><span class="hl-6">data</span><span class="hl-2">/</span><span class="hl-6">signal</span><span class="hl-2">/{</span><span class="hl-6">symbol</span><span class="hl-2">}</span><span class="hl-6">_</span><span class="hl-2">{</span><span class="hl-6">strategyName</span><span class="hl-2">}/{</span><span class="hl-6">symbol</span><span class="hl-2">}.</span><span class="hl-6">json</span>
</code><button>Copy</button></pre>

<p>Example: <code>./dump/data/signal/BTCUSDT_my-strategy/BTCUSDT.json</code></p>
<p><strong>Storage Pattern:</strong></p>
<ul>
<li><strong>Key</strong>: <code>symbol</code> (e.g., &quot;BTCUSDT&quot;)</li>
<li><strong>Value</strong>: <code>ISignalRow | null</code> (null when no active signal)</li>
<li><strong>Memoization</strong>: Cached by <code>${symbol}:${strategyName}</code> composite key</li>
</ul>
<hr>
<a id="methods" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Methods<a href="#methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="persistsignaladapterreadsignaldatasymbol-strategyname-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistSignalAdapter.readSignalData(symbol, strategyName): Promise&lt;ISignalRow | null&gt;</code><a href="#persistsignaladapterreadsignaldatasymbol-strategyname-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Reads persisted signal data for a symbol-strategy pair. Called by <code>ClientStrategy.waitForInit()</code> to restore state after crashes.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol</code>: Trading pair symbol (e.g., &quot;BTCUSDT&quot;)</li>
<li><code>strategyName</code>: Strategy identifier</li>
</ul>
<p><strong>Returns:</strong> Promise resolving to signal row or <code>null</code> if no active signal</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">PersistSignalAdapter</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Called during ClientStrategy initialization (live mode only)</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">signal</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">PersistSignalAdapter</span><span class="hl-2">.</span><span class="hl-1">readSignalData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">signal</span><span class="hl-2"> !== </span><span class="hl-3">null</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Restored signal </span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">id</span><span class="hl-3">}</span><span class="hl-4"> from disk`</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Position: </span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">position</span><span class="hl-3">}</span><span class="hl-4">, Entry: </span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceOpen</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="persistsignaladapterwritesignaldatasignalrow-symbol-strategyname-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistSignalAdapter.writeSignalData(signalRow, symbol, strategyName): Promise&lt;void&gt;</code><a href="#persistsignaladapterwritesignaldatasignalrow-symbol-strategyname-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Writes signal data to disk with atomic file writes. Called by <code>ClientStrategy.setPendingSignal()</code> after every state change in live mode.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>signalRow</code>: Signal data to persist (<code>ISignalRow | null</code>)</li>
<li><code>symbol</code>: Trading pair symbol</li>
<li><code>strategyName</code>: Strategy identifier</li>
</ul>
<p><strong>Returns:</strong> Promise that resolves when write completes</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">PersistSignalAdapter</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Called by ClientStrategy after opening a signal (live mode only)</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">signal</span><span class="hl-2">: </span><span class="hl-11">ISignalRow</span><span class="hl-2"> = {</span><br/><span class="hl-2">  </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;abc123&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-4">&quot;long&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">priceOpen:</span><span class="hl-2"> </span><span class="hl-7">50000</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> </span><span class="hl-7">52000</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> </span><span class="hl-7">49000</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">scheduledAt:</span><span class="hl-2"> </span><span class="hl-6">Date</span><span class="hl-2">.</span><span class="hl-1">now</span><span class="hl-2">(),</span><br/><span class="hl-2">  </span><span class="hl-6">pendingAt:</span><span class="hl-2"> </span><span class="hl-6">Date</span><span class="hl-2">.</span><span class="hl-1">now</span><span class="hl-2">(),</span><br/><span class="hl-2">  </span><span class="hl-0">// ... other fields</span><br/><span class="hl-2">};</span><br/><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">PersistSignalAdapter</span><span class="hl-2">.</span><span class="hl-1">writeSignalData</span><span class="hl-2">(</span><span class="hl-6">signal</span><span class="hl-2">, </span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-0">// Signal atomically written to ./dump/data/signal/BTCUSDT_my-strategy/BTCUSDT.json</span><br/><br/><span class="hl-0">// When signal closes, write null to clear state</span><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">PersistSignalAdapter</span><span class="hl-2">.</span><span class="hl-1">writeSignalData</span><span class="hl-2">(</span><span class="hl-3">null</span><span class="hl-2">, </span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="persistsignaladapterusepersistsignaladapterctor-void" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistSignalAdapter.usePersistSignalAdapter(Ctor): void</code><a href="#persistsignaladapterusepersistsignaladapterctor-void" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Registers a custom persistence adapter for signals. Enables integration with alternative backends like Redis, MongoDB, or S3.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>Ctor</code>: Custom <code>PersistBase</code> constructor implementing <code>IPersistBase&lt;SignalData&gt;</code></li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">PersistSignalAdapter</span><span class="hl-2">, </span><span class="hl-6">PersistBase</span><span class="hl-2">, </span><span class="hl-6">IPersistBase</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> </span><span class="hl-6">Redis</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;ioredis&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Custom Redis adapter</span><br/><span class="hl-3">class</span><span class="hl-2"> </span><span class="hl-11">RedisPersistSignal</span><span class="hl-2"> </span><span class="hl-3">extends</span><span class="hl-2"> </span><span class="hl-11">PersistBase</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">private</span><span class="hl-2"> </span><span class="hl-6">redis</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Redis</span><span class="hl-2">();</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-1">readValue</span><span class="hl-2">(</span><span class="hl-6">entityId</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">): </span><span class="hl-11">Promise</span><span class="hl-2">&lt;</span><span class="hl-11">SignalData</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">json</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">redis</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-4">`signal:</span><span class="hl-3">${</span><span class="hl-3">this</span><span class="hl-9">.</span><span class="hl-6">entityName</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-3">${</span><span class="hl-6">entityId</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">json</span><span class="hl-2"> ? </span><span class="hl-8">JSON</span><span class="hl-2">.</span><span class="hl-1">parse</span><span class="hl-2">(</span><span class="hl-6">json</span><span class="hl-2">) : </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-1">writeValue</span><span class="hl-2">(</span><span class="hl-6">entityId</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-6">entity</span><span class="hl-2">: </span><span class="hl-11">SignalData</span><span class="hl-2">): </span><span class="hl-11">Promise</span><span class="hl-2">&lt;</span><span class="hl-11">void</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">key</span><span class="hl-2"> = </span><span class="hl-4">`signal:</span><span class="hl-3">${</span><span class="hl-3">this</span><span class="hl-9">.</span><span class="hl-6">entityName</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-3">${</span><span class="hl-6">entityId</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">entity</span><span class="hl-2"> === </span><span class="hl-3">null</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">redis</span><span class="hl-2">.</span><span class="hl-1">del</span><span class="hl-2">(</span><span class="hl-6">key</span><span class="hl-2">);</span><br/><span class="hl-2">    } </span><span class="hl-5">else</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">redis</span><span class="hl-2">.</span><span class="hl-1">set</span><span class="hl-2">(</span><span class="hl-6">key</span><span class="hl-2">, </span><span class="hl-8">JSON</span><span class="hl-2">.</span><span class="hl-1">stringify</span><span class="hl-2">(</span><span class="hl-6">entity</span><span class="hl-2">));</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-1">hasValue</span><span class="hl-2">(</span><span class="hl-6">entityId</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">): </span><span class="hl-11">Promise</span><span class="hl-2">&lt;</span><span class="hl-11">boolean</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">exists</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">redis</span><span class="hl-2">.</span><span class="hl-1">exists</span><span class="hl-2">(</span><span class="hl-4">`signal:</span><span class="hl-3">${</span><span class="hl-3">this</span><span class="hl-9">.</span><span class="hl-6">entityName</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-3">${</span><span class="hl-6">entityId</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">exists</span><span class="hl-2"> === </span><span class="hl-7">1</span><span class="hl-2">;</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Register custom adapter globally</span><br/><span class="hl-6">PersistSignalAdapter</span><span class="hl-2">.</span><span class="hl-1">usePersistSignalAdapter</span><span class="hl-2">(</span><span class="hl-6">RedisPersistSignal</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// All subsequent signal persistence operations will use Redis</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="risk-persistence" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Risk Persistence<a href="#risk-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>PersistRiskUtils</code> manages persistence of portfolio-wide active positions for risk limit enforcement. Each risk profile maintains a map of active positions across all strategies.</p>
<p><strong>Purpose:</strong> Store the <code>_activePositionsMap</code> from <code>ClientRisk</code> to enforce <code>maxConcurrentPositions</code> constraints after crashes. Without persistence, risk limits would reset to zero on restart, allowing unlimited new positions.</p>
<p><strong>Adapter Instance:</strong></p>
<pre><code class="typescript"><span class="hl-5">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">PersistRiskAdapter</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">PersistRiskUtils</span><span class="hl-2">();</span>
</code><button type="button">Copy</button></pre>

<p>Global singleton instance used by <code>ClientRisk</code>.</p>
<p><strong>Data Type:</strong></p>
<pre><code class="typescript"><span class="hl-3">type</span><span class="hl-2"> </span><span class="hl-11">RiskData</span><span class="hl-2"> = </span><span class="hl-11">Array</span><span class="hl-2">&lt;[</span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-11">IRiskActivePosition</span><span class="hl-2">]&gt;;</span><br/><br/><span class="hl-0">// Serialized form of Map&lt;string, IRiskActivePosition&gt;</span><br/><span class="hl-0">// Each tuple: [key, value]</span><br/><span class="hl-0">// Key format: &quot;{symbol}:{strategyName}:{signalId}&quot;</span><br/><br/><span class="hl-0">// IRiskActivePosition contains:</span><br/><span class="hl-0">// - symbol: string</span><br/><span class="hl-0">// - strategyName: string</span><br/><span class="hl-0">// - signalId: string</span><br/><span class="hl-0">// - position: &quot;long&quot; | &quot;short&quot;</span><br/><span class="hl-0">// - priceOpen: number</span><br/><span class="hl-0">// - quantity: number</span><br/><span class="hl-0">// - addedAt: number (timestamp)</span>
</code><button type="button">Copy</button></pre>

<p><strong>File Location:</strong></p>
<pre><code><span class="hl-2">./</span><span class="hl-6">dump</span><span class="hl-2">/</span><span class="hl-6">data</span><span class="hl-2">/</span><span class="hl-6">risk</span><span class="hl-2">/{</span><span class="hl-6">riskName</span><span class="hl-2">}/</span><span class="hl-6">positions</span><span class="hl-2">.</span><span class="hl-6">json</span>
</code><button>Copy</button></pre>

<p>Example: <code>./dump/data/risk/my-risk/positions.json</code></p>
<p><strong>Storage Pattern:</strong></p>
<ul>
<li><strong>Key</strong>: Fixed string <code>&quot;positions&quot;</code> (single file per risk profile)</li>
<li><strong>Value</strong>: <code>Array&lt;[string, IRiskActivePosition]&gt;</code> (Map entries serialized as array)</li>
<li><strong>Memoization</strong>: Cached by <code>riskName</code></li>
</ul>
<hr>
<a id="methods-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Methods<a href="#methods-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="persistriskadapterreadpositiondatariskname-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistRiskAdapter.readPositionData(riskName): Promise&lt;RiskData&gt;</code><a href="#persistriskadapterreadpositiondatariskname-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Reads persisted active positions for a risk profile. Called by <code>ClientRisk.waitForInit()</code> to restore portfolio state.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>riskName</code>: Risk profile identifier</li>
</ul>
<p><strong>Returns:</strong> Promise resolving to <code>RiskData</code> (empty array if no positions)</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">PersistRiskAdapter</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Called during ClientRisk initialization (live mode only)</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">positions</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">PersistRiskAdapter</span><span class="hl-2">.</span><span class="hl-1">readPositionData</span><span class="hl-2">(</span><span class="hl-4">&quot;my-risk&quot;</span><span class="hl-2">);</span><br/><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Restored </span><span class="hl-3">${</span><span class="hl-6">positions</span><span class="hl-9">.</span><span class="hl-6">length</span><span class="hl-3">}</span><span class="hl-4"> active positions`</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Reconstruct Map from array</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">positionsMap</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Map</span><span class="hl-2">(</span><span class="hl-6">positions</span><span class="hl-2">);</span><br/><span class="hl-5">for</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> [</span><span class="hl-8">key</span><span class="hl-2">, </span><span class="hl-8">position</span><span class="hl-2">] </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">positionsMap</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Position: </span><span class="hl-3">${</span><span class="hl-6">position</span><span class="hl-9">.</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4"> </span><span class="hl-3">${</span><span class="hl-6">position</span><span class="hl-9">.</span><span class="hl-6">position</span><span class="hl-3">}</span><span class="hl-4"> @ </span><span class="hl-3">${</span><span class="hl-6">position</span><span class="hl-9">.</span><span class="hl-6">priceOpen</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="persistriskadapterwritepositiondatariskdata-riskname-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistRiskAdapter.writePositionData(riskData, riskName): Promise&lt;void&gt;</code><a href="#persistriskadapterwritepositiondatariskdata-riskname-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Writes active positions to disk with atomic file writes. Called by <code>ClientRisk</code> after <code>addSignal()</code> / <code>removeSignal()</code> operations.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>riskData</code>: Risk data to persist (<code>RiskData</code>)</li>
<li><code>riskName</code>: Risk profile identifier</li>
</ul>
<p><strong>Returns:</strong> Promise that resolves when write completes</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">PersistRiskAdapter</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Called by ClientRisk after adding/removing signals (live mode only)</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">activePositionsMap</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Map</span><span class="hl-2">([</span><br/><span class="hl-2">  [</span><span class="hl-4">&quot;BTCUSDT:my-strategy:abc123&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">    </span><span class="hl-6">symbol:</span><span class="hl-2"> </span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">signalId:</span><span class="hl-2"> </span><span class="hl-4">&quot;abc123&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-4">&quot;long&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">priceOpen:</span><span class="hl-2"> </span><span class="hl-7">50000</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">quantity:</span><span class="hl-2"> </span><span class="hl-7">0.1</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">addedAt:</span><span class="hl-2"> </span><span class="hl-6">Date</span><span class="hl-2">.</span><span class="hl-1">now</span><span class="hl-2">()</span><br/><span class="hl-2">  }]</span><br/><span class="hl-2">]);</span><br/><br/><span class="hl-0">// Convert Map to array for JSON serialization</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">riskData</span><span class="hl-2">: </span><span class="hl-11">RiskData</span><span class="hl-2"> = </span><span class="hl-6">Array</span><span class="hl-2">.</span><span class="hl-1">from</span><span class="hl-2">(</span><span class="hl-6">activePositionsMap</span><span class="hl-2">.</span><span class="hl-1">entries</span><span class="hl-2">());</span><br/><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">PersistRiskAdapter</span><span class="hl-2">.</span><span class="hl-1">writePositionData</span><span class="hl-2">(</span><span class="hl-6">riskData</span><span class="hl-2">, </span><span class="hl-4">&quot;my-risk&quot;</span><span class="hl-2">);</span><br/><span class="hl-0">// Positions atomically written to ./dump/data/risk/my-risk/positions.json</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="persistriskadapterusepersistriskadapterctor-void" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistRiskAdapter.usePersistRiskAdapter(Ctor): void</code><a href="#persistriskadapterusepersistriskadapterctor-void" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Registers a custom persistence adapter for risk positions. See <a href="#signal-persistence">Signal Persistence</a> for custom adapter pattern example.</p>
<hr>
<a id="schedule-persistence" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Schedule Persistence<a href="#schedule-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>PersistScheduleUtils</code> manages persistence of scheduled signals awaiting price activation. Each symbol-strategy pair maintains a single scheduled signal (limit order) at a time.</p>
<p><strong>Purpose:</strong> Store signals with <code>priceOpen</code> specified that are waiting for market price to reach entry level. After crashes, scheduled signals can resume monitoring without re-generating from <code>getSignal()</code>.</p>
<p><strong>Adapter Instance:</strong></p>
<pre><code class="typescript"><span class="hl-5">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">PersistScheduleAdapter</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">PersistScheduleUtils</span><span class="hl-2">();</span>
</code><button type="button">Copy</button></pre>

<p>Global singleton instance used by <code>ClientStrategy</code>.</p>
<p><strong>Data Type:</strong></p>
<pre><code class="typescript"><span class="hl-3">type</span><span class="hl-2"> </span><span class="hl-11">ScheduleData</span><span class="hl-2"> = </span><span class="hl-11">IScheduledSignalRow</span><span class="hl-2"> | </span><span class="hl-11">null</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// IScheduledSignalRow contains:</span><br/><span class="hl-0">// - All fields from ISignalRow</span><br/><span class="hl-0">// - scheduledAt: number (timestamp when signal was scheduled)</span><br/><span class="hl-0">// - priceOpen: number (entry price target)</span><br/><span class="hl-0">// - Awaiting: price to reach priceOpen OR timeout OR SL hit</span>
</code><button type="button">Copy</button></pre>

<p><strong>File Location:</strong></p>
<pre><code><span class="hl-2">./</span><span class="hl-6">dump</span><span class="hl-2">/</span><span class="hl-6">data</span><span class="hl-2">/</span><span class="hl-6">schedule</span><span class="hl-2">/{</span><span class="hl-6">symbol</span><span class="hl-2">}</span><span class="hl-6">_</span><span class="hl-2">{</span><span class="hl-6">strategyName</span><span class="hl-2">}/{</span><span class="hl-6">symbol</span><span class="hl-2">}.</span><span class="hl-6">json</span>
</code><button>Copy</button></pre>

<p>Example: <code>./dump/data/schedule/BTCUSDT_my-strategy/BTCUSDT.json</code></p>
<p><strong>Storage Pattern:</strong></p>
<ul>
<li><strong>Key</strong>: <code>symbol</code> (e.g., &quot;BTCUSDT&quot;)</li>
<li><strong>Value</strong>: <code>IScheduledSignalRow | null</code> (null when no scheduled signal)</li>
<li><strong>Memoization</strong>: Cached by <code>${symbol}:${strategyName}</code> composite key</li>
</ul>
<hr>
<a id="methods-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Methods<a href="#methods-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="persistscheduleadapterreadscheduledatasymbol-strategyname-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistScheduleAdapter.readScheduleData(symbol, strategyName): Promise&lt;IScheduledSignalRow | null&gt;</code><a href="#persistscheduleadapterreadscheduledatasymbol-strategyname-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Reads persisted scheduled signal data. Called by <code>ClientStrategy.waitForInit()</code> to restore scheduled signals.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol</code>: Trading pair symbol</li>
<li><code>strategyName</code>: Strategy identifier</li>
</ul>
<p><strong>Returns:</strong> Promise resolving to scheduled signal or <code>null</code></p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">PersistScheduleAdapter</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Called during ClientStrategy initialization (live mode only)</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">scheduled</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">PersistScheduleAdapter</span><span class="hl-2">.</span><span class="hl-1">readScheduleData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">scheduled</span><span class="hl-2"> !== </span><span class="hl-3">null</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Restored scheduled signal </span><span class="hl-3">${</span><span class="hl-6">scheduled</span><span class="hl-9">.</span><span class="hl-6">id</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Waiting for price to reach </span><span class="hl-3">${</span><span class="hl-6">scheduled</span><span class="hl-9">.</span><span class="hl-6">priceOpen</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="persistscheduleadapterwritescheduledatascheduledsignalrow-symbol-strategyname-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistScheduleAdapter.writeScheduleData(scheduledSignalRow, symbol, strategyName): Promise&lt;void&gt;</code><a href="#persistscheduleadapterwritescheduledatascheduledsignalrow-symbol-strategyname-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Writes scheduled signal data to disk. Called by <code>ClientStrategy.setScheduledSignal()</code> in live mode.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>scheduledSignalRow</code>: Scheduled signal data (<code>IScheduledSignalRow | null</code>)</li>
<li><code>symbol</code>: Trading pair symbol</li>
<li><code>strategyName</code>: Strategy identifier</li>
</ul>
<p><strong>Returns:</strong> Promise that resolves when write completes</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">PersistScheduleAdapter</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Called by ClientStrategy after scheduling a signal (live mode only)</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">scheduled</span><span class="hl-2">: </span><span class="hl-11">IScheduledSignalRow</span><span class="hl-2"> = {</span><br/><span class="hl-2">  </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;abc123&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-4">&quot;long&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">priceOpen:</span><span class="hl-2"> </span><span class="hl-7">49500</span><span class="hl-2">,  </span><span class="hl-0">// Limit order entry price</span><br/><span class="hl-2">  </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> </span><span class="hl-7">52000</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> </span><span class="hl-7">49000</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">scheduledAt:</span><span class="hl-2"> </span><span class="hl-6">Date</span><span class="hl-2">.</span><span class="hl-1">now</span><span class="hl-2">(),</span><br/><span class="hl-2">  </span><span class="hl-0">// ... other fields</span><br/><span class="hl-2">};</span><br/><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">PersistScheduleAdapter</span><span class="hl-2">.</span><span class="hl-1">writeScheduleData</span><span class="hl-2">(</span><span class="hl-6">scheduled</span><span class="hl-2">, </span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-0">// Scheduled signal written to ./dump/data/schedule/BTCUSDT_my-strategy/BTCUSDT.json</span><br/><br/><span class="hl-0">// When scheduled signal activates or cancels, write null</span><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">PersistScheduleAdapter</span><span class="hl-2">.</span><span class="hl-1">writeScheduleData</span><span class="hl-2">(</span><span class="hl-3">null</span><span class="hl-2">, </span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="persistscheduleadapterusepersistscheduleadapterctor-void" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistScheduleAdapter.usePersistScheduleAdapter(Ctor): void</code><a href="#persistscheduleadapterusepersistscheduleadapterctor-void" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Registers a custom persistence adapter for scheduled signals. See <a href="#signal-persistence">Signal Persistence</a> for custom adapter pattern example.</p>
<hr>
<a id="partial-persistence" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Partial Persistence<a href="#partial-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>PersistPartialUtils</code> manages persistence of profit/loss milestone levels reached per signal. Tracks which percentage thresholds (10%, 20%, 30%, etc) have been emitted for deduplication.</p>
<p><strong>Purpose:</strong> Store the <code>profitLevels</code> and <code>lossLevels</code> Sets from <code>ClientPartial</code> so that milestone events are not re-emitted after crashes. Without persistence, all levels would reset and be re-emitted when price is checked again.</p>
<p><strong>Adapter Instance:</strong></p>
<pre><code class="typescript"><span class="hl-5">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">PersistPartialAdapter</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">PersistPartialUtils</span><span class="hl-2">();</span>
</code><button type="button">Copy</button></pre>

<p>Global singleton instance used by <code>ClientPartial</code>.</p>
<p><strong>Data Type:</strong></p>
<pre><code class="typescript"><span class="hl-3">type</span><span class="hl-2"> </span><span class="hl-11">PartialData</span><span class="hl-2"> = </span><span class="hl-11">Record</span><span class="hl-2">&lt;</span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-11">IPartialData</span><span class="hl-2">&gt;;</span><br/><br/><span class="hl-0">// Record mapping signal IDs to their partial state</span><br/><span class="hl-0">// Key: signalId (string)</span><br/><span class="hl-0">// Value: IPartialData</span><br/><br/><span class="hl-0">// IPartialData contains:</span><br/><span class="hl-0">// - profitLevels: PartialLevel[] (array of reached profit levels)</span><br/><span class="hl-0">// - lossLevels: PartialLevel[] (array of reached loss levels)</span><br/><br/><span class="hl-0">// PartialLevel = 10 | 20 | 30 | 40 | 50 | 60 | 70 | 80 | 90 | 100</span>
</code><button type="button">Copy</button></pre>

<p><strong>File Location:</strong></p>
<pre><code><span class="hl-2">./</span><span class="hl-6">dump</span><span class="hl-2">/</span><span class="hl-6">data</span><span class="hl-2">/</span><span class="hl-6">partial</span><span class="hl-2">/{</span><span class="hl-6">symbol</span><span class="hl-2">}</span><span class="hl-6">_</span><span class="hl-2">{</span><span class="hl-6">strategyName</span><span class="hl-2">}/</span><span class="hl-6">levels</span><span class="hl-2">.</span><span class="hl-6">json</span>
</code><button>Copy</button></pre>

<p>Example: <code>./dump/data/partial/BTCUSDT_my-strategy/levels.json</code></p>
<p><strong>Storage Pattern:</strong></p>
<ul>
<li><strong>Key</strong>: Fixed string <code>&quot;levels&quot;</code> (single file per symbol-strategy pair)</li>
<li><strong>Value</strong>: <code>Record&lt;signalId, IPartialData&gt;</code> (all signals' partial states in one file)</li>
<li><strong>Memoization</strong>: Cached by <code>${symbol}:${strategyName}</code> composite key</li>
</ul>
<hr>
<a id="methods-3" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Methods<a href="#methods-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="persistpartialadapterreadpartialdatasymbol-strategyname-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistPartialAdapter.readPartialData(symbol, strategyName): Promise&lt;PartialData&gt;</code><a href="#persistpartialadapterreadpartialdatasymbol-strategyname-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Reads persisted partial data for all signals under a symbol-strategy pair. Called by <code>ClientPartial.waitForInit()</code>.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol</code>: Trading pair symbol</li>
<li><code>strategyName</code>: Strategy identifier</li>
</ul>
<p><strong>Returns:</strong> Promise resolving to <code>PartialData</code> (empty object if no data)</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">PersistPartialAdapter</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Called during ClientPartial initialization (live mode only)</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">partialData</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">PersistPartialAdapter</span><span class="hl-2">.</span><span class="hl-1">readPartialData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Restored partial state for </span><span class="hl-3">${</span><span class="hl-6">Object</span><span class="hl-9">.</span><span class="hl-1">keys</span><span class="hl-9">(</span><span class="hl-6">partialData</span><span class="hl-9">).</span><span class="hl-6">length</span><span class="hl-3">}</span><span class="hl-4"> signals`</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Reconstruct Sets from arrays</span><br/><span class="hl-5">for</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> [</span><span class="hl-8">signalId</span><span class="hl-2">, </span><span class="hl-8">data</span><span class="hl-2">] </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">Object</span><span class="hl-2">.</span><span class="hl-1">entries</span><span class="hl-2">(</span><span class="hl-6">partialData</span><span class="hl-2">)) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">profitLevels</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Set</span><span class="hl-2">(</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">profitLevels</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">lossLevels</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Set</span><span class="hl-2">(</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">lossLevels</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Signal </span><span class="hl-3">${</span><span class="hl-6">signalId</span><span class="hl-3">}</span><span class="hl-4">:`</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`  Profit levels reached: </span><span class="hl-3">${</span><span class="hl-6">Array</span><span class="hl-9">.</span><span class="hl-1">from</span><span class="hl-9">(</span><span class="hl-6">profitLevels</span><span class="hl-9">).</span><span class="hl-1">join</span><span class="hl-9">(</span><span class="hl-4">&quot;, &quot;</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%`</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`  Loss levels reached: </span><span class="hl-3">${</span><span class="hl-6">Array</span><span class="hl-9">.</span><span class="hl-1">from</span><span class="hl-9">(</span><span class="hl-6">lossLevels</span><span class="hl-9">).</span><span class="hl-1">join</span><span class="hl-9">(</span><span class="hl-4">&quot;, &quot;</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%`</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="persistpartialadapterwritepartialdatapartialdata-symbol-strategyname-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistPartialAdapter.writePartialData(partialData, symbol, strategyName): Promise&lt;void&gt;</code><a href="#persistpartialadapterwritepartialdatapartialdata-symbol-strategyname-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Writes partial data to disk with atomic file writes. Called by <code>ClientPartial._persistState()</code> after profit/loss level changes.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>partialData</code>: Partial data to persist (<code>PartialData</code>)</li>
<li><code>symbol</code>: Trading pair symbol</li>
<li><code>strategyName</code>: Strategy identifier</li>
</ul>
<p><strong>Returns:</strong> Promise that resolves when write completes</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">PersistPartialAdapter</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Called by ClientPartial after profit/loss levels change (live mode only)</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">partialData</span><span class="hl-2">: </span><span class="hl-11">PartialData</span><span class="hl-2"> = {</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;abc123&quot;</span><span class="hl-6">:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">profitLevels:</span><span class="hl-2"> [</span><span class="hl-7">10</span><span class="hl-2">, </span><span class="hl-7">20</span><span class="hl-2">],  </span><span class="hl-0">// Signal reached 10% and 20% profit</span><br/><span class="hl-2">    </span><span class="hl-6">lossLevels:</span><span class="hl-2"> []</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;def456&quot;</span><span class="hl-6">:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">profitLevels:</span><span class="hl-2"> [</span><span class="hl-7">10</span><span class="hl-2">],</span><br/><span class="hl-2">    </span><span class="hl-6">lossLevels:</span><span class="hl-2"> [</span><span class="hl-7">10</span><span class="hl-2">, </span><span class="hl-7">20</span><span class="hl-2">]  </span><span class="hl-0">// Signal reached -10% and -20% loss</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">};</span><br/><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">PersistPartialAdapter</span><span class="hl-2">.</span><span class="hl-1">writePartialData</span><span class="hl-2">(</span><span class="hl-6">partialData</span><span class="hl-2">, </span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-0">// Partial state written to ./dump/data/partial/BTCUSDT_my-strategy/levels.json</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="persistpartialadapterusepersistpartialadapterctor-void" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>PersistPartialAdapter.usePersistPartialAdapter(Ctor): void</code><a href="#persistpartialadapterusepersistpartialadapterctor-void" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Registers a custom persistence adapter for partial data. See <a href="#signal-persistence">Signal Persistence</a> for custom adapter pattern example.</p>
<hr>
<a id="crash-recovery-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Crash Recovery Flow<a href="#crash-recovery-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>Live Trading Restart Sequence</strong></p>
<p><img src="../media/21_Persistence_Utilities_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram 4: Complete Crash Recovery Flow with Multi-Domain State Restoration</strong></p>
<p>When <code>Live.background()</code> is called after a crash:</p>
<ol>
<li>
<p><strong>Strategy State Recovery</strong>:</p>
<ul>
<li><code>ClientStrategy.waitForInit()</code> loads active signal from <code>PersistSignalAdapter</code></li>
<li>Scheduled signals loaded from <code>PersistScheduleAdapter</code></li>
<li>Partial levels loaded from <code>PersistPartialAdapter</code> (per signal)</li>
</ul>
</li>
<li>
<p><strong>Risk State Recovery</strong>:</p>
<ul>
<li><code>ClientRisk.waitForInit()</code> loads <code>_activePositionsMap</code> from <code>PersistRiskAdapter</code></li>
<li>Portfolio limits immediately enforced with restored positions</li>
</ul>
</li>
<li>
<p><strong>Resume Execution</strong>:</p>
<ul>
<li><code>tick()</code> continues monitoring active signals for TP/SL/time</li>
<li>New state changes atomically persisted after each tick</li>
<li>System operates as if crash never occurred</li>
</ul>
</li>
</ol>
<p><strong>Critical Guarantee</strong>: Because state is persisted after every tick, the maximum loss window is one tick interval (typically 1 minute for live mode).</p>
<hr>
<a id="api-methods" class="tsd-anchor"></a><h3 class="tsd-anchor-link">API Methods<a href="#api-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="schedulegetdatasymbol-string-strategyname-string-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>Schedule.getData(symbol: string, strategyName: string): Promise&lt;ScheduleStatistics&gt;</code><a href="#schedulegetdatasymbol-string-strategyname-string-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Retrieves aggregated scheduled signal statistics for a specific symbol-strategy pair.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol</code>: Trading pair symbol (e.g., &quot;BTCUSDT&quot;)</li>
<li><code>strategyName</code>: Strategy name to query</li>
</ul>
<p><strong>Returns:</strong> Promise resolving to <code>ScheduleStatistics</code> object</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">Schedule</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// After backtest or live trading execution</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">stats</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Schedule</span><span class="hl-2">.</span><span class="hl-1">getData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Total scheduled events: </span><span class="hl-3">${</span><span class="hl-6">stats</span><span class="hl-9">.</span><span class="hl-6">totalEvents</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Scheduled signals: </span><span class="hl-3">${</span><span class="hl-6">stats</span><span class="hl-9">.</span><span class="hl-6">totalScheduled</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Activated signals: </span><span class="hl-3">${</span><span class="hl-6">stats</span><span class="hl-9">.</span><span class="hl-6">totalOpened</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Cancelled signals: </span><span class="hl-3">${</span><span class="hl-6">stats</span><span class="hl-9">.</span><span class="hl-6">totalCancelled</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">stats</span><span class="hl-2">.</span><span class="hl-6">cancellationRate</span><span class="hl-2"> !== </span><span class="hl-3">null</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Cancellation rate: </span><span class="hl-3">${</span><span class="hl-6">stats</span><span class="hl-9">.</span><span class="hl-6">cancellationRate</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%`</span><span class="hl-2">);</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">stats</span><span class="hl-2">.</span><span class="hl-6">avgActivationTime</span><span class="hl-2"> !== </span><span class="hl-3">null</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Average activation time: </span><span class="hl-3">${</span><span class="hl-6">stats</span><span class="hl-9">.</span><span class="hl-6">avgActivationTime</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">2</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4"> minutes`</span><span class="hl-2">);</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Analyze individual events</span><br/><span class="hl-6">stats</span><span class="hl-2">.</span><span class="hl-6">eventList</span><span class="hl-2">.</span><span class="hl-1">forEach</span><span class="hl-2">(</span><span class="hl-6">event</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">event</span><span class="hl-2">.</span><span class="hl-6">action</span><span class="hl-2"> === </span><span class="hl-4">&quot;cancelled&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Signal </span><span class="hl-3">${</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">signalId</span><span class="hl-3">}</span><span class="hl-4"> cancelled after </span><span class="hl-3">${</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">duration</span><span class="hl-3">}</span><span class="hl-4"> minutes`</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="schedulegetreportsymbol-string-strategyname-string-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>Schedule.getReport(symbol: string, strategyName: string): Promise&lt;string&gt;</code><a href="#schedulegetreportsymbol-string-strategyname-string-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Generates a markdown-formatted report of all scheduled signal events.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol</code>: Trading pair symbol</li>
<li><code>strategyName</code>: Strategy name to generate report for</li>
</ul>
<p><strong>Returns:</strong> Promise resolving to markdown-formatted string</p>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">Schedule</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">markdown</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Schedule</span><span class="hl-2">.</span><span class="hl-1">getReport</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">markdown</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Output format:</span><br/><span class="hl-0">// # Scheduled Signals Report: my-strategy</span><br/><span class="hl-0">// </span><br/><span class="hl-0">// | Timestamp | Action | Symbol | Signal ID | Position | Entry Price | Wait Time (min) |</span><br/><span class="hl-0">// | --- | --- | --- | --- | --- | --- | --- |</span><br/><span class="hl-0">// | 2024-01-01T10:00:00Z | SCHEDULED | BTCUSDT | abc123 | LONG | 94900.00 USD | N/A |</span><br/><span class="hl-0">// | 2024-01-01T10:15:00Z | OPENED | BTCUSDT | abc123 | LONG | 94900.00 USD | 15 |</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="scheduledumpsymbol-string-strategyname-string-path-string-promise" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>Schedule.dump(symbol: string, strategyName: string, path?: string): Promise&lt;void&gt;</code><a href="#scheduledumpsymbol-string-strategyname-string-path-string-promise" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Saves the scheduled signal report to disk as a markdown file.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>symbol</code>: Trading pair symbol</li>
<li><code>strategyName</code>: Strategy name to save report for</li>
<li><code>path</code>: Optional directory path (default: &quot;./dump/schedule&quot;)</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">Schedule</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Save to default path: ./dump/schedule/my-strategy.md</span><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Schedule</span><span class="hl-2">.</span><span class="hl-1">dump</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Save to custom path</span><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Schedule</span><span class="hl-2">.</span><span class="hl-1">dump</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;./reports/schedule&quot;</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="event-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Integration<a href="#event-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The Schedule API automatically subscribes to signal events and filters for scheduled lifecycle events:</p>
<p><img src="../media/21_Persistence_Utilities_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Schedule Event Data Flow from Signal Scheduling to Public API</strong></p>
<p>When <code>getSignal()</code> returns a signal with <code>priceOpen</code> specified, a scheduled signal is created. The framework monitors market price continuously, checking if the entry price is reached, stop loss is hit, or timeout occurs (configured via <code>CC_SCHEDULE_AWAIT_MINUTES</code>). All lifecycle events (scheduled, opened, cancelled) are emitted via <code>signalEmitter</code>. The <code>ScheduleMarkdownService</code> filters and aggregates these events, storing them in a <code>ReportStorage</code> instance accessible via the public API.</p>
<hr>
<a id="comparison-table" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Comparison Table<a href="#comparison-table" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Feature</th>
<th>Partial API</th>
<th>Schedule API</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Purpose</strong></td>
<td>Track profit/loss milestones during active signals</td>
<td>Track scheduled signal activation/cancellation</td>
</tr>
<tr>
<td><strong>Event Source</strong></td>
<td><code>partialProfitSubject</code>, <code>partialLossSubject</code></td>
<td><code>signalEmitter</code> (filtered for scheduled actions)</td>
</tr>
<tr>
<td><strong>Primary Metrics</strong></td>
<td>Profit/loss milestone counts, level distribution</td>
<td>Activation rate, cancellation rate, wait times</td>
</tr>
<tr>
<td><strong>Applies To</strong></td>
<td>All active signals (scheduled and immediate)</td>
<td>Only scheduled signals (with <code>priceOpen</code>)</td>
</tr>
<tr>
<td><strong>Event Frequency</strong></td>
<td>Multiple per signal (10%, 20%, 30%...)</td>
<td>1-2 per signal (scheduled → opened/cancelled)</td>
</tr>
<tr>
<td><strong>Backtest Support</strong></td>
<td>✅ Yes</td>
<td>✅ Yes</td>
</tr>
<tr>
<td><strong>Live Support</strong></td>
<td>✅ Yes</td>
<td>✅ Yes</td>
</tr>
<tr>
<td><strong>Report Location</strong></td>
<td><code>./dump/partial/</code></td>
<td><code>./dump/schedule/</code></td>
</tr>
</tbody>
</table>
<hr>
<a id="service-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Architecture<a href="#service-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Both APIs are implemented as markdown services that aggregate event data into queryable statistics:</p>
<p><img src="../media/21_Persistence_Utilities_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Service Architecture Connecting Strategy Execution to Public APIs</strong></p>
<p>The <code>ClientStrategy</code> class emits events during signal monitoring. These events flow through typed subjects (<code>partialProfitSubject</code>, <code>partialLossSubject</code>, <code>signalEmitter</code>) to markdown services. Each service maintains a memoized <code>ReportStorage</code> instance per symbol-strategy pair, ensuring isolated data collection. The public API facades (<code>Partial</code>, <code>Schedule</code>) provide simplified access to the underlying service methods.</p>
<hr>
<a id="usage-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage Patterns<a href="#usage-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="pattern-1-post-backtest-analysis" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 1: Post-Backtest Analysis<a href="#pattern-1-post-backtest-analysis" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">Backtest</span><span class="hl-2">, </span><span class="hl-6">Partial</span><span class="hl-2">, </span><span class="hl-6">Schedule</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Run backtest</span><br/><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-4">&quot;binance&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">frameName:</span><span class="hl-2"> </span><span class="hl-4">&quot;1d-jan-2024&quot;</span><br/><span class="hl-2">})) {</span><br/><span class="hl-2">  </span><span class="hl-0">// Process results</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Analyze partial profit/loss milestones</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">partialStats</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Partial</span><span class="hl-2">.</span><span class="hl-1">getData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Profit milestones: </span><span class="hl-3">${</span><span class="hl-6">partialStats</span><span class="hl-9">.</span><span class="hl-6">totalProfit</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Loss milestones: </span><span class="hl-3">${</span><span class="hl-6">partialStats</span><span class="hl-9">.</span><span class="hl-6">totalLoss</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Analyze scheduled signal performance</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">scheduleStats</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Schedule</span><span class="hl-2">.</span><span class="hl-1">getData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Activation rate: </span><span class="hl-3">${</span><span class="hl-6">scheduleStats</span><span class="hl-9">.</span><span class="hl-6">activationRate</span><span class="hl-3">}</span><span class="hl-4">%`</span><span class="hl-2">);</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Avg activation time: </span><span class="hl-3">${</span><span class="hl-6">scheduleStats</span><span class="hl-9">.</span><span class="hl-6">avgActivationTime</span><span class="hl-3">}</span><span class="hl-4"> min`</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Save reports</span><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Partial</span><span class="hl-2">.</span><span class="hl-1">dump</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Schedule</span><span class="hl-2">.</span><span class="hl-1">dump</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="pattern-2-live-trading-monitoring" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 2: Live Trading Monitoring<a href="#pattern-2-live-trading-monitoring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">Live</span><span class="hl-2">, </span><span class="hl-6">Partial</span><span class="hl-2">, </span><span class="hl-6">Schedule</span><span class="hl-2">, </span><span class="hl-6">listenSignalLive</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Start live trading</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">cancel</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Live</span><span class="hl-2">.</span><span class="hl-1">background</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-4">&quot;binance&quot;</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Periodic monitoring</span><br/><span class="hl-1">setInterval</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-0">// Check partial milestone progress</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">partialStats</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Partial</span><span class="hl-2">.</span><span class="hl-1">getData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">partialStats</span><span class="hl-2">.</span><span class="hl-6">totalLoss</span><span class="hl-2"> &gt; </span><span class="hl-7">5</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">warn</span><span class="hl-2">(</span><span class="hl-4">&quot;Multiple loss milestones detected!&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Check scheduled signal activation</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">scheduleStats</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Schedule</span><span class="hl-2">.</span><span class="hl-1">getData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">scheduleStats</span><span class="hl-2">.</span><span class="hl-6">cancellationRate</span><span class="hl-2"> &gt; </span><span class="hl-7">50</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">warn</span><span class="hl-2">(</span><span class="hl-4">&quot;High cancellation rate - consider adjusting entry logic&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}, </span><span class="hl-7">60000</span><span class="hl-2">); </span><span class="hl-0">// Check every minute</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="pattern-3-strategy-optimization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 3: Strategy Optimization<a href="#pattern-3-strategy-optimization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">Backtest</span><span class="hl-2">, </span><span class="hl-6">Partial</span><span class="hl-2">, </span><span class="hl-6">Schedule</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">evaluateEntryPriceStrategy</span><span class="hl-2">(</span><span class="hl-6">entryOffset</span><span class="hl-2">: </span><span class="hl-11">number</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-0">// Run backtest with specific entry price offset</span><br/><span class="hl-2">  </span><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">    </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">`test-entry-</span><span class="hl-3">${</span><span class="hl-6">entryOffset</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-4">&quot;binance&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">frameName:</span><span class="hl-2"> </span><span class="hl-4">&quot;1d-jan-2024&quot;</span><br/><span class="hl-2">  })) {</span><br/><span class="hl-2">    </span><span class="hl-0">// Process</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Analyze scheduled signal effectiveness</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">scheduleStats</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Schedule</span><span class="hl-2">.</span><span class="hl-1">getData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">`test-entry-</span><span class="hl-3">${</span><span class="hl-6">entryOffset</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">entryOffset</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">activationRate:</span><span class="hl-2"> </span><span class="hl-6">scheduleStats</span><span class="hl-2">.</span><span class="hl-6">activationRate</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">avgWaitTime:</span><span class="hl-2"> </span><span class="hl-6">scheduleStats</span><span class="hl-2">.</span><span class="hl-6">avgActivationTime</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">cancellationRate:</span><span class="hl-2"> </span><span class="hl-6">scheduleStats</span><span class="hl-2">.</span><span class="hl-6">cancellationRate</span><br/><span class="hl-2">  };</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Test different entry price offsets</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">offsets</span><span class="hl-2"> = [-</span><span class="hl-7">50</span><span class="hl-2">, -</span><span class="hl-7">100</span><span class="hl-2">, -</span><span class="hl-7">150</span><span class="hl-2">, -</span><span class="hl-7">200</span><span class="hl-2">];</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">results</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-11">Promise</span><span class="hl-2">.</span><span class="hl-1">all</span><span class="hl-2">(</span><span class="hl-6">offsets</span><span class="hl-2">.</span><span class="hl-1">map</span><span class="hl-2">(</span><span class="hl-6">evaluateEntryPriceStrategy</span><span class="hl-2">));</span><br/><br/><span class="hl-0">// Find optimal offset</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">best</span><span class="hl-2"> = </span><span class="hl-6">results</span><span class="hl-2">.</span><span class="hl-1">reduce</span><span class="hl-2">((</span><span class="hl-6">best</span><span class="hl-2">, </span><span class="hl-6">curr</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><br/><span class="hl-2">  </span><span class="hl-6">curr</span><span class="hl-2">.</span><span class="hl-6">activationRate</span><span class="hl-2"> &gt; </span><span class="hl-6">best</span><span class="hl-2">.</span><span class="hl-6">activationRate</span><span class="hl-2"> ? </span><span class="hl-6">curr</span><span class="hl-2"> : </span><span class="hl-6">best</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Optimal entry offset: </span><span class="hl-3">${</span><span class="hl-6">best</span><span class="hl-9">.</span><span class="hl-6">entryOffset</span><span class="hl-3">}</span><span class="hl-4"> with </span><span class="hl-3">${</span><span class="hl-6">best</span><span class="hl-9">.</span><span class="hl-6">activationRate</span><span class="hl-3">}</span><span class="hl-4">% activation`</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="data-retention" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Data Retention<a href="#data-retention" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Both APIs use a bounded storage mechanism to prevent memory growth:</p>
<ul>
<li><strong>Maximum Events per Storage</strong>: 250 events per symbol-strategy pair</li>
<li><strong>Storage Type</strong>: FIFO queue (oldest events dropped when limit exceeded)</li>
<li><strong>Isolation</strong>: Each symbol-strategy pair has its own isolated storage instance</li>
<li><strong>Persistence</strong>: Events are only stored in memory (not persisted to disk unless <code>dump()</code> is called)</li>
</ul>
<p>Storage instances are memoized using the pattern <code>${symbol}:${strategyName}</code> as the cache key.</p>
<hr>
<a id="safe-math-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Safe Math Handling<a href="#safe-math-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Both APIs implement safe math validation to handle edge cases:</p>
<ul>
<li><strong>Null for Invalid Values</strong>: Metrics return <code>null</code> instead of <code>NaN</code>, <code>Infinity</code>, or division-by-zero results</li>
<li><strong>Empty Data Handling</strong>: Returns structured objects with zero counts and null metrics when no data exists</li>
<li><strong>Percentage Calculations</strong>: Cancellation rate, activation rate calculated only when denominator &gt; 0</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">stats</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Schedule</span><span class="hl-2">.</span><span class="hl-1">getData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;new-strategy&quot;</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// If no scheduled signals exist yet:</span><br/><span class="hl-0">// stats.totalScheduled === 0</span><br/><span class="hl-0">// stats.cancellationRate === null (safe, not NaN or 0/0)</span><br/><span class="hl-0">// stats.activationRate === null</span><br/><br/><span class="hl-0">// Safe to use in conditionals:</span><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">stats</span><span class="hl-2">.</span><span class="hl-6">cancellationRate</span><span class="hl-2"> !== </span><span class="hl-3">null</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">stats</span><span class="hl-2">.</span><span class="hl-6">cancellationRate</span><span class="hl-2"> &gt; </span><span class="hl-7">50</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">warn</span><span class="hl-2">(</span><span class="hl-4">&quot;High cancellation rate!&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="integration-with-other-apis" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Other APIs<a href="#integration-with-other-apis" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/21_Persistence_Utilities_6.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Integration of Partial and Schedule APIs with Other Framework Components</strong></p>
<p>The Partial and Schedule APIs complement the main execution APIs:</p>
<ul>
<li><strong>Backtest.getData/Live.getData</strong>: Provide complete signal results (closed signals with PNL)</li>
<li><strong>Partial.getData</strong>: Provides milestone tracking during active signal execution</li>
<li><strong>Schedule.getData</strong>: Provides scheduled signal lifecycle analysis</li>
</ul>
<p>All three APIs source data from the same underlying event system, but aggregate different aspects of signal behavior.</p>
<hr>
<a id="configuration-parameters" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Configuration Parameters<a href="#configuration-parameters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="partial-milestones" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Partial Milestones<a href="#partial-milestones" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Profit milestones: hardcoded at 10% intervals (10%, 20%, ... 90%)
Loss milestones: hardcoded at -40% and -80%</p>
<p>These thresholds are defined in the <code>ClientStrategy</code> monitoring logic and cannot be configured via <code>GLOBAL_CONFIG</code>.</p>
<a id="schedule-timeout" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schedule Timeout<a href="#schedule-timeout" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Scheduled signal timeout is controlled by:</p>
<pre><code class="typescript"><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-2">.</span><span class="hl-8">CC_SCHEDULE_AWAIT_MINUTES</span><span class="hl-2"> = </span><span class="hl-7">120</span><span class="hl-2">; </span><span class="hl-0">// default: 120 minutes</span>
</code><button type="button">Copy</button></pre>

<p>If a scheduled signal does not activate within this period, it is cancelled with <code>action=&quot;cancelled&quot;</code>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#persistence-utilities"><span>Persistence <wbr/>Utilities</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#architecture-overview"><span>Architecture <wbr/>Overview</span></a></li><li><a href="#persistbase-abstract-class"><span>Persist<wbr/>Base <wbr/>Abstract <wbr/>Class</span></a></li><li><ul><li><a href="#atomic-write-pattern"><span>Atomic <wbr/>Write <wbr/>Pattern</span></a></li><li><a href="#self-healing-validation"><span>Self-<wbr/>Healing <wbr/>Validation</span></a></li></ul></li><li><a href="#signal-persistence"><span>Signal <wbr/>Persistence</span></a></li><li><ul><li><a href="#methods"><span>Methods</span></a></li><li><ul><li><a href="#persistsignaladapterreadsignaldatasymbol-strategyname-promise"><span>Persist<wbr/>Signal<wbr/>Adapter.read<wbr/>Signal<wbr/>Data(symbol, strategy<wbr/>Name): <wbr/>Promise&lt;ISignal<wbr/>Row | null&gt;</span></a></li><li><a href="#persistsignaladapterwritesignaldatasignalrow-symbol-strategyname-promise"><span>Persist<wbr/>Signal<wbr/>Adapter.write<wbr/>Signal<wbr/>Data(signal<wbr/>Row, symbol, strategy<wbr/>Name): <wbr/>Promise&lt;void&gt;</span></a></li><li><a href="#persistsignaladapterusepersistsignaladapterctor-void"><span>Persist<wbr/>Signal<wbr/>Adapter.use<wbr/>Persist<wbr/>Signal<wbr/>Adapter(<wbr/>Ctor): void</span></a></li></ul></li></ul></li><li><a href="#risk-persistence"><span>Risk <wbr/>Persistence</span></a></li><li><ul><li><a href="#methods-1"><span>Methods</span></a></li><li><ul><li><a href="#persistriskadapterreadpositiondatariskname-promise"><span>Persist<wbr/>Risk<wbr/>Adapter.read<wbr/>Position<wbr/>Data(risk<wbr/>Name): <wbr/>Promise&lt;<wbr/>Risk<wbr/>Data&gt;</span></a></li><li><a href="#persistriskadapterwritepositiondatariskdata-riskname-promise"><span>Persist<wbr/>Risk<wbr/>Adapter.write<wbr/>Position<wbr/>Data(risk<wbr/>Data, risk<wbr/>Name): <wbr/>Promise&lt;void&gt;</span></a></li><li><a href="#persistriskadapterusepersistriskadapterctor-void"><span>Persist<wbr/>Risk<wbr/>Adapter.use<wbr/>Persist<wbr/>Risk<wbr/>Adapter(<wbr/>Ctor): void</span></a></li></ul></li></ul></li><li><a href="#schedule-persistence"><span>Schedule <wbr/>Persistence</span></a></li><li><ul><li><a href="#methods-2"><span>Methods</span></a></li><li><ul><li><a href="#persistscheduleadapterreadscheduledatasymbol-strategyname-promise"><span>Persist<wbr/>Schedule<wbr/>Adapter.read<wbr/>Schedule<wbr/>Data(symbol, strategy<wbr/>Name): <wbr/>Promise&lt;IScheduled<wbr/>Signal<wbr/>Row | null&gt;</span></a></li><li><a href="#persistscheduleadapterwritescheduledatascheduledsignalrow-symbol-strategyname-promise"><span>Persist<wbr/>Schedule<wbr/>Adapter.write<wbr/>Schedule<wbr/>Data(scheduled<wbr/>Signal<wbr/>Row, symbol, strategy<wbr/>Name): <wbr/>Promise&lt;void&gt;</span></a></li><li><a href="#persistscheduleadapterusepersistscheduleadapterctor-void"><span>Persist<wbr/>Schedule<wbr/>Adapter.use<wbr/>Persist<wbr/>Schedule<wbr/>Adapter(<wbr/>Ctor): void</span></a></li></ul></li></ul></li><li><a href="#partial-persistence"><span>Partial <wbr/>Persistence</span></a></li><li><ul><li><a href="#methods-3"><span>Methods</span></a></li><li><ul><li><a href="#persistpartialadapterreadpartialdatasymbol-strategyname-promise"><span>Persist<wbr/>Partial<wbr/>Adapter.read<wbr/>Partial<wbr/>Data(symbol, strategy<wbr/>Name): <wbr/>Promise&lt;<wbr/>Partial<wbr/>Data&gt;</span></a></li><li><a href="#persistpartialadapterwritepartialdatapartialdata-symbol-strategyname-promise"><span>Persist<wbr/>Partial<wbr/>Adapter.write<wbr/>Partial<wbr/>Data(partial<wbr/>Data, symbol, strategy<wbr/>Name): <wbr/>Promise&lt;void&gt;</span></a></li><li><a href="#persistpartialadapterusepersistpartialadapterctor-void"><span>Persist<wbr/>Partial<wbr/>Adapter.use<wbr/>Persist<wbr/>Partial<wbr/>Adapter(<wbr/>Ctor): void</span></a></li></ul></li></ul></li><li><a href="#crash-recovery-flow"><span>Crash <wbr/>Recovery <wbr/>Flow</span></a></li><li><ul><li><a href="#api-methods"><span>API <wbr/>Methods</span></a></li><li><ul><li><a href="#schedulegetdatasymbol-string-strategyname-string-promise"><span>Schedule.get<wbr/>Data(symbol: string, strategy<wbr/>Name: string): <wbr/>Promise&lt;<wbr/>Schedule<wbr/>Statistics&gt;</span></a></li><li><a href="#schedulegetreportsymbol-string-strategyname-string-promise"><span>Schedule.get<wbr/>Report(symbol: string, strategy<wbr/>Name: string): <wbr/>Promise&lt;string&gt;</span></a></li><li><a href="#scheduledumpsymbol-string-strategyname-string-path-string-promise"><span>Schedule.dump(symbol: string, strategy<wbr/>Name: string, path?: string): <wbr/>Promise&lt;void&gt;</span></a></li></ul></li><li><a href="#event-integration"><span>Event <wbr/>Integration</span></a></li></ul></li><li><a href="#comparison-table"><span>Comparison <wbr/>Table</span></a></li><li><a href="#service-architecture"><span>Service <wbr/>Architecture</span></a></li><li><a href="#usage-patterns"><span>Usage <wbr/>Patterns</span></a></li><li><ul><li><a href="#pattern-1-post-backtest-analysis"><span>Pattern 1: <wbr/>Post-<wbr/>Backtest <wbr/>Analysis</span></a></li><li><a href="#pattern-2-live-trading-monitoring"><span>Pattern 2: <wbr/>Live <wbr/>Trading <wbr/>Monitoring</span></a></li><li><a href="#pattern-3-strategy-optimization"><span>Pattern 3: <wbr/>Strategy <wbr/>Optimization</span></a></li></ul></li><li><a href="#data-retention"><span>Data <wbr/>Retention</span></a></li><li><a href="#safe-math-handling"><span>Safe <wbr/>Math <wbr/>Handling</span></a></li><li><a href="#integration-with-other-apis"><span>Integration with <wbr/>Other APIs</span></a></li><li><a href="#configuration-parameters"><span>Configuration <wbr/>Parameters</span></a></li><li><ul><li><a href="#partial-milestones"><span>Partial <wbr/>Milestones</span></a></li><li><a href="#schedule-timeout"><span>Schedule <wbr/>Timeout</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
