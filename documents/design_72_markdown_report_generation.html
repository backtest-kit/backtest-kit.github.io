<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/72_markdown_report_generation | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_72_markdown_report_generation.html">design/72_markdown_report_generation</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="markdown-report-generation" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Markdown Report Generation<a href="#markdown-report-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The markdown report generation system transforms trading execution events into human-readable reports with statistical analysis. The system uses a consistent architectural pattern across seven report types, each subscribing to event emitters and accumulating data in bounded queues.</p>
<table>
<thead>
<tr>
<th>Report Type</th>
<th>Service</th>
<th>Event Source</th>
<th>Bounded Queue Key</th>
<th>Output Path</th>
</tr>
</thead>
<tbody>
<tr>
<td>Backtest</td>
<td><code>BacktestMarkdownService</code></td>
<td><code>signalBacktestEmitter</code></td>
<td><code>symbol:strategyName</code></td>
<td><code>./dump/backtest/{strategyName}.md</code></td>
</tr>
<tr>
<td>Live</td>
<td><code>LiveMarkdownService</code></td>
<td><code>signalLiveEmitter</code></td>
<td><code>symbol:strategyName</code></td>
<td><code>./dump/live/{strategyName}.md</code></td>
</tr>
<tr>
<td>Schedule</td>
<td><code>ScheduleMarkdownService</code></td>
<td><code>signalEmitter</code></td>
<td><code>symbol:strategyName</code></td>
<td><code>./dump/schedule/{strategyName}.md</code></td>
</tr>
<tr>
<td>Partial</td>
<td><code>PartialMarkdownService</code></td>
<td><code>partialProfitSubject</code>, <code>partialLossSubject</code></td>
<td><code>symbol:strategyName</code></td>
<td><code>./dump/partial/{symbol}_{strategyName}.md</code></td>
</tr>
<tr>
<td>Walker</td>
<td><code>WalkerMarkdownService</code></td>
<td><code>walkerEmitter</code></td>
<td><code>walkerName</code></td>
<td><code>./dump/walker/{walkerName}.md</code></td>
</tr>
<tr>
<td>Heatmap</td>
<td><code>HeatMarkdownService</code></td>
<td><code>signalEmitter</code></td>
<td><code>strategyName</code></td>
<td><code>./dump/heatmap/{strategyName}.md</code></td>
</tr>
<tr>
<td>Performance</td>
<td><code>PerformanceMarkdownService</code></td>
<td><code>performanceEmitter</code></td>
<td><code>symbol:strategyName</code></td>
<td><code>./dump/performance/{strategyName}.md</code></td>
</tr>
</tbody>
</table>
<p><strong>Core Architectural Concepts:</strong></p>
<ul>
<li><strong>ReportStorage Pattern</strong>: Inner storage class per service encapsulates event accumulation and report generation</li>
<li><strong>Bounded Queue</strong>: <code>MAX_EVENTS = 250</code> constant limits memory usage by dropping oldest events</li>
<li><strong>Memoized Isolation</strong>: Each storage instance is memoized by composite key to prevent data mixing</li>
<li><strong>Singleshot Initialization</strong>: Event subscriptions occur exactly once using <code>singleshot</code> from functools-kit</li>
</ul>
<p><strong>Related Pages:</strong></p>
<ul>
<li>Statistical calculations (Sharpe Ratio, Certainty Ratio): See page 13.2</li>
<li>Walker strategy comparison: See page 11.3</li>
<li>Heatmap portfolio analytics: See page 13.5</li>
<li>Performance timing metrics: See page 13.2</li>
</ul>
<hr>
<a id="architecture-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Overview<a href="#architecture-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The markdown generation system consists of seven independent service classes that follow identical architectural patterns. Each service subscribes to event emitters, accumulates events in memoized storage, and provides three methods for data access (<code>getData</code>), report generation (<code>getReport</code>), and file persistence (<code>dump</code>).</p>
<p><strong>Markdown Services Architecture</strong></p>
<p><img src="../media/72_Markdown_Report_Generation_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Common Service Pattern</strong></p>
<p>All services implement the same three-method pattern with memoized storage:</p>
<pre><code class="typescript"><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-11">XxxMarkdownService</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">private</span><span class="hl-1"> </span><span class="hl-4">getStorage</span><span class="hl-1"> = </span><span class="hl-0">memoize</span><span class="hl-1">&lt;(</span><span class="hl-4">key</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">Storage</span><span class="hl-1">&gt;(</span><span class="hl-5">/* ... */</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">public</span><span class="hl-1"> </span><span class="hl-0">getData</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">key</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-4">Statistics</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-7">public</span><span class="hl-1"> </span><span class="hl-0">getReport</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">key</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-7">public</span><span class="hl-1"> </span><span class="hl-0">dump</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">key</span><span class="hl-1">, </span><span class="hl-4">path</span><span class="hl-1">?) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">void</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-7">public</span><span class="hl-1"> </span><span class="hl-0">clear</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">key</span><span class="hl-1">?) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">void</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-7">protected</span><span class="hl-1"> </span><span class="hl-4">init</span><span class="hl-1"> = </span><span class="hl-0">singleshot</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> { </span><span class="hl-5">/* subscribe */</span><span class="hl-1"> });</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="reportstorage-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ReportStorage Pattern<a href="#reportstorage-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All markdown services implement the same architectural pattern: a public service class acting as a facade, delegating to an inner <code>ReportStorage</code> class that encapsulates event accumulation and report generation logic.</p>
<p><strong>Pattern Structure</strong></p>
<p><img src="../media/72_Markdown_Report_Generation_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Responsibilities:</strong></p>
<ul>
<li><strong>Service Class</strong>: Event subscription, storage routing, memoization management</li>
<li><strong>Storage Class</strong>: Event accumulation, statistical calculation, markdown formatting</li>
</ul>
<p>The separation ensures that each symbol-strategy pair gets isolated storage while the service class manages the storage lifecycle.</p>
<hr>
<a id="bounded-queue-system-max_events" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Bounded Queue System (MAX_EVENTS)<a href="#bounded-queue-system-max_events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All markdown services implement bounded queues to prevent unbounded memory growth during long-running executions. The <code>MAX_EVENTS = 250</code> constant defines the maximum queue capacity across all report types.</p>
<p><strong>Queue Management</strong></p>
<p><img src="../media/72_Markdown_Report_Generation_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Memory Characteristics:</strong></p>
<table>
<thead>
<tr>
<th>Constant</th>
<th>Value</th>
<th>Memory Impact</th>
<th>Retention Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MAX_EVENTS</code></td>
<td>250</td>
<td>~50-100 KB per storage instance</td>
<td>FIFO (First In, First Out)</td>
</tr>
<tr>
<td>Queue operations</td>
<td><code>unshift()</code> + <code>pop()</code></td>
<td>O(n) insertion, O(1) removal</td>
<td>Keep newest events</td>
</tr>
<tr>
<td>Storage per symbol-strategy</td>
<td>1 instance</td>
<td>Isolated memory pools</td>
<td>Memoized by key</td>
</tr>
</tbody>
</table>
<p><strong>Implementation Example (BacktestMarkdownService):</strong></p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-4">IStrategyTickResultClosed</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">unshift</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);  </span><span class="hl-5">// Add to front</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-8">MAX_EVENTS</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">pop</span><span class="hl-1">();  </span><span class="hl-5">// Remove oldest</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The bounded queue ensures that even with millions of events over days of live trading, each storage instance uses constant memory. With typical deployments running 10-20 symbol-strategy pairs, total memory usage remains under 5 MB for all markdown services combined.</p>
<hr>
<a id="event-subscription-lifecycle" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Subscription Lifecycle<a href="#event-subscription-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each markdown service subscribes to event emitters during initialization using the <code>singleshot</code> pattern from functools-kit. This ensures subscriptions occur exactly once, even with multiple concurrent callers.</p>
<p><strong>Initialization Sequence</strong></p>
<p><img src="../media/72_Markdown_Report_Generation_3.svg" alt="Mermaid Diagram"></p>
<p>The <code>singleshot</code> wrapper ensures thread-safe initialization without locks by leveraging JavaScript's single-threaded event loop. Multiple concurrent calls to <code>getData()</code> will queue behind the first call's initialization.</p>
<a id="backtest-event-processing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Event Processing<a href="#backtest-event-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>BacktestMarkdownService</code> filters events to only accumulate <code>action === &quot;closed&quot;</code> signals. This is because backtest execution uses fast-forward simulation that skips intermediate states.</p>
<p><strong>Event Filtering Logic</strong></p>
<pre><code class="typescript"><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-0">tick</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-11">IStrategyTickResult</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> !== </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1">;  </span><span class="hl-5">// Ignore idle/opened/active events</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">storage</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">getStorage</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">storage</span><span class="hl-1">.</span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);  </span><span class="hl-5">// Only closed events stored</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<a id="live-event-processing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live Event Processing<a href="#live-event-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>LiveMarkdownService</code> accumulates all four event types (<code>idle</code>, <code>opened</code>, <code>active</code>, <code>closed</code>) with specialized handling to prevent memory bloat from idle periods.</p>
<p><strong>Event Routing with Idle Deduplication</strong></p>
<p><img src="../media/72_Markdown_Report_Generation_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Idle Event Deduplication Logic:</strong></p>
<p>The service prevents idle event spam by replacing consecutive idle events when no signal activity has occurred:</p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">addIdleEvent</span><span class="hl-1">(</span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">lastIdleIndex</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-0">findLastIndex</span><span class="hl-1">(</span><br/><span class="hl-1">    (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;idle&quot;</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Can replace if no opened/active events exist after last idle</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">canReplace</span><span class="hl-1"> = </span><span class="hl-4">lastIdleIndex</span><span class="hl-1"> !== -</span><span class="hl-6">1</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">    !</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><br/><span class="hl-1">      .</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-4">lastIdleIndex</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">)</span><br/><span class="hl-1">      .</span><span class="hl-0">some</span><span class="hl-1">((</span><span class="hl-4">e</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">e</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1"> || </span><span class="hl-4">e</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">canReplace</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">[</span><span class="hl-4">lastIdleIndex</span><span class="hl-1">] = </span><span class="hl-4">newEvent</span><span class="hl-1">;  </span><span class="hl-5">// Replace in-place</span><br/><span class="hl-1">  } </span><span class="hl-3">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-0">unshift</span><span class="hl-1">(</span><span class="hl-4">newEvent</span><span class="hl-1">);  </span><span class="hl-5">// Push new</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Bounded queue enforcement</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-8">MAX_EVENTS</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-0">pop</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>This optimization prevents a strategy polling every minute with no signals from accumulating 1440 idle events per day. Instead, only the most recent idle event is retained until signal activity resumes.</p>
<a id="schedule-event-processing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schedule Event Processing<a href="#schedule-event-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>ScheduleMarkdownService</code> tracks scheduled signals (limit orders) through three states: scheduled, opened (activated), and cancelled.</p>
<p><strong>Event Types:</strong></p>
<table>
<thead>
<tr>
<th>Event</th>
<th>Trigger</th>
<th>Stored Data</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scheduled</code></td>
<td>Signal with <code>priceOpen</code> specified</td>
<td>Timestamp, signal metadata, entry price</td>
</tr>
<tr>
<td><code>opened</code></td>
<td><code>priceOpen</code> reached (only if previously scheduled)</td>
<td>Activation timestamp, wait duration</td>
</tr>
<tr>
<td><code>cancelled</code></td>
<td>Timeout or SL hit before activation</td>
<td>Cancellation timestamp, wait duration</td>
</tr>
</tbody>
</table>
<p><strong>Scheduled Signal Filtering:</strong></p>
<pre><code class="typescript"><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-0">tick</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-11">IStrategyTickResult</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">storage</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">getStorage</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;scheduled&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">storage</span><span class="hl-1">.</span><span class="hl-0">addScheduledEvent</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-3">else</span><span class="hl-1"> </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Only track if this was previously scheduled</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">scheduledAt</span><span class="hl-1"> !== </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">pendingAt</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">storage</span><span class="hl-1">.</span><span class="hl-0">addOpenedEvent</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-3">else</span><span class="hl-1"> </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;cancelled&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">storage</span><span class="hl-1">.</span><span class="hl-0">addCancelledEvent</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>The service subscribes to <code>signalEmitter</code> (global) rather than mode-specific emitters because scheduled signals can occur in both backtest and live modes.</p>
<hr>
<a id="report-generation-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Report Generation Services<a href="#report-generation-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each markdown service contains an inner <code>ReportStorage</code> class that encapsulates event accumulation logic and report generation. The service class itself acts as a facade that manages per-strategy storage instances using memoization.</p>
<a id="backtestmarkdownservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">BacktestMarkdownService<a href="#backtestmarkdownservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The backtest service generates reports with closed signal data in a tabular format. Each row represents a completed trade with open/close prices, PNL, duration, and close reason.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Code Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BacktestMarkdownService</code></td>
<td>Facade service managing storage instances</td>
<td><a href="">BacktestMarkdownService.ts:370-542</a></td>
</tr>
<tr>
<td><code>ReportStorage</code></td>
<td>Inner class storing signal list</td>
<td><a href="">BacktestMarkdownService.ts:183-341</a></td>
</tr>
<tr>
<td><code>BacktestStatistics</code></td>
<td>Interface for statistical data</td>
<td><a href="">BacktestMarkdownService.ts:66-102</a></td>
</tr>
<tr>
<td><code>Column[]</code></td>
<td>Table column definitions</td>
<td><a href="">BacktestMarkdownService.ts:104-177</a></td>
</tr>
<tr>
<td><code>getStorage()</code></td>
<td>Memoized storage retriever</td>
<td><a href="">BacktestMarkdownService.ts:378-381</a></td>
</tr>
</tbody>
</table>
<a id="livemarkdownservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">LiveMarkdownService<a href="#livemarkdownservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The live service generates reports with all event types (idle, opened, active, closed). The report shows strategy activity timeline including periods of inactivity and active position monitoring.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Code Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>LiveMarkdownService</code></td>
<td>Facade service managing storage instances</td>
<td><a href="">LiveMarkdownService.ts:567-746</a></td>
</tr>
<tr>
<td><code>ReportStorage</code></td>
<td>Inner class storing event list</td>
<td><a href="">LiveMarkdownService.ts:229-535</a></td>
</tr>
<tr>
<td><code>LiveStatistics</code></td>
<td>Interface for statistical data</td>
<td><a href="">LiveMarkdownService.ts:91-130</a></td>
</tr>
<tr>
<td><code>TickEvent</code></td>
<td>Unified event data structure</td>
<td><a href="">LiveMarkdownService.ts:39-66</a></td>
</tr>
<tr>
<td><code>Column[]</code></td>
<td>Table column definitions</td>
<td><a href="">LiveMarkdownService.ts:145-220</a></td>
</tr>
<tr>
<td><code>MAX_EVENTS</code></td>
<td>Event queue capacity (250)</td>
<td><a href="">LiveMarkdownService.ts:223</a></td>
</tr>
</tbody>
</table>
<a id="schedulemarkdownservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ScheduleMarkdownService<a href="#schedulemarkdownservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The schedule service tracks scheduled signals and their cancellation metrics. Reports include cancellation rate and average wait time for cancelled orders.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Code Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ScheduleMarkdownService</code></td>
<td>Facade service managing storage instances</td>
<td><a href="">ScheduleMarkdownService.ts:374-545</a></td>
</tr>
<tr>
<td><code>ReportStorage</code></td>
<td>Inner class storing scheduled events</td>
<td><a href="">ScheduleMarkdownService.ts:167-351</a></td>
</tr>
<tr>
<td><code>ScheduleStatistics</code></td>
<td>Interface for statistical data</td>
<td><a href="">ScheduleMarkdownService.ts:68-86</a></td>
</tr>
<tr>
<td><code>ScheduledEvent</code></td>
<td>Scheduled/cancelled event data</td>
<td><a href="">ScheduleMarkdownService.ts:19-44</a></td>
</tr>
<tr>
<td><code>Column[]</code></td>
<td>Table column definitions</td>
<td><a href="">ScheduleMarkdownService.ts:101-158</a></td>
</tr>
</tbody>
</table>
<hr>
<hr>
<a id="three-method-public-api" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Three-Method Public API<a href="#three-method-public-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All markdown services expose three public methods for data access, report generation, and file persistence. This consistent API enables predictable usage across all report types.</p>
<p><strong>API Contract</strong></p>
<p><img src="../media/72_Markdown_Report_Generation_5.svg" alt="Mermaid Diagram"></p>
<a id="getdata---statistical-data-access" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getData() - Statistical Data Access<a href="#getdata---statistical-data-access" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>getData()</code> method returns a statistics object containing raw event data and calculated metrics. All numeric fields use <code>null</code> for invalid values (NaN/Infinity) to prevent downstream errors.</p>
<p><strong>Statistics Interface Examples:</strong></p>
<pre><code class="typescript"><span class="hl-5">// BacktestStatisticsModel</span><br/><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">BacktestStatisticsModel</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">signalList</span><span class="hl-1">: </span><span class="hl-11">IStrategyTickResultClosed</span><span class="hl-1">[];  </span><span class="hl-5">// Raw closed signals</span><br/><span class="hl-1">  </span><span class="hl-4">totalSignals</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">winCount</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">lossCount</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">winRate</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">;        </span><span class="hl-5">// (winCount / total) * 100</span><br/><span class="hl-1">  </span><span class="hl-4">avgPnl</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalPnl</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">stdDev</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">sharpeRatio</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">;    </span><span class="hl-5">// avgPnl / stdDev</span><br/><span class="hl-1">  </span><span class="hl-4">annualizedSharpeRatio</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">;  </span><span class="hl-5">// sharpeRatio * sqrt(365)</span><br/><span class="hl-1">  </span><span class="hl-4">certaintyRatio</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">;  </span><span class="hl-5">// avgWin / abs(avgLoss)</span><br/><span class="hl-1">  </span><span class="hl-4">expectedYearlyReturns</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">;  </span><span class="hl-5">// avgPnl * (365 / avgDurationDays)</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// LiveStatisticsModel (includes all event types)</span><br/><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">LiveStatisticsModel</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">eventList</span><span class="hl-1">: </span><span class="hl-11">TickEvent</span><span class="hl-1">[];  </span><span class="hl-5">// idle/opened/active/closed events</span><br/><span class="hl-1">  </span><span class="hl-4">totalEvents</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalClosed</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">// ... same metrics as backtest for closed events</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Safe Math Guard:</strong></p>
<p>All services use <code>isUnsafe()</code> to prevent invalid numeric values:</p>
<pre><code class="typescript"><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">): </span><span class="hl-11">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">typeof</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1"> !== </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-0">isNaN</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-0">isFinite</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">false</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Applied to all metrics before returning</span><br/><span class="hl-10">winRate</span><span class="hl-1">: </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">winRate</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">winRate</span><span class="hl-1">,</span><br/><span class="hl-10">sharpeRatio</span><span class="hl-1">: </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">sharpeRatio</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">sharpeRatio</span><span class="hl-1">,</span>
</code><button type="button">Copy</button></pre>

<a id="getreport---markdown-generation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getReport() - Markdown Generation<a href="#getreport---markdown-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>getReport()</code> method transforms statistical data into formatted markdown tables. The method uses <code>ColumnModel</code> configuration to define table structure and cell formatting.</p>
<p><strong>Markdown Report Structure:</strong></p>
<pre><code class="markdown"># Backtest Report: my-strategy

| Signal ID | Symbol | Position | ... | PNL (net) | Close Reason |
|-----------|--------|----------|-----|-----------|--------------|
| abc-123   | BTCUSDT | LONG    | ... | +3.45%    | TAKEPROFIT   |
| def-456   | ETHUSDT | SHORT   | ... | -1.23%    | STOPLOSS     |

**Total signals:** 250
**Closed signals:** 250
**Win rate:** 65.00% (163W / 87L) (higher is better)
**Average PNL:** +1.25% (higher is better)
**Total PNL:** +312.50% (higher is better)
**Sharpe Ratio:** 1.850 (higher is better)
**Expected Yearly Returns:** +450.00% (higher is better)
</code><button type="button">Copy</button></pre>

<p><strong>Column Configuration System:</strong></p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">ColumnModel</span><span class="hl-1">&lt;</span><span class="hl-11">T</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-4">key</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;                                   </span><span class="hl-5">// Unique identifier</span><br/><span class="hl-1">  </span><span class="hl-4">label</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;                                 </span><span class="hl-5">// Table header</span><br/><span class="hl-1">  </span><span class="hl-0">format</span><span class="hl-1">: (</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-11">T</span><span class="hl-1">, </span><span class="hl-4">index</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">string</span><span class="hl-1">;    </span><span class="hl-5">// Cell formatter</span><br/><span class="hl-1">  </span><span class="hl-0">isVisible</span><span class="hl-1">: () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">boolean</span><span class="hl-1">;                      </span><span class="hl-5">// Visibility toggle</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Example column for PNL formatting</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">pnlColumn</span><span class="hl-1">: </span><span class="hl-11">ColumnModel</span><span class="hl-1">&lt;</span><span class="hl-11">IStrategyTickResultClosed</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;pnl&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">label:</span><span class="hl-1"> </span><span class="hl-2">&quot;PNL (net)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">format</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">pnl</span><span class="hl-1"> = </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">sign</span><span class="hl-1"> = </span><span class="hl-4">pnl</span><span class="hl-1"> &gt;= </span><span class="hl-6">0</span><span class="hl-1"> ? </span><span class="hl-2">&quot;+&quot;</span><span class="hl-1"> : </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">sign</span><span class="hl-7">}${</span><span class="hl-4">pnl</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">isVisible</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">true</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>The <code>isVisible()</code> function allows dynamic column hiding based on configuration or data availability.</p>
<a id="dump---file-persistence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">dump() - File Persistence<a href="#dump---file-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>dump()</code> method writes markdown reports to disk using Node.js file system APIs. The method creates directories recursively if they don't exist and uses UTF-8 encoding.</p>
<p><strong>Default Paths:</strong></p>
<ul>
<li>Backtest: <code>./dump/backtest/{strategyName}.md</code></li>
<li>Live: <code>./dump/live/{strategyName}.md</code></li>
<li>Schedule: <code>./dump/schedule/{strategyName}.md</code></li>
</ul>
<hr>
<a id="markdown-table-generation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Markdown Table Generation<a href="#markdown-table-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Tables are generated using a column configuration system that defines label, key, and formatting function for each column. The system maps event data to table rows using these column definitions.</p>
<p><img src="../media/72_Markdown_Report_Generation_6.svg" alt="Mermaid Diagram"></p>
<a id="backtest-columns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Columns<a href="#backtest-columns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The backtest table includes 12 columns showing complete signal lifecycle data:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Signal ID</td>
<td>UUID string</td>
<td><code>abc123-def456</code></td>
</tr>
<tr>
<td>Symbol</td>
<td>Trading pair</td>
<td><code>BTCUSDT</code></td>
</tr>
<tr>
<td>Position</td>
<td>LONG/SHORT</td>
<td><code>LONG</code></td>
</tr>
<tr>
<td>Note</td>
<td>User-provided string</td>
<td><code>Breakout entry</code></td>
</tr>
<tr>
<td>Open Price</td>
<td>8 decimals + USD</td>
<td><code>50000.12345678 USD</code></td>
</tr>
<tr>
<td>Close Price</td>
<td>8 decimals + USD</td>
<td><code>51500.00000000 USD</code></td>
</tr>
<tr>
<td>Take Profit</td>
<td>8 decimals + USD</td>
<td><code>52000.00000000 USD</code></td>
</tr>
<tr>
<td>Stop Loss</td>
<td>8 decimals + USD</td>
<td><code>49000.00000000 USD</code></td>
</tr>
<tr>
<td>PNL (net)</td>
<td>+/- 2 decimals + %</td>
<td><code>+3.00%</code></td>
</tr>
<tr>
<td>Close Reason</td>
<td>Enum string</td>
<td><code>TAKEPROFIT</code> / <code>STOPLOSS</code> / <code>TIMEOUT</code></td>
</tr>
<tr>
<td>Duration (min)</td>
<td>Integer minutes</td>
<td><code>120</code></td>
</tr>
<tr>
<td>Open Time</td>
<td>ISO 8601</td>
<td><code>2024-01-15T10:30:00.000Z</code></td>
</tr>
<tr>
<td>Close Time</td>
<td>ISO 8601</td>
<td><code>2024-01-15T12:30:00.000Z</code></td>
</tr>
</tbody>
</table>
<a id="live-columns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live Columns<a href="#live-columns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The live table includes 13 columns showing all event types including idle periods:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Timestamp</td>
<td>ISO 8601</td>
<td><code>2024-01-15T10:30:00.000Z</code></td>
</tr>
<tr>
<td>Action</td>
<td>IDLE/OPENED/ACTIVE/CLOSED</td>
<td><code>CLOSED</code></td>
</tr>
<tr>
<td>Symbol</td>
<td>Trading pair or N/A</td>
<td><code>BTCUSDT</code></td>
</tr>
<tr>
<td>Signal ID</td>
<td>UUID or N/A</td>
<td><code>abc123-def456</code></td>
</tr>
<tr>
<td>Position</td>
<td>LONG/SHORT or N/A</td>
<td><code>LONG</code></td>
</tr>
<tr>
<td>Note</td>
<td>User string or N/A</td>
<td><code>Breakout entry</code></td>
</tr>
<tr>
<td>Current Price</td>
<td>8 decimals + USD</td>
<td><code>51500.00000000 USD</code></td>
</tr>
<tr>
<td>Open Price</td>
<td>8 decimals + USD or N/A</td>
<td><code>50000.12345678 USD</code></td>
</tr>
<tr>
<td>Take Profit</td>
<td>8 decimals + USD or N/A</td>
<td><code>52000.00000000 USD</code></td>
</tr>
<tr>
<td>Stop Loss</td>
<td>8 decimals + USD or N/A</td>
<td><code>49000.00000000 USD</code></td>
</tr>
<tr>
<td>PNL (net)</td>
<td>+/- 2 decimals + % or N/A</td>
<td><code>+3.00%</code></td>
</tr>
<tr>
<td>Close Reason</td>
<td>Enum or N/A</td>
<td><code>TAKEPROFIT</code></td>
</tr>
<tr>
<td>Duration (min)</td>
<td>Integer or N/A</td>
<td><code>120</code></td>
</tr>
</tbody>
</table>
<a id="schedule-columns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schedule Columns<a href="#schedule-columns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The schedule table includes 11 columns focused on scheduled signal lifecycle:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Timestamp</td>
<td>ISO 8601</td>
<td><code>2024-01-15T10:30:00.000Z</code></td>
</tr>
<tr>
<td>Action</td>
<td>SCHEDULED/CANCELLED</td>
<td><code>CANCELLED</code></td>
</tr>
<tr>
<td>Symbol</td>
<td>Trading pair</td>
<td><code>BTCUSDT</code></td>
</tr>
<tr>
<td>Signal ID</td>
<td>UUID string</td>
<td><code>abc123-def456</code></td>
</tr>
<tr>
<td>Position</td>
<td>LONG/SHORT</td>
<td><code>LONG</code></td>
</tr>
<tr>
<td>Note</td>
<td>User string or N/A</td>
<td><code>Limit order</code></td>
</tr>
<tr>
<td>Current Price</td>
<td>8 decimals + USD</td>
<td><code>50500.00000000 USD</code></td>
</tr>
<tr>
<td>Entry Price</td>
<td>8 decimals + USD</td>
<td><code>50000.00000000 USD</code></td>
</tr>
<tr>
<td>Take Profit</td>
<td>8 decimals + USD</td>
<td><code>52000.00000000 USD</code></td>
</tr>
<tr>
<td>Stop Loss</td>
<td>8 decimals + USD</td>
<td><code>49000.00000000 USD</code></td>
</tr>
<tr>
<td>Wait Time (min)</td>
<td>Integer or N/A</td>
<td><code>45</code></td>
</tr>
</tbody>
</table>
<hr>
<a id="storage-management" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Storage Management<a href="#storage-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each markdown service uses memoized storage to maintain per-symbol-strategy isolation. This prevents data mixing between different trading pairs and strategies running in parallel.</p>
<a id="memoization-strategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoization Strategy<a href="#memoization-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Storage instances are memoized using the key pattern <code>&quot;symbol:strategyName&quot;</code>. The memoization ensures that repeated calls for the same symbol-strategy pair return the same storage instance, while different pairs get isolated storage.</p>
<pre><code class="typescript"><span class="hl-5">// Memoized storage retrieval pattern (all services)</span><br/><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">getStorage</span><span class="hl-1"> = </span><span class="hl-0">memoize</span><span class="hl-1">&lt;(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">ReportStorage</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">  ([</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">:</span><span class="hl-7">${</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">  () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">ReportStorage</span><span class="hl-1">()</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="clear-operation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Clear Operation<a href="#clear-operation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>clear()</code> method provides two modes of operation:</p>
<ol>
<li><strong>Targeted Clear</strong>: Clear specific symbol-strategy pair by providing context</li>
<li><strong>Global Clear</strong>: Clear all storage instances when no context provided</li>
</ol>
<pre><code class="typescript"><span class="hl-5">// Clear specific pair</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">service</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">({ </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// Clear all pairs</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">service</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>The clear operation calls <code>memoize.clear()</code> which removes cached entries, enabling garbage collection of storage instances.</p>
<hr>
<a id="event-type-processing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Type Processing<a href="#event-type-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each service processes different subsets of the event action types emitted by <code>ClientStrategy</code>. The action filtering determines which events contribute to the report.</p>
<a id="backtest-event-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Event Types<a href="#backtest-event-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Backtest only processes <code>action === &quot;closed&quot;</code> events. All other actions (<code>idle</code>, <code>opened</code>, <code>active</code>) are ignored because backtest execution uses fast-forward simulation that skips timeframes once a signal opens.</p>
<pre><code class="typescript"><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-0">tick</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-11">IStrategyTickResult</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> !== </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1">;  </span><span class="hl-5">// Ignore non-closed events</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">storage</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">getStorage</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">storage</span><span class="hl-1">.</span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<a id="live-event-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live Event Types<a href="#live-event-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Live processes all four action types with specialized handling for each:</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>Handling Logic</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>idle</code></td>
<td>Replace last idle if no opened/active after it</td>
<td>Prevent unbounded idle event accumulation</td>
</tr>
<tr>
<td><code>opened</code></td>
<td>Push new event</td>
<td>Track signal opening</td>
</tr>
<tr>
<td><code>active</code></td>
<td>Find by signalId and replace</td>
<td>Update position monitoring state</td>
</tr>
<tr>
<td><code>closed</code></td>
<td>Find by signalId and replace</td>
<td>Record final PNL and close reason</td>
</tr>
</tbody>
</table>
<a id="schedule-event-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schedule Event Types<a href="#schedule-event-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Schedule processes two action types related to limit orders:</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>Handling Logic</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scheduled</code></td>
<td>Push new event</td>
<td>Track limit order creation</td>
</tr>
<tr>
<td><code>cancelled</code></td>
<td>Find by signalId and replace</td>
<td>Record cancellation with wait time</td>
</tr>
</tbody>
</table>
<hr>
<a id="initialization-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Initialization Pattern<a href="#initialization-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All markdown services use the <code>singleshot</code> pattern from <code>functools-kit</code> to ensure event subscription happens exactly once. The <code>init()</code> method is marked protected and called automatically on first data access.</p>
<p><img src="../media/72_Markdown_Report_Generation_7.svg" alt="Mermaid Diagram"></p>
<p>The protected visibility (<code>protected init</code>) allows subclass testing while preventing external calls. The automatic initialization ensures services are ready without explicit setup calls.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#markdown-report-generation"><span>Markdown <wbr/>Report <wbr/>Generation</span></a><ul><li><a href="#architecture-overview"><span>Architecture <wbr/>Overview</span></a></li><li><a href="#reportstorage-pattern"><span>Report<wbr/>Storage <wbr/>Pattern</span></a></li><li><a href="#bounded-queue-system-max_events"><span>Bounded <wbr/>Queue <wbr/>System (MAX_<wbr/>EVENTS)</span></a></li><li><a href="#event-subscription-lifecycle"><span>Event <wbr/>Subscription <wbr/>Lifecycle</span></a></li><li><ul><li><a href="#backtest-event-processing"><span>Backtest <wbr/>Event <wbr/>Processing</span></a></li><li><a href="#live-event-processing"><span>Live <wbr/>Event <wbr/>Processing</span></a></li><li><a href="#schedule-event-processing"><span>Schedule <wbr/>Event <wbr/>Processing</span></a></li></ul></li><li><a href="#report-generation-services"><span>Report <wbr/>Generation <wbr/>Services</span></a></li><li><ul><li><a href="#backtestmarkdownservice"><span>Backtest<wbr/>Markdown<wbr/>Service</span></a></li><li><a href="#livemarkdownservice"><span>Live<wbr/>Markdown<wbr/>Service</span></a></li><li><a href="#schedulemarkdownservice"><span>Schedule<wbr/>Markdown<wbr/>Service</span></a></li></ul></li><li><a href="#three-method-public-api"><span>Three-<wbr/>Method <wbr/>Public API</span></a></li><li><ul><li><a href="#getdata---statistical-data-access"><span>get<wbr/>Data() -<wbr/> <wbr/>Statistical <wbr/>Data <wbr/>Access</span></a></li><li><a href="#getreport---markdown-generation"><span>get<wbr/>Report() -<wbr/> <wbr/>Markdown <wbr/>Generation</span></a></li><li><a href="#dump---file-persistence"><span>dump() -<wbr/> <wbr/>File <wbr/>Persistence</span></a></li></ul></li><li><a href="#markdown-table-generation"><span>Markdown <wbr/>Table <wbr/>Generation</span></a></li><li><ul><li><a href="#backtest-columns"><span>Backtest <wbr/>Columns</span></a></li><li><a href="#live-columns"><span>Live <wbr/>Columns</span></a></li><li><a href="#schedule-columns"><span>Schedule <wbr/>Columns</span></a></li></ul></li><li><a href="#storage-management"><span>Storage <wbr/>Management</span></a></li><li><ul><li><a href="#memoization-strategy"><span>Memoization <wbr/>Strategy</span></a></li><li><a href="#clear-operation"><span>Clear <wbr/>Operation</span></a></li></ul></li><li><a href="#event-type-processing"><span>Event <wbr/>Type <wbr/>Processing</span></a></li><li><ul><li><a href="#backtest-event-types"><span>Backtest <wbr/>Event <wbr/>Types</span></a></li><li><a href="#live-event-types"><span>Live <wbr/>Event <wbr/>Types</span></a></li><li><a href="#schedule-event-types"><span>Schedule <wbr/>Event <wbr/>Types</span></a></li></ul></li><li><a href="#initialization-pattern"><span>Initialization <wbr/>Pattern</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
