<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/31_performance-statistics | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_31_performance-statistics.html">design/31_performance-statistics</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="performance-statistics" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Performance Statistics<a href="#performance-statistics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents the statistical metrics calculated from trading results. The framework computes comprehensive performance analytics including win rates, Sharpe ratios, drawdowns, and risk-adjusted returns for both backtest and live trading modes.</p>
<p>For information about the markdown report system and how statistics are stored and generated, see <a href="design_30_markdown-report-system.html">Markdown Report System</a>. For portfolio-wide heatmap statistics aggregated across symbols, see <a href="design_32_portfolio-heatmaps.html">Portfolio Heatmaps</a>.</p>
<hr>
<a id="statistics-interfaces-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Statistics Interfaces Overview<a href="#statistics-interfaces-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides multiple statistics interfaces, each tailored to a specific execution mode or analysis type. All statistics calculations follow a consistent pattern: they aggregate signal data and compute derived metrics with safety checks for invalid values (NaN, Infinity).</p>
<table>
<thead>
<tr>
<th>Interface</th>
<th>Purpose</th>
<th>Location</th>
<th>Key Metrics</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BacktestStatistics</code></td>
<td>Historical simulation results</td>
<td><a href="">src/lib/services/markdown/BacktestMarkdownService.ts:70-106</a></td>
<td>Win rate, Sharpe ratio, PNL, drawdown</td>
</tr>
<tr>
<td><code>LiveStatistics</code></td>
<td>Real-time trading results</td>
<td><a href="">src/lib/services/markdown/LiveMarkdownService.ts:97-136</a></td>
<td>Same as backtest + event tracking</td>
</tr>
<tr>
<td><code>ScheduleStatistics</code></td>
<td>Scheduled signal tracking</td>
<td><a href="">src/lib/services/markdown/ScheduleMarkdownService.ts:72-99</a></td>
<td>Cancellation rate, activation rate</td>
</tr>
<tr>
<td><code>WalkerStatistics</code></td>
<td>Strategy comparison</td>
<td><a href="">src/lib/services/markdown/WalkerMarkdownService.ts:23-26</a></td>
<td>Best strategy, metric values</td>
</tr>
<tr>
<td><code>PerformanceStatistics</code></td>
<td>Execution metrics</td>
<td><a href="">src/lib/services/markdown/PerformanceMarkdownService.ts:60-75</a></td>
<td>Duration, percentiles, wait times</td>
</tr>
<tr>
<td><code>PartialStatistics</code></td>
<td>Profit/loss milestones</td>
<td><a href="">src/lib/services/markdown/PartialMarkdownService.ts:53-65</a></td>
<td>Event counts by type</td>
</tr>
</tbody>
</table>
<hr>
<a id="statistics-calculation-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Statistics Calculation Flow<a href="#statistics-calculation-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following diagram shows how raw signal data flows through the system to produce aggregated statistics:</p>
<p><img src="../media/31-performance-statistics_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="core-performance-metrics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Performance Metrics<a href="#core-performance-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="win-rate" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Win Rate<a href="#win-rate" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The win rate represents the percentage of closed signals that resulted in profit (PNL &gt; 0). This is a fundamental metric for evaluating strategy effectiveness.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">winRate</span><span class="hl-1"> = (</span><span class="hl-4">winCount</span><span class="hl-1"> / </span><span class="hl-4">totalSignals</span><span class="hl-1">) × </span><span class="hl-6">100</span><br/><span class="hl-10">where</span><span class="hl-1">:</span><br/><span class="hl-1">  </span><span class="hl-4">winCount</span><span class="hl-1"> = </span><span class="hl-4">signals</span><span class="hl-1"> </span><span class="hl-3">with</span><span class="hl-1"> </span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><br/><span class="hl-1">  </span><span class="hl-4">totalSignals</span><span class="hl-1"> = </span><span class="hl-4">all</span><span class="hl-1"> </span><span class="hl-4">closed</span><span class="hl-1"> </span><span class="hl-4">signals</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> Higher values indicate better strategy performance. A win rate above 50% means more winning trades than losing trades, but this must be considered alongside average win/loss sizes (see Certainty Ratio).</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">totalSignals</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">winCount</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">((</span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">lossCount</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">((</span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &lt; </span><span class="hl-6">0</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Calculate basic statistics</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgPnl</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-4">totalSignals</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">totalPnl</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">winRate</span><span class="hl-1"> = (</span><span class="hl-4">winCount</span><span class="hl-1"> / </span><span class="hl-4">totalSignals</span><span class="hl-1">) * </span><span class="hl-6">100</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Output Format:</strong> Returned as percentage (0-100) or <code>null</code> if unsafe. Display includes win/loss counts: <code>&quot;52.35% (10W / 9L)&quot;</code>.</p>
<hr>
<a id="average-pnl" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Average PNL<a href="#average-pnl" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Average profit/loss per closed signal, expressed as a percentage. This metric shows the expected return per trade.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">avgPnl</span><span class="hl-1"> = </span><span class="hl-0">Σ</span><span class="hl-1">(</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">) / </span><span class="hl-4">totalSignals</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> Higher values are better. Positive values indicate profitable strategy, negative values indicate losses. Should be significantly larger than total costs (slippage + fees) to be economically viable.</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgPnl</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-4">totalSignals</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgPnl</span><span class="hl-1"> = </span><span class="hl-4">totalClosed</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><br/><span class="hl-1">  ? </span><span class="hl-4">closedEvents</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">e</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + (</span><span class="hl-4">e</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1"> || </span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-4">totalClosed</span><br/><span class="hl-1">  : </span><span class="hl-6">0</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Safety:</strong> Returns <code>null</code> if value is NaN, Infinity, or not a number (checked via <code>isUnsafe()</code>).</p>
<hr>
<a id="total-pnl" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Total PNL<a href="#total-pnl" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Cumulative profit/loss across all closed signals, expressed as a percentage. This represents the total return if all trades were executed with equal capital allocation.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">totalPnl</span><span class="hl-1"> = </span><span class="hl-0">Σ</span><span class="hl-1">(</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> Higher values are better. This metric shows absolute performance but doesn't account for risk or number of trades.</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">totalPnl</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Display Example:</strong> <code>&quot;+12.45%&quot;</code> or <code>&quot;-5.23%&quot;</code> in reports.</p>
<hr>
<a id="standard-deviation-volatility" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Standard Deviation (Volatility)<a href="#standard-deviation-volatility" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Standard deviation of returns measures the volatility or dispersion of trade results. This is a key component in risk-adjusted metrics.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">variance</span><span class="hl-1"> = </span><span class="hl-0">Σ</span><span class="hl-1">((</span><span class="hl-4">pnl</span><span class="hl-1"> - </span><span class="hl-4">avgPnl</span><span class="hl-1">)²) / </span><span class="hl-4">totalSignals</span><br/><span class="hl-4">stdDev</span><span class="hl-1"> = √</span><span class="hl-4">variance</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> Lower values are better, indicating more consistent returns with less volatility. High standard deviation means returns are spread out over a wide range, indicating higher risk.</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Calculate Sharpe Ratio (risk-free rate = 0)</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">returns</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">variance</span><span class="hl-1"> = </span><span class="hl-4">returns</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">r</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">pow</span><span class="hl-1">(</span><span class="hl-4">r</span><span class="hl-1"> - </span><span class="hl-4">avgPnl</span><span class="hl-1">, </span><span class="hl-6">2</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-4">totalSignals</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stdDev</span><span class="hl-1"> = </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">sqrt</span><span class="hl-1">(</span><span class="hl-4">variance</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<pre><code class="typescript"><span class="hl-5">// Calculate Sharpe Ratio (risk-free rate = 0)</span><br/><span class="hl-7">let</span><span class="hl-1"> </span><span class="hl-4">sharpeRatio</span><span class="hl-1"> = </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-7">let</span><span class="hl-1"> </span><span class="hl-4">stdDev</span><span class="hl-1"> = </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">totalClosed</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">returns</span><span class="hl-1"> = </span><span class="hl-4">closedEvents</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-4">e</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">e</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1"> || </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">variance</span><span class="hl-1"> = </span><span class="hl-4">returns</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">r</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">pow</span><span class="hl-1">(</span><span class="hl-4">r</span><span class="hl-1"> - </span><span class="hl-4">avgPnl</span><span class="hl-1">, </span><span class="hl-6">2</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-4">totalClosed</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">stdDev</span><span class="hl-1"> = </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">sqrt</span><span class="hl-1">(</span><span class="hl-4">variance</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">sharpeRatio</span><span class="hl-1"> = </span><span class="hl-4">stdDev</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><span class="hl-1"> ? </span><span class="hl-4">avgPnl</span><span class="hl-1"> / </span><span class="hl-4">stdDev</span><span class="hl-1"> : </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Note:</strong> The calculation assumes risk-free rate = 0 for simplicity. In practice, you might subtract risk-free rate from returns before calculating Sharpe ratio.</p>
<hr>
<a id="sharpe-ratio" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Sharpe Ratio<a href="#sharpe-ratio" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The Sharpe ratio measures risk-adjusted return by dividing average return by volatility (standard deviation). This is one of the most important metrics for evaluating strategy quality.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">sharpeRatio</span><span class="hl-1"> = </span><span class="hl-4">avgPnl</span><span class="hl-1"> / </span><span class="hl-4">stdDev</span><br/><span class="hl-1">(</span><span class="hl-4">assuming</span><span class="hl-1"> </span><span class="hl-4">risk</span><span class="hl-1">-</span><span class="hl-4">free</span><span class="hl-1"> </span><span class="hl-4">rate</span><span class="hl-1"> = </span><span class="hl-6">0</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> Higher values are better. A Sharpe ratio above 1.0 is considered good, above 2.0 is very good, above 3.0 is excellent. Negative values indicate average losses exceed volatility, which is undesirable.</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">sharpeRatio</span><span class="hl-1"> = </span><span class="hl-4">stdDev</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><span class="hl-1"> ? </span><span class="hl-4">avgPnl</span><span class="hl-1"> / </span><span class="hl-4">stdDev</span><span class="hl-1"> : </span><span class="hl-6">0</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Typical Values:</strong></p>
<ul>
<li><code>&lt; 0</code>: Losing strategy</li>
<li><code>0.0 - 1.0</code>: Acceptable risk-adjusted returns</li>
<li><code>1.0 - 2.0</code>: Good risk-adjusted returns</li>
<li><code>&gt; 2.0</code>: Excellent risk-adjusted returns</li>
</ul>
<hr>
<a id="annualized-sharpe-ratio" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Annualized Sharpe Ratio<a href="#annualized-sharpe-ratio" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The annualized Sharpe ratio scales the daily/per-trade Sharpe ratio to yearly terms for easier comparison with other investments.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">annualizedSharpeRatio</span><span class="hl-1"> = </span><span class="hl-4">sharpeRatio</span><span class="hl-1"> × √</span><span class="hl-6">365</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> This assumes 365 trading days per year. The square root scaling is based on the assumption that returns are independent and identically distributed (IID). Higher values are better, with same thresholds as regular Sharpe ratio.</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">annualizedSharpeRatio</span><span class="hl-1"> = </span><span class="hl-4">sharpeRatio</span><span class="hl-1"> * </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">sqrt</span><span class="hl-1">(</span><span class="hl-6">365</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Note:</strong> The multiplier <code>√365</code> assumes daily trading frequency. For different frequencies, adjust accordingly (e.g., <code>√52</code> for weekly).</p>
<hr>
<a id="certainty-ratio" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Certainty Ratio<a href="#certainty-ratio" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The certainty ratio (also called risk/reward ratio) measures the relationship between average winning trades and average losing trades.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">certaintyRatio</span><span class="hl-1"> = </span><span class="hl-4">avgWin</span><span class="hl-1"> / |</span><span class="hl-4">avgLoss</span><span class="hl-1">|</span><br/><span class="hl-10">where</span><span class="hl-1">:</span><br/><span class="hl-1">  </span><span class="hl-4">avgWin</span><span class="hl-1"> = </span><span class="hl-4">average</span><span class="hl-1"> </span><span class="hl-4">profit</span><span class="hl-1"> </span><span class="hl-4">on</span><span class="hl-1"> </span><span class="hl-4">winning</span><span class="hl-1"> </span><span class="hl-4">trades</span><br/><span class="hl-1">  </span><span class="hl-4">avgLoss</span><span class="hl-1"> = </span><span class="hl-4">average</span><span class="hl-1"> </span><span class="hl-4">loss</span><span class="hl-1"> </span><span class="hl-4">on</span><span class="hl-1"> </span><span class="hl-4">losing</span><span class="hl-1"> </span><span class="hl-0">trades</span><span class="hl-1"> (</span><span class="hl-4">negative</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> Higher values are better. A ratio above 1.0 means average wins are larger than average losses. A ratio of 2.0 means average wins are twice the size of average losses, which is generally considered good risk management.</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Calculate Certainty Ratio</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">wins</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">((</span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">losses</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">((</span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &lt; </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgWin</span><span class="hl-1"> = </span><span class="hl-4">wins</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><br/><span class="hl-1">  ? </span><span class="hl-4">wins</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-4">wins</span><span class="hl-1">.</span><span class="hl-4">length</span><br/><span class="hl-1">  : </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgLoss</span><span class="hl-1"> = </span><span class="hl-4">losses</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><br/><span class="hl-1">  ? </span><span class="hl-4">losses</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-4">losses</span><span class="hl-1">.</span><span class="hl-4">length</span><br/><span class="hl-1">  : </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">certaintyRatio</span><span class="hl-1"> = </span><span class="hl-4">avgLoss</span><span class="hl-1"> &lt; </span><span class="hl-6">0</span><span class="hl-1"> ? </span><span class="hl-4">avgWin</span><span class="hl-1"> / </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">abs</span><span class="hl-1">(</span><span class="hl-4">avgLoss</span><span class="hl-1">) : </span><span class="hl-6">0</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Example:</strong> If <code>avgWin = 3.0%</code> and <code>avgLoss = -1.5%</code>, then <code>certaintyRatio = 3.0 / 1.5 = 2.0</code>.</p>
<hr>
<a id="expected-yearly-returns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Expected Yearly Returns<a href="#expected-yearly-returns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Expected yearly returns project the strategy's performance over a full year based on average trade duration and average PNL.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">avgDurationDays</span><span class="hl-1"> = </span><span class="hl-4">avgDurationMs</span><span class="hl-1"> / (</span><span class="hl-6">1000</span><span class="hl-1"> × </span><span class="hl-6">60</span><span class="hl-1"> × </span><span class="hl-6">60</span><span class="hl-1"> × </span><span class="hl-6">24</span><span class="hl-1">)</span><br/><span class="hl-4">tradesPerYear</span><span class="hl-1"> = </span><span class="hl-6">365</span><span class="hl-1"> / </span><span class="hl-4">avgDurationDays</span><br/><span class="hl-4">expectedYearlyReturns</span><span class="hl-1"> = </span><span class="hl-4">avgPnl</span><span class="hl-1"> × </span><span class="hl-4">tradesPerYear</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> Higher values are better. This metric assumes: (1) constant capital allocation per trade, (2) trades can be executed consecutively without gaps, (3) future performance matches historical average. It provides a rough estimate of annualized returns.</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Calculate Expected Yearly Returns</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgDurationMs</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + (</span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">closeTimestamp</span><span class="hl-1"> - </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">pendingAt</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">0</span><br/><span class="hl-1">) / </span><span class="hl-4">totalSignals</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgDurationDays</span><span class="hl-1"> = </span><span class="hl-4">avgDurationMs</span><span class="hl-1"> / (</span><span class="hl-6">1000</span><span class="hl-1"> * </span><span class="hl-6">60</span><span class="hl-1"> * </span><span class="hl-6">60</span><span class="hl-1"> * </span><span class="hl-6">24</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">tradesPerYear</span><span class="hl-1"> = </span><span class="hl-4">avgDurationDays</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><span class="hl-1"> ? </span><span class="hl-6">365</span><span class="hl-1"> / </span><span class="hl-4">avgDurationDays</span><span class="hl-1"> : </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">expectedYearlyReturns</span><span class="hl-1"> = </span><span class="hl-4">avgPnl</span><span class="hl-1"> * </span><span class="hl-4">tradesPerYear</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Example:</strong> If <code>avgPnl = 2.5%</code> and average trade duration is 5 days, then <code>tradesPerYear = 73</code> and <code>expectedYearlyReturns = 2.5% × 73 = 182.5%</code>.</p>
<hr>
<a id="advanced-portfolio-metrics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Advanced Portfolio Metrics<a href="#advanced-portfolio-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>These metrics are calculated by <code>HeatMarkdownService</code> for portfolio-wide analysis across multiple symbols.</p>
<a id="profit-factor" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Profit Factor<a href="#profit-factor" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Profit factor compares the sum of all winning trades to the sum of all losing trades.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">profitFactor</span><span class="hl-1"> = </span><span class="hl-0">Σ</span><span class="hl-1">(</span><span class="hl-4">winning</span><span class="hl-1"> </span><span class="hl-4">trades</span><span class="hl-1">) / |</span><span class="hl-0">Σ</span><span class="hl-1">(</span><span class="hl-4">losing</span><span class="hl-1"> </span><span class="hl-4">trades</span><span class="hl-1">)|</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> Higher values are better. A profit factor above 1.0 means total profits exceed total losses. Values above 1.5 are considered good, above 2.0 are excellent.</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Calculate Profit Factor</span><br/><span class="hl-7">let</span><span class="hl-1"> </span><span class="hl-4">profitFactor</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1"> = </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">totalWins</span><span class="hl-1"> = </span><span class="hl-4">wins</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">totalLosses</span><span class="hl-1"> = </span><span class="hl-4">losses</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">totalLosses</span><span class="hl-1"> &lt; </span><span class="hl-6">0</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">profitFactor</span><span class="hl-1"> = </span><span class="hl-4">totalWins</span><span class="hl-1"> / </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">abs</span><span class="hl-1">(</span><span class="hl-4">totalLosses</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-3">else</span><span class="hl-1"> </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">totalWins</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">totalLosses</span><span class="hl-1"> === </span><span class="hl-6">0</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">profitFactor</span><span class="hl-1"> = </span><span class="hl-7">Infinity</span><span class="hl-1">; </span><span class="hl-5">// All wins, no losses</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="maximum-drawdown" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Maximum Drawdown<a href="#maximum-drawdown" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Maximum drawdown measures the largest peak-to-trough decline in cumulative PNL. This is a critical risk metric.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">For</span><span class="hl-1"> </span><span class="hl-4">each</span><span class="hl-1"> </span><span class="hl-4">point</span><span class="hl-1"> </span><span class="hl-4">i</span><span class="hl-1"> </span><span class="hl-7">in</span><span class="hl-1"> </span><span class="hl-4">cumulative</span><span class="hl-1"> </span><span class="hl-10">PNL</span><span class="hl-1">:</span><br/><span class="hl-1">  </span><span class="hl-4">peak</span><span class="hl-1"> = </span><span class="hl-4">max</span><span class="hl-1"> </span><span class="hl-4">cumulative</span><span class="hl-1"> </span><span class="hl-8">PNL</span><span class="hl-1"> </span><span class="hl-4">up</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-4">point</span><span class="hl-1"> </span><span class="hl-4">i</span><br/><span class="hl-1">  </span><span class="hl-4">drawdown</span><span class="hl-1">[</span><span class="hl-4">i</span><span class="hl-1">] = (</span><span class="hl-4">cumulative</span><span class="hl-1">[</span><span class="hl-4">i</span><span class="hl-1">] - </span><span class="hl-4">peak</span><span class="hl-1">) / </span><span class="hl-4">peak</span><span class="hl-1"> × </span><span class="hl-6">100</span><br/><span class="hl-4">maxDrawdown</span><span class="hl-1"> = </span><span class="hl-0">min</span><span class="hl-1">(</span><span class="hl-4">drawdown</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> Lower absolute values are better (less risk). A drawdown of -20% means the portfolio declined 20% from its peak before recovering. Large drawdowns indicate higher risk and potential for significant losses.</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Calculate Maximum Drawdown</span><br/><span class="hl-7">let</span><span class="hl-1"> </span><span class="hl-4">maxDrawdown</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1"> = </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-7">let</span><span class="hl-1"> </span><span class="hl-4">peak</span><span class="hl-1"> = </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-7">let</span><span class="hl-1"> </span><span class="hl-4">maxDD</span><span class="hl-1"> = </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-7">let</span><span class="hl-1"> </span><span class="hl-4">cumulative</span><span class="hl-1"> = </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">signal</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">signals</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">cumulative</span><span class="hl-1"> += </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">cumulative</span><span class="hl-1"> &gt; </span><span class="hl-4">peak</span><span class="hl-1">) </span><span class="hl-4">peak</span><span class="hl-1"> = </span><span class="hl-4">cumulative</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">drawdown</span><span class="hl-1"> = </span><span class="hl-4">cumulative</span><span class="hl-1"> - </span><span class="hl-4">peak</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">drawdown</span><span class="hl-1"> &lt; </span><span class="hl-4">maxDD</span><span class="hl-1">) </span><span class="hl-4">maxDD</span><span class="hl-1"> = </span><span class="hl-4">drawdown</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><span class="hl-4">maxDrawdown</span><span class="hl-1"> = </span><span class="hl-4">maxDD</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Example:</strong> If cumulative PNL reaches +30%, then drops to +10%, the drawdown is -20%.</p>
<hr>
<a id="expectancy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Expectancy<a href="#expectancy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Expectancy represents the average expected profit per trade, weighted by win rate.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">expectancy</span><span class="hl-1"> = (</span><span class="hl-4">winRate</span><span class="hl-1"> × </span><span class="hl-4">avgWin</span><span class="hl-1">) - ((</span><span class="hl-6">1</span><span class="hl-1"> - </span><span class="hl-4">winRate</span><span class="hl-1">) × |</span><span class="hl-4">avgLoss</span><span class="hl-1">|)</span>
</code><button>Copy</button></pre>

<p><strong>Interpretation:</strong> Positive values indicate a profitable strategy in the long run. This metric combines win rate, average win, and average loss into a single measure of expected profitability per trade.</p>
<p><strong>Calculation Code:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Calculate Expectancy</span><br/><span class="hl-7">let</span><span class="hl-1"> </span><span class="hl-4">expectancy</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1"> = </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">totalTrades</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">winRate</span><span class="hl-1"> !== </span><span class="hl-7">null</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">avgWin</span><span class="hl-1"> !== </span><span class="hl-7">null</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">avgLoss</span><span class="hl-1"> !== </span><span class="hl-7">null</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">lossRate</span><span class="hl-1"> = </span><span class="hl-6">1</span><span class="hl-1"> - </span><span class="hl-4">winRate</span><span class="hl-1"> / </span><span class="hl-6">100</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">expectancy</span><span class="hl-1"> = (</span><span class="hl-4">winRate</span><span class="hl-1"> / </span><span class="hl-6">100</span><span class="hl-1">) * </span><span class="hl-4">avgWin</span><span class="hl-1"> + </span><span class="hl-4">lossRate</span><span class="hl-1"> * </span><span class="hl-4">avgLoss</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Example:</strong> If <code>winRate = 60%</code>, <code>avgWin = 5%</code>, <code>avgLoss = -3%</code>, then:</p>
<pre><code><span class="hl-4">expectancy</span><span class="hl-1"> = (</span><span class="hl-6">0.60</span><span class="hl-1"> × </span><span class="hl-6">5</span><span class="hl-1">%) + (</span><span class="hl-6">0.40</span><span class="hl-1"> × -</span><span class="hl-6">3</span><span class="hl-1">%) = </span><span class="hl-6">3.0</span><span class="hl-1">% - </span><span class="hl-6">1.2</span><span class="hl-1">% = </span><span class="hl-6">1.8</span><span class="hl-1">%</span>
</code><button>Copy</button></pre>

<hr>
<a id="safety-and-validation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Safety and Validation<a href="#safety-and-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All numeric statistics use the <code>isUnsafe()</code> function to validate values before returning them. Invalid values are replaced with <code>null</code> to prevent displaying misleading data.</p>
<p><img src="../media/31-performance-statistics_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Implementation:</strong></p>
<pre><code class="typescript"><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1">): </span><span class="hl-13">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">typeof</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1"> !== </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-0">isNaN</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-0">isFinite</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">false</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Usage in Statistics:</strong></p>
<pre><code class="typescript"><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">signalList:</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">totalSignals</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">winCount</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">lossCount</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">winRate:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">winRate</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">winRate</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">avgPnl:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">avgPnl</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">avgPnl</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">totalPnl:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">totalPnl</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">totalPnl</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">stdDev:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">stdDev</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">stdDev</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">sharpeRatio:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">sharpeRatio</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">sharpeRatio</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">annualizedSharpeRatio:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">annualizedSharpeRatio</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">annualizedSharpeRatio</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">certaintyRatio:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">certaintyRatio</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">certaintyRatio</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">expectedYearlyReturns:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">expectedYearlyReturns</span><span class="hl-1">) ? </span><span class="hl-7">null</span><span class="hl-1"> : </span><span class="hl-4">expectedYearlyReturns</span><span class="hl-1">,</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><strong>Safety Guarantees:</strong></p>
<ul>
<li>Division by zero returns 0 (not NaN)</li>
<li>Empty datasets return <code>null</code> for all metrics</li>
<li>Infinity values (e.g., profit factor with no losses) are caught and nullified</li>
<li>Type checking prevents non-numeric values</li>
</ul>
<hr>
<a id="accessing-statistics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Accessing Statistics<a href="#accessing-statistics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each markdown service provides a <code>getData()</code> method to retrieve statistics programmatically. These methods return the full statistics interface with all calculated metrics.</p>
<p><img src="../media/31-performance-statistics_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Backtest Statistics Example:</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Backtest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// After running a backtest</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total signals: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalSignals</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Win rate: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">winRate</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Sharpe ratio: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">sharpeRatio</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">3</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total PNL: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalPnl</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Access raw signal data</span><br/><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">signal</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">signalList</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal </span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-7">}</span><span class="hl-2">: </span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">pnl</span><span class="hl-9">.</span><span class="hl-4">pnlPercentage</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Live Statistics Example:</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Live</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// After running live trading</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total events: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalEvents</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Closed signals: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalClosed</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Expected yearly returns: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">expectedYearlyReturns</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Access all events (idle, opened, active, closed)</span><br/><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">event</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">eventList</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Closed: </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">pnl</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Heatmap Statistics Example:</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Heat</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Get portfolio-wide statistics</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">heatmap</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Heat</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total symbols: </span><span class="hl-7">${</span><span class="hl-4">heatmap</span><span class="hl-9">.</span><span class="hl-4">totalSymbols</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Portfolio PNL: </span><span class="hl-7">${</span><span class="hl-4">heatmap</span><span class="hl-9">.</span><span class="hl-4">portfolioTotalPnl</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Portfolio Sharpe: </span><span class="hl-7">${</span><span class="hl-4">heatmap</span><span class="hl-9">.</span><span class="hl-4">portfolioSharpeRatio</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">3</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Analyze each symbol</span><br/><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">row</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">heatmap</span><span class="hl-1">.</span><span class="hl-4">symbols</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">:`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Total PNL: </span><span class="hl-7">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">totalPnl</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Max Drawdown: </span><span class="hl-7">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">maxDrawdown</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Profit Factor: </span><span class="hl-7">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">profitFactor</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="statistics-by-service" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Statistics by Service<a href="#statistics-by-service" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following table maps which metrics are available in each statistics interface:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Backtest</th>
<th>Live</th>
<th>Schedule</th>
<th>Walker</th>
<th>Performance</th>
<th>Heat</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>signalList / eventList</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td><strong>totalSignals / totalEvents</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td><strong>winCount</strong></td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
</tr>
<tr>
<td><strong>lossCount</strong></td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
</tr>
<tr>
<td><strong>winRate</strong></td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
</tr>
<tr>
<td><strong>avgPnl</strong></td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
</tr>
<tr>
<td><strong>totalPnl</strong></td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
</tr>
<tr>
<td><strong>stdDev</strong></td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td><strong>sharpeRatio</strong></td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
</tr>
<tr>
<td><strong>annualizedSharpeRatio</strong></td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><strong>certaintyRatio</strong></td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><strong>expectedYearlyReturns</strong></td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><strong>profitFactor</strong></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
</tr>
<tr>
<td><strong>maxDrawdown</strong></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
</tr>
<tr>
<td><strong>expectancy</strong></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
</tr>
<tr>
<td><strong>cancellationRate</strong></td>
<td>-</td>
<td>-</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><strong>activationRate</strong></td>
<td>-</td>
<td>-</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><strong>avgDuration</strong></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
<td>-</td>
</tr>
<tr>
<td><strong>median / p95 / p99</strong></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
<td>-</td>
</tr>
<tr>
<td><strong>bestStrategy / bestMetric</strong></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Notes:</strong></p>
<ul>
<li><code>BacktestStatistics</code> and <code>LiveStatistics</code> have identical metrics</li>
<li><code>ScheduleStatistics</code> focuses on scheduled signal lifecycle (activation/cancellation)</li>
<li><code>PerformanceStatistics</code> measures execution timing (durations, percentiles, wait times)</li>
<li><code>HeatMarkdownService</code> includes advanced portfolio metrics (profit factor, max drawdown, expectancy)</li>
<li><code>WalkerStatistics</code> compares multiple strategies and identifies the best performer</li>
</ul>
<hr>
<a id="null-value-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Null Value Handling<a href="#null-value-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All calculated metrics can be <code>null</code> if:</p>
<ol>
<li>No data available (empty signal list)</li>
<li>Division by zero (e.g., Sharpe ratio when stdDev = 0)</li>
<li>Invalid calculation result (NaN, Infinity)</li>
<li>Insufficient data for calculation</li>
</ol>
<p><strong>Display Pattern in Reports:</strong></p>
<pre><code class="typescript"><span class="hl-2">`**Win rate:** </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">winRate</span><span class="hl-9"> </span><span class="hl-1">===</span><span class="hl-9"> </span><span class="hl-7">null</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">winRate</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">% (</span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">winCount</span><span class="hl-7">}</span><span class="hl-2">W / </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">lossCount</span><span class="hl-7">}</span><span class="hl-2">L) (higher is better)`</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-2">`**Average PNL:** </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">avgPnl</span><span class="hl-9"> </span><span class="hl-1">===</span><span class="hl-9"> </span><span class="hl-7">null</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">avgPnl</span><span class="hl-9"> </span><span class="hl-1">&gt;</span><span class="hl-9"> </span><span class="hl-6">0</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;+&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">&quot;&quot;</span><span class="hl-7">}${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">avgPnl</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">% (higher is better)`</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-2">`**Total PNL:** </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalPnl</span><span class="hl-9"> </span><span class="hl-1">===</span><span class="hl-9"> </span><span class="hl-7">null</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalPnl</span><span class="hl-9"> </span><span class="hl-1">&gt;</span><span class="hl-9"> </span><span class="hl-6">0</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;+&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">&quot;&quot;</span><span class="hl-7">}${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalPnl</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">% (higher is better)`</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-2">`**Standard Deviation:** </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">stdDev</span><span class="hl-9"> </span><span class="hl-1">===</span><span class="hl-9"> </span><span class="hl-7">null</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">stdDev</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">3</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">% (lower is better)`</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-2">`**Sharpe Ratio:** </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">sharpeRatio</span><span class="hl-9"> </span><span class="hl-1">===</span><span class="hl-9"> </span><span class="hl-7">null</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">sharpeRatio</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">3</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2"> (higher is better)`</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-2">`**Annualized Sharpe Ratio:** </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">annualizedSharpeRatio</span><span class="hl-9"> </span><span class="hl-1">===</span><span class="hl-9"> </span><span class="hl-7">null</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">annualizedSharpeRatio</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">3</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2"> (higher is better)`</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-2">`**Certainty Ratio:** </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">certaintyRatio</span><span class="hl-9"> </span><span class="hl-1">===</span><span class="hl-9"> </span><span class="hl-7">null</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">certaintyRatio</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">3</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2"> (higher is better)`</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-2">`**Expected Yearly Returns:** </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">expectedYearlyReturns</span><span class="hl-9"> </span><span class="hl-1">===</span><span class="hl-9"> </span><span class="hl-7">null</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;N/A&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">expectedYearlyReturns</span><span class="hl-9"> </span><span class="hl-1">&gt;</span><span class="hl-9"> </span><span class="hl-6">0</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;+&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">&quot;&quot;</span><span class="hl-7">}${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">expectedYearlyReturns</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">% (higher is better)`</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span>
</code><button type="button">Copy</button></pre>

<p>This pattern ensures reports always display meaningful information, even when calculations fail or data is insufficient.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#performance-statistics"><span>Performance <wbr/>Statistics</span></a><ul><li><a href="#statistics-interfaces-overview"><span>Statistics <wbr/>Interfaces <wbr/>Overview</span></a></li><li><a href="#statistics-calculation-flow"><span>Statistics <wbr/>Calculation <wbr/>Flow</span></a></li><li><a href="#core-performance-metrics"><span>Core <wbr/>Performance <wbr/>Metrics</span></a></li><li><ul><li><a href="#win-rate"><span>Win <wbr/>Rate</span></a></li><li><a href="#average-pnl"><span>Average PNL</span></a></li><li><a href="#total-pnl"><span>Total PNL</span></a></li><li><a href="#standard-deviation-volatility"><span>Standard <wbr/>Deviation (<wbr/>Volatility)</span></a></li><li><a href="#sharpe-ratio"><span>Sharpe <wbr/>Ratio</span></a></li><li><a href="#annualized-sharpe-ratio"><span>Annualized <wbr/>Sharpe <wbr/>Ratio</span></a></li><li><a href="#certainty-ratio"><span>Certainty <wbr/>Ratio</span></a></li><li><a href="#expected-yearly-returns"><span>Expected <wbr/>Yearly <wbr/>Returns</span></a></li></ul></li><li><a href="#advanced-portfolio-metrics"><span>Advanced <wbr/>Portfolio <wbr/>Metrics</span></a></li><li><ul><li><a href="#profit-factor"><span>Profit <wbr/>Factor</span></a></li><li><a href="#maximum-drawdown"><span>Maximum <wbr/>Drawdown</span></a></li><li><a href="#expectancy"><span>Expectancy</span></a></li></ul></li><li><a href="#safety-and-validation"><span>Safety and <wbr/>Validation</span></a></li><li><a href="#accessing-statistics"><span>Accessing <wbr/>Statistics</span></a></li><li><a href="#statistics-by-service"><span>Statistics by <wbr/>Service</span></a></li><li><a href="#null-value-handling"><span>Null <wbr/>Value <wbr/>Handling</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
