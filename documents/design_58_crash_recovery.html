<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/58_crash_recovery | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_58_crash_recovery.html">design/58_crash_recovery</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="crash-recovery" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Crash Recovery<a href="#crash-recovery" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This document explains the crash-safe persistence mechanism in the backtest-kit framework that ensures live trading strategies can recover gracefully from process crashes, restarts, or unexpected failures. The crash recovery system prevents duplicate signals and ensures no active trades are lost when the process terminates unexpectedly.</p>
<p><strong>Scope</strong>: This page covers signal state persistence, atomic file writes, state recovery on restart, and custom persistence adapters. For information about signal lifecycle states, see <a href="design_47_signal_states.html">Signal States</a>. For live trading execution flow, see <a href="design_47_signal_states.html">Live Execution Flow</a>. For backtest mode (which does not use persistence), see <a href="design_39_service_architecture_overview.html">Backtest Execution Flow</a>.</p>
<p><strong>Note</strong>: Crash recovery only applies to live trading mode. Backtest mode skips all persistence operations since historical data can be re-executed deterministically.</p>
<hr>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The crash recovery system solves a critical problem in live trading: maintaining signal state across process restarts. Without persistence, a process crash would lose track of open positions, potentially creating duplicate signals or abandoning active trades.</p>
<p>The framework addresses this through:</p>
<ol>
<li><strong>Atomic File Writes</strong> - Signal state is written to disk atomically before yielding results, preventing partial writes or corruption</li>
<li><strong>Automatic State Recovery</strong> - On restart, <code>waitForInit()</code> loads the last known state from disk</li>
<li><strong>Validation Guards</strong> - Ensures loaded state matches current strategy/exchange configuration</li>
<li><strong>Single Source of Truth</strong> - File system serves as the authoritative source for signal state</li>
</ol>
<hr>
<a id="persistence-points-in-signal-lifecycle" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Persistence Points in Signal Lifecycle<a href="#persistence-points-in-signal-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Signal state is persisted at two critical moments to ensure crash safety:</p>
<p><strong>Diagram: When Persistence Occurs</strong></p>
<p><img src="../media/58_Crash_Recovery_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Principle</strong>: State is persisted <strong>before</strong> yielding the result to the user. This ensures the disk state is always consistent with what the user observes.</p>
<hr>
<a id="atomic-write-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Atomic Write Implementation<a href="#atomic-write-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>setPendingSignal()</code> method centralizes all state changes and ensures atomic persistence:</p>
<p><strong>Diagram: setPendingSignal Flow</strong></p>
<p><img src="../media/58_Crash_Recovery_1.svg" alt="Mermaid Diagram"></p>
<p>The atomic write prevents corruption even if the process crashes mid-write. The temp file + rename pattern ensures the final file is either complete or doesn't exist.</p>
<hr>
<a id="state-recovery-on-restart" class="tsd-anchor"></a><h2 class="tsd-anchor-link">State Recovery on Restart<a href="#state-recovery-on-restart" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When a live trading process restarts, <code>waitForInit()</code> restores the signal state before any tick execution:</p>
<p><strong>Diagram: State Recovery Flow</strong></p>
<p><img src="../media/58_Crash_Recovery_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Validation Guards</strong>: The recovery logic validates that the persisted signal matches the current configuration. This prevents resuming with the wrong exchange or strategy after configuration changes.</p>
<hr>
<a id="file-based-persistence-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">File-Based Persistence Architecture<a href="#file-based-persistence-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The default persistence implementation uses the file system with a structured directory layout:</p>
<p><strong>Directory Structure</strong>:</p>
<pre><code><span class="hl-1">./</span><span class="hl-4">storage</span><span class="hl-1">/</span><span class="hl-4">signals</span><span class="hl-1">/</span><br/><span class="hl-1">├── </span><span class="hl-4">strategy</span><span class="hl-1">-</span><span class="hl-4">name</span><span class="hl-1">-</span><span class="hl-6">1</span><span class="hl-1">/</span><br/><span class="hl-1">│   ├── </span><span class="hl-8">BTCUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">│   ├── </span><span class="hl-8">ETHUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">│   └── </span><span class="hl-8">SOLUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">├── </span><span class="hl-4">strategy</span><span class="hl-1">-</span><span class="hl-4">name</span><span class="hl-1">-</span><span class="hl-6">2</span><span class="hl-1">/</span><br/><span class="hl-1">│   ├── </span><span class="hl-8">BTCUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">│   └── </span><span class="hl-8">ETHUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">└── </span><span class="hl-4">another</span><span class="hl-1">-</span><span class="hl-4">strategy</span><span class="hl-1">/</span><br/><span class="hl-1">    └── </span><span class="hl-8">BTCUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span>
</code><button>Copy</button></pre>

<p>Each file contains an <code>ISignalData</code> object:</p>
<pre><code class="typescript"><span class="hl-5">// Example: ./storage/signals/my-strategy/BTCUSDT.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;signalRow&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;id&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;abc-123-uuid&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;position&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;note&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;Breakout signal&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;priceOpen&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">50000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;priceTakeProfit&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">51000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;priceStopLoss&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">49000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;minuteEstimatedTime&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">60</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;timestamp&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">1704067200000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;symbol&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;exchangeName&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;strategyName&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>When a signal closes, the file is updated with <code>signalRow: null</code>:</p>
<pre><code class="typescript"><span class="hl-5">// After signal closure</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;signalRow&quot;</span><span class="hl-1">: </span><span class="hl-7">null</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key Classes</strong>:</p>
<table>
<thead>
<tr>
<th>Class</th>
<th>Role</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PersistSignalAdapter</code></td>
<td>Global singleton for signal persistence operations</td>
<td><a href="">src/classes/Persist.ts</a></td>
</tr>
<tr>
<td><code>PersistBase</code></td>
<td>Base class for file-based CRUD with atomic writes</td>
<td><a href="">src/classes/Persist.ts</a></td>
</tr>
<tr>
<td><code>PersistSignalUtils</code></td>
<td>Utility class with memoized storage instances</td>
<td><a href="">types.d.ts:1067-1108</a></td>
</tr>
</tbody>
</table>
<hr>
<a id="persistbase-internal-mechanism" class="tsd-anchor"></a><h2 class="tsd-anchor-link">PersistBase Internal Mechanism<a href="#persistbase-internal-mechanism" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>PersistBase</code> class implements the low-level persistence operations:</p>
<p><strong>Diagram: PersistBase.writeValue() Internals</strong></p>
<p><img src="../media/58_Crash_Recovery_3.svg" alt="Mermaid Diagram"></p>
<p>The atomic rename operation (<code>fs.rename()</code>) is the critical step that ensures atomicity. On POSIX systems, rename is atomic at the filesystem level, meaning the file either appears complete or doesn't appear at all - no partial writes are visible.</p>
<p><strong>Diagram: PersistBase.readValue() Internals</strong></p>
<p><img src="../media/58_Crash_Recovery_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Auto-Cleanup</strong>: If a file becomes corrupted (invalid JSON), <code>PersistBase</code> automatically deletes it and throws an error. This prevents accumulating corrupted files and ensures clean restarts.</p>
<hr>
<a id="custom-persistence-adapters" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Custom Persistence Adapters<a href="#custom-persistence-adapters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework allows replacing the default file-based persistence with custom implementations (e.g., Redis, PostgreSQL, MongoDB):</p>
<p><strong>Diagram: Custom Adapter Integration</strong></p>
<p><img src="../media/58_Crash_Recovery_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Example Implementation</strong>:</p>
<pre><code class="typescript"><span class="hl-5">// Custom Redis-based persistence adapter</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">PersistBase</span><span class="hl-1">, </span><span class="hl-4">PersistSignalAdapter</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">Redis</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;ioredis&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">redis</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Redis</span><span class="hl-1">();</span><br/><br/><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-13">RedisPersist</span><span class="hl-1"> </span><span class="hl-7">extends</span><span class="hl-1"> </span><span class="hl-13">PersistBase</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">readValue</span><span class="hl-1">(</span><span class="hl-4">entityId</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">data</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-7">this</span><span class="hl-9">.</span><span class="hl-4">entityName</span><span class="hl-7">}</span><span class="hl-2">:</span><span class="hl-7">${</span><span class="hl-4">entityId</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Entity not found&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">writeValue</span><span class="hl-1">(</span><span class="hl-4">entityId</span><span class="hl-1">, </span><span class="hl-4">entity</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-7">this</span><span class="hl-9">.</span><span class="hl-4">entityName</span><span class="hl-7">}</span><span class="hl-2">:</span><span class="hl-7">${</span><span class="hl-4">entityId</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-4">entity</span><span class="hl-1">)</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">hasValue</span><span class="hl-1">(</span><span class="hl-4">entityId</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> (</span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">exists</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-7">this</span><span class="hl-9">.</span><span class="hl-4">entityName</span><span class="hl-7">}</span><span class="hl-2">:</span><span class="hl-7">${</span><span class="hl-4">entityId</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">)) === </span><span class="hl-6">1</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Register before starting live trading</span><br/><span class="hl-4">PersistSignalAdapter</span><span class="hl-1">.</span><span class="hl-0">usePersistSignalAdapter</span><span class="hl-1">(</span><span class="hl-4">RedisPersist</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Requirements</strong>: Custom adapters must extend <code>PersistBase</code> and implement the <code>IPersistBase&lt;ISignalData&gt;</code> interface. The adapter must handle atomicity and error recovery according to the backing store's capabilities.</p>
<hr>
<a id="crash-recovery-example-walkthrough" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Crash Recovery Example Walkthrough<a href="#crash-recovery-example-walkthrough" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>Scenario</strong>: A live trading bot crashes while monitoring an active signal. Here's how recovery works:</p>
<p><strong>Initial State (Before Crash)</strong>:</p>
<pre><code class="typescript"><span class="hl-5">// Bot is running Live.run(&quot;BTCUSDT&quot;, {...})</span><br/><span class="hl-5">// Signal opened at 12:00:00</span><br/><span class="hl-5">// File written: ./storage/signals/my-strategy/BTCUSDT.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;signalRow&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;id&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;xyz-789&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;position&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;priceOpen&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">50000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;priceTakeProfit&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">51000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;priceStopLoss&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">49000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;timestamp&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">1704067200000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">// ... other fields</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Bot yields: { action: &quot;opened&quot;, signal: {...} }</span><br/><span class="hl-5">// Next tick: { action: &quot;active&quot;, currentPrice: 50100 }</span><br/><span class="hl-5">// ⚠️ PROCESS CRASHES HERE ⚠️</span>
</code><button type="button">Copy</button></pre>

<p><strong>Recovery Sequence (After Restart)</strong>:</p>
<p><img src="../media/58_Crash_Recovery_6.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Points</strong>:</p>
<ul>
<li>No duplicate signal is created because <code>_pendingSignal</code> is already set</li>
<li>The strategy immediately resumes monitoring TP/SL conditions</li>
<li>If TP/SL was hit during downtime, it will be detected on the first tick</li>
<li>The user sees <code>action: &quot;active&quot;</code> instead of <code>action: &quot;opened&quot;</code>, indicating recovery</li>
</ul>
<hr>
<a id="backtest-mode-skips-persistence" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Backtest Mode Skips Persistence<a href="#backtest-mode-skips-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The crash recovery system is disabled in backtest mode for performance and correctness reasons:</p>
<p><strong>Comparison Table</strong>:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Live Mode</th>
<th>Backtest Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>setPendingSignal()</code> behavior</td>
<td>Writes to disk atomically</td>
<td>Memory-only update</td>
</tr>
<tr>
<td><code>waitForInit()</code> behavior</td>
<td>Loads persisted state</td>
<td>Returns immediately (no-op)</td>
</tr>
<tr>
<td>Crash recovery</td>
<td>Fully enabled</td>
<td>Not applicable</td>
</tr>
<tr>
<td>Performance</td>
<td>Slower (disk I/O)</td>
<td>Faster (memory-only)</td>
</tr>
<tr>
<td>Determinism</td>
<td>State survives crashes</td>
<td>Re-run produces identical results</td>
</tr>
</tbody>
</table>
<p><strong>Why Skip Persistence in Backtest?</strong></p>
<ol>
<li><strong>Performance</strong>: Backtests iterate through thousands of timestamps. Disk I/O on every signal would be prohibitively slow</li>
<li><strong>Determinism</strong>: Historical data can be re-executed. No need to preserve state</li>
<li><strong>Idempotency</strong>: Running the same backtest twice should produce identical results. Persistence would create state pollution</li>
</ol>
<p><strong>Code Implementation</strong>:</p>
<pre><code class="typescript"><span class="hl-5">// src/client/ClientStrategy.ts:220-233</span><br/><br/><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">setPendingSignal</span><span class="hl-1">(</span><span class="hl-4">pendingSignal</span><span class="hl-1">: </span><span class="hl-4">ISignalRow</span><span class="hl-1"> | </span><span class="hl-7">null</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">debug</span><span class="hl-1">(</span><span class="hl-2">&quot;ClientStrategy setPendingSignal&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-4">pendingSignal</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_pendingSignal</span><span class="hl-1"> = </span><span class="hl-4">pendingSignal</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Skip persistence in backtest mode</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">backtest</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Only persist in live mode</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">PersistSignalAdaper</span><span class="hl-1">.</span><span class="hl-0">writeSignalData</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_pendingSignal</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">symbol</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="limitations-and-edge-cases" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Limitations and Edge Cases<a href="#limitations-and-edge-cases" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="one-signal-per-strategy-symbol-pair" class="tsd-anchor"></a><h3 class="tsd-anchor-link">One Signal Per Strategy-Symbol Pair<a href="#one-signal-per-strategy-symbol-pair" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The persistence system stores <strong>one signal</strong> per <code>(strategyName, symbol)</code> combination:</p>
<pre><code><span class="hl-1">./</span><span class="hl-4">storage</span><span class="hl-1">/</span><span class="hl-4">signals</span><span class="hl-1">/</span><br/><span class="hl-1">└── </span><span class="hl-4">my</span><span class="hl-1">-</span><span class="hl-4">strategy</span><span class="hl-1">/</span><br/><span class="hl-1">    ├── </span><span class="hl-8">BTCUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span><span class="hl-1">     ← </span><span class="hl-4">One</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1"> </span><span class="hl-4">for</span><span class="hl-1"> </span><span class="hl-8">BTCUSDT</span><br/><span class="hl-1">    ├── </span><span class="hl-8">ETHUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span><span class="hl-1">     ← </span><span class="hl-4">One</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1"> </span><span class="hl-4">for</span><span class="hl-1"> </span><span class="hl-8">ETHUSDT</span><br/><span class="hl-1">    └── </span><span class="hl-8">SOLUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span><span class="hl-1">     ← </span><span class="hl-4">One</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1"> </span><span class="hl-4">for</span><span class="hl-1"> </span><span class="hl-8">SOLUSDT</span>
</code><button>Copy</button></pre>

<p><strong>Implication</strong>: If your strategy generates multiple concurrent signals for the same symbol, only the most recent one will be persisted. The framework is designed for <strong>one-signal-at-a-time</strong> strategies.</p>
<a id="configuration-changes-between-restarts" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Configuration Changes Between Restarts<a href="#configuration-changes-between-restarts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If you change the strategy or exchange configuration between restarts, the validation guards will reject the persisted state:</p>
<pre><code class="typescript"><span class="hl-5">// First run</span><br/><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;strategy-v1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><br/><span class="hl-1">});</span><br/><span class="hl-5">// Signal persisted for strategy-v1 + binance</span><br/><br/><span class="hl-5">// After restart with different config</span><br/><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;strategy-v1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;coinbase&quot;</span><span class="hl-1">  </span><span class="hl-5">// ❌ Changed exchange</span><br/><span class="hl-1">});</span><br/><span class="hl-5">// Validation fails: exchangeName mismatch</span><br/><span class="hl-5">// Returns null, starts fresh</span>
</code><button type="button">Copy</button></pre>

<p><strong>Rationale</strong>: Prevents executing signals with the wrong exchange/strategy after configuration drift.</p>
<a id="file-system-requirements" class="tsd-anchor"></a><h3 class="tsd-anchor-link">File System Requirements<a href="#file-system-requirements" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The default <code>PersistBase</code> implementation requires:</p>
<ul>
<li><strong>Write permissions</strong> in the <code>./storage/signals/</code> directory</li>
<li><strong>Atomic rename support</strong> in the filesystem (POSIX-compliant)</li>
<li><strong>Sufficient disk space</strong> for JSON files (typically &lt;1KB per signal)</li>
</ul>
<p><strong>Non-POSIX systems</strong>: Windows NTFS supports atomic renames via <code>MoveFileEx</code> with <code>MOVEFILE_REPLACE_EXISTING</code>. The Node.js <code>fs.rename()</code> abstraction handles this correctly.</p>
<a id="concurrency-and-race-conditions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Concurrency and Race Conditions<a href="#concurrency-and-race-conditions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Single Process</strong>: The framework is designed for single-process execution. Running multiple processes with the same strategy+symbol will cause race conditions on file writes.</p>
<p><strong>Multi-Symbol Safety</strong>: Running the same strategy on different symbols is safe because each symbol has its own file:</p>
<pre><code class="typescript"><span class="hl-5">// Safe: Different symbols</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">([</span><br/><span class="hl-1">  </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, { </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;s1&quot;</span><span class="hl-1">, </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">  </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;ETHUSDT&quot;</span><span class="hl-1">, { </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;s1&quot;</span><span class="hl-1">, </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">]);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Multi-Strategy Safety</strong>: Running different strategies on the same symbol is safe because each strategy has its own directory:</p>
<pre><code class="typescript"><span class="hl-5">// Safe: Different strategies</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">([</span><br/><span class="hl-1">  </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, { </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;s1&quot;</span><span class="hl-1">, </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">  </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, { </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;s2&quot;</span><span class="hl-1">, </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">]);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="integration-with-signal-lifecycle" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Signal Lifecycle<a href="#integration-with-signal-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The crash recovery system integrates seamlessly with the signal lifecycle state machine:</p>
<p><strong>State Machine with Persistence Points</strong>:</p>
<p><img src="../media/58_Crash_Recovery_7.svg" alt="Mermaid Diagram"></p>
<p><strong>Recovery Behavior by State</strong>:</p>
<table>
<thead>
<tr>
<th>Last Persisted State</th>
<th>Recovery Behavior</th>
<th>First Tick Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>No file exists</td>
<td>Starts fresh</td>
<td><code>action: &quot;idle&quot;</code> or <code>action: &quot;opened&quot;</code></td>
</tr>
<tr>
<td><code>signalRow: ISignalRow</code></td>
<td>Resumes monitoring</td>
<td><code>action: &quot;active&quot;</code></td>
</tr>
<tr>
<td><code>signalRow: null</code></td>
<td>Starts fresh</td>
<td><code>action: &quot;idle&quot;</code> or <code>action: &quot;opened&quot;</code></td>
</tr>
</tbody>
</table>
<hr>
<a id="monitoring-and-debugging-persistence" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Monitoring and Debugging Persistence<a href="#monitoring-and-debugging-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides logging at key persistence points:</p>
<p><strong>Log Messages to Watch</strong>:</p>
<pre><code class="typescript"><span class="hl-5">// On initialization</span><br/><span class="hl-2">&quot;ClientStrategy waitForInit&quot;</span><br/><span class="hl-5">// Indicates state recovery attempt</span><br/><br/><span class="hl-5">// On signal state change</span><br/><span class="hl-2">&quot;ClientStrategy setPendingSignal&quot;</span><br/><span class="hl-5">// Indicates persistence operation</span><br/><span class="hl-5">// payload: { pendingSignal: ISignalRow | null }</span><br/><br/><span class="hl-5">// On tick</span><br/><span class="hl-2">&quot;ClientStrategy tick&quot;</span><br/><span class="hl-5">// Indicates tick execution start</span><br/><br/><span class="hl-5">// On signal closure</span><br/><span class="hl-2">&quot;ClientStrategy closing&quot;</span><br/><span class="hl-5">// payload: { symbol, signalId, reason, priceClose, closeTimestamp, pnlPercentage }</span>
</code><button type="button">Copy</button></pre>

<p><strong>Debugging Persistence Issues</strong>:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">setLogger</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Custom logger for debugging</span><br/><span class="hl-0">setLogger</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">log</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">topic</span><span class="hl-1">, ...</span><span class="hl-4">args</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[LOG] </span><span class="hl-7">${</span><span class="hl-4">topic</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-4">args</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-0">debug</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">topic</span><span class="hl-1">, ...</span><span class="hl-4">args</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">debug</span><span class="hl-1">(</span><span class="hl-2">`[DEBUG] </span><span class="hl-7">${</span><span class="hl-4">topic</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-4">args</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-0">info</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">topic</span><span class="hl-1">, ...</span><span class="hl-4">args</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">`[INFO] </span><span class="hl-7">${</span><span class="hl-4">topic</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-4">args</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-0">warn</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">topic</span><span class="hl-1">, ...</span><span class="hl-4">args</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`[WARN] </span><span class="hl-7">${</span><span class="hl-4">topic</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-4">args</span><span class="hl-1">),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Check persistence manually</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">PersistSignalAdapter</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">signal</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">PersistSignalAdapter</span><span class="hl-1">.</span><span class="hl-0">readSignalData</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;BTCUSDT&quot;</span><br/><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Persisted signal:&quot;</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>File System Inspection</strong>:</p>
<pre><code class="bash"><span class="hl-5"># List all persisted signals</span><br/><span class="hl-0">ls</span><span class="hl-1"> </span><span class="hl-7">-lR</span><span class="hl-1"> </span><span class="hl-2">./storage/signals/</span><br/><br/><span class="hl-5"># View specific signal</span><br/><span class="hl-0">cat</span><span class="hl-1"> </span><span class="hl-2">./storage/signals/my-strategy/BTCUSDT.json</span><span class="hl-1"> | </span><span class="hl-0">jq</span><br/><br/><span class="hl-5"># Check for corrupted files</span><br/><span class="hl-0">find</span><span class="hl-1"> </span><span class="hl-2">./storage/signals</span><span class="hl-1"> </span><span class="hl-7">-name</span><span class="hl-1"> </span><span class="hl-2">&quot;*.json&quot;</span><span class="hl-1"> </span><span class="hl-7">-exec</span><span class="hl-1"> </span><span class="hl-2">sh</span><span class="hl-1"> </span><span class="hl-7">-c</span><span class="hl-1"> </span><span class="hl-2">&#39;jq empty &quot;$1&quot; 2&gt;/dev/null || echo &quot;Corrupted: $1&quot;&#39;</span><span class="hl-1"> </span><span class="hl-2">_</span><span class="hl-1"> </span><span class="hl-2">{}</span><span class="hl-1"> </span><span class="hl-12">\;</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#crash-recovery"><span>Crash <wbr/>Recovery</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#overview"><span>Overview</span></a></li><li><a href="#persistence-points-in-signal-lifecycle"><span>Persistence <wbr/>Points in <wbr/>Signal <wbr/>Lifecycle</span></a></li><li><a href="#atomic-write-implementation"><span>Atomic <wbr/>Write <wbr/>Implementation</span></a></li><li><a href="#state-recovery-on-restart"><span>State <wbr/>Recovery on <wbr/>Restart</span></a></li><li><a href="#file-based-persistence-architecture"><span>File-<wbr/>Based <wbr/>Persistence <wbr/>Architecture</span></a></li><li><a href="#persistbase-internal-mechanism"><span>Persist<wbr/>Base <wbr/>Internal <wbr/>Mechanism</span></a></li><li><a href="#custom-persistence-adapters"><span>Custom <wbr/>Persistence <wbr/>Adapters</span></a></li><li><a href="#crash-recovery-example-walkthrough"><span>Crash <wbr/>Recovery <wbr/>Example <wbr/>Walkthrough</span></a></li><li><a href="#backtest-mode-skips-persistence"><span>Backtest <wbr/>Mode <wbr/>Skips <wbr/>Persistence</span></a></li><li><a href="#limitations-and-edge-cases"><span>Limitations and <wbr/>Edge <wbr/>Cases</span></a></li><li><ul><li><a href="#one-signal-per-strategy-symbol-pair"><span>One <wbr/>Signal <wbr/>Per <wbr/>Strategy-<wbr/>Symbol <wbr/>Pair</span></a></li><li><a href="#configuration-changes-between-restarts"><span>Configuration <wbr/>Changes <wbr/>Between <wbr/>Restarts</span></a></li><li><a href="#file-system-requirements"><span>File <wbr/>System <wbr/>Requirements</span></a></li><li><a href="#concurrency-and-race-conditions"><span>Concurrency and <wbr/>Race <wbr/>Conditions</span></a></li></ul></li><li><a href="#integration-with-signal-lifecycle"><span>Integration with <wbr/>Signal <wbr/>Lifecycle</span></a></li><li><a href="#monitoring-and-debugging-persistence"><span>Monitoring and <wbr/>Debugging <wbr/>Persistence</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
