<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/84_persistence_layer | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_84_persistence_layer.html">design/84_persistence_layer</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="persistence-layer" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Persistence Layer<a href="#persistence-layer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Persistence Layer provides crash-safe state management for live trading by atomically writing signal data to disk. This enables automatic recovery of active and scheduled signals after process crashes or restarts, ensuring that open trading positions are never lost. The layer is only active in Live mode; Backtest mode operates entirely in-memory for performance.</p>
<p>For information about Live mode execution flow, see <a href="design_58_live_trading.html">Live Trading</a>. For signal lifecycle states, see <a href="design_48_signal_lifecycle.html">Signal Lifecycle</a>.</p>
<hr>
<a id="architecture-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Overview<a href="#architecture-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The persistence layer implements a pluggable adapter pattern with atomic file writes to prevent data corruption during crashes.</p>
<p><img src="../media/84_Persistence_Layer_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="core-components" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Components<a href="#core-components" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="persistbase" class="tsd-anchor"></a><h3 class="tsd-anchor-link">PersistBase<a href="#persistbase" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Abstract base class providing atomic write operations and storage interface. All persistence adapters extend this class.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Atomic file writes using temp files + rename</li>
<li>Directory creation and validation</li>
<li>Abstract methods for custom backends</li>
</ul>
<p><strong>Methods:</strong></p>
<ul>
<li><code>writeData(filePath, data)</code> - Atomic write operation</li>
<li><code>readData(filePath)</code> - Read persisted data</li>
<li><code>deleteData(filePath)</code> - Remove persisted state</li>
<li><code>ensureDirectory(dirPath)</code> - Create storage directories</li>
</ul>
<hr>
<a id="persistsignaladapter" class="tsd-anchor"></a><h3 class="tsd-anchor-link">PersistSignalAdapter<a href="#persistsignaladapter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Manages persistence of active signals (opened → active → closed lifecycle).</p>
<p><img src="../media/84_Persistence_Layer_1.svg" alt="Mermaid Diagram"></p>
<p><strong>File Path Pattern:</strong></p>
<pre><code><span class="hl-1">./</span><span class="hl-4">dump</span><span class="hl-1">/</span><span class="hl-4">persist</span><span class="hl-1">/{</span><span class="hl-4">symbol</span><span class="hl-1">}</span><span class="hl-4">_</span><span class="hl-1">{</span><span class="hl-4">strategyName</span><span class="hl-1">}.</span><span class="hl-4">json</span>
</code><button>Copy</button></pre>

<p><strong>Data Structure:</strong></p>
<pre><code class="typescript"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">id</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">priceOpen</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">position</span><span class="hl-1">: </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;short&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">priceTakeProfit</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">priceStopLoss</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">minuteEstimatedTime</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">symbol</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">exchangeName</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">strategyName</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">scheduledAt</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">pendingAt</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">_isScheduled</span><span class="hl-1">: </span><span class="hl-7">false</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="persistscheduleadapter" class="tsd-anchor"></a><h3 class="tsd-anchor-link">PersistScheduleAdapter<a href="#persistscheduleadapter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Manages persistence of scheduled signals (awaiting price activation).</p>
<p><img src="../media/84_Persistence_Layer_2.svg" alt="Mermaid Diagram"></p>
<p><strong>File Path Pattern:</strong></p>
<pre><code><span class="hl-1">./</span><span class="hl-4">dump</span><span class="hl-1">/</span><span class="hl-4">schedule</span><span class="hl-1">/{</span><span class="hl-4">symbol</span><span class="hl-1">}</span><span class="hl-4">_</span><span class="hl-1">{</span><span class="hl-4">strategyName</span><span class="hl-1">}.</span><span class="hl-4">json</span>
</code><button>Copy</button></pre>

<p><strong>Data Structure:</strong></p>
<pre><code class="typescript"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">id</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">priceOpen</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;  </span><span class="hl-5">// Target activation price</span><br/><span class="hl-1">  </span><span class="hl-10">position</span><span class="hl-1">: </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;short&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">priceTakeProfit</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">priceStopLoss</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">minuteEstimatedTime</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">symbol</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">exchangeName</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">strategyName</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">scheduledAt</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">pendingAt</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;  </span><span class="hl-5">// Updated on activation</span><br/><span class="hl-1">  </span><span class="hl-10">_isScheduled</span><span class="hl-1">: </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="crash-recovery-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Crash Recovery Flow<a href="#crash-recovery-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When a live trading process restarts, the persistence layer automatically restores all active and scheduled signals.</p>
<p><img src="../media/84_Persistence_Layer_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Recovery Validation:</strong>
The system validates that restored signals match the current strategy configuration:</p>
<table>
<thead>
<tr>
<th>Validation Check</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exchangeName === current</code></td>
<td>Prevent cross-exchange contamination</td>
</tr>
<tr>
<td><code>strategyName === current</code></td>
<td>Prevent cross-strategy contamination</td>
</tr>
<tr>
<td>Signal structure valid</td>
<td>Ensure data integrity</td>
</tr>
</tbody>
</table>
<hr>
<a id="signal-state-persistence" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal State Persistence<a href="#signal-state-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="when-persistence-occurs" class="tsd-anchor"></a><h3 class="tsd-anchor-link">When Persistence Occurs<a href="#when-persistence-occurs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/84_Persistence_Layer_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Persistence Operations:</strong></p>
<table>
<thead>
<tr>
<th>State Transition</th>
<th>Persistence Action</th>
<th>Adapter</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>idle → scheduled</code></td>
<td><code>writeScheduleData()</code></td>
<td>PersistScheduleAdapter</td>
</tr>
<tr>
<td><code>idle → opened</code></td>
<td><code>writeSignalData()</code></td>
<td>PersistSignalAdapter</td>
</tr>
<tr>
<td><code>scheduled → opened</code></td>
<td><code>deleteScheduleData()</code> + <code>writeSignalData()</code></td>
<td>Both</td>
</tr>
<tr>
<td><code>scheduled → cancelled</code></td>
<td><code>deleteScheduleData()</code></td>
<td>PersistScheduleAdapter</td>
</tr>
<tr>
<td><code>active → closed</code></td>
<td><code>deleteSignalData()</code></td>
<td>PersistSignalAdapter</td>
</tr>
</tbody>
</table>
<hr>
<a id="atomic-write-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Atomic Write Implementation<a href="#atomic-write-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The persistence layer uses atomic file operations to prevent corruption during crashes.</p>
<p><img src="../media/84_Persistence_Layer_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Atomic Operation Sequence:</strong></p>
<ol>
<li><strong>Serialize to JSON</strong> - Convert <code>ISignalRow</code> to JSON string</li>
<li><strong>Write to temp file</strong> - <code>{filePath}.tmp</code> with full data</li>
<li><strong>Sync to disk</strong> - Ensure OS writes complete (fsync)</li>
<li><strong>Atomic rename</strong> - <code>rename(temp, final)</code> - OS-level atomic operation</li>
<li><strong>Verify existence</strong> - Confirm final file exists</li>
</ol>
<p><strong>Why This Prevents Corruption:</strong></p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Result</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>Crash before temp write complete</td>
<td>Old file intact</td>
<td>Temp file discarded, final untouched</td>
</tr>
<tr>
<td>Crash during temp write</td>
<td>Old file intact</td>
<td>Temp file partial, final untouched</td>
</tr>
<tr>
<td>Crash after write, before rename</td>
<td>Old file intact</td>
<td>Temp file complete, final untouched</td>
</tr>
<tr>
<td>Crash during rename</td>
<td>Either old or new file</td>
<td>OS guarantees rename atomicity</td>
</tr>
<tr>
<td>Crash after rename</td>
<td>New file intact</td>
<td>Rename completed successfully</td>
</tr>
</tbody>
</table>
<hr>
<a id="backtest-vs-live-mode" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Backtest vs Live Mode<a href="#backtest-vs-live-mode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Persistence behavior differs fundamentally between execution modes:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Backtest Mode</th>
<th>Live Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td>Persistence enabled</td>
<td>❌ No</td>
<td>✅ Yes</td>
</tr>
<tr>
<td>State storage</td>
<td>In-memory only</td>
<td>Disk-backed</td>
</tr>
<tr>
<td>Crash recovery</td>
<td>N/A (deterministic replay)</td>
<td>Automatic</td>
</tr>
<tr>
<td>Performance</td>
<td>Optimized (no I/O)</td>
<td>I/O overhead acceptable</td>
</tr>
<tr>
<td>File writes</td>
<td>None</td>
<td>Every signal state change</td>
</tr>
</tbody>
</table>
<p><img src="../media/84_Persistence_Layer_6.svg" alt="Mermaid Diagram"></p>
<p><strong>Conditional Execution Check:</strong></p>
<p>The framework uses <code>executionContextService.context.backtest</code> flag to skip persistence in backtest mode:</p>
<p><a href="">src/client/ClientStrategy.ts:493-495</a>:</p>
<pre><code class="typescript"><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">backtest</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1">; </span><span class="hl-5">// Skip persistence in backtest</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="custom-backend-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Custom Backend Implementation<a href="#custom-backend-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The persistence layer supports custom storage backends through the <code>PersistBase</code> abstract class.</p>
<a id="extension-points" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Extension Points<a href="#extension-points" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/84_Persistence_Layer_7.svg" alt="Mermaid Diagram"></p>
<a id="implementation-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Implementation Example<a href="#implementation-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Redis Backend:</strong></p>
<pre><code class="typescript"><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-11">RedisPersistBase</span><span class="hl-1"> </span><span class="hl-7">extends</span><span class="hl-1"> </span><span class="hl-11">PersistBase</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">writeData</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-11">any</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">serialized</span><span class="hl-1"> = </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">, </span><span class="hl-4">serialized</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">readData</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">any</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">data</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1"> ? </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">) : </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">deleteData</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">del</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">ensureDirectory</span><span class="hl-1">(</span><span class="hl-4">namespace</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-5">// Redis namespaces don&#39;t require creation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>MongoDB Backend:</strong></p>
<pre><code class="typescript"><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-11">MongoPersistBase</span><span class="hl-1"> </span><span class="hl-7">extends</span><span class="hl-1"> </span><span class="hl-11">PersistBase</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">writeData</span><span class="hl-1">(</span><span class="hl-4">docPath</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-11">any</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> [</span><span class="hl-8">collection</span><span class="hl-1">, </span><span class="hl-8">id</span><span class="hl-1">] = </span><span class="hl-4">docPath</span><span class="hl-1">.</span><span class="hl-0">split</span><span class="hl-1">(</span><span class="hl-2">&#39;/&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">.</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-4">collection</span><span class="hl-1">).</span><span class="hl-0">updateOne</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">id</span><span class="hl-1"> },</span><br/><span class="hl-1">      { </span><span class="hl-4">$set:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1"> },</span><br/><span class="hl-1">      { </span><span class="hl-4">upsert:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1"> }</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">readData</span><span class="hl-1">(</span><span class="hl-4">docPath</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">any</span><span class="hl-1"> | </span><span class="hl-11">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> [</span><span class="hl-8">collection</span><span class="hl-1">, </span><span class="hl-8">id</span><span class="hl-1">] = </span><span class="hl-4">docPath</span><span class="hl-1">.</span><span class="hl-0">split</span><span class="hl-1">(</span><span class="hl-2">&#39;/&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">.</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-4">collection</span><span class="hl-1">).</span><span class="hl-0">findOne</span><span class="hl-1">({ </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">deleteData</span><span class="hl-1">(</span><span class="hl-4">docPath</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> [</span><span class="hl-8">collection</span><span class="hl-1">, </span><span class="hl-8">id</span><span class="hl-1">] = </span><span class="hl-4">docPath</span><span class="hl-1">.</span><span class="hl-0">split</span><span class="hl-1">(</span><span class="hl-2">&#39;/&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">.</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-4">collection</span><span class="hl-1">).</span><span class="hl-0">deleteOne</span><span class="hl-1">({ </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">ensureDirectory</span><span class="hl-1">(</span><span class="hl-4">dbName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-5">// MongoDB creates collections automatically</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Custom Adapter Registration:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Replace default adapters with custom backends</span><br/><span class="hl-4">PersistSignalAdapter</span><span class="hl-1">.</span><span class="hl-0">setBackend</span><span class="hl-1">(</span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">RedisPersistBase</span><span class="hl-1">());</span><br/><span class="hl-4">PersistScheduleAdapter</span><span class="hl-1">.</span><span class="hl-0">setBackend</span><span class="hl-1">(</span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">MongoPersistBase</span><span class="hl-1">());</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="file-storage-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">File Storage Structure<a href="#file-storage-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Default file system backend organizes persisted data by type and symbol-strategy pairs.</p>
<pre><code><span class="hl-4">project</span><span class="hl-1">-</span><span class="hl-4">root</span><span class="hl-1">/</span><br/><span class="hl-1">└── </span><span class="hl-4">dump</span><span class="hl-1">/</span><br/><span class="hl-1">    ├── </span><span class="hl-4">persist</span><span class="hl-1">/              # </span><span class="hl-4">Active</span><span class="hl-1"> </span><span class="hl-4">signals</span><br/><span class="hl-1">    │   ├── </span><span class="hl-4">BTCUSDT_strategy1</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">    │   ├── </span><span class="hl-4">ETHUSDT_strategy1</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">    │   └── </span><span class="hl-4">BTCUSDT_strategy2</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">    │</span><br/><span class="hl-1">    └── </span><span class="hl-4">schedule</span><span class="hl-1">/             # </span><span class="hl-4">Scheduled</span><span class="hl-1"> </span><span class="hl-4">signals</span><br/><span class="hl-1">        ├── </span><span class="hl-4">BTCUSDT_strategy1</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">        ├── </span><span class="hl-4">ETHUSDT_strategy1</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">        └── </span><span class="hl-4">BTCUSDT_strategy2</span><span class="hl-1">.</span><span class="hl-4">json</span>
</code><button>Copy</button></pre>

<p><strong>Directory Structure:</strong></p>
<table>
<thead>
<tr>
<th>Directory</th>
<th>Purpose</th>
<th>Lifecycle</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>./dump/persist/</code></td>
<td>Active signals awaiting TP/SL/timeout</td>
<td>Created on first live run</td>
</tr>
<tr>
<td><code>./dump/schedule/</code></td>
<td>Scheduled signals awaiting activation</td>
<td>Created on first scheduled signal</td>
</tr>
</tbody>
</table>
<p><strong>File Naming Convention:</strong></p>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Example</th>
<th>Uniqueness</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>{symbol}_{strategyName}.json</code></td>
<td><code>BTCUSDT_strategy1.json</code></td>
<td>One file per symbol-strategy pair</td>
</tr>
</tbody>
</table>
<p><strong>File Lifecycle:</strong></p>
<table>
<thead>
<tr>
<th>Event</th>
<th>Active Signal File</th>
<th>Scheduled Signal File</th>
</tr>
</thead>
<tbody>
<tr>
<td>Signal scheduled</td>
<td>No file</td>
<td>File created</td>
</tr>
<tr>
<td>Signal opened (immediate)</td>
<td>File created</td>
<td>No file</td>
</tr>
<tr>
<td>Scheduled → Opened</td>
<td>File created</td>
<td>File deleted</td>
</tr>
<tr>
<td>Signal closed</td>
<td>File deleted</td>
<td>N/A</td>
</tr>
<tr>
<td>Signal cancelled</td>
<td>N/A</td>
<td>File deleted</td>
</tr>
</tbody>
</table>
<hr>
<a id="persistence-callbacks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Persistence Callbacks<a href="#persistence-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides optional callbacks to observe persistence operations.</p>
<a id="onwrite-callback" class="tsd-anchor"></a><h3 class="tsd-anchor-link">onWrite Callback<a href="#onwrite-callback" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Called whenever signal data is written to persistent storage.</p>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Testing persistence operations</li>
<li>Logging state changes</li>
<li>Auditing signal modifications</li>
<li>Custom replication logic</li>
</ul>
<p><strong>Signature:</strong></p>
<pre><code class="typescript"><span class="hl-10">onWrite</span><span class="hl-1">: (</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-4">ISignalRow</span><span class="hl-1"> | </span><span class="hl-7">null</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-4">boolean</span><br/><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span>
</code><button type="button">Copy</button></pre>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>symbol</code></td>
<td><code>string</code></td>
<td>Trading pair (e.g., <code>&quot;BTCUSDT&quot;</code>)</td>
</tr>
<tr>
<td><code>data</code></td>
<td><code>ISignalRow | null</code></td>
<td>Signal data written (null = deletion)</td>
</tr>
<tr>
<td><code>backtest</code></td>
<td><code>boolean</code></td>
<td>Always <code>false</code> (persistence disabled in backtest)</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> { </span><span class="hl-5">/* ... */</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onWrite</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1"> === </span><span class="hl-7">null</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal cleared: </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-3">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal persisted: </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> id=</span><span class="hl-7">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="error-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Error Handling<a href="#error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Persistence operations are wrapped in error handling to prevent crashes from propagating.</p>
<a id="error-scenarios" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Scenarios<a href="#error-scenarios" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Scenario</th>
<th>Behavior</th>
<th>Recovery</th>
</tr>
</thead>
<tbody>
<tr>
<td>Disk full</td>
<td>Error logged, signal lost</td>
<td>Manual intervention required</td>
</tr>
<tr>
<td>Permission denied</td>
<td>Error logged, signal lost</td>
<td>Fix permissions, restart</td>
</tr>
<tr>
<td>Corrupt JSON</td>
<td>Error logged, signal ignored</td>
<td>Old state discarded</td>
</tr>
<tr>
<td>Directory missing</td>
<td>Auto-created on write</td>
<td>Automatic recovery</td>
</tr>
<tr>
<td>File locked</td>
<td>Retry with exponential backoff</td>
<td>Automatic recovery</td>
</tr>
</tbody>
</table>
<a id="error-propagation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Propagation<a href="#error-propagation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/84_Persistence_Layer_8.svg" alt="Mermaid Diagram"></p>
<p><strong>Error Logging Payload:</strong></p>
<pre><code class="typescript"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">message</span><span class="hl-1">: </span><span class="hl-2">&quot;Persistence write failed&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">error</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-10">name</span><span class="hl-1">: </span><span class="hl-2">&quot;ENOSPC&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">message</span><span class="hl-1">: </span><span class="hl-2">&quot;No space left on device&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">stack</span><span class="hl-1">: </span><span class="hl-2">&quot;...&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-10">context</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-10">symbol</span><span class="hl-1">: </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">strategyName</span><span class="hl-1">: </span><span class="hl-2">&quot;strategy1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">operation</span><span class="hl-1">: </span><span class="hl-2">&quot;writeSignalData&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="performance-considerations" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Considerations<a href="#performance-considerations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Persistence adds I/O overhead to live trading operations. The framework optimizes this through strategic write patterns.</p>
<a id="write-frequency" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Write Frequency<a href="#write-frequency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Operation</th>
<th>Write Count</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td>Signal opened</td>
<td>1 write</td>
<td>Initial state persistence</td>
</tr>
<tr>
<td>Signal active (monitoring)</td>
<td>0 writes</td>
<td>No state changes</td>
</tr>
<tr>
<td>Signal closed</td>
<td>1 write (delete)</td>
<td>Cleanup</td>
</tr>
<tr>
<td>Scheduled signal created</td>
<td>1 write</td>
<td>Initial state persistence</td>
</tr>
<tr>
<td>Scheduled → Opened</td>
<td>2 writes (delete + write)</td>
<td>State transition</td>
</tr>
</tbody>
</table>
<p><strong>Total I/O per Signal Lifecycle:</strong></p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Writes</th>
<th>Deletes</th>
<th>Total Operations</th>
</tr>
</thead>
<tbody>
<tr>
<td>Immediate open → close</td>
<td>1</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>Scheduled → open → close</td>
<td>2</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>Scheduled → cancelled</td>
<td>1</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
<a id="optimization-strategies" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Optimization Strategies<a href="#optimization-strategies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>1. Batching (Not Implemented)</strong></p>
<ul>
<li>Current: One file per write</li>
<li>Potential: Batch multiple signals into single file</li>
<li>Trade-off: Complexity vs. performance</li>
</ul>
<p><strong>2. Async Writes</strong></p>
<ul>
<li>Current: Synchronous writes block execution</li>
<li>Benefit: Guaranteed persistence before proceeding</li>
<li>Alternative: Async with promise tracking</li>
</ul>
<p><strong>3. Memory Caching</strong></p>
<ul>
<li>Current: Direct disk writes</li>
<li>Potential: In-memory cache with periodic flush</li>
<li>Trade-off: Crash risk vs. performance</li>
</ul>
<p><strong>4. Compression</strong></p>
<ul>
<li>Current: Plain JSON</li>
<li>Potential: gzip/zstd compression</li>
<li>Trade-off: CPU vs. disk I/O</li>
</ul>
<hr>
<a id="integration-with-signal-lifecycle" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Signal Lifecycle<a href="#integration-with-signal-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Persistence operations integrate seamlessly with the signal lifecycle state machine.</p>
<p><img src="../media/84_Persistence_Layer_9.svg" alt="Mermaid Diagram"></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#persistence-layer"><span>Persistence <wbr/>Layer</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#architecture-overview"><span>Architecture <wbr/>Overview</span></a></li><li><a href="#core-components"><span>Core <wbr/>Components</span></a></li><li><ul><li><a href="#persistbase"><span>Persist<wbr/>Base</span></a></li><li><a href="#persistsignaladapter"><span>Persist<wbr/>Signal<wbr/>Adapter</span></a></li><li><a href="#persistscheduleadapter"><span>Persist<wbr/>Schedule<wbr/>Adapter</span></a></li></ul></li><li><a href="#crash-recovery-flow"><span>Crash <wbr/>Recovery <wbr/>Flow</span></a></li><li><a href="#signal-state-persistence"><span>Signal <wbr/>State <wbr/>Persistence</span></a></li><li><ul><li><a href="#when-persistence-occurs"><span>When <wbr/>Persistence <wbr/>Occurs</span></a></li></ul></li><li><a href="#atomic-write-implementation"><span>Atomic <wbr/>Write <wbr/>Implementation</span></a></li><li><a href="#backtest-vs-live-mode"><span>Backtest vs <wbr/>Live <wbr/>Mode</span></a></li><li><a href="#custom-backend-implementation"><span>Custom <wbr/>Backend <wbr/>Implementation</span></a></li><li><ul><li><a href="#extension-points"><span>Extension <wbr/>Points</span></a></li><li><a href="#implementation-example"><span>Implementation <wbr/>Example</span></a></li></ul></li><li><a href="#file-storage-structure"><span>File <wbr/>Storage <wbr/>Structure</span></a></li><li><a href="#persistence-callbacks"><span>Persistence <wbr/>Callbacks</span></a></li><li><ul><li><a href="#onwrite-callback"><span>on<wbr/>Write <wbr/>Callback</span></a></li></ul></li><li><a href="#error-handling"><span>Error <wbr/>Handling</span></a></li><li><ul><li><a href="#error-scenarios"><span>Error <wbr/>Scenarios</span></a></li><li><a href="#error-propagation"><span>Error <wbr/>Propagation</span></a></li></ul></li><li><a href="#performance-considerations"><span>Performance <wbr/>Considerations</span></a></li><li><ul><li><a href="#write-frequency"><span>Write <wbr/>Frequency</span></a></li><li><a href="#optimization-strategies"><span>Optimization <wbr/>Strategies</span></a></li></ul></li><li><a href="#integration-with-signal-lifecycle"><span>Integration with <wbr/>Signal <wbr/>Lifecycle</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
