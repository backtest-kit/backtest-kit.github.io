<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/08_dependency-injection-system | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_08_dependency-injection-system.html">design/08_dependency-injection-system</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="dependency-injection-system" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Dependency Injection System<a href="#dependency-injection-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Dependency Injection (DI) system provides centralized service management for the backtest-kit framework. It uses Symbol-based keys for type-safe service registration and retrieval, aggregating all services into a single <code>backtest</code> object that serves as the framework's service locator. This page documents the DI container implementation, service registration patterns, the aggregation object structure, and the 11 service categories.</p>
<p>For information about how services use scoped context propagation, see <a href="design_07_layered-architecture.html">Layered Architecture</a>. For details on individual service implementations, see <a href="design_09_service-categories.html">Service Categories</a>.</p>
<hr>
<a id="architecture-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Overview<a href="#architecture-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The DI system consists of three core components:</p>
<ol>
<li><strong>Symbol Registry</strong> - Unique Symbol keys for each service type</li>
<li><strong>Service Provider</strong> - Registration mechanism using factory functions</li>
<li><strong>Service Aggregation</strong> - The <code>backtest</code> singleton object exposing all services</li>
</ol>
<p><img src="../media/08-dependency-injection-system_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="symbol-based-service-keys" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Symbol-Based Service Keys<a href="#symbol-based-service-keys" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>TYPES</code> object in <a href="">src/lib/core/types.ts</a> defines Symbol-based keys for type-safe service registration. Each service category is grouped into a sub-object, then merged into the exported <code>TYPES</code> constant.</p>
<a id="symbol-registry-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Symbol Registry Structure<a href="#symbol-registry-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Category</th>
<th>Symbol Count</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>baseServices</strong></td>
<td>1</td>
<td><code>loggerService</code></td>
</tr>
<tr>
<td><strong>contextServices</strong></td>
<td>2</td>
<td><code>executionContextService</code>, <code>methodContextService</code></td>
</tr>
<tr>
<td><strong>connectionServices</strong></td>
<td>7</td>
<td><code>exchangeConnectionService</code>, <code>strategyConnectionService</code>, <code>frameConnectionService</code>, <code>sizingConnectionService</code>, <code>riskConnectionService</code>, <code>optimizerConnectionService</code>, <code>partialConnectionService</code></td>
</tr>
<tr>
<td><strong>schemaServices</strong></td>
<td>7</td>
<td><code>exchangeSchemaService</code>, <code>strategySchemaService</code>, <code>frameSchemaService</code>, <code>walkerSchemaService</code>, <code>sizingSchemaService</code>, <code>riskSchemaService</code>, <code>optimizerSchemaService</code></td>
</tr>
<tr>
<td><strong>coreServices</strong></td>
<td>3</td>
<td><code>exchangeCoreService</code>, <code>strategyCoreService</code>, <code>frameCoreService</code></td>
</tr>
<tr>
<td><strong>globalServices</strong></td>
<td>4</td>
<td><code>sizingGlobalService</code>, <code>riskGlobalService</code>, <code>optimizerGlobalService</code>, <code>partialGlobalService</code></td>
</tr>
<tr>
<td><strong>commandServices</strong></td>
<td>3</td>
<td><code>liveCommandService</code>, <code>backtestCommandService</code>, <code>walkerCommandService</code></td>
</tr>
<tr>
<td><strong>logicPrivateServices</strong></td>
<td>3</td>
<td><code>backtestLogicPrivateService</code>, <code>liveLogicPrivateService</code>, <code>walkerLogicPrivateService</code></td>
</tr>
<tr>
<td><strong>logicPublicServices</strong></td>
<td>3</td>
<td><code>backtestLogicPublicService</code>, <code>liveLogicPublicService</code>, <code>walkerLogicPublicService</code></td>
</tr>
<tr>
<td><strong>markdownServices</strong></td>
<td>9</td>
<td><code>backtestMarkdownService</code>, <code>liveMarkdownService</code>, <code>scheduleMarkdownService</code>, <code>performanceMarkdownService</code>, <code>walkerMarkdownService</code>, <code>heatMarkdownService</code>, <code>partialMarkdownService</code>, <code>outlineMarkdownService</code>, <code>riskMarkdownService</code></td>
</tr>
<tr>
<td><strong>validationServices</strong></td>
<td>8</td>
<td><code>exchangeValidationService</code>, <code>strategyValidationService</code>, <code>frameValidationService</code>, <code>walkerValidationService</code>, <code>sizingValidationService</code>, <code>riskValidationService</code>, <code>optimizerValidationService</code>, <code>configValidationService</code></td>
</tr>
<tr>
<td><strong>templateServices</strong></td>
<td>1</td>
<td><code>optimizerTemplateService</code></td>
</tr>
</tbody>
</table>
<a id="symbol-definition-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Symbol Definition Pattern<a href="#symbol-definition-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// src/lib/core/types.ts</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">baseServices</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">loggerService:</span><span class="hl-1"> </span><span class="hl-0">Symbol</span><span class="hl-1">(</span><span class="hl-2">&#39;loggerService&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">contextServices</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">executionContextService:</span><span class="hl-1"> </span><span class="hl-0">Symbol</span><span class="hl-1">(</span><span class="hl-2">&#39;executionContextService&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">methodContextService:</span><span class="hl-1"> </span><span class="hl-0">Symbol</span><span class="hl-1">(</span><span class="hl-2">&#39;methodContextService&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">connectionServices</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeConnectionService:</span><span class="hl-1"> </span><span class="hl-0">Symbol</span><span class="hl-1">(</span><span class="hl-2">&#39;exchangeConnectionService&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">strategyConnectionService:</span><span class="hl-1"> </span><span class="hl-0">Symbol</span><span class="hl-1">(</span><span class="hl-2">&#39;strategyConnectionService&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">frameConnectionService:</span><span class="hl-1"> </span><span class="hl-0">Symbol</span><span class="hl-1">(</span><span class="hl-2">&#39;frameConnectionService&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-5">// ... 4 more</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">// Merge all service categories</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">TYPES</span><span class="hl-1"> = {</span><br/><span class="hl-1">    ...</span><span class="hl-4">baseServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">contextServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">connectionServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">schemaServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">coreServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">globalServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">commandServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">logicPrivateServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">logicPublicServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">markdownServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">validationServices</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-4">templateServices</span><span class="hl-1">,</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Symbols guarantee uniqueness at runtime, preventing key collisions even if string names clash. Each Symbol is created with a descriptive string for debugging purposes.</p>
<hr>
<a id="service-registration-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Registration Pattern<a href="#service-registration-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <a href="">src/lib/core/provide.ts</a> file registers all services using the <code>provide()</code> function from the DI container. Each registration pairs a Symbol key with a factory function that instantiates the service.</p>
<a id="registration-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Flow<a href="#registration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/08-dependency-injection-system_1.svg" alt="Mermaid Diagram"></p>
<a id="registration-examples-by-category" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Examples by Category<a href="#registration-examples-by-category" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Base Services:</strong></p>
<pre><code class="typescript"><span class="hl-5">// src/lib/core/provide.ts:55-57</span><br/><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">LoggerService</span><span class="hl-1">());</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Context Services:</strong></p>
<pre><code class="typescript"><span class="hl-5">// src/lib/core/provide.ts:59-62</span><br/><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">executionContextService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">ExecutionContextService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">methodContextService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">MethodContextService</span><span class="hl-1">());</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Connection Services:</strong></p>
<pre><code class="typescript"><span class="hl-5">// src/lib/core/provide.ts:64-72</span><br/><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">exchangeConnectionService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">ExchangeConnectionService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">strategyConnectionService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">StrategyConnectionService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">frameConnectionService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">FrameConnectionService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">sizingConnectionService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">SizingConnectionService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">riskConnectionService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">RiskConnectionService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">optimizerConnectionService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">OptimizerConnectionService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">partialConnectionService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">PartialConnectionService</span><span class="hl-1">());</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Schema Services:</strong></p>
<pre><code class="typescript"><span class="hl-5">// src/lib/core/provide.ts:74-82</span><br/><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">exchangeSchemaService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">ExchangeSchemaService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">strategySchemaService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">StrategySchemaService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">frameSchemaService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">FrameSchemaService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">walkerSchemaService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">WalkerSchemaService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">sizingSchemaService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">SizingSchemaService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">riskSchemaService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">RiskSchemaService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-8">TYPES</span><span class="hl-1">.</span><span class="hl-4">optimizerSchemaService</span><span class="hl-1">, () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">OptimizerSchemaService</span><span class="hl-1">());</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>All other service categories follow the same pattern. The factory functions are invoked lazily by the DI container when services are first injected.</p>
<hr>
<a id="service-aggregation-object" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Aggregation Object<a href="#service-aggregation-object" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <a href="">src/lib/index.ts</a> file creates the <code>backtest</code> aggregation object by injecting all registered services and merging them into a single export. This serves as the framework's primary service locator.</p>
<a id="aggregation-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Aggregation Structure<a href="#aggregation-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/08-dependency-injection-system_2.svg" alt="Mermaid Diagram"></p>
<a id="initialization-and-export" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Initialization and Export<a href="#initialization-and-export" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// src/lib/index.ts:221-236</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">backtest</span><span class="hl-1"> = {</span><br/><span class="hl-1">  ...</span><span class="hl-4">baseServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">contextServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">connectionServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">schemaServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">coreServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">globalServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">commandServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">logicPrivateServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">logicPublicServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">markdownServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">validationServices</span><span class="hl-1">,</span><br/><span class="hl-1">  ...</span><span class="hl-4">templateServices</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">init</span><span class="hl-1">(); </span><span class="hl-5">// Resolves all lazy dependencies</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> { </span><span class="hl-4">ExecutionContextService</span><span class="hl-1"> };</span><br/><span class="hl-3">export</span><span class="hl-1"> { </span><span class="hl-4">MethodContextService</span><span class="hl-1"> };</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-3">default</span><span class="hl-1"> </span><span class="hl-4">backtest</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>The <code>init()</code> call triggers dependency resolution for all registered services. The <code>backtest</code> object is then exported as both a named export and default export.</p>
<hr>
<a id="service-categories" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Categories<a href="#service-categories" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The DI system organizes services into 11 categories based on their architectural role. Each category has a specific responsibility in the overall system.</p>
<a id="base-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Base Services<a href="#base-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Provides foundational logging infrastructure.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>loggerService</code></td>
<td><code>TYPES.loggerService</code></td>
<td><code>LoggerService</code></td>
<td>Structured logging with context injection</td>
</tr>
</tbody>
</table>
<hr>
<a id="context-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Services<a href="#context-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Provides scoped context propagation using the <code>di-scoped</code> library pattern. See <a href="">types.d.ts:246-285</a> and <a href="">types.d.ts:505-544</a> for interface definitions.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>executionContextService</code></td>
<td><code>TYPES.executionContextService</code></td>
<td><code>ExecutionContextService</code></td>
<td>Propagates <code>symbol</code>, <code>when</code>, and <code>backtest</code> flag through execution chain</td>
</tr>
<tr>
<td><code>methodContextService</code></td>
<td><code>TYPES.methodContextService</code></td>
<td><code>MethodContextService</code></td>
<td>Propagates <code>strategyName</code>, <code>exchangeName</code>, <code>frameName</code> for schema routing</td>
</tr>
</tbody>
</table>
<p>Both services extend the <code>di-scoped</code> library's scoped class pattern, enabling implicit context passing without explicit parameters.</p>
<pre><code class="typescript"><span class="hl-5">// Example from types.d.ts:274-280</span><br/><span class="hl-4">ExecutionContextService</span><span class="hl-1">.</span><span class="hl-0">runInContext</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Inside this callback, context is automatically available</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">someOperation</span><span class="hl-1">();</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-4">when:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(), </span><span class="hl-4">backtest:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="schema-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schema Services<a href="#schema-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Store registered user configurations using the Tool Registry pattern (immutable Map-based storage).</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Stored Schema Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exchangeSchemaService</code></td>
<td><code>TYPES.exchangeSchemaService</code></td>
<td><code>ExchangeSchemaService</code></td>
<td><code>IExchangeSchema</code></td>
</tr>
<tr>
<td><code>strategySchemaService</code></td>
<td><code>TYPES.strategySchemaService</code></td>
<td><code>StrategySchemaService</code></td>
<td><code>IStrategySchema</code></td>
</tr>
<tr>
<td><code>frameSchemaService</code></td>
<td><code>TYPES.frameSchemaService</code></td>
<td><code>FrameSchemaService</code></td>
<td><code>IFrameSchema</code></td>
</tr>
<tr>
<td><code>walkerSchemaService</code></td>
<td><code>TYPES.walkerSchemaService</code></td>
<td><code>WalkerSchemaService</code></td>
<td><code>IWalkerSchema</code></td>
</tr>
<tr>
<td><code>sizingSchemaService</code></td>
<td><code>TYPES.sizingSchemaService</code></td>
<td><code>SizingSchemaService</code></td>
<td><code>ISizingSchema</code></td>
</tr>
<tr>
<td><code>riskSchemaService</code></td>
<td><code>TYPES.riskSchemaService</code></td>
<td><code>RiskSchemaService</code></td>
<td><code>IRiskSchema</code></td>
</tr>
<tr>
<td><code>optimizerSchemaService</code></td>
<td><code>TYPES.optimizerSchemaService</code></td>
<td><code>OptimizerSchemaService</code></td>
<td><code>IOptimizerSchema</code></td>
</tr>
</tbody>
</table>
<p>Each Schema Service provides:</p>
<ul>
<li><code>register(name: string, schema: TSchema): void</code> - Store schema</li>
<li><code>get(name: string): TSchema | null</code> - Retrieve schema</li>
<li><code>has(name: string): boolean</code> - Check existence</li>
</ul>
<hr>
<a id="validation-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Services<a href="#validation-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Enforce schema structure and business rules before registration.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Validates</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exchangeValidationService</code></td>
<td><code>TYPES.exchangeValidationService</code></td>
<td><code>ExchangeValidationService</code></td>
<td><code>IExchangeSchema</code> structure, required fields</td>
</tr>
<tr>
<td><code>strategyValidationService</code></td>
<td><code>TYPES.strategyValidationService</code></td>
<td><code>StrategyValidationService</code></td>
<td><code>IStrategySchema</code> structure, interval validity, memoization</td>
</tr>
<tr>
<td><code>frameValidationService</code></td>
<td><code>TYPES.frameValidationService</code></td>
<td><code>FrameValidationService</code></td>
<td><code>IFrameSchema</code> structure, date range logic</td>
</tr>
<tr>
<td><code>walkerValidationService</code></td>
<td><code>TYPES.walkerValidationService</code></td>
<td><code>WalkerValidationService</code></td>
<td><code>IWalkerSchema</code> structure, strategy list, metric</td>
</tr>
<tr>
<td><code>sizingValidationService</code></td>
<td><code>TYPES.sizingValidationService</code></td>
<td><code>SizingValidationService</code></td>
<td><code>ISizingSchema</code> structure, method-specific params</td>
</tr>
<tr>
<td><code>riskValidationService</code></td>
<td><code>TYPES.riskValidationService</code></td>
<td><code>RiskValidationService</code></td>
<td><code>IRiskSchema</code> structure, validation array</td>
</tr>
<tr>
<td><code>optimizerValidationService</code></td>
<td><code>TYPES.optimizerValidationService</code></td>
<td><code>OptimizerValidationService</code></td>
<td><code>IOptimizerSchema</code> structure, source functions</td>
</tr>
<tr>
<td><code>configValidationService</code></td>
<td><code>TYPES.configValidationService</code></td>
<td><code>ConfigValidationService</code></td>
<td>Global config economic viability</td>
</tr>
</tbody>
</table>
<p>Each Validation Service provides:</p>
<ul>
<li><code>addXXX(name: string, schema: TSchema): void</code> - Validate and throw on error</li>
<li><code>list(): Promise&lt;TSchema[]&gt;</code> - Return all registered schemas</li>
</ul>
<hr>
<a id="connection-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Connection Services<a href="#connection-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Factory pattern for creating memoized client instances. Each service maintains a cache keyed by identifier strings to prevent duplicate instantiation.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Factory Return Type</th>
<th>Cache Key Pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exchangeConnectionService</code></td>
<td><code>TYPES.exchangeConnectionService</code></td>
<td><code>ExchangeConnectionService</code></td>
<td><code>IExchange</code> (ClientExchange)</td>
<td><code>exchangeName</code></td>
</tr>
<tr>
<td><code>strategyConnectionService</code></td>
<td><code>TYPES.strategyConnectionService</code></td>
<td><code>StrategyConnectionService</code></td>
<td><code>IStrategy</code> (ClientStrategy)</td>
<td><code>symbol:strategyName</code></td>
</tr>
<tr>
<td><code>frameConnectionService</code></td>
<td><code>TYPES.frameConnectionService</code></td>
<td><code>FrameConnectionService</code></td>
<td><code>IFrame</code> (ClientFrame)</td>
<td><code>frameName</code></td>
</tr>
<tr>
<td><code>sizingConnectionService</code></td>
<td><code>TYPES.sizingConnectionService</code></td>
<td><code>SizingConnectionService</code></td>
<td><code>ISizing</code> (ClientSizing)</td>
<td><code>sizingName</code></td>
</tr>
<tr>
<td><code>riskConnectionService</code></td>
<td><code>TYPES.riskConnectionService</code></td>
<td><code>RiskConnectionService</code></td>
<td><code>IRisk</code> (ClientRisk)</td>
<td><code>riskName</code></td>
</tr>
<tr>
<td><code>optimizerConnectionService</code></td>
<td><code>TYPES.optimizerConnectionService</code></td>
<td><code>OptimizerConnectionService</code></td>
<td><code>IOptimizer</code> (ClientOptimizer)</td>
<td><code>optimizerName</code></td>
</tr>
<tr>
<td><code>partialConnectionService</code></td>
<td><code>TYPES.partialConnectionService</code></td>
<td><code>PartialConnectionService</code></td>
<td><code>IPartial</code> (ClientPartial)</td>
<td><code>symbol</code></td>
</tr>
</tbody>
</table>
<a id="connection-service-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Connection Service Pattern<a href="#connection-service-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Typical Connection Service structure</span><br/><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-13">ExchangeConnectionService</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">private</span><span class="hl-1"> </span><span class="hl-4">cache</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Map</span><span class="hl-1">&lt;</span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-13">IExchange</span><span class="hl-1">&gt;();</span><br/><br/><span class="hl-1">  </span><span class="hl-0">getExchange</span><span class="hl-1">(</span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">): </span><span class="hl-13">IExchange</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">cache</span><span class="hl-1">.</span><span class="hl-0">has</span><span class="hl-1">(</span><span class="hl-4">exchangeName</span><span class="hl-1">)) {</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">schema</span><span class="hl-1"> = </span><span class="hl-4">schemaService</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-4">exchangeName</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">client</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">ClientExchange</span><span class="hl-1">(</span><span class="hl-4">schema</span><span class="hl-1">, </span><span class="hl-4">dependencies</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">cache</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-4">client</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">cache</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-4">exchangeName</span><span class="hl-1">)!;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Memoization ensures that multiple calls with the same identifier return the same client instance, preserving internal state.</p>
<hr>
<a id="core-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Core Services<a href="#core-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Implement domain logic for primary business entities.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exchangeCoreService</code></td>
<td><code>TYPES.exchangeCoreService</code></td>
<td><code>ExchangeCoreService</code></td>
<td>Candle fetching (<code>getCandles</code>, <code>getNextCandles</code>), VWAP calculation</td>
</tr>
<tr>
<td><code>strategyCoreService</code></td>
<td><code>TYPES.strategyCoreService</code></td>
<td><code>StrategyCoreService</code></td>
<td>Signal lifecycle management (<code>tick</code>, <code>backtest</code> methods)</td>
</tr>
<tr>
<td><code>frameCoreService</code></td>
<td><code>TYPES.frameCoreService</code></td>
<td><code>FrameCoreService</code></td>
<td>Timeframe generation, date iteration</td>
</tr>
</tbody>
</table>
<p>Core Services are invoked by Logic Services to execute domain operations. They consume Connection Services to access client instances.</p>
<hr>
<a id="global-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Global Services<a href="#global-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Provide portfolio-level orchestration and shared state management.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sizingGlobalService</code></td>
<td><code>TYPES.sizingGlobalService</code></td>
<td><code>SizingGlobalService</code></td>
<td>Position size calculation across strategies</td>
</tr>
<tr>
<td><code>riskGlobalService</code></td>
<td><code>TYPES.riskGlobalService</code></td>
<td><code>RiskGlobalService</code></td>
<td>Risk state management, position tracking</td>
</tr>
<tr>
<td><code>optimizerGlobalService</code></td>
<td><code>TYPES.optimizerGlobalService</code></td>
<td><code>OptimizerGlobalService</code></td>
<td>Optimizer orchestration, validation wrapper</td>
</tr>
<tr>
<td><code>partialGlobalService</code></td>
<td><code>TYPES.partialGlobalService</code></td>
<td><code>PartialGlobalService</code></td>
<td>Partial profit/loss tracking, milestone management</td>
</tr>
</tbody>
</table>
<p>Global Services coordinate between multiple client instances and provide cross-cutting concerns like risk limits and position sizing.</p>
<hr>
<a id="command-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Command Services<a href="#command-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>High-level orchestration layer that coordinates validation, context setup, and execution.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Orchestrates</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>liveCommandService</code></td>
<td><code>TYPES.liveCommandService</code></td>
<td><code>LiveCommandService</code></td>
<td>Live trading execution workflow</td>
</tr>
<tr>
<td><code>backtestCommandService</code></td>
<td><code>TYPES.backtestCommandService</code></td>
<td><code>BacktestCommandService</code></td>
<td>Backtest execution workflow</td>
</tr>
<tr>
<td><code>walkerCommandService</code></td>
<td><code>TYPES.walkerCommandService</code></td>
<td><code>WalkerCommandService</code></td>
<td>Walker comparison workflow</td>
</tr>
</tbody>
</table>
<p>Command Services delegate to Logic Services after performing validation and context initialization.</p>
<hr>
<a id="logic-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Logic Services<a href="#logic-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Implement execution flow with public/private split. Public services wrap private services with context setup.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Execution Pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>backtestLogicPublicService</code></td>
<td><code>TYPES.backtestLogicPublicService</code></td>
<td><code>BacktestLogicPublicService</code></td>
<td>Sets up <code>MethodContextService</code> context</td>
</tr>
<tr>
<td><code>backtestLogicPrivateService</code></td>
<td><code>TYPES.backtestLogicPrivateService</code></td>
<td><code>BacktestLogicPrivateService</code></td>
<td>Generator implementation with timeframe iteration</td>
</tr>
<tr>
<td><code>liveLogicPublicService</code></td>
<td><code>TYPES.liveLogicPublicService</code></td>
<td><code>LiveLogicPublicService</code></td>
<td>Sets up <code>MethodContextService</code> context</td>
</tr>
<tr>
<td><code>liveLogicPrivateService</code></td>
<td><code>TYPES.liveLogicPrivateService</code></td>
<td><code>LiveLogicPrivateService</code></td>
<td>Generator implementation with infinite loop</td>
</tr>
<tr>
<td><code>walkerLogicPublicService</code></td>
<td><code>TYPES.walkerLogicPublicService</code></td>
<td><code>WalkerLogicPublicService</code></td>
<td>Sets up <code>MethodContextService</code> context</td>
</tr>
<tr>
<td><code>walkerLogicPrivateService</code></td>
<td><code>TYPES.walkerLogicPrivateService</code></td>
<td><code>WalkerLogicPrivateService</code></td>
<td>Generator implementation with sequential backtests</td>
</tr>
</tbody>
</table>
<a id="publicprivate-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Public/Private Pattern<a href="#publicprivate-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Public Service (context wrapper)</span><br/><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-13">BacktestLogicPublicService</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-7">*</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">options</span><span class="hl-1">: </span><span class="hl-13">BacktestOptions</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">yield</span><span class="hl-7">*</span><span class="hl-1"> </span><span class="hl-4">MethodContextService</span><span class="hl-1">.</span><span class="hl-0">runAsyncIterator</span><span class="hl-1">(</span><br/><span class="hl-1">      () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">privateService</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">options</span><span class="hl-1">),</span><br/><span class="hl-1">      { </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">options</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-4">options</span><span class="hl-1">.</span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-4">options</span><span class="hl-1">.</span><span class="hl-4">frameName</span><span class="hl-1"> }</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Private Service (generator implementation)</span><br/><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-13">BacktestLogicPrivateService</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-7">*</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">options</span><span class="hl-1">: </span><span class="hl-13">BacktestOptions</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">timeframe</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">frameService</span><span class="hl-1">.</span><span class="hl-0">getTimeframe</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">options</span><span class="hl-1">.</span><span class="hl-4">frameName</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">when</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">timeframe</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-5">// Execution logic</span><br/><span class="hl-1">      </span><span class="hl-3">yield</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="markdown-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Markdown Services<a href="#markdown-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Generate reports and calculate statistics from accumulated events.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Report Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>backtestMarkdownService</code></td>
<td><code>TYPES.backtestMarkdownService</code></td>
<td><code>BacktestMarkdownService</code></td>
<td>Closed signals, PnL statistics (MAX_EVENTS: 250)</td>
</tr>
<tr>
<td><code>liveMarkdownService</code></td>
<td><code>TYPES.liveMarkdownService</code></td>
<td><code>LiveMarkdownService</code></td>
<td>All tick types, live monitoring (MAX_EVENTS: 250)</td>
</tr>
<tr>
<td><code>scheduleMarkdownService</code></td>
<td><code>TYPES.scheduleMarkdownService</code></td>
<td><code>ScheduleMarkdownService</code></td>
<td>Scheduled signals, activation tracking (MAX_EVENTS: 250)</td>
</tr>
<tr>
<td><code>performanceMarkdownService</code></td>
<td><code>TYPES.performanceMarkdownService</code></td>
<td><code>PerformanceMarkdownService</code></td>
<td>Execution metrics, duration tracking (MAX_EVENTS: 10000)</td>
</tr>
<tr>
<td><code>walkerMarkdownService</code></td>
<td><code>TYPES.walkerMarkdownService</code></td>
<td><code>WalkerMarkdownService</code></td>
<td>Comparison tables, best strategy (unbounded)</td>
</tr>
<tr>
<td><code>heatMarkdownService</code></td>
<td><code>TYPES.heatMarkdownService</code></td>
<td><code>HeatMarkdownService</code></td>
<td>Portfolio heatmap, symbol statistics (unbounded)</td>
</tr>
<tr>
<td><code>partialMarkdownService</code></td>
<td><code>TYPES.partialMarkdownService</code></td>
<td><code>PartialMarkdownService</code></td>
<td>Partial P/L, milestone events (MAX_EVENTS: 250)</td>
</tr>
<tr>
<td><code>outlineMarkdownService</code></td>
<td><code>TYPES.outlineMarkdownService</code></td>
<td><code>OutlineMarkdownService</code></td>
<td>System outline, configuration dump (unbounded)</td>
</tr>
<tr>
<td><code>riskMarkdownService</code></td>
<td><code>TYPES.riskMarkdownService</code></td>
<td><code>RiskMarkdownService</code></td>
<td>Risk rejections, validation stats (unbounded)</td>
</tr>
</tbody>
</table>
<p>Each Markdown Service subscribes to relevant event emitters and provides:</p>
<ul>
<li><code>getData(): TData[]</code> - Return accumulated event data</li>
<li><code>getReport(): string</code> - Generate markdown report</li>
<li><code>dump(filepath: string): Promise&lt;void&gt;</code> - Write report to file</li>
</ul>
<hr>
<a id="template-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Template Services<a href="#template-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Generate code artifacts for strategy creation.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Symbol Key</th>
<th>Class</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>optimizerTemplateService</code></td>
<td><code>TYPES.optimizerTemplateService</code></td>
<td><code>OptimizerTemplateService</code></td>
<td>Code generation for optimizer output, default templates</td>
</tr>
</tbody>
</table>
<p>The Optimizer Template Service merges user-provided template overrides with default templates to generate complete executable <code>.mjs</code> files containing strategy implementations.</p>
<hr>
<a id="service-dependency-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Dependency Flow<a href="#service-dependency-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following diagram illustrates how services depend on each other within the DI system.</p>
<p><img src="../media/08-dependency-injection-system_3.svg" alt="Mermaid Diagram"></p>
<a id="dependency-resolution-order" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Dependency Resolution Order<a href="#dependency-resolution-order" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Base Services</strong> - No dependencies, instantiated first</li>
<li><strong>Context Services</strong> - No dependencies, instantiated early</li>
<li><strong>Schema Services</strong> - No dependencies, instantiated to store configurations</li>
<li><strong>Validation Services</strong> - Depend on Schema Services for existence checks</li>
<li><strong>Connection Services</strong> - Depend on Schema Services for client instantiation</li>
<li><strong>Core Services</strong> - Depend on Connection Services and Context Services</li>
<li><strong>Global Services</strong> - Depend on Connection Services</li>
<li><strong>Logic Services</strong> - Depend on Core Services and Context Services</li>
<li><strong>Command Services</strong> - Depend on Logic Services</li>
<li><strong>Markdown Services</strong> - Subscribe to event emitters (no direct dependencies)</li>
<li><strong>Template Services</strong> - No dependencies</li>
</ol>
<hr>
<a id="usage-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage Patterns<a href="#usage-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="accessing-services-internally" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Accessing Services Internally<a href="#accessing-services-internally" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Services access other services by importing the <code>backtest</code> aggregation object:</p>
<pre><code class="typescript"><span class="hl-5">// Example from a Core Service</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">backtest</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;../index&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-13">StrategyCoreService</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">tick</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-13">Date</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Access connection service</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">strategy</span><span class="hl-1"> = </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategyConnectionService</span><span class="hl-1">.</span><span class="hl-0">getStrategy</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Access logger</span><br/><span class="hl-1">    </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;StrategyCoreService.tick&quot;</span><span class="hl-1">, { </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// ... implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="accessing-services-externally" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Accessing Services Externally<a href="#accessing-services-externally" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>External code (public API functions, user code) imports the <code>backtest</code> object from the main library export:</p>
<pre><code class="typescript"><span class="hl-5">// Example from function/add.ts</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">backtest</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;../lib/index&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">addStrategy</span><span class="hl-1">(</span><span class="hl-4">strategySchema</span><span class="hl-1">: </span><span class="hl-13">IStrategySchema</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">// Use validation service</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategyValidationService</span><span class="hl-1">.</span><span class="hl-0">addStrategy</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">strategySchema</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">strategySchema</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Use schema service</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategySchemaService</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">strategySchema</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">strategySchema</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="service-initialization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Initialization<a href="#service-initialization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>init()</code> function must be called after all <code>provide()</code> registrations but before any service usage:</p>
<pre><code class="typescript"><span class="hl-5">// src/lib/index.ts:236</span><br/><span class="hl-0">init</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>This resolves any circular dependencies and ensures all services are properly instantiated in the container.</p>
<hr>
<a id="summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Summary<a href="#summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Dependency Injection system provides:</p>
<ol>
<li><strong>Type-Safe Service Keys</strong> - Symbol-based keys prevent collisions and enable type inference</li>
<li><strong>Lazy Instantiation</strong> - Services are created only when first requested</li>
<li><strong>Centralized Access</strong> - The <code>backtest</code> aggregation object serves as the single service locator</li>
<li><strong>Organized Structure</strong> - 11 service categories with clear architectural boundaries</li>
<li><strong>Memoization</strong> - Connection Services cache client instances by identifier</li>
<li><strong>Context Propagation</strong> - Scoped services enable implicit parameter passing</li>
</ol>
<p>This architecture enables loose coupling, testability, and modular service composition across the 51 registered services in the framework.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#dependency-injection-system"><span>Dependency <wbr/>Injection <wbr/>System</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#architecture-overview"><span>Architecture <wbr/>Overview</span></a></li><li><a href="#symbol-based-service-keys"><span>Symbol-<wbr/>Based <wbr/>Service <wbr/>Keys</span></a></li><li><ul><li><a href="#symbol-registry-structure"><span>Symbol <wbr/>Registry <wbr/>Structure</span></a></li><li><a href="#symbol-definition-pattern"><span>Symbol <wbr/>Definition <wbr/>Pattern</span></a></li></ul></li><li><a href="#service-registration-pattern"><span>Service <wbr/>Registration <wbr/>Pattern</span></a></li><li><ul><li><a href="#registration-flow"><span>Registration <wbr/>Flow</span></a></li><li><a href="#registration-examples-by-category"><span>Registration <wbr/>Examples by <wbr/>Category</span></a></li></ul></li><li><a href="#service-aggregation-object"><span>Service <wbr/>Aggregation <wbr/>Object</span></a></li><li><ul><li><a href="#aggregation-structure"><span>Aggregation <wbr/>Structure</span></a></li><li><a href="#initialization-and-export"><span>Initialization and <wbr/>Export</span></a></li></ul></li><li><a href="#service-categories"><span>Service <wbr/>Categories</span></a></li><li><ul><li><a href="#base-services"><span>Base <wbr/>Services</span></a></li><li><a href="#context-services"><span>Context <wbr/>Services</span></a></li><li><a href="#schema-services"><span>Schema <wbr/>Services</span></a></li><li><a href="#validation-services"><span>Validation <wbr/>Services</span></a></li><li><a href="#connection-services"><span>Connection <wbr/>Services</span></a></li><li><a href="#connection-service-pattern"><span>Connection <wbr/>Service <wbr/>Pattern</span></a></li><li><a href="#core-services"><span>Core <wbr/>Services</span></a></li><li><a href="#global-services"><span>Global <wbr/>Services</span></a></li><li><a href="#command-services"><span>Command <wbr/>Services</span></a></li><li><a href="#logic-services"><span>Logic <wbr/>Services</span></a></li><li><a href="#publicprivate-pattern"><span>Public/<wbr/>Private <wbr/>Pattern</span></a></li><li><a href="#markdown-services"><span>Markdown <wbr/>Services</span></a></li><li><a href="#template-services"><span>Template <wbr/>Services</span></a></li></ul></li><li><a href="#service-dependency-flow"><span>Service <wbr/>Dependency <wbr/>Flow</span></a></li><li><ul><li><a href="#dependency-resolution-order"><span>Dependency <wbr/>Resolution <wbr/>Order</span></a></li></ul></li><li><a href="#usage-patterns"><span>Usage <wbr/>Patterns</span></a></li><li><ul><li><a href="#accessing-services-internally"><span>Accessing <wbr/>Services <wbr/>Internally</span></a></li><li><a href="#accessing-services-externally"><span>Accessing <wbr/>Services <wbr/>Externally</span></a></li><li><a href="#service-initialization"><span>Service <wbr/>Initialization</span></a></li></ul></li><li><a href="#summary"><span>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
