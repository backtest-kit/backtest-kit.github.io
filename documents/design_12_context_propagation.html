<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/12_context_propagation | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_12_context_propagation.html">design/12_context_propagation</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="context-propagation" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Context Propagation<a href="#context-propagation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page explains how runtime context (symbol, timestamp, execution mode, component names) is propagated through the system without explicit parameter passing. Context propagation enables operations to access execution parameters implicitly, reducing coupling and simplifying function signatures.</p>
<p>For information about dependency injection of services, see <a href="design_11_dependency_injection_system.html">3.2</a>. For information about how Global services orchestrate operations, see <a href="design_43_global_services.html">7.5</a>.</p>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework uses two scoped context services to propagate runtime parameters throughout the execution stack:</p>
<ol>
<li><strong>ExecutionContextService</strong> - Runtime execution parameters (symbol, timestamp, mode)</li>
<li><strong>MethodContextService</strong> - Component routing parameters (schema names)</li>
</ol>
<p>Both services leverage the <code>di-scoped</code> library to provide implicit context access without passing parameters through every function call. Context is established at operation boundaries (Logic services) and consumed by leaf components (Client classes).</p>
<a id="context-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Services<a href="#context-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="executioncontextservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ExecutionContextService<a href="#executioncontextservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>ExecutionContextService</code> provides runtime execution parameters that change on every operation:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>symbol</code></td>
<td><code>string</code></td>
<td>Trading pair symbol (e.g., &quot;BTCUSDT&quot;)</td>
</tr>
<tr>
<td><code>when</code></td>
<td><code>Date</code></td>
<td>Current timestamp for the operation</td>
</tr>
<tr>
<td><code>backtest</code></td>
<td><code>boolean</code></td>
<td>True for backtest mode, false for live mode</td>
</tr>
</tbody>
</table>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IExecutionContext</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-10">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>This context determines which data to fetch (symbol), what time to query (when), and whether to use persistence (backtest flag).</p>
<a id="methodcontextservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">MethodContextService<a href="#methodcontextservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>MethodContextService</code> provides component routing parameters that determine which registered schemas to use:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strategyName</code></td>
<td><code>StrategyName</code></td>
<td>Which strategy schema to execute</td>
</tr>
<tr>
<td><code>exchangeName</code></td>
<td><code>ExchangeName</code></td>
<td>Which exchange schema to use for data</td>
</tr>
<tr>
<td><code>frameName</code></td>
<td><code>FrameName</code></td>
<td>Which frame schema to use (empty for live)</td>
</tr>
</tbody>
</table>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IMethodContext</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">ExchangeName</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">StrategyName</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-10">FrameName</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>This context routes operations to the correct registered components via ConnectionServices.</p>
<a id="context-scope-mechanism" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Scope Mechanism<a href="#context-scope-mechanism" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="di-scoped-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">di-scoped Integration<a href="#di-scoped-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Both context services extend the <code>di-scoped</code> library's scoped class pattern, providing two key methods:</p>
<ol>
<li><strong><code>runInContext(callback, context)</code></strong> - Executes synchronous or async callback with context</li>
<li><strong><code>runAsyncIterator(generator, context)</code></strong> - Wraps async generator with context</li>
</ol>
<p>The context is stored in async local storage, making it accessible to all code within the callback/generator without explicit passing.</p>
<p><img src="../media/12_Context_Propagation_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: di-scoped Context Establishment</strong></p>
<a id="context-registration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Registration<a href="#context-registration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The context services are registered in the dependency injection container as singleton services:</p>
<pre><code class="typescript"><span class="hl-5">// Service registration</span><br/><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">executionContextService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">ExecutionContextService</span><span class="hl-1">());</span><br/><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">methodContextService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">MethodContextService</span><span class="hl-1">());</span><br/><br/><span class="hl-5">// Service injection</span><br/><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">TExecutionContextService</span><span class="hl-1">&gt;(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">executionContextService</span><span class="hl-1">);</span><br/><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">TMethodContextService</span><span class="hl-1">&gt;(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">methodContextService</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="context-flow-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Flow Architecture<a href="#context-flow-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="layer-by-layer-propagation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Layer-by-Layer Propagation<a href="#layer-by-layer-propagation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Context flows through the architecture layers in a cascade pattern:</p>
<p><img src="../media/12_Context_Propagation_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Context Propagation Through Layers</strong></p>
<a id="establishing-context" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Establishing Context<a href="#establishing-context" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Logic services establish context at the beginning of operations:</p>
<ol>
<li><strong>BacktestLogicPrivateService</strong> - Sets context for each timeframe iteration</li>
<li><strong>LiveLogicPrivateService</strong> - Sets context on each tick with current timestamp</li>
<li><strong>WalkerLogicPrivateService</strong> - Sets context for each strategy iteration</li>
</ol>
<p>The context wraps the entire operation, ensuring all downstream code has access.</p>
<p><strong>Example Context Establishment (Conceptual):</strong></p>
<pre><code class="typescript"><span class="hl-5">// BacktestLogicPrivateService establishes ExecutionContext</span><br/><span class="hl-4">ExecutionContextService</span><span class="hl-1">.</span><span class="hl-0">runInContext</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// All code here can access context</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">strategyGlobalService</span><span class="hl-1">.</span><span class="hl-0">tick</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-4">when:</span><span class="hl-1"> </span><span class="hl-4">timeframe</span><span class="hl-1">, </span><span class="hl-4">backtest:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-5">// Also establishes MethodContext</span><br/><span class="hl-4">MethodContextService</span><span class="hl-1">.</span><span class="hl-0">runAsyncIterator</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">backtestGenerator</span><span class="hl-1">,</span><br/><span class="hl-1">  { </span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-4">frameName</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="context-injection-points" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Injection Points<a href="#context-injection-points" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="global-services-as-wrappers" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Global Services as Wrappers<a href="#global-services-as-wrappers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Global services inject context into operations by accessing the context services via dependency injection and calling operations within the context scope:</p>
<p><img src="../media/12_Context_Propagation_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Context Injection Through Global Services</strong></p>
<a id="constructor-parameters" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Constructor Parameters<a href="#constructor-parameters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Client classes receive context services through their constructor parameters:</p>
<table>
<thead>
<tr>
<th>Client Class</th>
<th>Context Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ClientStrategy</code></td>
<td><code>execution: TExecutionContextService</code><br/><code>method: TMethodContextService</code></td>
</tr>
<tr>
<td><code>ClientExchange</code></td>
<td><code>execution: TExecutionContextService</code></td>
</tr>
<tr>
<td><code>ClientFrame</code></td>
<td>(No context - uses parameters directly)</td>
</tr>
<tr>
<td><code>ClientRisk</code></td>
<td>(No context - uses parameters directly)</td>
</tr>
</tbody>
</table>
<p>The <code>IStrategyParams</code> interface defines the complete parameter structure:</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IStrategyParams</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-10">IStrategySchema</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">partial</span><span class="hl-1">: </span><span class="hl-10">IPartial</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">logger</span><span class="hl-1">: </span><span class="hl-10">ILogger</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchange</span><span class="hl-1">: </span><span class="hl-10">IExchange</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">risk</span><span class="hl-1">: </span><span class="hl-10">IRisk</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">execution</span><span class="hl-1">: </span><span class="hl-10">TExecutionContextService</span><span class="hl-1">;  </span><span class="hl-5">// ExecutionContext</span><br/><span class="hl-1">  </span><span class="hl-4">method</span><span class="hl-1">: </span><span class="hl-10">TMethodContextService</span><span class="hl-1">;        </span><span class="hl-5">// MethodContext</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="context-consumption" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Consumption<a href="#context-consumption" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="accessing-context-properties" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Accessing Context Properties<a href="#accessing-context-properties" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Client classes access context through the injected services:</p>
<p><strong>ExecutionContext Access Pattern:</strong></p>
<pre><code class="typescript"><span class="hl-5">// In ClientStrategy methods</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">symbol</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">when</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">when</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">backtest</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">backtest</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">currentTime</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">when</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p><strong>MethodContext Access Pattern:</strong></p>
<pre><code class="typescript"><span class="hl-5">// In ClientStrategy methods</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">strategyName</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">method</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">exchangeName</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">method</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">exchangeName</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">frameName</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">method</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">frameName</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<a id="context-usage-examples" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Usage Examples<a href="#context-usage-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The following table shows common context usage patterns in ClientStrategy:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Context Property</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Signal generation throttling</td>
<td><code>execution.context.when.getTime()</code></td>
<td>Check elapsed time since last signal</td>
</tr>
<tr>
<td>VWAP calculation</td>
<td><code>execution.context.symbol</code></td>
<td>Fetch candles for the correct symbol</td>
</tr>
<tr>
<td>Risk validation</td>
<td><code>execution.context.symbol</code><br/><code>method.context.strategyName</code><br/><code>method.context.exchangeName</code></td>
<td>Route risk check to correct risk instance</td>
</tr>
<tr>
<td>Persistence</td>
<td><code>execution.context.backtest</code><br/><code>execution.context.symbol</code><br/><code>method.context.strategyName</code></td>
<td>Skip persistence in backtest mode, use symbol+strategy for file path</td>
</tr>
<tr>
<td>Signal metadata</td>
<td><code>method.context.exchangeName</code><br/><code>method.context.strategyName</code></td>
<td>Populate signal row fields</td>
</tr>
<tr>
<td>Callbacks</td>
<td><code>execution.context.symbol</code><br/><code>execution.context.backtest</code></td>
<td>Pass context to user callbacks</td>
</tr>
</tbody>
</table>
<a id="context-lifecycle" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Lifecycle<a href="#context-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="context-boundaries" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Boundaries<a href="#context-boundaries" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Context is established and torn down at specific architectural boundaries:</p>
<p><img src="../media/12_Context_Propagation_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Context Lifecycle in Single Operation</strong></p>
<a id="multiple-context-scopes" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Multiple Context Scopes<a href="#multiple-context-scopes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework supports nested context scopes:</p>
<ol>
<li>
<p><strong>Outer Scope (MethodContext)</strong> - Set once per operation mode (backtest/live/walker)</p>
<ul>
<li>Remains constant throughout the entire execution</li>
<li>Determines which strategy/exchange/frame schemas to use</li>
</ul>
</li>
<li>
<p><strong>Inner Scope (ExecutionContext)</strong> - Set for each operation (tick, backtest)</p>
<ul>
<li>Changes with each timeframe iteration or live tick</li>
<li>Updates <code>when</code> timestamp and potentially <code>symbol</code></li>
</ul>
</li>
</ol>
<p>This nesting allows logic services to maintain stable routing while updating temporal parameters.</p>
<a id="code-entity-mapping" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Code Entity Mapping<a href="#code-entity-mapping" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="context-service-to-code-entities" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Service to Code Entities<a href="#context-service-to-code-entities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/12_Context_Propagation_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Context Service Code Entity Relationships</strong></p>
<a id="context-access-points-in-clientstrategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Access Points in ClientStrategy<a href="#context-access-points-in-clientstrategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The following diagram maps natural language concepts to actual code access patterns in <code>ClientStrategy</code>:</p>
<p><img src="../media/12_Context_Propagation_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Context Access in ClientStrategy (Natural Language to Code)</strong></p>
<a id="benefits-and-tradeoffs" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Benefits and Tradeoffs<a href="#benefits-and-tradeoffs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="benefits-of-context-propagation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Benefits of Context Propagation<a href="#benefits-of-context-propagation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Reduced Parameter Passing</strong> - Operations don't need to pass symbol/timestamp through every function call</li>
<li><strong>Simplified Function Signatures</strong> - Client methods like <code>tick()</code> take minimal parameters</li>
<li><strong>Centralized Context Management</strong> - Logic services control when and how context is established</li>
<li><strong>Type Safety</strong> - TypeScript interfaces ensure correct context structure</li>
<li><strong>Testability</strong> - Context can be mocked by wrapping test code in <code>runInContext()</code></li>
</ol>
<a id="tradeoffs" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Tradeoffs<a href="#tradeoffs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Implicit Dependencies</strong> - Code depends on context being established by caller</li>
<li><strong>Debugging Complexity</strong> - Context access failures may be unclear without understanding scoping</li>
<li><strong>Library Dependency</strong> - Requires <code>di-scoped</code> for async local storage implementation</li>
</ol>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#context-propagation"><span>Context <wbr/>Propagation</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#context-services"><span>Context <wbr/>Services</span></a></li><li><ul><li><a href="#executioncontextservice"><span>Execution<wbr/>Context<wbr/>Service</span></a></li><li><a href="#methodcontextservice"><span>Method<wbr/>Context<wbr/>Service</span></a></li></ul></li><li><a href="#context-scope-mechanism"><span>Context <wbr/>Scope <wbr/>Mechanism</span></a></li><li><ul><li><a href="#di-scoped-integration"><span>di-<wbr/>scoped <wbr/>Integration</span></a></li><li><a href="#context-registration"><span>Context <wbr/>Registration</span></a></li></ul></li><li><a href="#context-flow-architecture"><span>Context <wbr/>Flow <wbr/>Architecture</span></a></li><li><ul><li><a href="#layer-by-layer-propagation"><span>Layer-<wbr/>by-<wbr/>Layer <wbr/>Propagation</span></a></li><li><a href="#establishing-context"><span>Establishing <wbr/>Context</span></a></li></ul></li><li><a href="#context-injection-points"><span>Context <wbr/>Injection <wbr/>Points</span></a></li><li><ul><li><a href="#global-services-as-wrappers"><span>Global <wbr/>Services as <wbr/>Wrappers</span></a></li><li><a href="#constructor-parameters"><span>Constructor <wbr/>Parameters</span></a></li></ul></li><li><a href="#context-consumption"><span>Context <wbr/>Consumption</span></a></li><li><ul><li><a href="#accessing-context-properties"><span>Accessing <wbr/>Context <wbr/>Properties</span></a></li><li><a href="#context-usage-examples"><span>Context <wbr/>Usage <wbr/>Examples</span></a></li></ul></li><li><a href="#context-lifecycle"><span>Context <wbr/>Lifecycle</span></a></li><li><ul><li><a href="#context-boundaries"><span>Context <wbr/>Boundaries</span></a></li><li><a href="#multiple-context-scopes"><span>Multiple <wbr/>Context <wbr/>Scopes</span></a></li></ul></li><li><a href="#code-entity-mapping"><span>Code <wbr/>Entity <wbr/>Mapping</span></a></li><li><ul><li><a href="#context-service-to-code-entities"><span>Context <wbr/>Service to <wbr/>Code <wbr/>Entities</span></a></li><li><a href="#context-access-points-in-clientstrategy"><span>Context <wbr/>Access <wbr/>Points in <wbr/>Client<wbr/>Strategy</span></a></li></ul></li><li><a href="#benefits-and-tradeoffs"><span>Benefits and <wbr/>Tradeoffs</span></a></li><li><ul><li><a href="#benefits-of-context-propagation"><span>Benefits of <wbr/>Context <wbr/>Propagation</span></a></li><li><a href="#tradeoffs"><span>Tradeoffs</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
