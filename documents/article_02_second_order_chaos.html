<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>article/02_second_order_chaos | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="article_02_second_order_chaos.html">article/02_second_order_chaos</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="ðŸ¤–-second-order-chaos-how-algo-trading-bots-play-against-themselves-at-a-loss" class="tsd-anchor"></a><h1 class="tsd-anchor-link">ðŸ¤– Second-Order Chaos: How Algo Trading Bots Play Against Themselves at a Loss<a href="#ðŸ¤–-second-order-chaos-how-algo-trading-bots-play-against-themselves-at-a-loss" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p><img src="../media/bots.png" alt="bots"></p>
<p>I build trading systems for crypto and discovered a paradox that explains why 95% of bots blow their accounts. The problem isn't the strategies â€” it's that thousands of copies of the same algorithm trade against each other.</p>
<a id="first-order-vs-second-order-chaos" class="tsd-anchor"></a><h2 class="tsd-anchor-link">First-Order vs Second-Order Chaos<a href="#first-order-vs-second-order-chaos" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Let's define terms.</p>
<p><strong>First-order chaos</strong> â€” the market is unpredictable, but participants don't know the patterns. You can find edge through analysis. Classic indicators work.</p>
<p><strong>Second-order chaos</strong> â€” the market is unpredictable BECAUSE everyone knows the patterns. Everyone trades the same way. Bots react to bots. Strategies CREATE the noise they're trying to trade.</p>
<p>We're living in the second one now.</p>
<a id="one-algorithm-against-itself" class="tsd-anchor"></a><h2 class="tsd-anchor-link">One Algorithm Against Itself<a href="#one-algorithm-against-itself" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Here's what happens every second on crypto exchanges:</p>
<pre><code><span class="hl-6">09</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">.</span><span class="hl-6">000</span><span class="hl-1"> - </span><span class="hl-8">BTC</span><span class="hl-1"> </span><span class="hl-4">price</span><span class="hl-1"> </span><span class="hl-4">drops</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">300</span><br/><span class="hl-6">09</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">.</span><span class="hl-6">050</span><span class="hl-1"> - </span><span class="hl-6">1000</span><span class="hl-1"> </span><span class="hl-4">freqtrade</span><span class="hl-1"> </span><span class="hl-4">bots</span><span class="hl-1"> </span><span class="hl-10">see</span><span class="hl-1">: </span><span class="hl-8">RSI</span><span class="hl-1"> &lt; </span><span class="hl-6">30</span><br/><br/><span class="hl-4">Each</span><span class="hl-1"> </span><span class="hl-4">bot</span><span class="hl-1"> </span><span class="hl-10">thinks</span><span class="hl-1">:</span><br/><br/><span class="hl-2">&quot;RSI in oversold zone â†’ this is a buy signal&quot;</span><br/><span class="hl-6">09</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">.</span><span class="hl-6">100</span><span class="hl-1"> - </span><span class="hl-4">All</span><span class="hl-1"> </span><span class="hl-4">simultaneously</span><span class="hl-1"> </span><span class="hl-4">send</span><span class="hl-1"> </span><span class="hl-8">BUY</span><span class="hl-1"> </span><span class="hl-4">orders</span><br/><span class="hl-6">09</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">.</span><span class="hl-6">150</span><span class="hl-1"> - </span><span class="hl-4">Price</span><span class="hl-1"> </span><span class="hl-4">spikes</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">450</span><span class="hl-1"> (</span><span class="hl-4">they</span><span class="hl-1"> </span><span class="hl-4">all</span><span class="hl-1"> </span><span class="hl-4">bought</span><span class="hl-1"> </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-4">each</span><span class="hl-1"> </span><span class="hl-4">other</span><span class="hl-1">)</span><br/><span class="hl-6">09</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">.</span><span class="hl-6">200</span><span class="hl-1"> - </span><span class="hl-8">RSI</span><span class="hl-1"> </span><span class="hl-4">instantly</span><span class="hl-1"> </span><span class="hl-4">jumps</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-6">75</span><br/><br/><span class="hl-4">The</span><span class="hl-1"> </span><span class="hl-4">same</span><span class="hl-1"> </span><span class="hl-10">bots</span><span class="hl-1">:</span><br/><br/><span class="hl-2">&quot;RSI in overbought zone â†’ this is a sell signal&quot;</span><br/><span class="hl-6">09</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">.</span><span class="hl-6">250</span><span class="hl-1"> - </span><span class="hl-4">All</span><span class="hl-1"> </span><span class="hl-4">simultaneously</span><span class="hl-1"> </span><span class="hl-4">send</span><span class="hl-1"> </span><span class="hl-8">SELL</span><span class="hl-1"> </span><span class="hl-4">orders</span><br/><span class="hl-6">09</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">:</span><span class="hl-6">00</span><span class="hl-1">.</span><span class="hl-6">300</span><span class="hl-1"> - </span><span class="hl-4">Price</span><span class="hl-1"> </span><span class="hl-4">back</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">300</span>
</code><button>Copy</button></pre>

<p>Final score:</p>
<ul>
<li>Each bot: -0.1% (spread) -0.04% (fees) = <strong>-0.14%</strong></li>
<li>Exchange: +0.04% Ã— 1000 = <strong>+40 USD</strong></li>
</ul>
<p><strong>These aren't different bots competing. This is literally one algorithm playing against itself at a loss.</strong></p>
<a id="why-this-happens" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Why This Happens<a href="#why-this-happens" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Look at a typical strategy from the freqtrade tutorial:</p>
<pre><code class="python">class RSIStrategy(IStrategy):
    def populate_indicators(self, dataframe, metadata):
        dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)
        return dataframe
    
    def populate_entry_trend(self, dataframe, metadata):
        dataframe.loc[
            (dataframe['rsi'] < 30),  # Oversold
            'enter_long'] = 1
        return dataframe
    
    def populate_exit_trend(self, dataframe, metadata):
        dataframe.loc[
            (dataframe['rsi'] > 70),  # Overbought
            'exit_long'] = 1
        return dataframe
</code><button type="button">Copy</button></pre>

<p>This strategy:</p>
<ol>
<li>Published in official documentation</li>
<li>Copied into thousands of bots</li>
<li>Runs on the same timeframes (5m, 15m)</li>
<li>Uses identical parameters (RSI 14, thresholds 30/70)</li>
</ol>
<p>Result: <strong>thousands of identical instances</strong> of one code trading on the same market.</p>
<a id="the-math-of-self-conflict" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Math of Self-Conflict<a href="#the-math-of-self-conflict" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Let's break it down with real numbers:</p>
<pre><code><span class="hl-10">Conditions</span><span class="hl-1">:</span><br/><br/><span class="hl-1">- </span><span class="hl-6">1000</span><span class="hl-1"> </span><span class="hl-4">bots</span><span class="hl-1"> </span><span class="hl-3">with</span><span class="hl-1"> </span><span class="hl-4">identical</span><span class="hl-1"> </span><span class="hl-8">RSI</span><span class="hl-1"> </span><span class="hl-4">strategy</span><br/><span class="hl-1">- </span><span class="hl-4">Each</span><span class="hl-1"> </span><span class="hl-4">trading</span><span class="hl-1"> </span><span class="hl-6">0.01</span><span class="hl-1"> </span><span class="hl-8">BTC</span><br/><span class="hl-1">- </span><span class="hl-10">Spread</span><span class="hl-1">: </span><span class="hl-6">0.05</span><span class="hl-1">%</span><br/><span class="hl-1">- </span><span class="hl-10">Commission</span><span class="hl-1">: </span><span class="hl-6">0.04</span><span class="hl-1">% (</span><span class="hl-4">taker</span><span class="hl-1">)</span><br/><br/><span class="hl-2">&quot;RSI reversal&quot;</span><span class="hl-1"> </span><span class="hl-10">scenario</span><span class="hl-1">:</span><br/><span class="hl-6">1.</span><span class="hl-1"> </span><span class="hl-8">RSI</span><span class="hl-1"> </span><span class="hl-4">drops</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-6">29</span><br/><span class="hl-6">2.</span><span class="hl-1"> </span><span class="hl-4">All</span><span class="hl-1"> </span><span class="hl-6">1000</span><span class="hl-1"> </span><span class="hl-4">bots</span><span class="hl-1"> </span><span class="hl-4">send</span><span class="hl-1"> </span><span class="hl-8">BUY</span><span class="hl-1"> </span><span class="hl-6">0.01</span><span class="hl-1"> </span><span class="hl-8">BTC</span><br/><span class="hl-6">3.</span><span class="hl-1"> </span><span class="hl-4">Total</span><span class="hl-1"> </span><span class="hl-10">volume</span><span class="hl-1">: </span><span class="hl-6">10</span><span class="hl-1"> </span><span class="hl-8">BTC</span><span class="hl-1"> </span><span class="hl-4">bought</span><span class="hl-1"> </span><span class="hl-7">in</span><span class="hl-1"> 100</span><span class="hl-4">ms</span><br/><span class="hl-6">4.</span><span class="hl-1"> </span><span class="hl-4">Price</span><span class="hl-1"> </span><span class="hl-4">rises</span><span class="hl-1"> </span><span class="hl-6">0.15</span><span class="hl-1">% </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-4">impact</span><br/><span class="hl-6">5.</span><span class="hl-1"> </span><span class="hl-8">RSI</span><span class="hl-1"> </span><span class="hl-4">jumps</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-6">72</span><span class="hl-1"> (</span><span class="hl-4">bots</span><span class="hl-1"> </span><span class="hl-4">raised</span><span class="hl-1"> </span><span class="hl-4">it</span><span class="hl-1"> </span><span class="hl-4">themselves</span><span class="hl-1">)</span><br/><span class="hl-6">6.</span><span class="hl-1"> </span><span class="hl-4">All</span><span class="hl-1"> </span><span class="hl-6">1000</span><span class="hl-1"> </span><span class="hl-4">bots</span><span class="hl-1"> </span><span class="hl-4">send</span><span class="hl-1"> </span><span class="hl-8">SELL</span><span class="hl-1"> </span><span class="hl-6">0.01</span><span class="hl-1"> </span><span class="hl-8">BTC</span><br/><span class="hl-6">7.</span><span class="hl-1"> </span><span class="hl-4">Price</span><span class="hl-1"> </span><span class="hl-4">drops</span><span class="hl-1"> </span><span class="hl-6">0.15</span><span class="hl-1">% </span><span class="hl-4">back</span><br/><br/><span class="hl-4">PnL</span><span class="hl-1"> </span><span class="hl-4">per</span><span class="hl-1"> </span><span class="hl-10">bot</span><span class="hl-1">:</span><br/><br/><span class="hl-1">- </span><span class="hl-10">Entry</span><span class="hl-1">: </span><span class="hl-4">bought</span><span class="hl-1"> </span><span class="hl-6">0.05</span><span class="hl-1">% </span><span class="hl-4">above</span><span class="hl-1"> </span><span class="hl-0">mid</span><span class="hl-1"> (</span><span class="hl-4">spread</span><span class="hl-1">)</span><br/><span class="hl-1">- </span><span class="hl-10">Exit</span><span class="hl-1">: </span><span class="hl-4">sold</span><span class="hl-1"> </span><span class="hl-6">0.05</span><span class="hl-1">% </span><span class="hl-4">below</span><span class="hl-1"> </span><span class="hl-0">mid</span><span class="hl-1"> (</span><span class="hl-4">spread</span><span class="hl-1">)</span><br/><span class="hl-1">- </span><span class="hl-10">Fees</span><span class="hl-1">: </span><span class="hl-6">0.04</span><span class="hl-1">% Ã— </span><span class="hl-6">2</span><span class="hl-1"> = </span><span class="hl-6">0.08</span><span class="hl-1">%</span><br/><span class="hl-1">- </span><span class="hl-4">Price</span><span class="hl-1"> </span><span class="hl-10">impact</span><span class="hl-1">: ~</span><span class="hl-6">0</span><span class="hl-1">% (</span><span class="hl-4">canceled</span><span class="hl-1"> </span><span class="hl-4">out</span><span class="hl-1">)</span><br/><span class="hl-1">- </span><span class="hl-10">Total</span><span class="hl-1">: -</span><span class="hl-6">0.18</span><span class="hl-1">% </span><span class="hl-4">per</span><span class="hl-1"> </span><span class="hl-4">round</span><span class="hl-1">-</span><span class="hl-4">trip</span><br/><br/><span class="hl-4">Over</span><span class="hl-1"> </span><span class="hl-6">100</span><span class="hl-1"> </span><span class="hl-4">such</span><span class="hl-1"> </span><span class="hl-4">cycles</span><span class="hl-1"> </span><span class="hl-4">per</span><span class="hl-1"> </span><span class="hl-10">day</span><span class="hl-1">:</span><br/><br/><span class="hl-1">- </span><span class="hl-4">Each</span><span class="hl-1"> </span><span class="hl-10">bot</span><span class="hl-1">: -</span><span class="hl-6">18</span><span class="hl-1">% </span><span class="hl-4">per</span><span class="hl-1"> </span><span class="hl-4">day</span><br/><span class="hl-1">- </span><span class="hl-10">Exchange</span><span class="hl-1">: +</span><span class="hl-6">0.08</span><span class="hl-1">% Ã— </span><span class="hl-6">1000</span><span class="hl-1"> Ã— </span><span class="hl-6">100</span><span class="hl-1"> = +</span><span class="hl-6">8000</span><span class="hl-1"> </span><span class="hl-8">USD</span><span class="hl-1"> </span><span class="hl-4">per</span><span class="hl-1"> </span><span class="hl-4">day</span>
</code><button>Copy</button></pre>

<a id="but-my-bot-uses-different-indicators" class="tsd-anchor"></a><h2 class="tsd-anchor-link">But My Bot Uses Different Indicators!<a href="#but-my-bot-uses-different-indicators" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>No, it doesn't. Here's what 90% of retail bots use:</p>
<table>
<thead>
<tr>
<th>Indicator</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>RSI</td>
<td>85%</td>
</tr>
<tr>
<td>MACD</td>
<td>78%</td>
</tr>
<tr>
<td>Bollinger Bands</td>
<td>65%</td>
</tr>
<tr>
<td>EMA/SMA crosses</td>
<td>72%</td>
</tr>
<tr>
<td>Volume</td>
<td>45%</td>
</tr>
</tbody>
</table>
<p>Bots combine these indicators, but combinations are also standard:</p>
<ul>
<li>RSI + MACD = most popular</li>
<li>BB + RSI = second most popular</li>
<li>EMA cross + Volume = third</li>
</ul>
<p><strong>You're not unique. Your &quot;secret&quot; strategy is copy-paste from the top 5 tutorials.</strong></p>
<a id="predictable-stop-losses" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Predictable Stop-Losses<a href="#predictable-stop-losses" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Another pain point â€” stop placement. 90% of bots use:</p>
<pre><code class="python">stoploss = -0.10  # Fixed 10%
# or
stoploss = atr * 1.5  # ATR-based
# or
stoploss = last_swing_low - 0.5%  # Structure-based
</code><button type="button">Copy</button></pre>

<p>Market makers see these stop clusters and hunt them:</p>
<pre><code><span class="hl-4">Typical</span><span class="hl-1"> </span><span class="hl-10">situation</span><span class="hl-1">:</span><br/><br/><span class="hl-6">1.</span><span class="hl-1"> </span><span class="hl-10">Price</span><span class="hl-1">: </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">500</span><br/><span class="hl-6">2.</span><span class="hl-1"> </span><span class="hl-4">Bots</span><span class="hl-1"> </span><span class="hl-4">entered</span><span class="hl-1"> </span><span class="hl-8">LONG</span><span class="hl-1"> </span><span class="hl-4">on</span><span class="hl-1"> </span><span class="hl-2">&quot;breakout&quot;</span><span class="hl-1"> </span><span class="hl-4">at</span><span class="hl-1"> </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">450</span><br/><span class="hl-6">3.</span><span class="hl-1"> </span><span class="hl-10">Stops</span><span class="hl-1">: </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">450</span><span class="hl-1"> - </span><span class="hl-0">ATR</span><span class="hl-1">(</span><span class="hl-6">1.5</span><span class="hl-1">) â‰ˆ </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">280</span><br/><span class="hl-6">4.</span><span class="hl-1"> </span><span class="hl-4">Market</span><span class="hl-1"> </span><span class="hl-4">maker</span><span class="hl-1"> </span><span class="hl-10">sees</span><span class="hl-1">: </span><span class="hl-4">cluster</span><span class="hl-1"> </span><span class="hl-4">stop</span><span class="hl-1"> </span><span class="hl-4">orders</span><span class="hl-1"> @ </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">280</span><span class="hl-1">-</span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">300</span><br/><span class="hl-6">5.</span><span class="hl-1"> </span><span class="hl-4">Pushes</span><span class="hl-1"> </span><span class="hl-4">price</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">275</span><br/><span class="hl-6">6.</span><span class="hl-1"> </span><span class="hl-4">Stops</span><span class="hl-1"> </span><span class="hl-4">trigger</span><span class="hl-1"> = </span><span class="hl-4">selling</span><span class="hl-1"> </span><span class="hl-4">cascade</span><br/><span class="hl-6">7.</span><span class="hl-1"> </span><span class="hl-4">Buys</span><span class="hl-1"> </span><span class="hl-4">cheaper</span><span class="hl-1"> @ </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">250</span><br/><span class="hl-6">8.</span><span class="hl-1"> </span><span class="hl-4">Price</span><span class="hl-1"> </span><span class="hl-4">returns</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-4">$87</span><span class="hl-1">,</span><span class="hl-6">400</span><br/><br/><span class="hl-10">Bots</span><span class="hl-1">: -</span><span class="hl-6">1.5</span><span class="hl-1">% </span><span class="hl-4">each</span><br/><span class="hl-4">Market</span><span class="hl-1"> </span><span class="hl-10">maker</span><span class="hl-1">: +</span><span class="hl-6">0.3</span><span class="hl-1">%</span>
</code><button>Copy</button></pre>

<a id="self-reinforcing-feedback-loop" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Self-Reinforcing Feedback Loop<a href="#self-reinforcing-feedback-loop" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Here's the full picture of what happens:</p>
<p><img src="../media/ouroboros.png" alt="Ouroboros"></p>
<a id="what-to-do-llm-instead-of-indicators" class="tsd-anchor"></a><h2 class="tsd-anchor-link">What To Do: LLM Instead of Indicators<a href="#what-to-do-llm-instead-of-indicators" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>I use <a href="https://github.com/tripolskypetr/backtest-kit">backtest-kit</a> with Ollama for signal generation. LLM analyzes context holistically instead of jerking on every line crossing.</p>
<a id="signal-schema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Schema<a href="#signal-schema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">str</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;functools-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">z</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;zod&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">SignalSchema</span><span class="hl-1"> = </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">object</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-4">z</span><br/><span class="hl-1">    .</span><span class="hl-0">enum</span><span class="hl-1">([</span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;short&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;wait&quot;</span><span class="hl-1">])</span><br/><span class="hl-1">    .</span><span class="hl-0">describe</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Position direction (ALWAYS required):&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;long: market shows aligned bullish signals&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;short: market shows aligned bearish signals&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;wait: conflicting signals between timeframes&quot;</span><br/><span class="hl-1">      )</span><br/><span class="hl-1">    ),</span><br/><span class="hl-1">  </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-4">z</span><br/><span class="hl-1">    .</span><span class="hl-0">string</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-0">describe</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Professional recommendation in ONE LINE:&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;For LONG: strategy, reason, plan (buy â†’ sell higher)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;For SHORT: strategy, reason, plan (sell â†’ buy lower)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;For WAIT: why and when to enter&quot;</span><br/><span class="hl-1">      )</span><br/><span class="hl-1">    ),</span><br/><span class="hl-1">  </span><span class="hl-4">reasoning:</span><span class="hl-1"> </span><span class="hl-4">z</span><br/><span class="hl-1">    .</span><span class="hl-0">string</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-0">describe</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Technical justification (4-6 sentences):&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Signal alignment across timeframes&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Volume quality and dynamics&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Momentum, slope, hidden divergences&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Key support and resistance levels&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;REQUIRED: TP/SL level selection with technical justification&quot;</span><br/><span class="hl-1">      )</span><br/><span class="hl-1">    ),</span><br/><span class="hl-1">  </span><span class="hl-4">price_open:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">number</span><span class="hl-1">().</span><span class="hl-0">describe</span><span class="hl-1">(</span><span class="hl-2">&quot;Entry price in USD&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">price_stop_loss:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">number</span><span class="hl-1">().</span><span class="hl-0">describe</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Stop-loss price in USD&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;For LONG: below price_open&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;For SHORT: above price_open&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;NEVER set SL without technical justification&quot;</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">price_take_profit:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">number</span><span class="hl-1">().</span><span class="hl-0">describe</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Take-profit price in USD&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;For LONG: above price_open&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;For SHORT: below price_open&quot;</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">minute_estimated_time:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">number</span><span class="hl-1">().</span><span class="hl-0">describe</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Time to reach TP in minutes&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Based on ATR, ADX, MACD, Momentum&quot;</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">risk_note:</span><span class="hl-1"> </span><span class="hl-4">z</span><br/><span class="hl-1">    .</span><span class="hl-0">string</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-0">describe</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Risk description (ALWAYS required):&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;1. Whale manipulation (fake breakouts, pin bars)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;2. Order book (walls, spoofing, imbalance)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;3. Time factors (session, liquidity)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;4. Technical risks (divergences, weak volume)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Provide SPECIFIC numbers and probabilities&quot;</span><br/><span class="hl-1">      )</span><br/><span class="hl-1">    ),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="signal-generation-prompt" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Generation Prompt<a href="#signal-generation-prompt" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">str</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;functools-kit&quot;</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">SIGNAL_PROMPT</span><span class="hl-1"> = </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Analyze the market using attached data.&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Minimum profit percentage at TP: 1%&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Risk Reward ratio: no higher than 1:2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Requirements:&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;- 1m timeframe, next three hours&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;- Recommendation for both uptrend AND downtrend&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;- Entry conditions as IF-THEN with price levels&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;- Entry/Stop/TP as numbers in USD&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;- Filters required&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;- Risk management at the end&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;- No data retelling&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;- Maximum compression&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Format:&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;LONG conditions: [logic with Support/Resistance]&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Entry: [USD], TP: [USD], SL: [USD]&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;SHORT conditions: [logic with Support/Resistance]&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Entry: [USD], TP: [USD], SL: [USD]&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Filters: [list]&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Risk: [rules]&quot;</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="strategy" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Strategy<a href="#strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">json</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;agent-swarm-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addStrategy</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;llm-anti-bot&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskList:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;TakeProfitDistanceRisk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;RiskRewardRatioRisk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;LanguageModelOpinionRisk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> { </span><span class="hl-8">data</span><span class="hl-1">, </span><span class="hl-8">resultId</span><span class="hl-1">, </span><span class="hl-8">error</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">json</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;SignalOutline&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">symbol</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">position</span><span class="hl-1"> === </span><span class="hl-2">&quot;wait&quot;</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">resultId</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">position</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> +</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">minute_estimated_time</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> +</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_stop_loss</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> +</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_take_profit</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceOpen:</span><span class="hl-1"> +</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_open</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">risk_note</span><span class="hl-1">,</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="preparing-history-for-llm" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Preparing History for LLM<a href="#preparing-history-for-llm" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Cache</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">str</span><span class="hl-1">, </span><span class="hl-4">trycatch</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;functools-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">fetchHourHistory</span><span class="hl-1"> = </span><span class="hl-4">Cache</span><span class="hl-1">.</span><span class="hl-0">fn</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">lib</span><span class="hl-1">.</span><span class="hl-4">hourCandleHistoryService</span><span class="hl-1">.</span><span class="hl-4">getReport</span><span class="hl-1">,</span><br/><span class="hl-1">  { </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;30m&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">fetchFifteenMinuteHistory</span><span class="hl-1"> = </span><span class="hl-4">Cache</span><span class="hl-1">.</span><span class="hl-0">fn</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">lib</span><span class="hl-1">.</span><span class="hl-4">fifteenMinuteCandleHistoryService</span><span class="hl-1">.</span><span class="hl-4">getReport</span><span class="hl-1">,</span><br/><span class="hl-1">  { </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">commitHourHistory</span><span class="hl-1"> = </span><span class="hl-0">trycatch</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">history</span><span class="hl-1">: </span><span class="hl-11">History</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">hourHistory</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchHourHistory</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">history</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;=== 1-HOUR CANDLES (last 6 candles) ===&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">hourHistory</span><br/><span class="hl-1">        ),</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;assistant&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">&quot;1-hour candles received.&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-0">fallback</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">Cache</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">(</span><span class="hl-4">fetchHourHistory</span><span class="hl-1">) }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">commitFifteenMinuteHistory</span><span class="hl-1"> = </span><span class="hl-0">trycatch</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">history</span><span class="hl-1">: </span><span class="hl-11">History</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">data</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchFifteenMinuteHistory</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">history</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;=== 15-MINUTE CANDLES (last 8 candles) ===&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">data</span><br/><span class="hl-1">        ),</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;assistant&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">&quot;15-minute candles received.&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-0">fallback</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">Cache</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">(</span><span class="hl-4">fetchFifteenMinuteHistory</span><span class="hl-1">) }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="indicator-calculation-service-excerpt" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Indicator Calculation Service (excerpt)<a href="#indicator-calculation-service-excerpt" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">FasterRSI</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-4">RSI</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">FasterMACD</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-4">MACD</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">FasterBollingerBands</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-4">BollingerBands</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">FasterATR</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-4">ATR</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">FasterADX</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-4">ADX</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">// ... other indicators</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;trading-signals&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">generateAnalysis</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">candles</span><span class="hl-1">: </span><span class="hl-11">ICandleData</span><span class="hl-1">[]) {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">rsi</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">RSI</span><span class="hl-1">(</span><span class="hl-6">14</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">macd</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">MACD</span><span class="hl-1">(</span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">EMA</span><span class="hl-1">(</span><span class="hl-6">12</span><span class="hl-1">), </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">EMA</span><span class="hl-1">(</span><span class="hl-6">26</span><span class="hl-1">), </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">EMA</span><span class="hl-1">(</span><span class="hl-6">9</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">bollinger</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">BollingerBands</span><span class="hl-1">(</span><span class="hl-6">20</span><span class="hl-1">, </span><span class="hl-6">2.0</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">atr14</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">ATR</span><span class="hl-1">(</span><span class="hl-6">14</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">adx</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">ADX</span><span class="hl-1">(</span><span class="hl-6">14</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">// ... initialize other indicators</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">results</span><span class="hl-1">: </span><span class="hl-11">ILongTermRow</span><span class="hl-1">[] = [];</span><br/><span class="hl-1">  </span><span class="hl-4">candles</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-4">candle</span><span class="hl-1">, </span><span class="hl-4">i</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> { </span><span class="hl-8">high</span><span class="hl-1">, </span><span class="hl-8">low</span><span class="hl-1">, </span><span class="hl-8">close</span><span class="hl-1"> } = </span><span class="hl-4">candle</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-5">// Update all indicators</span><br/><span class="hl-1">    </span><span class="hl-4">rsi</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">(</span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-7">false</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">macd</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">(</span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-7">false</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">bollinger</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">(</span><span class="hl-4">close</span><span class="hl-1">, </span><span class="hl-7">false</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">atr14</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({ </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1"> }, </span><span class="hl-7">false</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">adx</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({ </span><span class="hl-4">high</span><span class="hl-1">, </span><span class="hl-4">low</span><span class="hl-1">, </span><span class="hl-4">close</span><span class="hl-1"> }, </span><span class="hl-7">false</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// Skip until indicators are warmed up</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">i</span><span class="hl-1"> &lt; </span><span class="hl-8">WARMUP_PERIOD</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-5">// Volume trend: compare SMA(6) of current and previous period</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">volumeTrend</span><span class="hl-1"> = </span><span class="hl-0">calculateVolumeTrend</span><span class="hl-1">(</span><span class="hl-4">volumes</span><span class="hl-1">, </span><span class="hl-4">i</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// Support/Resistance: min/max over last N candles</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> { </span><span class="hl-8">support</span><span class="hl-1">, </span><span class="hl-8">resistance</span><span class="hl-1"> } = </span><span class="hl-0">calculatePivots</span><span class="hl-1">(</span><span class="hl-4">highs</span><span class="hl-1">, </span><span class="hl-4">lows</span><span class="hl-1">, </span><span class="hl-4">i</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// Fibonacci: nearest level to current price</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">fibonacciNearest</span><span class="hl-1"> = </span><span class="hl-0">calculateFibonacciLevels</span><span class="hl-1">(</span><span class="hl-4">candles</span><span class="hl-1">, </span><span class="hl-4">i</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">rsi14:</span><span class="hl-1"> </span><span class="hl-4">rsi</span><span class="hl-1">.</span><span class="hl-0">getResult</span><span class="hl-1">(),</span><br/><span class="hl-1">      </span><span class="hl-4">macd12_26_9:</span><span class="hl-1"> </span><span class="hl-4">macd</span><span class="hl-1">.</span><span class="hl-0">getResult</span><span class="hl-1">()?.</span><span class="hl-4">macd</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">adx14:</span><span class="hl-1"> </span><span class="hl-4">adx</span><span class="hl-1">.</span><span class="hl-0">getResult</span><span class="hl-1">(),</span><br/><span class="hl-1">      </span><span class="hl-4">atr14:</span><span class="hl-1"> </span><span class="hl-4">atr14</span><span class="hl-1">.</span><span class="hl-0">getResult</span><span class="hl-1">(),</span><br/><span class="hl-1">      </span><span class="hl-4">support</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">resistance</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">fibonacciNearestLevel:</span><span class="hl-1"> </span><span class="hl-4">fibonacciNearest</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">// ... remaining fields</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">results</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="validations" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validations<a href="#validations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addOutline</span><span class="hl-1">, </span><span class="hl-4">dumpOutlineResult</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;agent-swarm-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">zodResponseFormat</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;openai/helpers/zod&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addOutline</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">outlineName:</span><span class="hl-1"> </span><span class="hl-2">&quot;SignalOutline&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">completion:</span><span class="hl-1"> </span><span class="hl-2">&quot;OllamaCompletion&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">format:</span><span class="hl-1"> </span><span class="hl-0">zodResponseFormat</span><span class="hl-1">(</span><span class="hl-4">SignalSchema</span><span class="hl-1">, </span><span class="hl-2">&quot;position_open_decision&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-0">getOutlineHistory</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> ({ </span><span class="hl-4">history</span><span class="hl-1">, </span><span class="hl-4">param</span><span class="hl-1">: </span><span class="hl-4">symbol</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">commitHourHistory</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">history</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">commitFifteenMinuteHistory</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">history</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// ... other timeframes</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-0">validate</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">data</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">position</span><span class="hl-1"> === </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_stop_loss</span><span class="hl-1"> &gt;= </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_open</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;LONG: SL must be below entry&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_take_profit</span><span class="hl-1"> &lt;= </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_open</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;LONG: TP must be above entry&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">docDescription:</span><span class="hl-1"> </span><span class="hl-2">&quot;Validates price correctness for LONG&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-0">validate</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">data</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">position</span><span class="hl-1"> === </span><span class="hl-2">&quot;short&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_stop_loss</span><span class="hl-1"> &lt;= </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_open</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;SHORT: SL must be above entry&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_take_profit</span><span class="hl-1"> &gt;= </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">price_open</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;SHORT: TP must be below entry&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">docDescription:</span><span class="hl-1"> </span><span class="hl-2">&quot;Validates price correctness for SHORT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-0">validate</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">data</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">position</span><span class="hl-1"> !== </span><span class="hl-2">&quot;wait&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">minute_estimated_time</span><span class="hl-1"> &gt; </span><span class="hl-6">360</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Time to TP &gt; 6 hours. Use wait&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">docDescription:</span><span class="hl-1"> </span><span class="hl-2">&quot;Validates time realism&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">onValidDocument</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">dumpOutlineResult</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="why-llm-works-better" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Why LLM Works Better<a href="#why-llm-works-better" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>LLM doesn't jerk on every RSI &lt; 30. It sees context:</p>
<pre><code><span class="hl-8">RSI</span><span class="hl-1"> 1</span><span class="hl-10">m</span><span class="hl-1">: </span><span class="hl-6">28</span><span class="hl-1"> (</span><span class="hl-4">oversold</span><span class="hl-1">)</span><br/><span class="hl-8">RSI</span><span class="hl-1"> 1</span><span class="hl-10">h</span><span class="hl-1">: </span><span class="hl-6">55</span><span class="hl-1"> (</span><span class="hl-4">neutral</span><span class="hl-1">)</span><br/><span class="hl-10">Volume</span><span class="hl-1">: 0.3</span><span class="hl-4">x</span><span class="hl-1"> </span><span class="hl-0">average</span><span class="hl-1"> (</span><span class="hl-4">weak</span><span class="hl-1">)</span><br/><span class="hl-10">ADX</span><span class="hl-1">: </span><span class="hl-6">15</span><span class="hl-1"> (</span><span class="hl-4">no</span><span class="hl-1"> </span><span class="hl-4">trend</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>

<p>A standard bot would see RSI &lt; 30 and buy. LLM understands it's a trap.</p>
<pre><code><span class="hl-8">LLM</span><span class="hl-1"> </span><span class="hl-10">output</span><span class="hl-1">: </span><span class="hl-2">&quot;WAIT - RSI oversold on 1m, but 1h neutral,</span><span class="hl-12"> </span><br/><span class="hl-4">volume</span><span class="hl-1"> </span><span class="hl-4">weak</span><span class="hl-1">. </span><span class="hl-4">These</span><span class="hl-1"> </span><span class="hl-4">are</span><span class="hl-1"> </span><span class="hl-4">bots</span><span class="hl-1"> </span><span class="hl-4">trying</span><span class="hl-1"> </span><span class="hl-4">to</span><span class="hl-1"> </span><span class="hl-4">buy</span><span class="hl-1">, </span><span class="hl-4">not</span><span class="hl-1"> </span><span class="hl-4">real</span><span class="hl-1"> </span><br/><span class="hl-4">capitulation</span><span class="hl-1">. </span><span class="hl-4">Wait</span><span class="hl-1"> </span><span class="hl-4">for</span><span class="hl-1"> </span><span class="hl-4">breakout</span><span class="hl-1"> </span><span class="hl-3">with</span><span class="hl-1"> </span><span class="hl-4">volume</span><span class="hl-1"> </span><span class="hl-4">or</span><span class="hl-1"> 1</span><span class="hl-4">h</span><span class="hl-1"> </span><span class="hl-4">correction</span><span class="hl-1">.</span><span class="hl-2">&quot;</span>
</code><button>Copy</button></pre>

<a id="conclusion" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Conclusion<a href="#conclusion" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Algo trading in crypto has become a game where thousands of copies of the same code trade against each other. Every bot pays fees, every bot loses on spread, the only beneficiary is the exchange.</p>
<p>If your strategy is RSI/MACD/BB from a tutorial, you're trading against 10,000 identical bots with the same code.</p>
<p>Edge exists, but it's elsewhere:</p>
<ul>
<li>In understanding bot crowd behavior</li>
<li>In using LLM for holistic analysis instead of dumb triggers</li>
<li>In validating signals before execution</li>
<li>Or in exiting this game entirely</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#ðŸ¤–-second-order-chaos-how-algo-trading-bots-play-against-themselves-at-a-loss"><span>ðŸ¤– <wbr/>Second-<wbr/>Order <wbr/>Chaos: <wbr/>How <wbr/>Algo <wbr/>Trading <wbr/>Bots <wbr/>Play <wbr/>Against <wbr/>Themselves at a <wbr/>Loss</span></a><ul><li><a href="#first-order-vs-second-order-chaos"><span>First-<wbr/>Order vs <wbr/>Second-<wbr/>Order <wbr/>Chaos</span></a></li><li><a href="#one-algorithm-against-itself"><span>One <wbr/>Algorithm <wbr/>Against <wbr/>Itself</span></a></li><li><a href="#why-this-happens"><span>Why <wbr/>This <wbr/>Happens</span></a></li><li><a href="#the-math-of-self-conflict"><span>The <wbr/>Math of <wbr/>Self-<wbr/>Conflict</span></a></li><li><a href="#but-my-bot-uses-different-indicators"><span>But <wbr/>My <wbr/>Bot <wbr/>Uses <wbr/>Different <wbr/>Indicators!</span></a></li><li><a href="#predictable-stop-losses"><span>Predictable <wbr/>Stop-<wbr/>Losses</span></a></li><li><a href="#self-reinforcing-feedback-loop"><span>Self-<wbr/>Reinforcing <wbr/>Feedback <wbr/>Loop</span></a></li><li><a href="#what-to-do-llm-instead-of-indicators"><span>What <wbr/>To <wbr/>Do: LLM <wbr/>Instead of <wbr/>Indicators</span></a></li><li><a href="#signal-schema"><span>Signal <wbr/>Schema</span></a></li><li><a href="#signal-generation-prompt"><span>Signal <wbr/>Generation <wbr/>Prompt</span></a></li><li><a href="#strategy"><span>Strategy</span></a></li><li><a href="#preparing-history-for-llm"><span>Preparing <wbr/>History for LLM</span></a></li><li><a href="#indicator-calculation-service-excerpt"><span>Indicator <wbr/>Calculation <wbr/>Service (excerpt)</span></a></li><li><a href="#validations"><span>Validations</span></a></li><li><a href="#why-llm-works-better"><span>Why LLM <wbr/>Works <wbr/>Better</span></a></li><li><a href="#conclusion"><span>Conclusion</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
