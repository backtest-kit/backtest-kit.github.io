<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>article/02_second_order_chaos | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="article_02_second_order_chaos.html">article/02_second_order_chaos</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="ðŸ¤–-second-order-chaos-how-algo-trading-bots-play-against-themselves-at-a-loss" class="tsd-anchor"></a><h1 class="tsd-anchor-link">ðŸ¤– Second-Order Chaos: How Algo Trading Bots Play Against Themselves at a Loss<a href="#ðŸ¤–-second-order-chaos-how-algo-trading-bots-play-against-themselves-at-a-loss" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p><img src="../media/bots.png" alt="bots"></p>
<p>I build trading systems for crypto and discovered a paradox that explains why 95% of bots blow their accounts. The problem isn't the strategies â€” it's that thousands of copies of the same algorithm trade against each other.</p>
<a id="first-order-vs-second-order-chaos" class="tsd-anchor"></a><h2 class="tsd-anchor-link">First-Order vs Second-Order Chaos<a href="#first-order-vs-second-order-chaos" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Let's define terms.</p>
<p><strong>First-order chaos</strong> â€” the market is unpredictable, but participants don't know the patterns. You can find edge through analysis. Classic indicators work.</p>
<p><strong>Second-order chaos</strong> â€” the market is unpredictable BECAUSE everyone knows the patterns. Everyone trades the same way. Bots react to bots. Strategies CREATE the noise they're trying to trade.</p>
<p>We're living in the second one now.</p>
<a id="one-algorithm-against-itself" class="tsd-anchor"></a><h2 class="tsd-anchor-link">One Algorithm Against Itself<a href="#one-algorithm-against-itself" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Here's what happens every second on crypto exchanges:</p>
<pre><code><span class="hl-7">09</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">.</span><span class="hl-7">000</span><span class="hl-2"> - </span><span class="hl-8">BTC</span><span class="hl-2"> </span><span class="hl-6">price</span><span class="hl-2"> </span><span class="hl-6">drops</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">300</span><br/><span class="hl-7">09</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">.</span><span class="hl-7">050</span><span class="hl-2"> - </span><span class="hl-7">1000</span><span class="hl-2"> </span><span class="hl-6">freqtrade</span><span class="hl-2"> </span><span class="hl-6">bots</span><span class="hl-2"> </span><span class="hl-10">see</span><span class="hl-2">: </span><span class="hl-8">RSI</span><span class="hl-2"> &lt; </span><span class="hl-7">30</span><br/><br/><span class="hl-6">Each</span><span class="hl-2"> </span><span class="hl-6">bot</span><span class="hl-2"> </span><span class="hl-10">thinks</span><span class="hl-2">:</span><br/><br/><span class="hl-4">&quot;RSI in oversold zone â†’ this is a buy signal&quot;</span><br/><span class="hl-7">09</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">.</span><span class="hl-7">100</span><span class="hl-2"> - </span><span class="hl-6">All</span><span class="hl-2"> </span><span class="hl-6">simultaneously</span><span class="hl-2"> </span><span class="hl-6">send</span><span class="hl-2"> </span><span class="hl-8">BUY</span><span class="hl-2"> </span><span class="hl-6">orders</span><br/><span class="hl-7">09</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">.</span><span class="hl-7">150</span><span class="hl-2"> - </span><span class="hl-6">Price</span><span class="hl-2"> </span><span class="hl-6">spikes</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">450</span><span class="hl-2"> (</span><span class="hl-6">they</span><span class="hl-2"> </span><span class="hl-6">all</span><span class="hl-2"> </span><span class="hl-6">bought</span><span class="hl-2"> </span><span class="hl-6">from</span><span class="hl-2"> </span><span class="hl-6">each</span><span class="hl-2"> </span><span class="hl-6">other</span><span class="hl-2">)</span><br/><span class="hl-7">09</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">.</span><span class="hl-7">200</span><span class="hl-2"> - </span><span class="hl-8">RSI</span><span class="hl-2"> </span><span class="hl-6">instantly</span><span class="hl-2"> </span><span class="hl-6">jumps</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-7">75</span><br/><br/><span class="hl-6">The</span><span class="hl-2"> </span><span class="hl-6">same</span><span class="hl-2"> </span><span class="hl-10">bots</span><span class="hl-2">:</span><br/><br/><span class="hl-4">&quot;RSI in overbought zone â†’ this is a sell signal&quot;</span><br/><span class="hl-7">09</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">.</span><span class="hl-7">250</span><span class="hl-2"> - </span><span class="hl-6">All</span><span class="hl-2"> </span><span class="hl-6">simultaneously</span><span class="hl-2"> </span><span class="hl-6">send</span><span class="hl-2"> </span><span class="hl-8">SELL</span><span class="hl-2"> </span><span class="hl-6">orders</span><br/><span class="hl-7">09</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">:</span><span class="hl-7">00</span><span class="hl-2">.</span><span class="hl-7">300</span><span class="hl-2"> - </span><span class="hl-6">Price</span><span class="hl-2"> </span><span class="hl-6">back</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">300</span>
</code><button>Copy</button></pre>

<p>Final score:</p>
<ul>
<li>Each bot: -0.1% (spread) -0.04% (fees) = <strong>-0.14%</strong></li>
<li>Exchange: +0.04% Ã— 1000 = <strong>+40 USD</strong></li>
</ul>
<p><strong>These aren't different bots competing. This is literally one algorithm playing against itself at a loss.</strong></p>
<a id="why-this-happens" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Why This Happens<a href="#why-this-happens" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Look at a typical strategy from the freqtrade tutorial:</p>
<pre><code class="python">class RSIStrategy(IStrategy):
    def populate_indicators(self, dataframe, metadata):
        dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)
        return dataframe
    
    def populate_entry_trend(self, dataframe, metadata):
        dataframe.loc[
            (dataframe['rsi'] < 30),  # Oversold
            'enter_long'] = 1
        return dataframe
    
    def populate_exit_trend(self, dataframe, metadata):
        dataframe.loc[
            (dataframe['rsi'] > 70),  # Overbought
            'exit_long'] = 1
        return dataframe
</code><button type="button">Copy</button></pre>

<p>This strategy:</p>
<ol>
<li>Published in official documentation</li>
<li>Copied into thousands of bots</li>
<li>Runs on the same timeframes (5m, 15m)</li>
<li>Uses identical parameters (RSI 14, thresholds 30/70)</li>
</ol>
<p>Result: <strong>thousands of identical instances</strong> of one code trading on the same market.</p>
<a id="the-math-of-self-conflict" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Math of Self-Conflict<a href="#the-math-of-self-conflict" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Let's break it down with real numbers:</p>
<pre><code><span class="hl-10">Conditions</span><span class="hl-2">:</span><br/><br/><span class="hl-2">- </span><span class="hl-7">1000</span><span class="hl-2"> </span><span class="hl-6">bots</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-6">identical</span><span class="hl-2"> </span><span class="hl-8">RSI</span><span class="hl-2"> </span><span class="hl-6">strategy</span><br/><span class="hl-2">- </span><span class="hl-6">Each</span><span class="hl-2"> </span><span class="hl-6">trading</span><span class="hl-2"> </span><span class="hl-7">0.01</span><span class="hl-2"> </span><span class="hl-8">BTC</span><br/><span class="hl-2">- </span><span class="hl-10">Spread</span><span class="hl-2">: </span><span class="hl-7">0.05</span><span class="hl-2">%</span><br/><span class="hl-2">- </span><span class="hl-10">Commission</span><span class="hl-2">: </span><span class="hl-7">0.04</span><span class="hl-2">% (</span><span class="hl-6">taker</span><span class="hl-2">)</span><br/><br/><span class="hl-4">&quot;RSI reversal&quot;</span><span class="hl-2"> </span><span class="hl-10">scenario</span><span class="hl-2">:</span><br/><span class="hl-7">1.</span><span class="hl-2"> </span><span class="hl-8">RSI</span><span class="hl-2"> </span><span class="hl-6">drops</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-7">29</span><br/><span class="hl-7">2.</span><span class="hl-2"> </span><span class="hl-6">All</span><span class="hl-2"> </span><span class="hl-7">1000</span><span class="hl-2"> </span><span class="hl-6">bots</span><span class="hl-2"> </span><span class="hl-6">send</span><span class="hl-2"> </span><span class="hl-8">BUY</span><span class="hl-2"> </span><span class="hl-7">0.01</span><span class="hl-2"> </span><span class="hl-8">BTC</span><br/><span class="hl-7">3.</span><span class="hl-2"> </span><span class="hl-6">Total</span><span class="hl-2"> </span><span class="hl-10">volume</span><span class="hl-2">: </span><span class="hl-7">10</span><span class="hl-2"> </span><span class="hl-8">BTC</span><span class="hl-2"> </span><span class="hl-6">bought</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> 100</span><span class="hl-6">ms</span><br/><span class="hl-7">4.</span><span class="hl-2"> </span><span class="hl-6">Price</span><span class="hl-2"> </span><span class="hl-6">rises</span><span class="hl-2"> </span><span class="hl-7">0.15</span><span class="hl-2">% </span><span class="hl-6">from</span><span class="hl-2"> </span><span class="hl-6">impact</span><br/><span class="hl-7">5.</span><span class="hl-2"> </span><span class="hl-8">RSI</span><span class="hl-2"> </span><span class="hl-6">jumps</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-7">72</span><span class="hl-2"> (</span><span class="hl-6">bots</span><span class="hl-2"> </span><span class="hl-6">raised</span><span class="hl-2"> </span><span class="hl-6">it</span><span class="hl-2"> </span><span class="hl-6">themselves</span><span class="hl-2">)</span><br/><span class="hl-7">6.</span><span class="hl-2"> </span><span class="hl-6">All</span><span class="hl-2"> </span><span class="hl-7">1000</span><span class="hl-2"> </span><span class="hl-6">bots</span><span class="hl-2"> </span><span class="hl-6">send</span><span class="hl-2"> </span><span class="hl-8">SELL</span><span class="hl-2"> </span><span class="hl-7">0.01</span><span class="hl-2"> </span><span class="hl-8">BTC</span><br/><span class="hl-7">7.</span><span class="hl-2"> </span><span class="hl-6">Price</span><span class="hl-2"> </span><span class="hl-6">drops</span><span class="hl-2"> </span><span class="hl-7">0.15</span><span class="hl-2">% </span><span class="hl-6">back</span><br/><br/><span class="hl-6">PnL</span><span class="hl-2"> </span><span class="hl-6">per</span><span class="hl-2"> </span><span class="hl-10">bot</span><span class="hl-2">:</span><br/><br/><span class="hl-2">- </span><span class="hl-10">Entry</span><span class="hl-2">: </span><span class="hl-6">bought</span><span class="hl-2"> </span><span class="hl-7">0.05</span><span class="hl-2">% </span><span class="hl-6">above</span><span class="hl-2"> </span><span class="hl-1">mid</span><span class="hl-2"> (</span><span class="hl-6">spread</span><span class="hl-2">)</span><br/><span class="hl-2">- </span><span class="hl-10">Exit</span><span class="hl-2">: </span><span class="hl-6">sold</span><span class="hl-2"> </span><span class="hl-7">0.05</span><span class="hl-2">% </span><span class="hl-6">below</span><span class="hl-2"> </span><span class="hl-1">mid</span><span class="hl-2"> (</span><span class="hl-6">spread</span><span class="hl-2">)</span><br/><span class="hl-2">- </span><span class="hl-10">Fees</span><span class="hl-2">: </span><span class="hl-7">0.04</span><span class="hl-2">% Ã— </span><span class="hl-7">2</span><span class="hl-2"> = </span><span class="hl-7">0.08</span><span class="hl-2">%</span><br/><span class="hl-2">- </span><span class="hl-6">Price</span><span class="hl-2"> </span><span class="hl-10">impact</span><span class="hl-2">: ~</span><span class="hl-7">0</span><span class="hl-2">% (</span><span class="hl-6">canceled</span><span class="hl-2"> </span><span class="hl-6">out</span><span class="hl-2">)</span><br/><span class="hl-2">- </span><span class="hl-10">Total</span><span class="hl-2">: -</span><span class="hl-7">0.18</span><span class="hl-2">% </span><span class="hl-6">per</span><span class="hl-2"> </span><span class="hl-6">round</span><span class="hl-2">-</span><span class="hl-6">trip</span><br/><br/><span class="hl-6">Over</span><span class="hl-2"> </span><span class="hl-7">100</span><span class="hl-2"> </span><span class="hl-6">such</span><span class="hl-2"> </span><span class="hl-6">cycles</span><span class="hl-2"> </span><span class="hl-6">per</span><span class="hl-2"> </span><span class="hl-10">day</span><span class="hl-2">:</span><br/><br/><span class="hl-2">- </span><span class="hl-6">Each</span><span class="hl-2"> </span><span class="hl-10">bot</span><span class="hl-2">: -</span><span class="hl-7">18</span><span class="hl-2">% </span><span class="hl-6">per</span><span class="hl-2"> </span><span class="hl-6">day</span><br/><span class="hl-2">- </span><span class="hl-10">Exchange</span><span class="hl-2">: +</span><span class="hl-7">0.08</span><span class="hl-2">% Ã— </span><span class="hl-7">1000</span><span class="hl-2"> Ã— </span><span class="hl-7">100</span><span class="hl-2"> = +</span><span class="hl-7">8000</span><span class="hl-2"> </span><span class="hl-8">USD</span><span class="hl-2"> </span><span class="hl-6">per</span><span class="hl-2"> </span><span class="hl-6">day</span>
</code><button>Copy</button></pre>

<a id="but-my-bot-uses-different-indicators" class="tsd-anchor"></a><h2 class="tsd-anchor-link">But My Bot Uses Different Indicators!<a href="#but-my-bot-uses-different-indicators" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>No, it doesn't. Here's what 90% of retail bots use:</p>
<table>
<thead>
<tr>
<th>Indicator</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>RSI</td>
<td>85%</td>
</tr>
<tr>
<td>MACD</td>
<td>78%</td>
</tr>
<tr>
<td>Bollinger Bands</td>
<td>65%</td>
</tr>
<tr>
<td>EMA/SMA crosses</td>
<td>72%</td>
</tr>
<tr>
<td>Volume</td>
<td>45%</td>
</tr>
</tbody>
</table>
<p>Bots combine these indicators, but combinations are also standard:</p>
<ul>
<li>RSI + MACD = most popular</li>
<li>BB + RSI = second most popular</li>
<li>EMA cross + Volume = third</li>
</ul>
<p><strong>You're not unique. Your &quot;secret&quot; strategy is copy-paste from the top 5 tutorials.</strong></p>
<a id="predictable-stop-losses" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Predictable Stop-Losses<a href="#predictable-stop-losses" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Another pain point â€” stop placement. 90% of bots use:</p>
<pre><code class="python">stoploss = -0.10  # Fixed 10%
# or
stoploss = atr * 1.5  # ATR-based
# or
stoploss = last_swing_low - 0.5%  # Structure-based
</code><button type="button">Copy</button></pre>

<p>Market makers see these stop clusters and hunt them:</p>
<pre><code><span class="hl-6">Typical</span><span class="hl-2"> </span><span class="hl-10">situation</span><span class="hl-2">:</span><br/><br/><span class="hl-7">1.</span><span class="hl-2"> </span><span class="hl-10">Price</span><span class="hl-2">: </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">500</span><br/><span class="hl-7">2.</span><span class="hl-2"> </span><span class="hl-6">Bots</span><span class="hl-2"> </span><span class="hl-6">entered</span><span class="hl-2"> </span><span class="hl-8">LONG</span><span class="hl-2"> </span><span class="hl-6">on</span><span class="hl-2"> </span><span class="hl-4">&quot;breakout&quot;</span><span class="hl-2"> </span><span class="hl-6">at</span><span class="hl-2"> </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">450</span><br/><span class="hl-7">3.</span><span class="hl-2"> </span><span class="hl-10">Stops</span><span class="hl-2">: </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">450</span><span class="hl-2"> - </span><span class="hl-1">ATR</span><span class="hl-2">(</span><span class="hl-7">1.5</span><span class="hl-2">) â‰ˆ </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">280</span><br/><span class="hl-7">4.</span><span class="hl-2"> </span><span class="hl-6">Market</span><span class="hl-2"> </span><span class="hl-6">maker</span><span class="hl-2"> </span><span class="hl-10">sees</span><span class="hl-2">: </span><span class="hl-6">cluster</span><span class="hl-2"> </span><span class="hl-6">stop</span><span class="hl-2"> </span><span class="hl-6">orders</span><span class="hl-2"> @ </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">280</span><span class="hl-2">-</span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">300</span><br/><span class="hl-7">5.</span><span class="hl-2"> </span><span class="hl-6">Pushes</span><span class="hl-2"> </span><span class="hl-6">price</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">275</span><br/><span class="hl-7">6.</span><span class="hl-2"> </span><span class="hl-6">Stops</span><span class="hl-2"> </span><span class="hl-6">trigger</span><span class="hl-2"> = </span><span class="hl-6">selling</span><span class="hl-2"> </span><span class="hl-6">cascade</span><br/><span class="hl-7">7.</span><span class="hl-2"> </span><span class="hl-6">Buys</span><span class="hl-2"> </span><span class="hl-6">cheaper</span><span class="hl-2"> @ </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">250</span><br/><span class="hl-7">8.</span><span class="hl-2"> </span><span class="hl-6">Price</span><span class="hl-2"> </span><span class="hl-6">returns</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">$87</span><span class="hl-2">,</span><span class="hl-7">400</span><br/><br/><span class="hl-10">Bots</span><span class="hl-2">: -</span><span class="hl-7">1.5</span><span class="hl-2">% </span><span class="hl-6">each</span><br/><span class="hl-6">Market</span><span class="hl-2"> </span><span class="hl-10">maker</span><span class="hl-2">: +</span><span class="hl-7">0.3</span><span class="hl-2">%</span>
</code><button>Copy</button></pre>

<a id="self-reinforcing-feedback-loop" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Self-Reinforcing Feedback Loop<a href="#self-reinforcing-feedback-loop" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Here's the full picture of what happens:</p>
<p><img src="../media/ouroboros.png" alt="Ouroboros"></p>
<a id="what-to-do-llm-instead-of-indicators" class="tsd-anchor"></a><h2 class="tsd-anchor-link">What To Do: LLM Instead of Indicators<a href="#what-to-do-llm-instead-of-indicators" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>I use <a href="https://github.com/tripolskypetr/backtest-kit">backtest-kit</a> with Ollama for signal generation. LLM analyzes context holistically instead of jerking on every line crossing.</p>
<a id="signal-schema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Schema<a href="#signal-schema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">str</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;functools-kit&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">z</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;zod&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-5">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">SignalSchema</span><span class="hl-2"> = </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">object</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-6">z</span><br/><span class="hl-2">    .</span><span class="hl-1">enum</span><span class="hl-2">([</span><span class="hl-4">&quot;long&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;short&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;wait&quot;</span><span class="hl-2">])</span><br/><span class="hl-2">    .</span><span class="hl-1">describe</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-6">str</span><span class="hl-2">.</span><span class="hl-1">newline</span><span class="hl-2">(</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;Position direction (ALWAYS required):&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;long: market shows aligned bullish signals&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;short: market shows aligned bearish signals&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;wait: conflicting signals between timeframes&quot;</span><br/><span class="hl-2">      )</span><br/><span class="hl-2">    ),</span><br/><span class="hl-2">  </span><span class="hl-6">description:</span><span class="hl-2"> </span><span class="hl-6">z</span><br/><span class="hl-2">    .</span><span class="hl-1">string</span><span class="hl-2">()</span><br/><span class="hl-2">    .</span><span class="hl-1">describe</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-6">str</span><span class="hl-2">.</span><span class="hl-1">newline</span><span class="hl-2">(</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;Professional recommendation in ONE LINE:&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;For LONG: strategy, reason, plan (buy â†’ sell higher)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;For SHORT: strategy, reason, plan (sell â†’ buy lower)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;For WAIT: why and when to enter&quot;</span><br/><span class="hl-2">      )</span><br/><span class="hl-2">    ),</span><br/><span class="hl-2">  </span><span class="hl-6">reasoning:</span><span class="hl-2"> </span><span class="hl-6">z</span><br/><span class="hl-2">    .</span><span class="hl-1">string</span><span class="hl-2">()</span><br/><span class="hl-2">    .</span><span class="hl-1">describe</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-6">str</span><span class="hl-2">.</span><span class="hl-1">newline</span><span class="hl-2">(</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;Technical justification (4-6 sentences):&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;Signal alignment across timeframes&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;Volume quality and dynamics&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;Momentum, slope, hidden divergences&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;Key support and resistance levels&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;REQUIRED: TP/SL level selection with technical justification&quot;</span><br/><span class="hl-2">      )</span><br/><span class="hl-2">    ),</span><br/><span class="hl-2">  </span><span class="hl-6">price_open:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">().</span><span class="hl-1">describe</span><span class="hl-2">(</span><span class="hl-4">&quot;Entry price in USD&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">  </span><span class="hl-6">price_stop_loss:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">().</span><span class="hl-1">describe</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-6">str</span><span class="hl-2">.</span><span class="hl-1">newline</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;Stop-loss price in USD&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;For LONG: below price_open&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;For SHORT: above price_open&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;NEVER set SL without technical justification&quot;</span><br/><span class="hl-2">    )</span><br/><span class="hl-2">  ),</span><br/><span class="hl-2">  </span><span class="hl-6">price_take_profit:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">().</span><span class="hl-1">describe</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-6">str</span><span class="hl-2">.</span><span class="hl-1">newline</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;Take-profit price in USD&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;For LONG: above price_open&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;For SHORT: below price_open&quot;</span><br/><span class="hl-2">    )</span><br/><span class="hl-2">  ),</span><br/><span class="hl-2">  </span><span class="hl-6">minute_estimated_time:</span><span class="hl-2"> </span><span class="hl-6">z</span><span class="hl-2">.</span><span class="hl-1">number</span><span class="hl-2">().</span><span class="hl-1">describe</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-6">str</span><span class="hl-2">.</span><span class="hl-1">newline</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;Time to reach TP in minutes&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;Based on ATR, ADX, MACD, Momentum&quot;</span><br/><span class="hl-2">    )</span><br/><span class="hl-2">  ),</span><br/><span class="hl-2">  </span><span class="hl-6">risk_note:</span><span class="hl-2"> </span><span class="hl-6">z</span><br/><span class="hl-2">    .</span><span class="hl-1">string</span><span class="hl-2">()</span><br/><span class="hl-2">    .</span><span class="hl-1">describe</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-6">str</span><span class="hl-2">.</span><span class="hl-1">newline</span><span class="hl-2">(</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;Risk description (ALWAYS required):&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;1. Whale manipulation (fake breakouts, pin bars)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;2. Order book (walls, spoofing, imbalance)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;3. Time factors (session, liquidity)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;4. Technical risks (divergences, weak volume)&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">&quot;Provide SPECIFIC numbers and probabilities&quot;</span><br/><span class="hl-2">      )</span><br/><span class="hl-2">    ),</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<a id="signal-generation-prompt" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Generation Prompt<a href="#signal-generation-prompt" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">str</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;functools-kit&quot;</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">SIGNAL_PROMPT</span><span class="hl-2"> = </span><span class="hl-6">str</span><span class="hl-2">.</span><span class="hl-1">newline</span><span class="hl-2">(</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;Analyze the market using attached data.&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;Minimum profit percentage at TP: 1%&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;Risk Reward ratio: no higher than 1:2&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;Requirements:&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;- 1m timeframe, next three hours&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;- Recommendation for both uptrend AND downtrend&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;- Entry conditions as IF-THEN with price levels&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;- Entry/Stop/TP as numbers in USD&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;- Filters required&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;- Risk management at the end&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;- No data retelling&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;- Maximum compression&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;Format:&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;LONG conditions: [logic with Support/Resistance]&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;Entry: [USD], TP: [USD], SL: [USD]&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;SHORT conditions: [logic with Support/Resistance]&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;Entry: [USD], TP: [USD], SL: [USD]&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;Filters: [list]&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-4">&quot;Risk: [rules]&quot;</span><br/><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<a id="strategy" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Strategy<a href="#strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">json</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;agent-swarm-kit&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">addStrategy</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-1">addStrategy</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;llm-anti-bot&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">riskList:</span><span class="hl-2"> [</span><br/><span class="hl-2">    </span><span class="hl-4">&quot;TakeProfitDistanceRisk&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">&quot;RiskRewardRatioRisk&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-4">&quot;LanguageModelOpinionRisk&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  ],</span><br/><span class="hl-2">  </span><span class="hl-1">getSignal</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> { </span><span class="hl-8">data</span><span class="hl-2">, </span><span class="hl-8">resultId</span><span class="hl-2">, </span><span class="hl-8">error</span><span class="hl-2"> } = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">json</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;SignalOutline&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">symbol</span><br/><span class="hl-2">    );</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">error</span><span class="hl-2">) </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><span class="hl-6">error</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-4">&quot;wait&quot;</span><span class="hl-2">) </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-6">id:</span><span class="hl-2"> </span><span class="hl-6">resultId</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">minuteEstimatedTime:</span><span class="hl-2"> +</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">minute_estimated_time</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> +</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_stop_loss</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> +</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_take_profit</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceOpen:</span><span class="hl-2"> +</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_open</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">note:</span><span class="hl-2"> </span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">risk_note</span><span class="hl-2">,</span><br/><span class="hl-2">    };</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<a id="preparing-history-for-llm" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Preparing History for LLM<a href="#preparing-history-for-llm" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">Cache</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">str</span><span class="hl-2">, </span><span class="hl-6">trycatch</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;functools-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">fetchHourHistory</span><span class="hl-2"> = </span><span class="hl-6">Cache</span><span class="hl-2">.</span><span class="hl-1">fn</span><span class="hl-2">(</span><br/><span class="hl-2">  </span><span class="hl-6">lib</span><span class="hl-2">.</span><span class="hl-6">hourCandleHistoryService</span><span class="hl-2">.</span><span class="hl-6">getReport</span><span class="hl-2">,</span><br/><span class="hl-2">  { </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&quot;30m&quot;</span><span class="hl-2"> }</span><br/><span class="hl-2">);</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">fetchFifteenMinuteHistory</span><span class="hl-2"> = </span><span class="hl-6">Cache</span><span class="hl-2">.</span><span class="hl-1">fn</span><span class="hl-2">(</span><br/><span class="hl-2">  </span><span class="hl-6">lib</span><span class="hl-2">.</span><span class="hl-6">fifteenMinuteCandleHistoryService</span><span class="hl-2">.</span><span class="hl-6">getReport</span><span class="hl-2">,</span><br/><span class="hl-2">  { </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2"> }</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">commitHourHistory</span><span class="hl-2"> = </span><span class="hl-1">trycatch</span><span class="hl-2">(</span><br/><span class="hl-2">  </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-6">history</span><span class="hl-2">: </span><span class="hl-11">History</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">hourHistory</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">fetchHourHistory</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">history</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-6">str</span><span class="hl-2">.</span><span class="hl-1">newline</span><span class="hl-2">(</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;=== 1-HOUR CANDLES (last 6 candles) ===&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">hourHistory</span><br/><span class="hl-2">        ),</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;assistant&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">&quot;1-hour candles received.&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    );</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  { </span><span class="hl-1">fallback</span><span class="hl-6">:</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">Cache</span><span class="hl-2">.</span><span class="hl-1">clear</span><span class="hl-2">(</span><span class="hl-6">fetchHourHistory</span><span class="hl-2">) }</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">commitFifteenMinuteHistory</span><span class="hl-2"> = </span><span class="hl-1">trycatch</span><span class="hl-2">(</span><br/><span class="hl-2">  </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-6">history</span><span class="hl-2">: </span><span class="hl-11">History</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">data</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">fetchFifteenMinuteHistory</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">history</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;user&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-6">str</span><span class="hl-2">.</span><span class="hl-1">newline</span><span class="hl-2">(</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;=== 15-MINUTE CANDLES (last 8 candles) ===&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-4">&quot;&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-6">data</span><br/><span class="hl-2">        ),</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-6">role:</span><span class="hl-2"> </span><span class="hl-4">&quot;assistant&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-6">content:</span><span class="hl-2"> </span><span class="hl-4">&quot;15-minute candles received.&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    );</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  { </span><span class="hl-1">fallback</span><span class="hl-6">:</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">Cache</span><span class="hl-2">.</span><span class="hl-1">clear</span><span class="hl-2">(</span><span class="hl-6">fetchFifteenMinuteHistory</span><span class="hl-2">) }</span><br/><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<a id="indicator-calculation-service-excerpt" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Indicator Calculation Service (excerpt)<a href="#indicator-calculation-service-excerpt" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">FasterRSI</span><span class="hl-2"> </span><span class="hl-5">as</span><span class="hl-2"> </span><span class="hl-6">RSI</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">FasterMACD</span><span class="hl-2"> </span><span class="hl-5">as</span><span class="hl-2"> </span><span class="hl-6">MACD</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">FasterBollingerBands</span><span class="hl-2"> </span><span class="hl-5">as</span><span class="hl-2"> </span><span class="hl-6">BollingerBands</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">FasterATR</span><span class="hl-2"> </span><span class="hl-5">as</span><span class="hl-2"> </span><span class="hl-6">ATR</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">FasterADX</span><span class="hl-2"> </span><span class="hl-5">as</span><span class="hl-2"> </span><span class="hl-6">ADX</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-0">// ... other indicators</span><br/><span class="hl-2">} </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;trading-signals&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-1">generateAnalysis</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-6">candles</span><span class="hl-2">: </span><span class="hl-11">ICandleData</span><span class="hl-2">[]) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">rsi</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">RSI</span><span class="hl-2">(</span><span class="hl-7">14</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">macd</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">MACD</span><span class="hl-2">(</span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">EMA</span><span class="hl-2">(</span><span class="hl-7">12</span><span class="hl-2">), </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">EMA</span><span class="hl-2">(</span><span class="hl-7">26</span><span class="hl-2">), </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">EMA</span><span class="hl-2">(</span><span class="hl-7">9</span><span class="hl-2">));</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">bollinger</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">BollingerBands</span><span class="hl-2">(</span><span class="hl-7">20</span><span class="hl-2">, </span><span class="hl-7">2.0</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">atr14</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">ATR</span><span class="hl-2">(</span><span class="hl-7">14</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">adx</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">ADX</span><span class="hl-2">(</span><span class="hl-7">14</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-0">// ... initialize other indicators</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">results</span><span class="hl-2">: </span><span class="hl-11">ILongTermRow</span><span class="hl-2">[] = [];</span><br/><span class="hl-2">  </span><span class="hl-6">candles</span><span class="hl-2">.</span><span class="hl-1">forEach</span><span class="hl-2">((</span><span class="hl-6">candle</span><span class="hl-2">, </span><span class="hl-6">i</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> { </span><span class="hl-8">high</span><span class="hl-2">, </span><span class="hl-8">low</span><span class="hl-2">, </span><span class="hl-8">close</span><span class="hl-2"> } = </span><span class="hl-6">candle</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-0">// Update all indicators</span><br/><span class="hl-2">    </span><span class="hl-6">rsi</span><span class="hl-2">.</span><span class="hl-1">update</span><span class="hl-2">(</span><span class="hl-6">close</span><span class="hl-2">, </span><span class="hl-3">false</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">macd</span><span class="hl-2">.</span><span class="hl-1">update</span><span class="hl-2">(</span><span class="hl-6">close</span><span class="hl-2">, </span><span class="hl-3">false</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">bollinger</span><span class="hl-2">.</span><span class="hl-1">update</span><span class="hl-2">(</span><span class="hl-6">close</span><span class="hl-2">, </span><span class="hl-3">false</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">atr14</span><span class="hl-2">.</span><span class="hl-1">update</span><span class="hl-2">({ </span><span class="hl-6">high</span><span class="hl-2">, </span><span class="hl-6">low</span><span class="hl-2">, </span><span class="hl-6">close</span><span class="hl-2"> }, </span><span class="hl-3">false</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">adx</span><span class="hl-2">.</span><span class="hl-1">update</span><span class="hl-2">({ </span><span class="hl-6">high</span><span class="hl-2">, </span><span class="hl-6">low</span><span class="hl-2">, </span><span class="hl-6">close</span><span class="hl-2"> }, </span><span class="hl-3">false</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-0">// Skip until indicators are warmed up</span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">i</span><span class="hl-2"> &lt; </span><span class="hl-8">WARMUP_PERIOD</span><span class="hl-2">) </span><span class="hl-5">return</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-0">// Volume trend: compare SMA(6) of current and previous period</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">volumeTrend</span><span class="hl-2"> = </span><span class="hl-1">calculateVolumeTrend</span><span class="hl-2">(</span><span class="hl-6">volumes</span><span class="hl-2">, </span><span class="hl-6">i</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-0">// Support/Resistance: min/max over last N candles</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> { </span><span class="hl-8">support</span><span class="hl-2">, </span><span class="hl-8">resistance</span><span class="hl-2"> } = </span><span class="hl-1">calculatePivots</span><span class="hl-2">(</span><span class="hl-6">highs</span><span class="hl-2">, </span><span class="hl-6">lows</span><span class="hl-2">, </span><span class="hl-6">i</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-0">// Fibonacci: nearest level to current price</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">fibonacciNearest</span><span class="hl-2"> = </span><span class="hl-1">calculateFibonacciLevels</span><span class="hl-2">(</span><span class="hl-6">candles</span><span class="hl-2">, </span><span class="hl-6">i</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">results</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">symbol</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">rsi14:</span><span class="hl-2"> </span><span class="hl-6">rsi</span><span class="hl-2">.</span><span class="hl-1">getResult</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">macd12_26_9:</span><span class="hl-2"> </span><span class="hl-6">macd</span><span class="hl-2">.</span><span class="hl-1">getResult</span><span class="hl-2">()?.</span><span class="hl-6">macd</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">adx14:</span><span class="hl-2"> </span><span class="hl-6">adx</span><span class="hl-2">.</span><span class="hl-1">getResult</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">atr14:</span><span class="hl-2"> </span><span class="hl-6">atr14</span><span class="hl-2">.</span><span class="hl-1">getResult</span><span class="hl-2">(),</span><br/><span class="hl-2">      </span><span class="hl-6">support</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">resistance</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">fibonacciNearestLevel:</span><span class="hl-2"> </span><span class="hl-6">fibonacciNearest</span><span class="hl-2">.</span><span class="hl-6">level</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-0">// ... remaining fields</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">results</span><span class="hl-2">;</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="validations" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validations<a href="#validations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">addOutline</span><span class="hl-2">, </span><span class="hl-6">dumpOutlineResult</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;agent-swarm-kit&quot;</span><span class="hl-2">;</span><br/><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">zodResponseFormat</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;openai/helpers/zod&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-1">addOutline</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">outlineName:</span><span class="hl-2"> </span><span class="hl-4">&quot;SignalOutline&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">completion:</span><span class="hl-2"> </span><span class="hl-4">&quot;OllamaCompletion&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">format:</span><span class="hl-2"> </span><span class="hl-1">zodResponseFormat</span><span class="hl-2">(</span><span class="hl-6">SignalSchema</span><span class="hl-2">, </span><span class="hl-4">&quot;position_open_decision&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">  </span><span class="hl-1">getOutlineHistory</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> ({ </span><span class="hl-6">history</span><span class="hl-2">, </span><span class="hl-6">param</span><span class="hl-2">: </span><span class="hl-6">symbol</span><span class="hl-2"> }) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">commitHourHistory</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">history</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">commitFifteenMinuteHistory</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">history</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-0">// ... other timeframes</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-6">validations:</span><span class="hl-2"> [</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-1">validate</span><span class="hl-6">:</span><span class="hl-2"> ({ </span><span class="hl-6">data</span><span class="hl-2"> }) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-4">&quot;long&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">          </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_stop_loss</span><span class="hl-2"> &gt;= </span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_open</span><span class="hl-2">) {</span><br/><span class="hl-2">            </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><span class="hl-4">&quot;LONG: SL must be below entry&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">          }</span><br/><span class="hl-2">          </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_take_profit</span><span class="hl-2"> &lt;= </span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_open</span><span class="hl-2">) {</span><br/><span class="hl-2">            </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><span class="hl-4">&quot;LONG: TP must be above entry&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">          }</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-6">docDescription:</span><span class="hl-2"> </span><span class="hl-4">&quot;Validates price correctness for LONG&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-1">validate</span><span class="hl-6">:</span><span class="hl-2"> ({ </span><span class="hl-6">data</span><span class="hl-2"> }) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> === </span><span class="hl-4">&quot;short&quot;</span><span class="hl-2">) {</span><br/><span class="hl-2">          </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_stop_loss</span><span class="hl-2"> &lt;= </span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_open</span><span class="hl-2">) {</span><br/><span class="hl-2">            </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><span class="hl-4">&quot;SHORT: SL must be above entry&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">          }</span><br/><span class="hl-2">          </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_take_profit</span><span class="hl-2"> &gt;= </span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">price_open</span><span class="hl-2">) {</span><br/><span class="hl-2">            </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><span class="hl-4">&quot;SHORT: TP must be below entry&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">          }</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-6">docDescription:</span><span class="hl-2"> </span><span class="hl-4">&quot;Validates price correctness for SHORT&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-1">validate</span><span class="hl-6">:</span><span class="hl-2"> ({ </span><span class="hl-6">data</span><span class="hl-2"> }) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">position</span><span class="hl-2"> !== </span><span class="hl-4">&quot;wait&quot;</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">minute_estimated_time</span><span class="hl-2"> &gt; </span><span class="hl-7">360</span><span class="hl-2">) {</span><br/><span class="hl-2">          </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><span class="hl-4">&quot;Time to TP &gt; 6 hours. Use wait&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-6">docDescription:</span><span class="hl-2"> </span><span class="hl-4">&quot;Validates time realism&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  ],</span><br/><span class="hl-2">  </span><span class="hl-6">callbacks:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-1">onValidDocument</span><span class="hl-2">(</span><span class="hl-6">result</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">dumpOutlineResult</span><span class="hl-2">(</span><span class="hl-6">result</span><span class="hl-2">);</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<a id="why-llm-works-better" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Why LLM Works Better<a href="#why-llm-works-better" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>LLM doesn't jerk on every RSI &lt; 30. It sees context:</p>
<pre><code><span class="hl-8">RSI</span><span class="hl-2"> 1</span><span class="hl-10">m</span><span class="hl-2">: </span><span class="hl-7">28</span><span class="hl-2"> (</span><span class="hl-6">oversold</span><span class="hl-2">)</span><br/><span class="hl-8">RSI</span><span class="hl-2"> 1</span><span class="hl-10">h</span><span class="hl-2">: </span><span class="hl-7">55</span><span class="hl-2"> (</span><span class="hl-6">neutral</span><span class="hl-2">)</span><br/><span class="hl-10">Volume</span><span class="hl-2">: 0.3</span><span class="hl-6">x</span><span class="hl-2"> </span><span class="hl-1">average</span><span class="hl-2"> (</span><span class="hl-6">weak</span><span class="hl-2">)</span><br/><span class="hl-10">ADX</span><span class="hl-2">: </span><span class="hl-7">15</span><span class="hl-2"> (</span><span class="hl-6">no</span><span class="hl-2"> </span><span class="hl-6">trend</span><span class="hl-2">)</span>
</code><button>Copy</button></pre>

<p>A standard bot would see RSI &lt; 30 and buy. LLM understands it's a trap.</p>
<pre><code><span class="hl-8">LLM</span><span class="hl-2"> </span><span class="hl-10">output</span><span class="hl-2">: </span><span class="hl-4">&quot;WAIT - RSI oversold on 1m, but 1h neutral,</span><span class="hl-12"> </span><br/><span class="hl-6">volume</span><span class="hl-2"> </span><span class="hl-6">weak</span><span class="hl-2">. </span><span class="hl-6">These</span><span class="hl-2"> </span><span class="hl-6">are</span><span class="hl-2"> </span><span class="hl-6">bots</span><span class="hl-2"> </span><span class="hl-6">trying</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">buy</span><span class="hl-2">, </span><span class="hl-6">not</span><span class="hl-2"> </span><span class="hl-6">real</span><span class="hl-2"> </span><br/><span class="hl-6">capitulation</span><span class="hl-2">. </span><span class="hl-6">Wait</span><span class="hl-2"> </span><span class="hl-6">for</span><span class="hl-2"> </span><span class="hl-6">breakout</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-6">volume</span><span class="hl-2"> </span><span class="hl-6">or</span><span class="hl-2"> 1</span><span class="hl-6">h</span><span class="hl-2"> </span><span class="hl-6">correction</span><span class="hl-2">.</span><span class="hl-4">&quot;</span>
</code><button>Copy</button></pre>

<a id="conclusion" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Conclusion<a href="#conclusion" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Algo trading in crypto has become a game where thousands of copies of the same code trade against each other. Every bot pays fees, every bot loses on spread, the only beneficiary is the exchange.</p>
<p>If your strategy is RSI/MACD/BB from a tutorial, you're trading against 10,000 identical bots with the same code.</p>
<p>Edge exists, but it's elsewhere:</p>
<ul>
<li>In understanding bot crowd behavior</li>
<li>In using LLM for holistic analysis instead of dumb triggers</li>
<li>In validating signals before execution</li>
<li>Or in exiting this game entirely</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#ðŸ¤–-second-order-chaos-how-algo-trading-bots-play-against-themselves-at-a-loss"><span>ðŸ¤– <wbr/>Second-<wbr/>Order <wbr/>Chaos: <wbr/>How <wbr/>Algo <wbr/>Trading <wbr/>Bots <wbr/>Play <wbr/>Against <wbr/>Themselves at a <wbr/>Loss</span></a><ul><li><a href="#first-order-vs-second-order-chaos"><span>First-<wbr/>Order vs <wbr/>Second-<wbr/>Order <wbr/>Chaos</span></a></li><li><a href="#one-algorithm-against-itself"><span>One <wbr/>Algorithm <wbr/>Against <wbr/>Itself</span></a></li><li><a href="#why-this-happens"><span>Why <wbr/>This <wbr/>Happens</span></a></li><li><a href="#the-math-of-self-conflict"><span>The <wbr/>Math of <wbr/>Self-<wbr/>Conflict</span></a></li><li><a href="#but-my-bot-uses-different-indicators"><span>But <wbr/>My <wbr/>Bot <wbr/>Uses <wbr/>Different <wbr/>Indicators!</span></a></li><li><a href="#predictable-stop-losses"><span>Predictable <wbr/>Stop-<wbr/>Losses</span></a></li><li><a href="#self-reinforcing-feedback-loop"><span>Self-<wbr/>Reinforcing <wbr/>Feedback <wbr/>Loop</span></a></li><li><a href="#what-to-do-llm-instead-of-indicators"><span>What <wbr/>To <wbr/>Do: LLM <wbr/>Instead of <wbr/>Indicators</span></a></li><li><a href="#signal-schema"><span>Signal <wbr/>Schema</span></a></li><li><a href="#signal-generation-prompt"><span>Signal <wbr/>Generation <wbr/>Prompt</span></a></li><li><a href="#strategy"><span>Strategy</span></a></li><li><a href="#preparing-history-for-llm"><span>Preparing <wbr/>History for LLM</span></a></li><li><a href="#indicator-calculation-service-excerpt"><span>Indicator <wbr/>Calculation <wbr/>Service (excerpt)</span></a></li><li><a href="#validations"><span>Validations</span></a></li><li><a href="#why-llm-works-better"><span>Why LLM <wbr/>Works <wbr/>Better</span></a></li><li><a href="#conclusion"><span>Conclusion</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
