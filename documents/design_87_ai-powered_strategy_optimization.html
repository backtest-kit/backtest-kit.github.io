<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/87_ai-powered_strategy_optimization | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_87_ai-powered_strategy_optimization.html">design/87_ai-powered_strategy_optimization</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="ai-powered-strategy-optimization" class="tsd-anchor"></a><h1 class="tsd-anchor-link">AI-Powered Strategy Optimization<a href="#ai-powered-strategy-optimization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This document describes the AI-powered strategy optimization system that uses Large Language Models (LLMs) to automatically generate and evaluate trading strategies based on historical market data. For detailed information about the template system, see <a href="design_88_optimizer_architecture.html">Optimizer Architecture</a>. For data collection specifics, see <a href="design_89_data_collection_pipeline.html">Data Collection Pipeline</a>. For LLM integration details, see <a href="design_90_llm_integration.html">LLM Integration</a>.</p>
<p>The optimization system enables:</p>
<ul>
<li>Automated strategy generation from historical data analysis</li>
<li>Multi-timeframe market data processing (1h, 30m, 15m, 1m)</li>
<li>LLM-driven trading logic synthesis using Ollama API</li>
<li>Executable code generation with backtest validation</li>
<li>Walker-based performance comparison of generated strategies</li>
</ul>
<hr>
<a id="system-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">System Architecture<a href="#system-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The optimizer system consists of four primary components that orchestrate data collection, LLM conversation building, code generation, and file export.</p>
<p><img src="../media/87_AI-Powered_Strategy_Optimization_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="core-components-and-data-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Components and Data Flow<a href="#core-components-and-data-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The optimizer follows a three-phase pipeline: data collection, LLM interaction, and code assembly.</p>
<p><img src="../media/87_AI-Powered_Strategy_Optimization_1.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="ioptimizerschema-configuration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">IOptimizerSchema Configuration<a href="#ioptimizerschema-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>IOptimizerSchema</code> interface defines the complete configuration for an optimizer instance. Registration uses the <code>addOptimizer()</code> function.</p>
<a id="schema-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schema Structure<a href="#schema-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>optimizerName</code></td>
<td><code>OptimizerName</code></td>
<td>Yes</td>
<td>Unique identifier for registry lookup</td>
</tr>
<tr>
<td><code>rangeTrain</code></td>
<td><code>IOptimizerRange[]</code></td>
<td>Yes</td>
<td>Training date ranges for strategy generation</td>
</tr>
<tr>
<td><code>rangeTest</code></td>
<td><code>IOptimizerRange</code></td>
<td>Yes</td>
<td>Testing date range for Walker validation</td>
</tr>
<tr>
<td><code>source</code></td>
<td><code>Source[]</code></td>
<td>Yes</td>
<td>Data sources (functions or config objects)</td>
</tr>
<tr>
<td><code>getPrompt</code></td>
<td><code>Function</code></td>
<td>Yes</td>
<td>LLM prompt generator from message history</td>
</tr>
<tr>
<td><code>template</code></td>
<td><code>Partial&lt;IOptimizerTemplate&gt;</code></td>
<td>No</td>
<td>Custom template method overrides</td>
</tr>
<tr>
<td><code>callbacks</code></td>
<td><code>Partial&lt;IOptimizerCallbacks&gt;</code></td>
<td>No</td>
<td>Lifecycle event handlers</td>
</tr>
</tbody>
</table>
<a id="source-configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Source Configuration<a href="#source-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Sources can be defined as either simple fetch functions or full configuration objects:</p>
<pre><code class="typescript"><span class="hl-5">// Simple function source</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-0">simpleSource</span><span class="hl-1">: </span><span class="hl-10">IOptimizerSourceFn</span><span class="hl-1"> = </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Return IOptimizerData[] with unique id field</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">fetchedData</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">// Full configuration source</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">configSource</span><span class="hl-1">: </span><span class="hl-10">IOptimizerSource</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;long-term-range&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">fetch</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Return paginated data</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">fetchedData</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">user</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Custom user message formatter</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">formattedPrompt</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">assistant</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Custom assistant response</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">acknowledgment</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="data-collection-and-pagination" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Data Collection and Pagination<a href="#data-collection-and-pagination" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>ClientOptimizer</code> collects data from all sources across all training ranges, building a conversation history for the LLM.</p>
<p><img src="../media/87_AI-Powered_Strategy_Optimization_2.svg" alt="Mermaid Diagram"></p>
<a id="pagination-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pagination Implementation<a href="#pagination-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>RESOLVE_PAGINATION_FN</code> uses <code>functools-kit</code> utilities to handle automatic pagination with deduplication:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-0">RESOLVE_PAGINATION_FN</span><span class="hl-1"> = </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">fetch</span><span class="hl-1">, </span><span class="hl-4">filterData</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">iterator</span><span class="hl-1"> = </span><span class="hl-0">iterateDocuments</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">limit:</span><span class="hl-1"> </span><span class="hl-7">ITERATION_LIMIT</span><span class="hl-1">,  </span><span class="hl-5">// 25 rows per request</span><br/><span class="hl-1">    </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">createRequest</span><span class="hl-1">({ </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-4">filterData</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-4">filterData</span><span class="hl-1">.</span><span class="hl-4">startDate</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-4">filterData</span><span class="hl-1">.</span><span class="hl-4">endDate</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">limit</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">offset</span><span class="hl-1">,</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">distinct</span><span class="hl-1"> = </span><span class="hl-0">distinctDocuments</span><span class="hl-1">(</span><span class="hl-4">iterator</span><span class="hl-1">, (</span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">resolveDocuments</span><span class="hl-1">(</span><span class="hl-4">distinct</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="template-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Template System<a href="#template-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>OptimizerTemplateService</code> provides 11 default template methods for code generation. Each method can be overridden in the optimizer schema configuration.</p>
<a id="template-method-reference" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Template Method Reference<a href="#template-method-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Method</th>
<th>Returns</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getTopBanner(symbol)</code></td>
<td>Shebang + imports</td>
<td>Package imports and constants</td>
</tr>
<tr>
<td><code>getJsonDumpTemplate(symbol)</code></td>
<td><code>dumpJson()</code> function</td>
<td>Debug output to <code>./dump/strategy/</code></td>
</tr>
<tr>
<td><code>getTextTemplate(symbol)</code></td>
<td><code>text()</code> function</td>
<td>LLM text generation with Ollama</td>
</tr>
<tr>
<td><code>getJsonTemplate(symbol)</code></td>
<td><code>json()</code> function</td>
<td>Structured signal output with schema</td>
</tr>
<tr>
<td><code>getExchangeTemplate(symbol, exchangeName)</code></td>
<td><code>addExchange()</code> call</td>
<td>CCXT Binance integration</td>
</tr>
<tr>
<td><code>getFrameTemplate(symbol, frameName, interval, startDate, endDate)</code></td>
<td><code>addFrame()</code> call</td>
<td>Timeframe configuration</td>
</tr>
<tr>
<td><code>getStrategyTemplate(strategyName, interval, prompt)</code></td>
<td><code>addStrategy()</code> call</td>
<td>Strategy with multi-timeframe LLM</td>
</tr>
<tr>
<td><code>getWalkerTemplate(walkerName, exchangeName, frameName, strategies)</code></td>
<td><code>addWalker()</code> call</td>
<td>Strategy comparison setup</td>
</tr>
<tr>
<td><code>getLauncherTemplate(symbol, walkerName)</code></td>
<td><code>Walker.background()</code> + listeners</td>
<td>Execution and event handling</td>
</tr>
</tbody>
</table>
<a id="code-assembly-order" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Code Assembly Order<a href="#code-assembly-order" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>GET_STRATEGY_CODE_FN</code> assembles code sections in this order:</p>
<ol>
<li>Top banner with imports (<code>getTopBanner</code>)</li>
<li>JSON dump helper (<code>getJsonDumpTemplate</code>)</li>
<li>LLM helpers (<code>getTextTemplate</code>, <code>getJsonTemplate</code>)</li>
<li>Exchange configuration (<code>getExchangeTemplate</code>)</li>
<li>Training frames (one <code>getFrameTemplate</code> per <code>rangeTrain</code>)</li>
<li>Test frame (one <code>getFrameTemplate</code> for <code>rangeTest</code>)</li>
<li>Strategies (one <code>getStrategyTemplate</code> per generated strategy)</li>
<li>Walker configuration (<code>getWalkerTemplate</code>)</li>
<li>Launcher code (<code>getLauncherTemplate</code>)</li>
</ol>
<hr>
<a id="llm-integration-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">LLM Integration Architecture<a href="#llm-integration-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The generated code integrates Ollama for runtime strategy generation with two helper functions: <code>text()</code> for analysis and <code>json()</code> for structured signals.</p>
<p><img src="../media/87_AI-Powered_Strategy_Optimization_3.svg" alt="Mermaid Diagram"></p>
<a id="json-schema-configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">JSON Schema Configuration<a href="#json-schema-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>getJsonTemplate()</code> method generates a <code>json()</code> function with strict type enforcement:</p>
<pre><code class="typescript"><span class="hl-12">format</span><span class="hl-1">: {</span><br/><span class="hl-1">  </span><span class="hl-12">type</span><span class="hl-1">: </span><span class="hl-2">&quot;object&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-12">properties</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-12">position</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-12">type</span><span class="hl-1">: </span><span class="hl-2">&quot;string&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-12">enum</span><span class="hl-1">: [</span><span class="hl-2">&quot;wait&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;short&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">      </span><span class="hl-12">description</span><span class="hl-1">: </span><span class="hl-2">&quot;Trade decision&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-12">note</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-12">type</span><span class="hl-1">: </span><span class="hl-2">&quot;string&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-12">description</span><span class="hl-1">: </span><span class="hl-2">&quot;Professional trading recommendation&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-12">priceOpen</span><span class="hl-1">: { </span><span class="hl-12">type</span><span class="hl-1">: </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">, </span><span class="hl-12">description</span><span class="hl-1">: </span><span class="hl-2">&quot;Entry price&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-12">priceTakeProfit</span><span class="hl-1">: { </span><span class="hl-12">type</span><span class="hl-1">: </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">, </span><span class="hl-12">description</span><span class="hl-1">: </span><span class="hl-2">&quot;Take profit target&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-12">priceStopLoss</span><span class="hl-1">: { </span><span class="hl-12">type</span><span class="hl-1">: </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">, </span><span class="hl-12">description</span><span class="hl-1">: </span><span class="hl-2">&quot;Stop loss exit&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-12">minuteEstimatedTime</span><span class="hl-1">: { </span><span class="hl-12">type</span><span class="hl-1">: </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">, </span><span class="hl-12">description</span><span class="hl-1">: </span><span class="hl-2">&quot;Expected time to TP&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-12">required</span><span class="hl-1">: [</span><span class="hl-2">&quot;position&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;note&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;priceOpen&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;priceTakeProfit&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;priceStopLoss&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;minuteEstimatedTime&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="usage-example" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage Example<a href="#usage-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Complete example demonstrating optimizer configuration with CCXT Dumper integration:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addOptimizer</span><span class="hl-1">, </span><span class="hl-4">Optimizer</span><span class="hl-1">, </span><span class="hl-4">listenOptimizerProgress</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Ollama</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;ollama&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addOptimizer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;btc-optimizer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Training ranges (multiple periods for strategy generation)</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTrain:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Bull market period&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2025-11-24T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2025-11-24T23:59:59Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Consolidation period&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2025-11-25T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2025-11-25T23:59:59Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Test range (held out for Walker validation)</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTest:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Validation period&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2025-12-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2025-12-01T23:59:59Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Data sources with pagination support</span><br/><span class="hl-1">  </span><span class="hl-4">source:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;long-term-range&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">fetch</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">url</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">URL</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">process</span><span class="hl-9">.</span><span class="hl-4">env</span><span class="hl-9">.</span><span class="hl-7">CCXT_DUMPER_URL</span><span class="hl-6">}</span><span class="hl-2">/view/long-term-range`</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;symbol&quot;</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;startDate&quot;</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">());</span><br/><span class="hl-1">        </span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;endDate&quot;</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">());</span><br/><span class="hl-1">        </span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;limit&quot;</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1"> || </span><span class="hl-8">1000</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;offset&quot;</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> || </span><span class="hl-8">0</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-7">data</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchApi</span><span class="hl-1">(</span><span class="hl-4">url</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">rows</span><span class="hl-1">; </span><span class="hl-5">// Must have unique &#39;id&#39; field</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">user</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`# 1-Hour Analysis for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-11">\n\n</span><span class="hl-6">${</span><span class="hl-0">arrayToMarkdownTable</span><span class="hl-9">(</span><span class="hl-4">data</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">assistant</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;Historical 1h data acknowledged&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;short-term-range&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">fetch</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">// Fetch 15m candles with technical indicators</span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">url</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">URL</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">process</span><span class="hl-9">.</span><span class="hl-4">env</span><span class="hl-9">.</span><span class="hl-7">CCXT_DUMPER_URL</span><span class="hl-6">}</span><span class="hl-2">/view/short-term-range`</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;symbol&quot;</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;startDate&quot;</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">());</span><br/><span class="hl-1">        </span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;endDate&quot;</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">());</span><br/><span class="hl-1">        </span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;limit&quot;</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1"> || </span><span class="hl-8">1000</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;offset&quot;</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> || </span><span class="hl-8">0</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-7">data</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchApi</span><span class="hl-1">(</span><span class="hl-4">url</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">rows</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">user</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`# 15-Minute Analysis for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-11">\n\n</span><span class="hl-6">${</span><span class="hl-0">arrayToMarkdownTable</span><span class="hl-9">(</span><span class="hl-4">data</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">assistant</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;Historical 15m data acknowledged&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// LLM prompt generation from conversation history</span><br/><span class="hl-1">  </span><span class="hl-0">getPrompt</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">messages</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">ollama</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Ollama</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">host:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://ollama.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">headers:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">Authorization:</span><span class="hl-1"> </span><span class="hl-2">`Bearer </span><span class="hl-6">${</span><span class="hl-4">process</span><span class="hl-9">.</span><span class="hl-4">env</span><span class="hl-9">.</span><span class="hl-7">OLLAMA_API_KEY</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">response</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">ollama</span><span class="hl-1">.</span><span class="hl-0">chat</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">model:</span><span class="hl-1"> </span><span class="hl-2">&quot;deepseek-v3.1:671b&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">messages:</span><span class="hl-1"> [</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;system&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">&quot;Generate a trading strategy based on the provided data analysis.&quot;</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        ...</span><span class="hl-4">messages</span><span class="hl-1">,</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">`What conditions should trigger </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2"> trades? Provide clear entry rules.`</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      ]</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">.</span><span class="hl-4">content</span><span class="hl-1">.</span><span class="hl-0">trim</span><span class="hl-1">();</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Optional: Custom template overrides</span><br/><span class="hl-1">  </span><span class="hl-4">template:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">getStrategyTemplate</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">prompt</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Custom strategy code generation</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`addStrategy({</span><br/><span class="hl-2">        strategyName: &quot;</span><span class="hl-6">${</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">&quot;,</span><br/><span class="hl-2">        interval: &quot;</span><span class="hl-6">${</span><span class="hl-4">interval</span><span class="hl-6">}</span><span class="hl-2">&quot;,</span><br/><span class="hl-2">        getSignal: async (symbol) =&gt; {</span><br/><span class="hl-2">          // Custom implementation using prompt</span><br/><span class="hl-2">          const signal = await analyzeWithCustomLogic(symbol, </span><span class="hl-6">${</span><span class="hl-7">JSON</span><span class="hl-9">.</span><span class="hl-0">stringify</span><span class="hl-9">(</span><span class="hl-4">prompt</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">);</span><br/><span class="hl-2">          return signal;</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">      });`</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Optional: Lifecycle callbacks</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onSourceData</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">sourceName</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Fetched </span><span class="hl-6">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> rows from </span><span class="hl-6">${</span><span class="hl-4">sourceName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onData</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyData</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-6">${</span><span class="hl-4">strategyData</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> strategies for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onCode</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">code</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-6">${</span><span class="hl-4">code</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> chars of code for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onDump</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">filepath</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Saved strategy to </span><span class="hl-6">${</span><span class="hl-4">filepath</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Listen to progress events</span><br/><span class="hl-0">listenOptimizerProgress</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Progress: </span><span class="hl-6">${</span><span class="hl-9">(</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">progress</span><span class="hl-9"> </span><span class="hl-1">*</span><span class="hl-9"> </span><span class="hl-8">100</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Processed: </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">processedSources</span><span class="hl-6">}</span><span class="hl-2"> / </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">totalSources</span><span class="hl-6">}</span><span class="hl-2"> sources`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Generate and save strategy code</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Optimizer</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTC/USDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;btc-optimizer&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;./generated&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="generated-file-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Generated File Structure<a href="#generated-file-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The generated <code>.mjs</code> file contains:</p>
<ol>
<li>Imports (<code>ollama</code>, <code>ccxt</code>, <code>backtest-kit</code>, <code>fs</code>, <code>uuid</code>)</li>
<li>Helper functions (<code>dumpJson</code>, <code>text</code>, <code>json</code>)</li>
<li>Exchange configuration (CCXT Binance)</li>
<li>Frame configurations (train + test)</li>
<li>Strategy configurations with LLM integration</li>
<li>Walker configuration for comparison</li>
<li>Launcher code with event listeners</li>
</ol>
<hr>
<a id="optimizer-lifecycle-callbacks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Optimizer Lifecycle Callbacks<a href="#optimizer-lifecycle-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>IOptimizerCallbacks</code> interface provides hooks for monitoring optimizer execution:</p>
<table>
<thead>
<tr>
<th>Callback</th>
<th>Invoked When</th>
<th>Parameters</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>onSourceData</code></td>
<td>Data fetched from source</td>
<td><code>symbol, sourceName, data, startDate, endDate</code></td>
<td>Log data volume, validate rows</td>
</tr>
<tr>
<td><code>onData</code></td>
<td>All strategies generated</td>
<td><code>symbol, strategyData</code></td>
<td>Inspect message history, validate prompts</td>
</tr>
<tr>
<td><code>onCode</code></td>
<td>Code assembly complete</td>
<td><code>symbol, code</code></td>
<td>Log code size, syntax validation</td>
</tr>
<tr>
<td><code>onDump</code></td>
<td>File written to disk</td>
<td><code>symbol, filepath</code></td>
<td>Trigger CI/CD, run generated script</td>
</tr>
</tbody>
</table>
<a id="progress-tracking" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Progress Tracking<a href="#progress-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>progressOptimizerEmitter</code> emits <code>ProgressOptimizerContract</code> events during data collection:</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ProgressOptimizerContract</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;       </span><span class="hl-5">// &quot;btc-optimizer&quot;</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;               </span><span class="hl-5">// &quot;BTC/USDT&quot;</span><br/><span class="hl-1">  </span><span class="hl-4">totalSources</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;         </span><span class="hl-5">// rangeTrain.length * source.length</span><br/><span class="hl-1">  </span><span class="hl-4">processedSources</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;     </span><span class="hl-5">// Increments after each source fetch</span><br/><span class="hl-1">  </span><span class="hl-4">progress</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;             </span><span class="hl-5">// 0.0 to 1.0</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Events are emitted:</p>
<ul>
<li>Before processing each source (shows current progress)</li>
<li>After all sources complete (progress = 1.0)</li>
</ul>
<hr>
<a id="optimizerconnectionservice" class="tsd-anchor"></a><h2 class="tsd-anchor-link">OptimizerConnectionService<a href="#optimizerconnectionservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>OptimizerConnectionService</code> manages optimizer instances with memoization and template merging.</p>
<p><img src="../media/87_AI-Powered_Strategy_Optimization_4.svg" alt="Mermaid Diagram"></p>
<a id="template-merging-logic" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Template Merging Logic<a href="#template-merging-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>getOptimizer()</code> method merges custom templates with defaults:</p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">getOptimizer</span><span class="hl-1"> = </span><span class="hl-0">memoize</span><span class="hl-1">(</span><br/><span class="hl-1">  ([</span><span class="hl-4">optimizerName</span><span class="hl-1">]) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">optimizerName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">  (</span><span class="hl-4">optimizerName</span><span class="hl-1">: </span><span class="hl-10">OptimizerName</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-4">template</span><span class="hl-1">: </span><span class="hl-7">rawTemplate</span><span class="hl-1"> = {}, ...</span><span class="hl-7">schemaRest</span><span class="hl-1"> } = </span><br/><span class="hl-1">      </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">optimizerSchemaService</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-4">optimizerName</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Merge custom templates with defaults</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">template</span><span class="hl-1">: </span><span class="hl-10">IOptimizerTemplate</span><span class="hl-1"> = {</span><br/><span class="hl-1">      </span><span class="hl-4">getAssistantMessage:</span><span class="hl-1"> </span><span class="hl-4">rawTemplate</span><span class="hl-1">.</span><span class="hl-4">getAssistantMessage</span><span class="hl-1"> || </span><br/><span class="hl-1">        </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">optimizerTemplateService</span><span class="hl-1">.</span><span class="hl-4">getAssistantMessage</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">getExchangeTemplate:</span><span class="hl-1"> </span><span class="hl-4">rawTemplate</span><span class="hl-1">.</span><span class="hl-4">getExchangeTemplate</span><span class="hl-1"> || </span><br/><span class="hl-1">        </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">optimizerTemplateService</span><span class="hl-1">.</span><span class="hl-4">getExchangeTemplate</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">// ... repeat for all 11 methods</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">ClientOptimizer</span><span class="hl-1">(</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-4">optimizerName</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">logger:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">template</span><span class="hl-1">,</span><br/><span class="hl-1">        ...</span><span class="hl-4">schemaRest</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-7">COMMIT_PROGRESS_FN</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Memoization ensures only one <code>ClientOptimizer</code> instance exists per <code>optimizerName</code>, reducing memory overhead and maintaining consistent state.</p>
<hr>
<a id="advanced-customization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Advanced Customization<a href="#advanced-customization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="custom-message-formatters" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom Message Formatters<a href="#custom-message-formatters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Override <code>user</code> and <code>assistant</code> formatters in source configuration to control LLM conversation:</p>
<pre><code class="typescript"><span class="hl-12">source</span><span class="hl-1">: [</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;custom-indicators&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">fetch</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">args</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-0">fetchIndicatorData</span><span class="hl-1">(</span><span class="hl-4">args</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Custom user message with markdown table</span><br/><span class="hl-1">    </span><span class="hl-0">user</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">table</span><span class="hl-1"> = </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">row</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><br/><span class="hl-1">        </span><span class="hl-2">`| </span><span class="hl-6">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">timestamp</span><span class="hl-6">}</span><span class="hl-2"> | </span><span class="hl-6">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">rsi</span><span class="hl-6">}</span><span class="hl-2"> | </span><span class="hl-6">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">macd</span><span class="hl-6">}</span><span class="hl-2"> | </span><span class="hl-6">${</span><span class="hl-4">row</span><span class="hl-9">.</span><span class="hl-4">signal</span><span class="hl-6">}</span><span class="hl-2"> |`</span><br/><span class="hl-1">      ).</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&#39;</span><span class="hl-11">\n</span><span class="hl-2">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`# Technical Indicators for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-11">\n\n</span><span class="hl-6">${</span><span class="hl-4">table</span><span class="hl-6">}</span><span class="hl-11">\n\n</span><span class="hl-2">Analyze these indicators.`</span><span class="hl-1">;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Custom assistant acknowledgment</span><br/><span class="hl-1">    </span><span class="hl-0">assistant</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`Analyzed </span><span class="hl-6">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> indicator rows for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">]</span>
</code><button type="button">Copy</button></pre>

<a id="custom-template-methods" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom Template Methods<a href="#custom-template-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Override any of the 11 template methods for complete control over generated code:</p>
<pre><code class="typescript"><span class="hl-12">template</span><span class="hl-1">: {</span><br/><span class="hl-1">  </span><span class="hl-5">// Custom strategy generation with different LLM model</span><br/><span class="hl-1">  </span><span class="hl-12">getStrategyTemplate</span><span class="hl-1">: </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">prompt</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`</span><br/><span class="hl-2">addStrategy({</span><br/><span class="hl-2">  strategyName: &quot;</span><span class="hl-6">${</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">&quot;,</span><br/><span class="hl-2">  interval: &quot;</span><span class="hl-6">${</span><span class="hl-4">interval</span><span class="hl-6">}</span><span class="hl-2">&quot;,</span><br/><span class="hl-2">  getSignal: async (symbol) =&gt; {</span><br/><span class="hl-2">    // Use GPT-4 instead of deepseek</span><br/><span class="hl-2">    const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });</span><br/><span class="hl-2">    const response = await openai.chat.completions.create({</span><br/><span class="hl-2">      model: &quot;gpt-4&quot;,</span><br/><span class="hl-2">      messages: [</span><br/><span class="hl-2">        { role: &quot;system&quot;, content: &quot;</span><span class="hl-6">${</span><span class="hl-4">prompt</span><span class="hl-6">}</span><span class="hl-2">&quot; },</span><br/><span class="hl-2">        { role: &quot;user&quot;, content: &quot;Generate signal for &quot; + symbol }</span><br/><span class="hl-2">      ]</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">    return JSON.parse(response.choices[0].message.content);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});`</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Custom Walker with different metric</span><br/><span class="hl-1">  </span><span class="hl-12">getWalkerTemplate</span><span class="hl-1">: </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">walkerName</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-4">frameName</span><span class="hl-1">, </span><span class="hl-4">strategies</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`</span><br/><span class="hl-2">addWalker({</span><br/><span class="hl-2">  walkerName: &quot;</span><span class="hl-6">${</span><span class="hl-4">walkerName</span><span class="hl-6">}</span><span class="hl-2">&quot;,</span><br/><span class="hl-2">  exchangeName: &quot;</span><span class="hl-6">${</span><span class="hl-4">exchangeName</span><span class="hl-6">}</span><span class="hl-2">&quot;,</span><br/><span class="hl-2">  frameName: &quot;</span><span class="hl-6">${</span><span class="hl-4">frameName</span><span class="hl-6">}</span><span class="hl-2">&quot;,</span><br/><span class="hl-2">  strategies: [</span><span class="hl-6">${</span><span class="hl-4">strategies</span><span class="hl-9">.</span><span class="hl-0">map</span><span class="hl-9">(</span><span class="hl-4">s</span><span class="hl-9"> </span><span class="hl-6">=&gt;</span><span class="hl-9"> </span><span class="hl-2">`&quot;</span><span class="hl-6">${</span><span class="hl-4">s</span><span class="hl-6">}</span><span class="hl-2">&quot;`</span><span class="hl-9">).</span><span class="hl-0">join</span><span class="hl-9">(</span><span class="hl-2">&quot;, &quot;</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">],</span><br/><span class="hl-2">  metric: &quot;winRate&quot;  // Use win rate instead of sharpeRatio</span><br/><span class="hl-2">});`</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="custom-data-sources" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom Data Sources<a href="#custom-data-sources" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Implement custom pagination logic and data transformation:</p>
<pre><code class="typescript"><span class="hl-12">source</span><span class="hl-1">: [</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;database-source&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">fetch</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Connect to custom database</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">db</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">connectToDatabase</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">rows</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">(</span><span class="hl-2">`</span><br/><span class="hl-2">        SELECT </span><br/><span class="hl-2">          id,</span><br/><span class="hl-2">          timestamp,</span><br/><span class="hl-2">          close_price as close,</span><br/><span class="hl-2">          rsi_14 as rsi,</span><br/><span class="hl-2">          macd,</span><br/><span class="hl-2">          signal</span><br/><span class="hl-2">        FROM technical_data</span><br/><span class="hl-2">        WHERE symbol = $1 </span><br/><span class="hl-2">          AND timestamp BETWEEN $2 AND $3</span><br/><span class="hl-2">        ORDER BY timestamp</span><br/><span class="hl-2">        LIMIT $4 OFFSET $5</span><br/><span class="hl-2">      `</span><span class="hl-1">, [</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1">]);</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-5">// Transform to IOptimizerData format</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">rows</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">row</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">        </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">row</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">row</span><span class="hl-1">.</span><span class="hl-4">timestamp</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">close:</span><span class="hl-1"> </span><span class="hl-0">parseFloat</span><span class="hl-1">(</span><span class="hl-4">row</span><span class="hl-1">.</span><span class="hl-4">close</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-4">rsi:</span><span class="hl-1"> </span><span class="hl-0">parseFloat</span><span class="hl-1">(</span><span class="hl-4">row</span><span class="hl-1">.</span><span class="hl-4">rsi</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-4">macd:</span><span class="hl-1"> </span><span class="hl-0">parseFloat</span><span class="hl-1">(</span><span class="hl-4">row</span><span class="hl-1">.</span><span class="hl-4">macd</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-4">signal:</span><span class="hl-1"> </span><span class="hl-0">parseFloat</span><span class="hl-1">(</span><span class="hl-4">row</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">)</span><br/><span class="hl-1">      }));</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">user</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`Database indicators for </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">: </span><span class="hl-6">${</span><span class="hl-7">JSON</span><span class="hl-9">.</span><span class="hl-0">stringify</span><span class="hl-9">(</span><span class="hl-4">data</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">assistant</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;Database data processed&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">]</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#ai-powered-strategy-optimization"><span>AI-<wbr/>Powered <wbr/>Strategy <wbr/>Optimization</span></a><ul><li><a href="#system-architecture"><span>System <wbr/>Architecture</span></a></li><li><a href="#core-components-and-data-flow"><span>Core <wbr/>Components and <wbr/>Data <wbr/>Flow</span></a></li><li><a href="#ioptimizerschema-configuration"><span>IOptimizer<wbr/>Schema <wbr/>Configuration</span></a></li><li><ul><li><a href="#schema-structure"><span>Schema <wbr/>Structure</span></a></li><li><a href="#source-configuration"><span>Source <wbr/>Configuration</span></a></li></ul></li><li><a href="#data-collection-and-pagination"><span>Data <wbr/>Collection and <wbr/>Pagination</span></a></li><li><ul><li><a href="#pagination-implementation"><span>Pagination <wbr/>Implementation</span></a></li></ul></li><li><a href="#template-system"><span>Template <wbr/>System</span></a></li><li><ul><li><a href="#template-method-reference"><span>Template <wbr/>Method <wbr/>Reference</span></a></li><li><a href="#code-assembly-order"><span>Code <wbr/>Assembly <wbr/>Order</span></a></li></ul></li><li><a href="#llm-integration-architecture"><span>LLM <wbr/>Integration <wbr/>Architecture</span></a></li><li><ul><li><a href="#json-schema-configuration"><span>JSON <wbr/>Schema <wbr/>Configuration</span></a></li></ul></li><li><a href="#usage-example"><span>Usage <wbr/>Example</span></a></li><li><ul><li><a href="#generated-file-structure"><span>Generated <wbr/>File <wbr/>Structure</span></a></li></ul></li><li><a href="#optimizer-lifecycle-callbacks"><span>Optimizer <wbr/>Lifecycle <wbr/>Callbacks</span></a></li><li><ul><li><a href="#progress-tracking"><span>Progress <wbr/>Tracking</span></a></li></ul></li><li><a href="#optimizerconnectionservice"><span>Optimizer<wbr/>Connection<wbr/>Service</span></a></li><li><ul><li><a href="#template-merging-logic"><span>Template <wbr/>Merging <wbr/>Logic</span></a></li></ul></li><li><a href="#advanced-customization"><span>Advanced <wbr/>Customization</span></a></li><li><ul><li><a href="#custom-message-formatters"><span>Custom <wbr/>Message <wbr/>Formatters</span></a></li><li><a href="#custom-template-methods"><span>Custom <wbr/>Template <wbr/>Methods</span></a></li><li><a href="#custom-data-sources"><span>Custom <wbr/>Data <wbr/>Sources</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
