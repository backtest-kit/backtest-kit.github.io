<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/79_validation_parameters | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_79_validation_parameters.html">design/79_validation_parameters</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="validation-parameters" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Validation Parameters<a href="#validation-parameters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This document describes the global validation parameters that control financial safety constraints in signal generation. These parameters enforce minimum take profit distances, maximum stop loss distances, and signal lifetime limits to protect capital from unprofitable trades, catastrophic losses, and strategy deadlock.</p>
<p>For information about other configuration parameters like timeout and timing constraints, see <a href="design_80_timing_parameters.html">Timing Parameters</a>. For an overview of the configuration system, see <a href="design_78_global_configuration.html">Global Configuration</a>. For details on how signals are validated during generation, see <a href="design_50_signal_generation_and_validation.html">Signal Generation and Validation</a>.</p>
<hr>
<a id="overview-of-validation-parameters" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview of Validation Parameters<a href="#overview-of-validation-parameters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework enforces four critical validation parameters that act as financial guardrails during signal generation. These parameters are part of <code>GLOBAL_CONFIG</code> and can be modified via <code>setConfig()</code> at runtime.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</code></td>
<td>number</td>
<td>0.5</td>
<td>Minimum percentage distance between <code>priceOpen</code> and <code>priceTakeProfit</code> to ensure profit exceeds trading fees</td>
</tr>
<tr>
<td><code>CC_MIN_STOPLOSS_DISTANCE_PERCENT</code></td>
<td>number</td>
<td>0.5</td>
<td>Minimum percentage distance between <code>priceOpen</code> and <code>priceStopLoss</code> to prevent instant stop out on market volatility</td>
</tr>
<tr>
<td><code>CC_MAX_STOPLOSS_DISTANCE_PERCENT</code></td>
<td>number</td>
<td>20</td>
<td>Maximum percentage distance between <code>priceOpen</code> and <code>priceStopLoss</code> to prevent catastrophic losses</td>
</tr>
<tr>
<td><code>CC_MAX_SIGNAL_LIFETIME_MINUTES</code></td>
<td>number</td>
<td>1440</td>
<td>Maximum signal duration in minutes to prevent eternal signals blocking risk limits</td>
</tr>
</tbody>
</table>
<p>These validations occur in the <code>VALIDATE_SIGNAL_FN</code> function within <code>ClientStrategy</code>, which is called before every signal is created. Signals that fail validation are rejected immediately with descriptive error messages.</p>
<hr>
<a id="take-profit-distance-validation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Take Profit Distance Validation<a href="#take-profit-distance-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="problem-statement" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Problem Statement<a href="#problem-statement" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Trading fees (typically 0.1% per side) create a minimum profit threshold. If <code>priceTakeProfit</code> is too close to <code>priceOpen</code>, the gross profit will be consumed by fees, resulting in a net loss despite hitting the take profit target.</p>
<p><strong>Example Scenario:</strong></p>
<ul>
<li>Long position: <code>priceOpen = 42000</code>, <code>priceTakeProfit = 42010</code> (0.024% profit)</li>
<li>Fees: 2 × 0.1% = 0.2% total (entry + exit)</li>
<li>Net PNL: 0.024% - 0.2% = <strong>-0.176% loss</strong></li>
</ul>
<p>Even hitting take profit results in a net loss because the gross profit fails to cover trading fees.</p>
<a id="validation-logic" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Logic<a href="#validation-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/79_Validation_Parameters_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Take Profit Distance Validation Flow</strong></p>
<p>The validation calculates the percentage distance between entry price and take profit target, then compares it against <code>CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</code>. For long positions, TP must be above entry. For short positions, TP must be below entry.</p>
<p><strong>Long Position Validation</strong> (<a href="">src/client/ClientStrategy.ts:138-148</a>):</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">tpDistancePercent</span><span class="hl-2"> = ((</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceTakeProfit</span><span class="hl-2"> - </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">) / </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">) * </span><span class="hl-7">100</span><span class="hl-2">;</span><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">tpDistancePercent</span><span class="hl-2"> &lt; </span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-2">.</span><span class="hl-8">CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">errors</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-4">`Long: TakeProfit too close to priceOpen (</span><span class="hl-3">${</span><span class="hl-6">tpDistancePercent</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">3</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%). `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Minimum distance: </span><span class="hl-3">${</span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-9">.</span><span class="hl-8">CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</span><span class="hl-3">}</span><span class="hl-4">% to cover trading fees.`</span><br/><span class="hl-2">  );</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Short Position Validation</strong> (<a href="">src/client/ClientStrategy.ts:198-208</a>):</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">tpDistancePercent</span><span class="hl-2"> = ((</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2"> - </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceTakeProfit</span><span class="hl-2">) / </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">) * </span><span class="hl-7">100</span><span class="hl-2">;</span><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">tpDistancePercent</span><span class="hl-2"> &lt; </span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-2">.</span><span class="hl-8">CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">errors</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-4">`Short: TakeProfit too close to priceOpen (</span><span class="hl-3">${</span><span class="hl-6">tpDistancePercent</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">3</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%). `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Minimum distance: </span><span class="hl-3">${</span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-9">.</span><span class="hl-8">CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</span><span class="hl-3">}</span><span class="hl-4">% to cover trading fees.`</span><br/><span class="hl-2">  );</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="default-value-justification" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Default Value Justification<a href="#default-value-justification" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The default value of <code>0.5%</code> provides a safety margin above trading fees:</p>
<ul>
<li>Slippage effect: 2 × 0.1% = 0.2% total (entry + exit)</li>
<li>Exchange fees: 2 × 0.1% = 0.2% total (entry + exit)</li>
<li>Total costs: 0.4%</li>
<li>Additional margin: 0.5% - 0.4% = <strong>0.1% minimum profit buffer</strong></li>
<li>Ensures every TP hit produces positive net PNL after fees and slippage</li>
<li>Can be increased to enforce larger minimum profits (e.g., 1.0% for conservative strategies)</li>
<li>Can be decreased to 0.2% for zero-fee/zero-slippage testing environments</li>
<li>Can be set to <code>0</code> to disable validation (only for testing environments)</li>
</ul>
<hr>
<a id="minimum-stop-loss-distance-validation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Minimum Stop Loss Distance Validation<a href="#minimum-stop-loss-distance-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="problem-statement-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Problem Statement<a href="#problem-statement-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Stop losses positioned too close to the entry price can result in instant stop-outs due to normal market volatility or spread fluctuations. This creates a scenario where positions are closed immediately after opening, even when the strategy's directional bias is correct.</p>
<p><strong>Example Scenario:</strong></p>
<ul>
<li>Long position: <code>priceOpen = 42000</code>, <code>priceStopLoss = 41990</code> (0.024% distance)</li>
<li>Normal volatility: ±0.1% (±42 price points)</li>
<li>Market briefly dips to 41980 (-0.048%), hits SL immediately</li>
<li>Position closed with loss before strategy thesis can play out</li>
</ul>
<p>Even with correct market direction, tight stop losses guarantee losses from noise.</p>
<a id="validation-logic-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Logic<a href="#validation-logic-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/79_Validation_Parameters_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Minimum Stop Loss Distance Validation Flow</strong></p>
<p>The validation calculates the percentage distance between entry price and stop loss, then compares it against <code>CC_MIN_STOPLOSS_DISTANCE_PERCENT</code>. For long positions, SL must be below entry with sufficient buffer. For short positions, SL must be above entry with sufficient buffer.</p>
<p><strong>Long Position Validation</strong> (<a href="">src/client/ClientStrategy.ts:176-186</a>):</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">slDistancePercent</span><span class="hl-2"> = ((</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2"> - </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceStopLoss</span><span class="hl-2">) / </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">) * </span><span class="hl-7">100</span><span class="hl-2">;</span><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">slDistancePercent</span><span class="hl-2"> &lt; </span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-2">.</span><span class="hl-8">CC_MIN_STOPLOSS_DISTANCE_PERCENT</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">errors</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-4">`Long: StopLoss too close to priceOpen (</span><span class="hl-3">${</span><span class="hl-6">slDistancePercent</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">3</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%). `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Minimum distance: </span><span class="hl-3">${</span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-9">.</span><span class="hl-8">CC_MIN_STOPLOSS_DISTANCE_PERCENT</span><span class="hl-3">}</span><span class="hl-4">% to avoid instant stop out on market volatility. `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Current: SL=</span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceStopLoss</span><span class="hl-3">}</span><span class="hl-4">, Open=</span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceOpen</span><span class="hl-3">}</span><span class="hl-4">`</span><br/><span class="hl-2">  );</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Short Position Validation</strong> (<a href="">src/client/ClientStrategy.ts:267-277</a>):</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">slDistancePercent</span><span class="hl-2"> = ((</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceStopLoss</span><span class="hl-2"> - </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">) / </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">) * </span><span class="hl-7">100</span><span class="hl-2">;</span><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">slDistancePercent</span><span class="hl-2"> &lt; </span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-2">.</span><span class="hl-8">CC_MIN_STOPLOSS_DISTANCE_PERCENT</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">errors</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-4">`Short: StopLoss too close to priceOpen (</span><span class="hl-3">${</span><span class="hl-6">slDistancePercent</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">3</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%). `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Minimum distance: </span><span class="hl-3">${</span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-9">.</span><span class="hl-8">CC_MIN_STOPLOSS_DISTANCE_PERCENT</span><span class="hl-3">}</span><span class="hl-4">% to avoid instant stop out on market volatility. `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Current: SL=</span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceStopLoss</span><span class="hl-3">}</span><span class="hl-4">, Open=</span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceOpen</span><span class="hl-3">}</span><span class="hl-4">`</span><br/><span class="hl-2">  );</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="default-value-justification-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Default Value Justification<a href="#default-value-justification-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The default value of <code>0.5%</code> provides a buffer against normal market noise:</p>
<ul>
<li>Prevents instant stop-outs from bid-ask spread fluctuations</li>
<li>Allows position to survive normal volatility (±0.2-0.3% intraday moves)</li>
<li>Ensures stop loss serves its intended purpose (protecting against adverse moves, not noise)</li>
<li>Can be decreased to <code>0.2-0.3%</code> for stable forex pairs with tight spreads</li>
<li>Can be increased to <code>1-2%</code> for volatile crypto markets</li>
<li>Should not be set to <code>0</code> in production (disables protection against micro-stops)</li>
</ul>
<hr>
<a id="maximum-stop-loss-distance-validation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Maximum Stop Loss Distance Validation<a href="#maximum-stop-loss-distance-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="problem-statement-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Problem Statement<a href="#problem-statement-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Excessively wide stop losses can expose the portfolio to catastrophic single-trade losses. A stop loss positioned 50% below entry would lose half the position size in one trade, potentially destroying the strategy's expected value.</p>
<p><strong>Example Scenario:</strong></p>
<ul>
<li>Long position: <code>priceOpen = 42000</code>, <code>priceStopLoss = 20000</code> (52.4% loss)</li>
<li>With 10% position sizing: -5.24% portfolio loss on one signal</li>
<li>After 4 consecutive stop loss hits: portfolio down -20%</li>
</ul>
<a id="validation-logic-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Logic<a href="#validation-logic-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/79_Validation_Parameters_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Stop Loss Distance Validation Flow</strong></p>
<p>The validation calculates the percentage distance between entry price and stop loss target, then compares it against <code>CC_MAX_STOPLOSS_DISTANCE_PERCENT</code>. For long positions, SL must be below entry. For short positions, SL must be above entry.</p>
<p><strong>Long Position Validation</strong> (<a href="">src/client/ClientStrategy.ts:189-199</a>):</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">slDistancePercent</span><span class="hl-2"> = ((</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2"> - </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceStopLoss</span><span class="hl-2">) / </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">) * </span><span class="hl-7">100</span><span class="hl-2">;</span><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">slDistancePercent</span><span class="hl-2"> &gt; </span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-2">.</span><span class="hl-8">CC_MAX_STOPLOSS_DISTANCE_PERCENT</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">errors</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-4">`Long: StopLoss too far from priceOpen (</span><span class="hl-3">${</span><span class="hl-6">slDistancePercent</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">3</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%). `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Maximum distance: </span><span class="hl-3">${</span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-9">.</span><span class="hl-8">CC_MAX_STOPLOSS_DISTANCE_PERCENT</span><span class="hl-3">}</span><span class="hl-4">% to protect capital. `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Current: SL=</span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceStopLoss</span><span class="hl-3">}</span><span class="hl-4">, Open=</span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceOpen</span><span class="hl-3">}</span><span class="hl-4">`</span><br/><span class="hl-2">  );</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Short Position Validation</strong> (<a href="">src/client/ClientStrategy.ts:280-290</a>):</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">slDistancePercent</span><span class="hl-2"> = ((</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceStopLoss</span><span class="hl-2"> - </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">) / </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">priceOpen</span><span class="hl-2">) * </span><span class="hl-7">100</span><span class="hl-2">;</span><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">slDistancePercent</span><span class="hl-2"> &gt; </span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-2">.</span><span class="hl-8">CC_MAX_STOPLOSS_DISTANCE_PERCENT</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">errors</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-4">`Short: StopLoss too far from priceOpen (</span><span class="hl-3">${</span><span class="hl-6">slDistancePercent</span><span class="hl-9">.</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">3</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%). `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Maximum distance: </span><span class="hl-3">${</span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-9">.</span><span class="hl-8">CC_MAX_STOPLOSS_DISTANCE_PERCENT</span><span class="hl-3">}</span><span class="hl-4">% to protect capital. `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Current: SL=</span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceStopLoss</span><span class="hl-3">}</span><span class="hl-4">, Open=</span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">priceOpen</span><span class="hl-3">}</span><span class="hl-4">`</span><br/><span class="hl-2">  );</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="default-value-justification-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Default Value Justification<a href="#default-value-justification-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The default value of <code>20%</code> represents a reasonable maximum loss per signal:</p>
<ul>
<li>Prevents single-trade portfolio destruction</li>
<li>Allows flexibility for volatile markets</li>
<li>Enforces risk discipline at the signal level</li>
<li>Can be tightened to <code>5-10%</code> for conservative strategies</li>
<li>Should not be disabled (set to <code>100+%</code>) in production</li>
</ul>
<hr>
<a id="signal-lifetime-validation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Lifetime Validation<a href="#signal-lifetime-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="problem-statement-3" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Problem Statement<a href="#problem-statement-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Signals with excessively long <code>minuteEstimatedTime</code> can create strategy deadlock by occupying risk limits indefinitely. If a signal expects to remain active for 30+ days, it blocks new signals from being generated, effectively freezing the strategy.</p>
<p><strong>Example Scenario:</strong></p>
<ul>
<li>Signal with <code>minuteEstimatedTime = 50000</code> minutes (34.7 days)</li>
<li>Risk profile allows <code>maxConcurrentPositions = 3</code></li>
<li>After 3 such signals open: strategy cannot generate new signals for weeks</li>
<li>Strategy becomes non-responsive to market changes</li>
</ul>
<a id="validation-logic-3" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Logic<a href="#validation-logic-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/79_Validation_Parameters_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Signal Lifetime Validation Flow</strong></p>
<p>The validation compares <code>minuteEstimatedTime</code> directly against <code>CC_MAX_SIGNAL_LIFETIME_MINUTES</code>. Error messages include human-readable day conversions for clarity.</p>
<p><strong>Validation Implementation</strong> (<a href="">src/client/ClientStrategy.ts:306-316</a>):</p>
<pre><code class="typescript"><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">minuteEstimatedTime</span><span class="hl-2"> &gt; </span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-2">.</span><span class="hl-8">CC_MAX_SIGNAL_LIFETIME_MINUTES</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">days</span><span class="hl-2"> = (</span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">minuteEstimatedTime</span><span class="hl-2"> / </span><span class="hl-7">60</span><span class="hl-2"> / </span><span class="hl-7">24</span><span class="hl-2">).</span><span class="hl-1">toFixed</span><span class="hl-2">(</span><span class="hl-7">1</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">maxDays</span><span class="hl-2"> = (</span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-2">.</span><span class="hl-8">CC_MAX_SIGNAL_LIFETIME_MINUTES</span><span class="hl-2"> / </span><span class="hl-7">60</span><span class="hl-2"> / </span><span class="hl-7">24</span><span class="hl-2">).</span><span class="hl-1">toFixed</span><span class="hl-2">(</span><span class="hl-7">0</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-6">errors</span><span class="hl-2">.</span><span class="hl-1">push</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-4">`minuteEstimatedTime too large (</span><span class="hl-3">${</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">minuteEstimatedTime</span><span class="hl-3">}</span><span class="hl-4"> minutes = </span><span class="hl-3">${</span><span class="hl-6">days</span><span class="hl-3">}</span><span class="hl-4"> days). `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Maximum: </span><span class="hl-3">${</span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-9">.</span><span class="hl-8">CC_MAX_SIGNAL_LIFETIME_MINUTES</span><span class="hl-3">}</span><span class="hl-4"> minutes (</span><span class="hl-3">${</span><span class="hl-6">maxDays</span><span class="hl-3">}</span><span class="hl-4"> days) to prevent strategy deadlock. `</span><span class="hl-2"> +</span><br/><span class="hl-2">    </span><span class="hl-4">`Eternal signals block risk limits and prevent new trades.`</span><br/><span class="hl-2">  );</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="default-value-justification-3" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Default Value Justification<a href="#default-value-justification-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The default value of <code>1440 minutes</code> (1 day):</p>
<ul>
<li>Balances flexibility with risk management</li>
<li>Prevents week-long signals from blocking strategy execution</li>
<li>Aligns with typical intraday/swing trading timeframes</li>
<li>Can be increased for longer-term strategies (e.g., 10080 minutes = 1 week)</li>
<li>Should not be disabled (set to <code>999999</code>) in production</li>
</ul>
<hr>
<a id="complete-validation-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Complete Validation Flow<a href="#complete-validation-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following diagram shows how validation parameters integrate into the signal generation pipeline:</p>
<p><img src="../media/79_Validation_Parameters_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Complete Signal Validation Flow with Validation Parameters</strong></p>
<p>The validation occurs in <code>VALIDATE_SIGNAL_FN</code> at <a href="">src/client/ClientStrategy.ts:45-330</a>. The function accumulates all validation errors into an array, then throws a single descriptive error if any validations fail. This provides comprehensive feedback to strategy developers.</p>
<p><strong>Key Validation Stages:</strong></p>
<table>
<thead>
<tr>
<th>Stage</th>
<th>Lines</th>
<th>Validation Logic</th>
<th>Configuration Used</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Required Fields</strong></td>
<td>48-69</td>
<td>Checks <code>id</code>, <code>exchangeName</code>, <code>strategyName</code>, <code>symbol</code>, <code>position</code>, <code>_isScheduled</code> are non-null/empty</td>
<td>N/A</td>
</tr>
<tr>
<td><strong>NaN/Infinity Protection</strong></td>
<td>71-96</td>
<td>Validates <code>currentPrice</code>, <code>priceOpen</code>, <code>priceTakeProfit</code>, <code>priceStopLoss</code> are finite numbers</td>
<td>N/A</td>
</tr>
<tr>
<td><strong>Positive Price Validation</strong></td>
<td>99-109</td>
<td>Ensures all prices are positive (&gt; 0)</td>
<td>N/A</td>
</tr>
<tr>
<td><strong>Long Position Logic</strong></td>
<td>112-199</td>
<td>For <code>position === &quot;long&quot;</code>: validates TP &gt; Open &gt; SL, checks all distance constraints</td>
<td><code>CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</code>, <code>CC_MIN_STOPLOSS_DISTANCE_PERCENT</code>, <code>CC_MAX_STOPLOSS_DISTANCE_PERCENT</code></td>
</tr>
<tr>
<td><strong>Short Position Logic</strong></td>
<td>202-290</td>
<td>For <code>position === &quot;short&quot;</code>: validates SL &gt; Open &gt; TP, checks all distance constraints</td>
<td><code>CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</code>, <code>CC_MIN_STOPLOSS_DISTANCE_PERCENT</code>, <code>CC_MAX_STOPLOSS_DISTANCE_PERCENT</code></td>
</tr>
<tr>
<td><strong>Time Parameter Validation</strong></td>
<td>293-323</td>
<td>Validates <code>minuteEstimatedTime</code>, <code>scheduledAt</code>, <code>pendingAt</code> are positive integers</td>
<td><code>CC_MAX_SIGNAL_LIFETIME_MINUTES</code></td>
</tr>
<tr>
<td><strong>Error Aggregation</strong></td>
<td>325-330</td>
<td>Throws single error with newline-separated list of all failures</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<hr>
<a id="configuration-via-setconfig" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Configuration via setConfig<a href="#configuration-via-setconfig" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Validation parameters can be modified at runtime using the <code>setConfig()</code> function. This is typically done during initialization or in test environments.</p>
<a id="configuration-syntax" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Configuration Syntax<a href="#configuration-syntax" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">setConfig</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;backtest-kit&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Example: Conservative configuration for stable markets</span><br/><span class="hl-1">setConfig</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">CC_MIN_TAKEPROFIT_DISTANCE_PERCENT:</span><span class="hl-2"> </span><span class="hl-7">1.0</span><span class="hl-2">,   </span><span class="hl-0">// Require 1.0% minimum profit (higher than default 0.5%)</span><br/><span class="hl-2">  </span><span class="hl-6">CC_MIN_STOPLOSS_DISTANCE_PERCENT:</span><span class="hl-2"> </span><span class="hl-7">0.8</span><span class="hl-2">,     </span><span class="hl-0">// Require 0.8% min SL buffer (higher than default 0.5%)</span><br/><span class="hl-2">  </span><span class="hl-6">CC_MAX_STOPLOSS_DISTANCE_PERCENT:</span><span class="hl-2"> </span><span class="hl-7">10</span><span class="hl-2">,      </span><span class="hl-0">// Allow max 10% stop loss (tighter than default 20%)</span><br/><span class="hl-2">  </span><span class="hl-6">CC_MAX_SIGNAL_LIFETIME_MINUTES:</span><span class="hl-2"> </span><span class="hl-7">720</span><span class="hl-2">,       </span><span class="hl-0">// Max 12 hours per signal (shorter than default 24h)</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<a id="configuration-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Configuration Patterns<a href="#configuration-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Use Case</th>
<th>Configuration</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Disable Validation (Testing)</strong></td>
<td><code>CC_MIN_TP: 0</code>, <code>CC_MIN_SL: 0</code>, <code>CC_MAX_SL: 100</code>, <code>CC_MAX_LIFETIME: 999999</code></td>
<td>Allows testing edge cases without validation constraints</td>
</tr>
<tr>
<td><strong>Conservative Trading</strong></td>
<td><code>CC_MIN_TP: 1.0%</code>, <code>CC_MIN_SL: 0.8%</code>, <code>CC_MAX_SL: 5%</code>, <code>CC_MAX_LIFETIME: 360 min</code></td>
<td>Tighter constraints for risk-averse strategies and stable markets</td>
</tr>
<tr>
<td><strong>Default (Balanced)</strong></td>
<td><code>CC_MIN_TP: 0.5%</code>, <code>CC_MIN_SL: 0.5%</code>, <code>CC_MAX_SL: 20%</code>, <code>CC_MAX_LIFETIME: 1440 min</code></td>
<td>Standard configuration covering fees + slippage + margin, reasonable max loss</td>
</tr>
<tr>
<td><strong>Volatile Markets</strong></td>
<td><code>CC_MIN_TP: 0.8%</code>, <code>CC_MIN_SL: 1.0%</code>, <code>CC_MAX_SL: 30%</code>, <code>CC_MAX_LIFETIME: 2880 min</code></td>
<td>Higher margins to handle volatility swings, wider SL tolerance</td>
</tr>
<tr>
<td><strong>Long-term Holding</strong></td>
<td><code>CC_MIN_TP: 2%</code>, <code>CC_MIN_SL: 1.0%</code>, <code>CC_MAX_SL: 20%</code>, <code>CC_MAX_LIFETIME: 10080 min</code></td>
<td>Larger minimum profits for multi-day positions, allow 1-week signals</td>
</tr>
</tbody>
</table>
<a id="test-environment-configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Test Environment Configuration<a href="#test-environment-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Test files disable validation by default to isolate signal logic testing from validation constraints:</p>
<pre><code class="typescript"><span class="hl-0">// Test environment typically disables validation globally</span><br/><span class="hl-1">setConfig</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">CC_MIN_TAKEPROFIT_DISTANCE_PERCENT:</span><span class="hl-2"> </span><span class="hl-7">0</span><span class="hl-2">,      </span><span class="hl-0">// No TP distance check</span><br/><span class="hl-2">  </span><span class="hl-6">CC_MIN_STOPLOSS_DISTANCE_PERCENT:</span><span class="hl-2"> </span><span class="hl-7">0</span><span class="hl-2">,        </span><span class="hl-0">// No min SL distance check</span><br/><span class="hl-2">  </span><span class="hl-6">CC_MAX_STOPLOSS_DISTANCE_PERCENT:</span><span class="hl-2"> </span><span class="hl-7">100</span><span class="hl-2">,      </span><span class="hl-0">// Allow any SL</span><br/><span class="hl-2">  </span><span class="hl-6">CC_MAX_SIGNAL_LIFETIME_MINUTES:</span><span class="hl-2"> </span><span class="hl-7">999999</span><span class="hl-2">,     </span><span class="hl-0">// No lifetime limit</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<p>Individual tests re-enable specific validations to verify error handling:</p>
<pre><code class="typescript"><span class="hl-0">// Example: Testing TP distance validation in isolation</span><br/><span class="hl-1">test</span><span class="hl-2">(</span><span class="hl-4">&quot;Micro-profit validation&quot;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">setConfig</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">CC_MIN_TAKEPROFIT_DISTANCE_PERCENT:</span><span class="hl-2"> </span><span class="hl-7">0.5</span><span class="hl-2">,  </span><span class="hl-0">// Enable TP validation with default value</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Signal with TP too close to Open should throw validation error</span><br/><span class="hl-2">  </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">addStrategy</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;micro-profit-test&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-1">getSignal</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> ({</span><br/><span class="hl-2">      </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-4">&quot;long&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceOpen:</span><span class="hl-2"> </span><span class="hl-7">42000</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> </span><span class="hl-7">42010</span><span class="hl-2">,  </span><span class="hl-0">// 0.024% - below 0.5% threshold</span><br/><span class="hl-2">      </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> </span><span class="hl-7">41000</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">minuteEstimatedTime:</span><span class="hl-2"> </span><span class="hl-7">60</span><span class="hl-2">,</span><br/><span class="hl-2">    }),</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">  </span><span class="hl-0">// Expected: Signal rejected with &quot;TakeProfit too close to priceOpen&quot; error</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="validation-error-messages" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Error Messages<a href="#validation-error-messages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Validation failures produce detailed error messages that help strategy developers diagnose issues:</p>
<a id="take-profit-error-message-format" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Take Profit Error Message Format<a href="#take-profit-error-message-format" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-10">Long</span><span class="hl-2">: </span><span class="hl-6">TakeProfit</span><span class="hl-2"> </span><span class="hl-6">too</span><span class="hl-2"> </span><span class="hl-6">close</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-1">priceOpen</span><span class="hl-2"> (</span><span class="hl-7">0.024</span><span class="hl-2">%). </span><br/><span class="hl-6">Minimum</span><span class="hl-2"> </span><span class="hl-10">distance</span><span class="hl-2">: </span><span class="hl-7">0.5</span><span class="hl-2">% </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">cover</span><span class="hl-2"> </span><span class="hl-6">trading</span><span class="hl-2"> </span><span class="hl-6">fees</span><span class="hl-2">. </span><br/><span class="hl-10">Current</span><span class="hl-2">: </span><span class="hl-8">TP</span><span class="hl-2">=</span><span class="hl-7">42010</span><span class="hl-2">, </span><span class="hl-6">Open</span><span class="hl-2">=</span><span class="hl-7">42000</span>
</code><button>Copy</button></pre>

<p>The error includes:</p>
<ul>
<li>Calculated distance as percentage: <code>0.024%</code></li>
<li>Configured minimum threshold: <code>0.3%</code></li>
<li>Actual prices for debugging: <code>TP=42010, Open=42000</code></li>
</ul>
<a id="minimum-stop-loss-error-message-format" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Minimum Stop Loss Error Message Format<a href="#minimum-stop-loss-error-message-format" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-10">Long</span><span class="hl-2">: </span><span class="hl-6">StopLoss</span><span class="hl-2"> </span><span class="hl-6">too</span><span class="hl-2"> </span><span class="hl-6">close</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-1">priceOpen</span><span class="hl-2"> (</span><span class="hl-7">0.024</span><span class="hl-2">%). </span><br/><span class="hl-6">Minimum</span><span class="hl-2"> </span><span class="hl-10">distance</span><span class="hl-2">: </span><span class="hl-7">0.5</span><span class="hl-2">% </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">avoid</span><span class="hl-2"> </span><span class="hl-6">instant</span><span class="hl-2"> </span><span class="hl-6">stop</span><span class="hl-2"> </span><span class="hl-6">out</span><span class="hl-2"> </span><span class="hl-6">on</span><span class="hl-2"> </span><span class="hl-6">market</span><span class="hl-2"> </span><span class="hl-6">volatility</span><span class="hl-2">. </span><br/><span class="hl-10">Current</span><span class="hl-2">: </span><span class="hl-8">SL</span><span class="hl-2">=</span><span class="hl-7">41990</span><span class="hl-2">, </span><span class="hl-6">Open</span><span class="hl-2">=</span><span class="hl-7">42000</span>
</code><button>Copy</button></pre>

<a id="maximum-stop-loss-error-message-format" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Maximum Stop Loss Error Message Format<a href="#maximum-stop-loss-error-message-format" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-10">Long</span><span class="hl-2">: </span><span class="hl-6">StopLoss</span><span class="hl-2"> </span><span class="hl-6">too</span><span class="hl-2"> </span><span class="hl-6">far</span><span class="hl-2"> </span><span class="hl-6">from</span><span class="hl-2"> </span><span class="hl-1">priceOpen</span><span class="hl-2"> (</span><span class="hl-7">52.381</span><span class="hl-2">%). </span><br/><span class="hl-6">Maximum</span><span class="hl-2"> </span><span class="hl-10">distance</span><span class="hl-2">: </span><span class="hl-7">20</span><span class="hl-2">% </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">protect</span><span class="hl-2"> </span><span class="hl-6">capital</span><span class="hl-2">. </span><br/><span class="hl-10">Current</span><span class="hl-2">: </span><span class="hl-8">SL</span><span class="hl-2">=</span><span class="hl-7">20000</span><span class="hl-2">, </span><span class="hl-6">Open</span><span class="hl-2">=</span><span class="hl-7">42000</span>
</code><button>Copy</button></pre>

<a id="signal-lifetime-error-message-format" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signal Lifetime Error Message Format<a href="#signal-lifetime-error-message-format" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-6">minuteEstimatedTime</span><span class="hl-2"> </span><span class="hl-6">too</span><span class="hl-2"> </span><span class="hl-1">large</span><span class="hl-2"> (</span><span class="hl-7">50000</span><span class="hl-2"> </span><span class="hl-6">minutes</span><span class="hl-2"> = </span><span class="hl-7">34.7</span><span class="hl-2"> </span><span class="hl-6">days</span><span class="hl-2">). </span><br/><span class="hl-10">Maximum</span><span class="hl-2">: </span><span class="hl-7">1440</span><span class="hl-2"> </span><span class="hl-1">minutes</span><span class="hl-2"> (</span><span class="hl-7">1</span><span class="hl-2"> </span><span class="hl-6">days</span><span class="hl-2">) </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">prevent</span><span class="hl-2"> </span><span class="hl-6">strategy</span><span class="hl-2"> </span><span class="hl-6">deadlock</span><span class="hl-2">. </span><br/><span class="hl-6">Eternal</span><span class="hl-2"> </span><span class="hl-6">signals</span><span class="hl-2"> </span><span class="hl-6">block</span><span class="hl-2"> </span><span class="hl-6">risk</span><span class="hl-2"> </span><span class="hl-6">limits</span><span class="hl-2"> </span><span class="hl-6">and</span><span class="hl-2"> </span><span class="hl-6">prevent</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-6">trades</span><span class="hl-2">.</span>
</code><button>Copy</button></pre>

<a id="error-aggregation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Aggregation<a href="#error-aggregation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Multiple validation failures are combined into a single error message:</p>
<pre><code><span class="hl-6">Invalid</span><span class="hl-2"> </span><span class="hl-6">signal</span><span class="hl-2"> </span><span class="hl-6">for</span><span class="hl-2"> </span><span class="hl-6">long</span><span class="hl-2"> </span><span class="hl-10">position</span><span class="hl-2">:</span><br/><span class="hl-10">Long</span><span class="hl-2">: </span><span class="hl-6">TakeProfit</span><span class="hl-2"> </span><span class="hl-6">too</span><span class="hl-2"> </span><span class="hl-6">close</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-1">priceOpen</span><span class="hl-2"> (</span><span class="hl-7">0.024</span><span class="hl-2">%). </span><span class="hl-6">Minimum</span><span class="hl-2"> </span><span class="hl-10">distance</span><span class="hl-2">: </span><span class="hl-7">0.5</span><span class="hl-2">% </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">cover</span><span class="hl-2"> </span><span class="hl-6">trading</span><span class="hl-2"> </span><span class="hl-6">fees</span><span class="hl-2">. </span><span class="hl-6">Current</span><span class="hl-2">: </span><span class="hl-8">TP</span><span class="hl-2">=</span><span class="hl-7">42010</span><span class="hl-2">, </span><span class="hl-6">Open</span><span class="hl-2">=</span><span class="hl-7">42000</span><br/><span class="hl-10">Long</span><span class="hl-2">: </span><span class="hl-6">StopLoss</span><span class="hl-2"> </span><span class="hl-6">too</span><span class="hl-2"> </span><span class="hl-6">close</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-1">priceOpen</span><span class="hl-2"> (</span><span class="hl-7">0.024</span><span class="hl-2">%). </span><span class="hl-6">Minimum</span><span class="hl-2"> </span><span class="hl-10">distance</span><span class="hl-2">: </span><span class="hl-7">0.5</span><span class="hl-2">% </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">avoid</span><span class="hl-2"> </span><span class="hl-6">instant</span><span class="hl-2"> </span><span class="hl-6">stop</span><span class="hl-2"> </span><span class="hl-6">out</span><span class="hl-2"> </span><span class="hl-6">on</span><span class="hl-2"> </span><span class="hl-6">market</span><span class="hl-2"> </span><span class="hl-6">volatility</span><span class="hl-2">. </span><span class="hl-6">Current</span><span class="hl-2">: </span><span class="hl-8">SL</span><span class="hl-2">=</span><span class="hl-7">41990</span><span class="hl-2">, </span><span class="hl-6">Open</span><span class="hl-2">=</span><span class="hl-7">42000</span><br/><span class="hl-10">Long</span><span class="hl-2">: </span><span class="hl-6">StopLoss</span><span class="hl-2"> </span><span class="hl-6">too</span><span class="hl-2"> </span><span class="hl-6">far</span><span class="hl-2"> </span><span class="hl-6">from</span><span class="hl-2"> </span><span class="hl-1">priceOpen</span><span class="hl-2"> (</span><span class="hl-7">52.381</span><span class="hl-2">%). </span><span class="hl-6">Maximum</span><span class="hl-2"> </span><span class="hl-10">distance</span><span class="hl-2">: </span><span class="hl-7">20</span><span class="hl-2">% </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">protect</span><span class="hl-2"> </span><span class="hl-6">capital</span><span class="hl-2">. </span><span class="hl-6">Current</span><span class="hl-2">: </span><span class="hl-8">SL</span><span class="hl-2">=</span><span class="hl-7">20000</span><span class="hl-2">, </span><span class="hl-6">Open</span><span class="hl-2">=</span><span class="hl-7">42000</span><br/><span class="hl-6">minuteEstimatedTime</span><span class="hl-2"> </span><span class="hl-6">too</span><span class="hl-2"> </span><span class="hl-1">large</span><span class="hl-2"> (</span><span class="hl-7">50000</span><span class="hl-2"> </span><span class="hl-6">minutes</span><span class="hl-2"> = </span><span class="hl-7">34.7</span><span class="hl-2"> </span><span class="hl-6">days</span><span class="hl-2">). </span><span class="hl-6">Maximum</span><span class="hl-2">: </span><span class="hl-7">1440</span><span class="hl-2"> </span><span class="hl-1">minutes</span><span class="hl-2"> (</span><span class="hl-7">1</span><span class="hl-2"> </span><span class="hl-6">days</span><span class="hl-2">) </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">prevent</span><span class="hl-2"> </span><span class="hl-6">strategy</span><span class="hl-2"> </span><span class="hl-6">deadlock</span><span class="hl-2">. </span><span class="hl-6">Eternal</span><span class="hl-2"> </span><span class="hl-6">signals</span><span class="hl-2"> </span><span class="hl-6">block</span><span class="hl-2"> </span><span class="hl-6">risk</span><span class="hl-2"> </span><span class="hl-6">limits</span><span class="hl-2"> </span><span class="hl-6">and</span><span class="hl-2"> </span><span class="hl-6">prevent</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-6">trades</span><span class="hl-2">.</span>
</code><button>Copy</button></pre>

<p>This comprehensive error output allows developers to fix all validation issues in a single iteration, reducing trial-and-error debugging cycles.</p>
<hr>
<a id="default-values-and-trade-offs" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Default Values and Trade-offs<a href="#default-values-and-trade-offs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The table below summarizes default values, their safety guarantees, and when to adjust them:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Safety Guarantee</th>
<th>When to Increase</th>
<th>When to Decrease</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</code></td>
<td>0.5%</td>
<td>Prevents fee-eating micro-profits (0.4% total costs + 0.1% margin)</td>
<td>Higher fee exchanges (1%+ for VIP tiers), require larger minimum profit (2-5%)</td>
<td>Zero-fee maker rebate accounts (0.2%), testing environments</td>
</tr>
<tr>
<td><code>CC_MIN_STOPLOSS_DISTANCE_PERCENT</code></td>
<td>0.5%</td>
<td>Prevents instant stop-outs from normal market volatility and spread fluctuations</td>
<td>High-volatility crypto markets (1-2%), assets with wide spreads</td>
<td>Stable forex major pairs with tight spreads (0.2-0.3%), low volatility periods</td>
</tr>
<tr>
<td><code>CC_MAX_STOPLOSS_DISTANCE_PERCENT</code></td>
<td>20%</td>
<td>Prevents catastrophic single-trade losses (max 20% position loss)</td>
<td>High-volatility assets requiring wide stops (crypto 30-40%), low-liquidity markets</td>
<td>Stable forex pairs (10-15%), conservative risk management (5-10%)</td>
</tr>
<tr>
<td><code>CC_MAX_SIGNAL_LIFETIME_MINUTES</code></td>
<td>1440 (1 day)</td>
<td>Prevents strategy deadlock from eternal signals blocking risk limits</td>
<td>Swing trading strategies (10080 = 1 week), position trading (43200 = 1 month)</td>
<td>Scalping strategies (60-120 min), intraday mean reversion (240-480 min)</td>
</tr>
</tbody>
</table>
<a id="interaction-with-risk-management" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interaction with Risk Management<a href="#interaction-with-risk-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>These validation parameters work in conjunction with risk profile limits (see <a href="design_68_risk_profiles.html">Risk Profiles</a>):</p>
<p><img src="../media/79_Validation_Parameters_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Validation Parameters as First Line of Defense</strong></p>
<p>Validation parameters act as the first line of defense, rejecting signals before they reach the risk management layer. This prevents invalid signals from consuming risk limit slots or triggering custom validations.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#validation-parameters"><span>Validation <wbr/>Parameters</span></a><ul><li><a href="#overview-of-validation-parameters"><span>Overview of <wbr/>Validation <wbr/>Parameters</span></a></li><li><a href="#take-profit-distance-validation"><span>Take <wbr/>Profit <wbr/>Distance <wbr/>Validation</span></a></li><li><ul><li><a href="#problem-statement"><span>Problem <wbr/>Statement</span></a></li><li><a href="#validation-logic"><span>Validation <wbr/>Logic</span></a></li><li><a href="#default-value-justification"><span>Default <wbr/>Value <wbr/>Justification</span></a></li></ul></li><li><a href="#minimum-stop-loss-distance-validation"><span>Minimum <wbr/>Stop <wbr/>Loss <wbr/>Distance <wbr/>Validation</span></a></li><li><ul><li><a href="#problem-statement-1"><span>Problem <wbr/>Statement</span></a></li><li><a href="#validation-logic-1"><span>Validation <wbr/>Logic</span></a></li><li><a href="#default-value-justification-1"><span>Default <wbr/>Value <wbr/>Justification</span></a></li></ul></li><li><a href="#maximum-stop-loss-distance-validation"><span>Maximum <wbr/>Stop <wbr/>Loss <wbr/>Distance <wbr/>Validation</span></a></li><li><ul><li><a href="#problem-statement-2"><span>Problem <wbr/>Statement</span></a></li><li><a href="#validation-logic-2"><span>Validation <wbr/>Logic</span></a></li><li><a href="#default-value-justification-2"><span>Default <wbr/>Value <wbr/>Justification</span></a></li></ul></li><li><a href="#signal-lifetime-validation"><span>Signal <wbr/>Lifetime <wbr/>Validation</span></a></li><li><ul><li><a href="#problem-statement-3"><span>Problem <wbr/>Statement</span></a></li><li><a href="#validation-logic-3"><span>Validation <wbr/>Logic</span></a></li><li><a href="#default-value-justification-3"><span>Default <wbr/>Value <wbr/>Justification</span></a></li></ul></li><li><a href="#complete-validation-flow"><span>Complete <wbr/>Validation <wbr/>Flow</span></a></li><li><a href="#configuration-via-setconfig"><span>Configuration via set<wbr/>Config</span></a></li><li><ul><li><a href="#configuration-syntax"><span>Configuration <wbr/>Syntax</span></a></li><li><a href="#configuration-patterns"><span>Configuration <wbr/>Patterns</span></a></li><li><a href="#test-environment-configuration"><span>Test <wbr/>Environment <wbr/>Configuration</span></a></li></ul></li><li><a href="#validation-error-messages"><span>Validation <wbr/>Error <wbr/>Messages</span></a></li><li><ul><li><a href="#take-profit-error-message-format"><span>Take <wbr/>Profit <wbr/>Error <wbr/>Message <wbr/>Format</span></a></li><li><a href="#minimum-stop-loss-error-message-format"><span>Minimum <wbr/>Stop <wbr/>Loss <wbr/>Error <wbr/>Message <wbr/>Format</span></a></li><li><a href="#maximum-stop-loss-error-message-format"><span>Maximum <wbr/>Stop <wbr/>Loss <wbr/>Error <wbr/>Message <wbr/>Format</span></a></li><li><a href="#signal-lifetime-error-message-format"><span>Signal <wbr/>Lifetime <wbr/>Error <wbr/>Message <wbr/>Format</span></a></li><li><a href="#error-aggregation"><span>Error <wbr/>Aggregation</span></a></li></ul></li><li><a href="#default-values-and-trade-offs"><span>Default <wbr/>Values and <wbr/>Trade-<wbr/>offs</span></a></li><li><ul><li><a href="#interaction-with-risk-management"><span>Interaction with <wbr/>Risk <wbr/>Management</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
