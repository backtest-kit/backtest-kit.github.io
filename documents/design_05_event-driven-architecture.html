<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/05_event-driven-architecture | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_05_event-driven-architecture.html">design/05_event-driven-architecture</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="event-driven-architecture" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Event-Driven Architecture<a href="#event-driven-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This document explains the pub/sub event system in backtest-kit, including event emitters, listener functions, queued async processing, and how events flow through the system. It covers the complete event architecture from producers to consumers.</p>
<p>For information about the signal lifecycle state machine that produces signal events, see <a href="design_03_signal-lifecycle-and-state-machine.html">Signal Lifecycle and State Machine</a>. For details on how different execution modes use events, see <a href="design_04_execution-modes-overview.html">Execution Modes Overview</a>. For comprehensive documentation on using event listeners in your code, see <a href="design_35_event-listeners-and-monitoring.html">Event Listeners and Monitoring</a>.</p>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The backtest-kit framework implements a comprehensive event-driven architecture using the pub/sub pattern via <code>functools-kit</code> Subject. This architecture decouples event producers (strategies, execution logic, risk managers) from event consumers (markdown reports, user callbacks, monitoring systems) through a central event bus.</p>
<p>All event communication flows through typed Subject instances exported from <a href="">src/config/emitters.ts</a>. The framework provides 18 distinct event emitters organized by domain: signals, errors, completion, progress, risk, and performance. User code subscribes to events via listener functions exported from <a href="">src/function/event.ts</a>, which wrap Subject subscriptions with queued async processing to maintain event ordering.</p>
<p><strong>Key Architecture Principles:</strong></p>
<table>
<thead>
<tr>
<th>Principle</th>
<th>Implementation</th>
<th>Benefit</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Decoupling</strong></td>
<td>Producers emit to Subject, consumers subscribe</td>
<td>Producers don't know about consumers</td>
</tr>
<tr>
<td><strong>Type Safety</strong></td>
<td>Typed payloads (contracts)</td>
<td>Compile-time validation</td>
</tr>
<tr>
<td><strong>Ordering</strong></td>
<td><code>queued()</code> wrapper on all listeners</td>
<td>Sequential async execution</td>
</tr>
<tr>
<td><strong>Filtering</strong></td>
<td>Separate emitters for live/backtest</td>
<td>Targeted subscriptions</td>
</tr>
<tr>
<td><strong>Once Semantics</strong></td>
<td><code>Once</code> listener variants</td>
<td>Single-shot reactions</td>
</tr>
</tbody>
</table>
<a id="event-emitter-taxonomy" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Emitter Taxonomy<a href="#event-emitter-taxonomy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework organizes 18 event emitters into six functional categories. Each emitter is a <code>functools-kit</code> Subject instance that implements the Observable pattern.</p>
<p><img src="../media/05-event-driven-architecture_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Event Emitter Reference:</strong></p>
<table>
<thead>
<tr>
<th>Emitter</th>
<th>Payload Type</th>
<th>Purpose</th>
<th>Producers</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>signalEmitter</code></td>
<td><code>IStrategyTickResult</code></td>
<td>All signal events (live + backtest)</td>
<td>ClientStrategy</td>
</tr>
<tr>
<td><code>signalLiveEmitter</code></td>
<td><code>IStrategyTickResult</code></td>
<td>Live trading signals only</td>
<td>LiveLogicPrivateService</td>
</tr>
<tr>
<td><code>signalBacktestEmitter</code></td>
<td><code>IStrategyTickResult</code></td>
<td>Backtest signals only</td>
<td>BacktestLogicPrivateService</td>
</tr>
<tr>
<td><code>errorEmitter</code></td>
<td><code>Error</code></td>
<td>Recoverable execution errors</td>
<td>Logic services</td>
</tr>
<tr>
<td><code>exitEmitter</code></td>
<td><code>Error</code></td>
<td>Fatal errors requiring termination</td>
<td>Logic services</td>
</tr>
<tr>
<td><code>validationSubject</code></td>
<td><code>Error</code></td>
<td>Risk validation failures</td>
<td>ClientRisk</td>
</tr>
<tr>
<td><code>doneLiveSubject</code></td>
<td><code>DoneContract</code></td>
<td>Live execution completion</td>
<td>LiveLogicPrivateService</td>
</tr>
<tr>
<td><code>doneBacktestSubject</code></td>
<td><code>DoneContract</code></td>
<td>Backtest completion</td>
<td>BacktestLogicPrivateService</td>
</tr>
<tr>
<td><code>doneWalkerSubject</code></td>
<td><code>DoneContract</code></td>
<td>Walker completion</td>
<td>WalkerLogicPrivateService</td>
</tr>
<tr>
<td><code>progressBacktestEmitter</code></td>
<td><code>ProgressBacktestContract</code></td>
<td>Backtest timeframe progress</td>
<td>BacktestLogicPrivateService</td>
</tr>
<tr>
<td><code>progressWalkerEmitter</code></td>
<td><code>ProgressWalkerContract</code></td>
<td>Walker strategy progress</td>
<td>WalkerLogicPrivateService</td>
</tr>
<tr>
<td><code>progressOptimizerEmitter</code></td>
<td><code>ProgressOptimizerContract</code></td>
<td>Optimizer source progress</td>
<td>OptimizerGlobalService</td>
</tr>
<tr>
<td><code>performanceEmitter</code></td>
<td><code>PerformanceContract</code></td>
<td>Performance metrics</td>
<td>Logic services</td>
</tr>
<tr>
<td><code>walkerEmitter</code></td>
<td><code>WalkerContract</code></td>
<td>Walker strategy results</td>
<td>WalkerLogicPrivateService</td>
</tr>
<tr>
<td><code>walkerCompleteSubject</code></td>
<td><code>IWalkerResults</code></td>
<td>Walker final results</td>
<td>WalkerLogicPrivateService</td>
</tr>
<tr>
<td><code>walkerStopSubject</code></td>
<td><code>WalkerStopContract</code></td>
<td>Walker stop signals (bidirectional)</td>
<td>User code / Logic</td>
</tr>
<tr>
<td><code>partialProfitSubject</code></td>
<td><code>PartialProfitContract</code></td>
<td>Profit level milestones</td>
<td>ClientPartial</td>
</tr>
<tr>
<td><code>partialLossSubject</code></td>
<td><code>PartialLossContract</code></td>
<td>Loss level milestones</td>
<td>ClientPartial</td>
</tr>
<tr>
<td><code>riskSubject</code></td>
<td><code>RiskContract</code></td>
<td>Risk rejection events (rejections only)</td>
<td>ClientRisk</td>
</tr>
</tbody>
</table>
<a id="event-producers" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Producers<a href="#event-producers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Event producers are internal framework components that emit events during strategy execution, risk validation, and progress tracking. Understanding producers helps debug event flow and build custom event-driven logic.</p>
<p><img src="../media/05-event-driven-architecture_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Producer Emission Points:</strong></p>
<table>
<thead>
<tr>
<th>Producer</th>
<th>Method</th>
<th>Emitter</th>
<th>When</th>
<th>Line Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td>ClientStrategy</td>
<td><code>tick()</code></td>
<td><code>signalEmitter</code></td>
<td>Every tick (idle/opened/active/closed/scheduled/cancelled)</td>
<td>Implementation in Client layer</td>
</tr>
<tr>
<td>ClientStrategy</td>
<td><code>tick()</code></td>
<td><code>signalLiveEmitter</code></td>
<td>Only during Live.run()</td>
<td>Filtered by Logic service</td>
</tr>
<tr>
<td>ClientStrategy</td>
<td><code>tick()</code></td>
<td><code>signalBacktestEmitter</code></td>
<td>Only during Backtest.run()</td>
<td>Filtered by Logic service</td>
</tr>
<tr>
<td>ClientRisk</td>
<td><code>checkSignal()</code></td>
<td><code>riskSubject</code></td>
<td>When signal rejected by validation</td>
<td>Via onRejected callback</td>
</tr>
<tr>
<td>ClientRisk</td>
<td><code>checkSignal()</code></td>
<td><code>validationSubject</code></td>
<td>When validation throws error</td>
<td>Exception handling</td>
</tr>
<tr>
<td>ClientPartial</td>
<td><code>profit()</code></td>
<td><code>partialProfitSubject</code></td>
<td>When reaching 10%, 20%, 30%... profit</td>
<td>Set-based deduplication</td>
</tr>
<tr>
<td>ClientPartial</td>
<td><code>loss()</code></td>
<td><code>partialLossSubject</code></td>
<td>When reaching 10%, 20%, 30%... loss</td>
<td>Set-based deduplication</td>
</tr>
<tr>
<td>BacktestLogicPrivateService</td>
<td><code>run()</code></td>
<td><code>progressBacktestEmitter</code></td>
<td>After each timeframe</td>
<td>Loop iteration</td>
</tr>
<tr>
<td>BacktestLogicPrivateService</td>
<td><code>run()</code></td>
<td><code>doneBacktestSubject</code></td>
<td>After all timeframes</td>
<td>Generator completion</td>
</tr>
<tr>
<td>LiveLogicPrivateService</td>
<td><code>run()</code></td>
<td><code>doneLiveSubject</code></td>
<td>After stop() called</td>
<td>Graceful shutdown</td>
</tr>
<tr>
<td>WalkerLogicPrivateService</td>
<td><code>run()</code></td>
<td><code>walkerEmitter</code></td>
<td>After each strategy backtest</td>
<td>Sequential execution</td>
</tr>
<tr>
<td>WalkerLogicPrivateService</td>
<td><code>run()</code></td>
<td><code>walkerCompleteSubject</code></td>
<td>After all strategies</td>
<td>Final results</td>
</tr>
<tr>
<td>WalkerLogicPrivateService</td>
<td><code>run()</code></td>
<td><code>progressWalkerEmitter</code></td>
<td>After each strategy</td>
<td>Progress tracking</td>
</tr>
<tr>
<td>WalkerLogicPrivateService</td>
<td><code>run()</code></td>
<td><code>doneWalkerSubject</code></td>
<td>After completion</td>
<td>Generator done</td>
</tr>
</tbody>
</table>
<p><strong>Signal Event Flow Example:</strong></p>
<p>The most common event flow is signal events from strategy execution:</p>
<p><img src="../media/05-event-driven-architecture_2.svg" alt="Mermaid Diagram"></p>
<a id="event-listeners-and-public-api" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Listeners and Public API<a href="#event-listeners-and-public-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>User code subscribes to events via listener functions exported from <a href="">src/function/event.ts</a>. Each listener function wraps a Subject subscription with queued async processing to ensure sequential execution even when callbacks are async.</p>
<p><img src="../media/05-event-driven-architecture_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Listener Function Patterns:</strong></p>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Functions</th>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Standard</strong></td>
<td><code>listenSignal</code>, <code>listenError</code>, etc.</td>
<td>Subscribe to all events, runs on each</td>
<td>Monitor all signals</td>
</tr>
<tr>
<td><strong>Once</strong></td>
<td><code>listenSignalOnce</code>, <code>listenDoneLiveOnce</code>, etc.</td>
<td>Subscribe with filter, runs once, auto-unsubscribe</td>
<td>Wait for specific signal</td>
</tr>
<tr>
<td><strong>Filtered</strong></td>
<td><code>listenSignalLive</code>, <code>listenSignalBacktest</code></td>
<td>Subscribe to subset of events</td>
<td>Separate live/backtest handling</td>
</tr>
<tr>
<td><strong>Once + Filtered</strong></td>
<td><code>listenSignalLiveOnce</code>, <code>listenSignalBacktestOnce</code></td>
<td>Filtered subset, runs once</td>
<td>Wait for first live take profit</td>
</tr>
</tbody>
</table>
<p><strong>Complete Listener API:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Signal listeners - src/function/event.ts:70-221</span><br/><span class="hl-0">listenSignal</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">IStrategyTickResult</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">) </span><span class="hl-5">// All signals</span><br/><span class="hl-0">listenSignalOnce</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">fn</span><span class="hl-1">) </span><span class="hl-5">// Filtered, once</span><br/><span class="hl-0">listenSignalLive</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">) </span><span class="hl-5">// Live only</span><br/><span class="hl-0">listenSignalLiveOnce</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">fn</span><span class="hl-1">) </span><span class="hl-5">// Live only, once</span><br/><span class="hl-0">listenSignalBacktest</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">) </span><span class="hl-5">// Backtest only</span><br/><span class="hl-0">listenSignalBacktestOnce</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">fn</span><span class="hl-1">) </span><span class="hl-5">// Backtest only, once</span><br/><br/><span class="hl-5">// Error listeners - src/function/event.ts:247-278</span><br/><span class="hl-0">listenError</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-13">Error</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">) </span><span class="hl-5">// Recoverable errors</span><br/><span class="hl-0">listenExit</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-13">Error</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">) </span><span class="hl-5">// Fatal errors</span><br/><br/><span class="hl-5">// Completion listeners - src/function/event.ts:308-405</span><br/><span class="hl-0">listenDoneLive</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">DoneContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><span class="hl-0">listenDoneLiveOnce</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">fn</span><span class="hl-1">)</span><br/><span class="hl-0">listenDoneBacktest</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">DoneContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><span class="hl-0">listenDoneBacktestOnce</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">fn</span><span class="hl-1">)</span><br/><span class="hl-0">listenDoneWalker</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">DoneContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><span class="hl-0">listenDoneWalkerOnce</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">fn</span><span class="hl-1">)</span><br/><br/><span class="hl-5">// Progress listeners - src/function/event.ts:423-476</span><br/><span class="hl-0">listenBacktestProgress</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">ProgressBacktestContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><span class="hl-0">listenWalkerProgress</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">ProgressWalkerContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><span class="hl-0">listenOptimizerProgress</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">ProgressOptimizerContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><br/><span class="hl-5">// Performance listeners - src/function/event.ts:491-500</span><br/><span class="hl-0">listenPerformance</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">PerformanceContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><br/><span class="hl-5">// Walker listeners - src/function/event.ts:515-548</span><br/><span class="hl-0">listenWalker</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">WalkerContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><span class="hl-0">listenWalkerOnce</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">fn</span><span class="hl-1">)</span><br/><span class="hl-0">listenWalkerComplete</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">IWalkerResults</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><br/><span class="hl-5">// Validation listeners - src/function/event.ts</span><br/><span class="hl-0">listenValidation</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-13">Error</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><br/><span class="hl-5">// Partial tracking listeners - src/function/event.ts</span><br/><span class="hl-0">listenPartialProfit</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">PartialProfitContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><span class="hl-0">listenPartialProfitOnce</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">fn</span><span class="hl-1">)</span><br/><span class="hl-0">listenPartialLoss</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">PartialLossContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><span class="hl-0">listenPartialLossOnce</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">fn</span><span class="hl-1">)</span><br/><br/><span class="hl-5">// Risk listeners - src/function/event.ts</span><br/><span class="hl-0">listenRisk</span><span class="hl-1">(</span><span class="hl-4">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">RiskContract</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">)</span><br/><span class="hl-0">listenRiskOnce</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">fn</span><span class="hl-1">)</span>
</code><button type="button">Copy</button></pre>

<p>All listener functions return an unsubscribe function to stop listening:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">unsubscribe</span><span class="hl-1"> = </span><span class="hl-0">listenSignal</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Signal event:&#39;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Later: stop listening</span><br/><span class="hl-0">unsubscribe</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="queued-async-processing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Queued Async Processing<a href="#queued-async-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All listener functions wrap user callbacks with <code>queued()</code> from <code>functools-kit</code> to ensure sequential async execution. This prevents race conditions and maintains event ordering even when callbacks perform async operations like database writes or API calls.</p>
<p><img src="../media/05-event-driven-architecture_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Implementation Pattern:</strong></p>
<p>Every listener function in <a href="">src/function/event.ts</a> follows this pattern:</p>
<pre><code class="typescript"><span class="hl-5">// Example from listenSignal - src/function/event.ts:70-73</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">listenSignal</span><span class="hl-1">(</span><span class="hl-0">fn</span><span class="hl-1">: (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-13">IStrategyTickResult</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-13">void</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-8">LISTEN_SIGNAL_METHOD_NAME</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">signalEmitter</span><span class="hl-1">.</span><span class="hl-0">subscribe</span><span class="hl-1">(</span><span class="hl-0">queued</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-0">fn</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">)));</span><br/><span class="hl-1">  </span><span class="hl-5">//                              ^^^^^^ Wraps callback for sequential execution</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Example from listenError - src/function/event.ts:247-250</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">listenError</span><span class="hl-1">(</span><span class="hl-0">fn</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-13">Error</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-13">void</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-8">LISTEN_ERROR_METHOD_NAME</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">errorEmitter</span><span class="hl-1">.</span><span class="hl-0">subscribe</span><span class="hl-1">(</span><span class="hl-0">queued</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-0">fn</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">)));</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Queued Processing Guarantees:</strong></p>
<table>
<thead>
<tr>
<th>Guarantee</th>
<th>Mechanism</th>
<th>Benefit</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Sequential Execution</strong></td>
<td>Callbacks wait for previous to complete</td>
<td>No concurrent execution</td>
</tr>
<tr>
<td><strong>Order Preservation</strong></td>
<td>Events processed in emission order</td>
<td>Predictable state transitions</td>
</tr>
<tr>
<td><strong>Async Support</strong></td>
<td>Handles Promise-returning callbacks</td>
<td>Database writes, API calls</td>
</tr>
<tr>
<td><strong>Error Isolation</strong></td>
<td>Errors in one callback don't block queue</td>
<td>Resilient processing</td>
</tr>
</tbody>
</table>
<p><strong>Example Use Case - Database Persistence:</strong></p>
<pre><code class="typescript"><span class="hl-5">// Without queued: race condition on writes</span><br/><span class="hl-0">listenSignal</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">database</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">); </span><span class="hl-5">// These writes can overlap and conflict!</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// With queued (built-in): sequential writes</span><br/><span class="hl-0">listenSignal</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">database</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">); </span><span class="hl-5">// Waits for previous write to complete</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The <code>queued()</code> wrapper is critical for internal framework consumers like markdown services that accumulate events:</p>
<pre><code class="typescript"><span class="hl-5">// BacktestMarkdownService.init() - src/lib/services/markdown/BacktestMarkdownService.ts:564-567</span><br/><span class="hl-4">protected</span><span class="hl-1"> </span><span class="hl-4">init</span><span class="hl-1"> = </span><span class="hl-0">singleshot</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;backtestMarkdownService init&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">signalBacktestEmitter</span><span class="hl-1">.</span><span class="hl-0">subscribe</span><span class="hl-1">(</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">tick</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">//                                ^^^^^^^^^ Already uses queued internally</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="event-payload-contracts" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Payload Contracts<a href="#event-payload-contracts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Event payloads are strongly typed interfaces (contracts) that define the data structure emitted by each event. All contracts are defined in <a href="">types.d.ts</a> and exported contract files in <a href="">src/contract/</a>.</p>
<p><img src="../media/05-event-driven-architecture_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Contract Definitions:</strong></p>
<table>
<thead>
<tr>
<th>Contract</th>
<th>File</th>
<th>Key Fields</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IStrategyTickResult</code></td>
<td>types.d.ts:974-1007</td>
<td><code>action</code>, <code>signal</code>, <code>strategyName</code>, <code>symbol</code></td>
<td>Discriminated union for all signal states</td>
</tr>
<tr>
<td><code>DoneContract</code></td>
<td>src/contract/Done.contract.ts</td>
<td><code>backtest</code>, <code>symbol</code>, <code>strategyName</code>, <code>exchangeName</code>, <code>frameName</code></td>
<td>Execution completion notification</td>
</tr>
<tr>
<td><code>ProgressBacktestContract</code></td>
<td>src/contract/ProgressBacktest.contract.ts</td>
<td><code>symbol</code>, <code>strategyName</code>, <code>exchangeName</code>, <code>frameName</code>, <code>processed</code>, <code>total</code></td>
<td>Backtest timeframe progress</td>
</tr>
<tr>
<td><code>ProgressWalkerContract</code></td>
<td>src/contract/ProgressWalker.contract.ts</td>
<td><code>symbol</code>, <code>walkerName</code>, <code>strategiesCompleted</code>, <code>totalStrategies</code></td>
<td>Walker strategy progress</td>
</tr>
<tr>
<td><code>ProgressOptimizerContract</code></td>
<td>src/contract/ProgressOptimizer.contract.ts</td>
<td><code>symbol</code>, <code>optimizerName</code>, <code>sourcesCompleted</code>, <code>totalSources</code></td>
<td>Optimizer source progress</td>
</tr>
<tr>
<td><code>PerformanceContract</code></td>
<td>src/contract/Performance.contract.ts</td>
<td><code>strategyName</code>, <code>metricType</code>, <code>duration</code>, <code>timestamp</code>, <code>previousTimestamp</code></td>
<td>Performance profiling</td>
</tr>
<tr>
<td><code>WalkerContract</code></td>
<td>src/contract/Walker.contract.ts</td>
<td><code>symbol</code>, <code>walkerName</code>, <code>strategyName</code>, <code>stats</code>, <code>metricValue</code>, <code>bestStrategy</code>, <code>bestMetric</code></td>
<td>Walker strategy result</td>
</tr>
<tr>
<td><code>IWalkerResults</code></td>
<td>types.d.ts:1326-1356</td>
<td><code>walkerName</code>, <code>symbol</code>, <code>bestStrategy</code>, <code>bestMetric</code>, <code>bestStats</code></td>
<td>Walker final results</td>
</tr>
<tr>
<td><code>PartialProfitContract</code></td>
<td>src/contract/PartialProfit.contract.ts</td>
<td><code>symbol</code>, <code>data</code>, <code>currentPrice</code>, <code>level</code>, <code>backtest</code>, <code>timestamp</code></td>
<td>Profit milestone reached</td>
</tr>
<tr>
<td><code>PartialLossContract</code></td>
<td>src/contract/PartialLoss.contract.ts</td>
<td><code>symbol</code>, <code>data</code>, <code>currentPrice</code>, <code>level</code>, <code>backtest</code>, <code>timestamp</code></td>
<td>Loss milestone reached</td>
</tr>
<tr>
<td><code>RiskContract</code></td>
<td>src/contract/Risk.contract.ts</td>
<td><code>symbol</code>, <code>params</code>, <code>activePositionCount</code>, <code>comment</code>, <code>timestamp</code></td>
<td>Risk validation rejection</td>
</tr>
</tbody>
</table>
<p><strong>Signal Event Discriminated Union:</strong></p>
<p>The most complex contract is <code>IStrategyTickResult</code>, which uses TypeScript discriminated unions for type-safe signal state handling:</p>
<pre><code class="typescript"><span class="hl-5">// Type guard example</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&#39;closed&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">// TypeScript knows event is IStrategyTickResultClosed</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">); </span><span class="hl-5">// Type-safe access</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1">); </span><span class="hl-5">// &#39;take_profit&#39; | &#39;stop_loss&#39; | &#39;time_expired&#39;</span><br/><span class="hl-1">} </span><span class="hl-3">else</span><span class="hl-1"> </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&#39;opened&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">// TypeScript knows event is IStrategyTickResultOpened</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">priceOpen</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="internal-event-consumers" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Internal Event Consumers<a href="#internal-event-consumers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Internal framework components subscribe to events for automated report generation and statistics collection. These consumers run transparently without user configuration.</p>
<p><img src="../media/05-event-driven-architecture_6.svg" alt="Mermaid Diagram"></p>
<p><strong>Markdown Service Subscriptions:</strong></p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Subscribed Emitters</th>
<th>Event Filter</th>
<th>Storage Limit</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>BacktestMarkdownService</td>
<td><code>signalBacktestEmitter</code></td>
<td><code>action === 'closed'</code></td>
<td>250 events</td>
<td>Closed signal statistics</td>
</tr>
<tr>
<td>LiveMarkdownService</td>
<td><code>signalLiveEmitter</code></td>
<td>All actions</td>
<td>250 events</td>
<td>Live trading log</td>
</tr>
<tr>
<td>ScheduleMarkdownService</td>
<td><code>signalEmitter</code></td>
<td><code>action === 'scheduled' | 'opened' | 'cancelled'</code></td>
<td>250 events</td>
<td>Scheduled signal tracking</td>
</tr>
<tr>
<td>HeatMarkdownService</td>
<td><code>signalEmitter</code></td>
<td><code>action === 'closed'</code></td>
<td>Unbounded (per symbol)</td>
<td>Portfolio heatmap</td>
</tr>
<tr>
<td>PartialMarkdownService</td>
<td><code>partialProfitSubject</code>, <code>partialLossSubject</code></td>
<td>All</td>
<td>250 events</td>
<td>Partial profit/loss log</td>
</tr>
<tr>
<td>RiskMarkdownService</td>
<td><code>riskSubject</code></td>
<td>All</td>
<td>Unbounded</td>
<td>Risk rejection log</td>
</tr>
<tr>
<td>PerformanceMarkdownService</td>
<td><code>performanceEmitter</code></td>
<td>All</td>
<td>10000 events</td>
<td>Performance profiling</td>
</tr>
<tr>
<td>WalkerMarkdownService</td>
<td><code>walkerEmitter</code></td>
<td>All</td>
<td>Unbounded</td>
<td>Strategy comparison</td>
</tr>
</tbody>
</table>
<p><strong>Initialization Pattern:</strong></p>
<p>All markdown services use the <code>singleshot</code> pattern to subscribe on first use:</p>
<pre><code class="typescript"><span class="hl-5">// BacktestMarkdownService - src/lib/services/markdown/BacktestMarkdownService.ts:564-567</span><br/><span class="hl-4">protected</span><span class="hl-1"> </span><span class="hl-4">init</span><span class="hl-1"> = </span><span class="hl-0">singleshot</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;backtestMarkdownService init&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">signalBacktestEmitter</span><span class="hl-1">.</span><span class="hl-0">subscribe</span><span class="hl-1">(</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">tick</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// LiveMarkdownService - src/lib/services/markdown/LiveMarkdownService.ts:771-774</span><br/><span class="hl-4">protected</span><span class="hl-1"> </span><span class="hl-4">init</span><span class="hl-1"> = </span><span class="hl-0">singleshot</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;liveMarkdownService init&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">signalLiveEmitter</span><span class="hl-1">.</span><span class="hl-0">subscribe</span><span class="hl-1">(</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">tick</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Bounded Queue Pattern:</strong></p>
<p>Services with <code>MAX_EVENTS</code> limits use a bounded queue to prevent memory leaks:</p>
<pre><code class="typescript"><span class="hl-5">// LiveMarkdownService - src/lib/services/markdown/LiveMarkdownService.ts:296-300</span><br/><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-0">unshift</span><span class="hl-1">(</span><span class="hl-4">newEvent</span><span class="hl-1">);</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-8">MAX_EVENTS</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_eventList</span><span class="hl-1">.</span><span class="hl-0">pop</span><span class="hl-1">(); </span><span class="hl-5">// Remove oldest event</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>This ensures long-running live trading sessions don't accumulate unbounded event history.</p>
<p><strong>Report Access:</strong></p>
<p>User code accesses accumulated statistics via public classes:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Backtest</span><span class="hl-1">, </span><span class="hl-4">Live</span><span class="hl-1">, </span><span class="hl-4">Schedule</span><span class="hl-1">, </span><span class="hl-4">Heat</span><span class="hl-1">, </span><span class="hl-4">Partial</span><span class="hl-1">, </span><span class="hl-4">Risk</span><span class="hl-1">, </span><span class="hl-4">Performance</span><span class="hl-1">, </span><span class="hl-4">Walker</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;backtest-kit&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Get statistics</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">backtestStats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">liveStats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Generate markdown report</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">report</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Save to disk</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;./reports&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="common-event-flow-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Common Event Flow Patterns<a href="#common-event-flow-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This section demonstrates common event flow patterns for typical use cases.</p>
<a id="pattern-1-monitoring-all-signals" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 1: Monitoring All Signals<a href="#pattern-1-monitoring-all-signals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Subscribe to all signals regardless of execution mode:</p>
<p><img src="../media/05-event-driven-architecture_7.svg" alt="Mermaid Diagram"></p>
<a id="pattern-2-waiting-for-specific-event" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 2: Waiting for Specific Event<a href="#pattern-2-waiting-for-specific-event" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Use <code>listenSignalOnce</code> to wait for a specific condition:</p>
<p><img src="../media/05-event-driven-architecture_8.svg" alt="Mermaid Diagram"></p>
<a id="pattern-3-background-execution-with-completion" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 3: Background Execution with Completion<a href="#pattern-3-background-execution-with-completion" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Start background task and wait for completion:</p>
<p><img src="../media/05-event-driven-architecture_9.svg" alt="Mermaid Diagram"></p>
<a id="pattern-4-progress-tracking" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 4: Progress Tracking<a href="#pattern-4-progress-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Monitor backtest or walker progress:</p>
<p><img src="../media/05-event-driven-architecture_10.svg" alt="Mermaid Diagram"></p>
<a id="pattern-5-risk-rejection-monitoring" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 5: Risk Rejection Monitoring<a href="#pattern-5-risk-rejection-monitoring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Track signals rejected by risk management:</p>
<p><img src="../media/05-event-driven-architecture_11.svg" alt="Mermaid Diagram"></p>
<p>The <code>riskSubject</code> only emits rejection events to prevent spam from allowed signals.</p>
<a id="pattern-6-partial-profitloss-tracking" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 6: Partial Profit/Loss Tracking<a href="#pattern-6-partial-profitloss-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Monitor profit/loss milestones:</p>
<p><img src="../media/05-event-driven-architecture_12.svg" alt="Mermaid Diagram"></p>
<a id="bidirectional-event-walker-stop" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Bidirectional Event: Walker Stop<a href="#bidirectional-event-walker-stop" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>walkerStopSubject</code> is uniqueit's bidirectional, allowing both user code and internal logic to communicate stop signals.</p>
<p><img src="../media/05-event-driven-architecture_13.svg" alt="Mermaid Diagram"></p>
<p><strong>Stop Signal Flow:</strong></p>
<pre><code class="typescript"><span class="hl-5">// User initiates stop - src/classes/Walker.ts</span><br/><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">stop</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;my-walker&quot;</span><span class="hl-1">);</span><br/><span class="hl-5">// Emits: { symbol: &quot;BTCUSDT&quot;, walkerName: &quot;my-walker&quot; }</span><br/><br/><span class="hl-5">// WalkerLogicPrivateService subscribes</span><br/><span class="hl-4">walkerStopSubject</span><span class="hl-1">.</span><span class="hl-0">subscribe</span><span class="hl-1">((</span><span class="hl-4">stop</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">stop</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1"> === </span><span class="hl-4">symbol</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">stop</span><span class="hl-1">.</span><span class="hl-4">walkerName</span><span class="hl-1"> === </span><span class="hl-4">walkerName</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Break execution loop</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>This enables graceful cancellation of long-running walker comparisons without process termination.</p>
<a id="summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Summary<a href="#summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The event-driven architecture in backtest-kit provides:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Implementation</th>
<th>Benefit</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Decoupling</strong></td>
<td>Subject-based pub/sub</td>
<td>Producers independent of consumers</td>
</tr>
<tr>
<td><strong>Type Safety</strong></td>
<td>Strongly typed contracts</td>
<td>Compile-time validation</td>
</tr>
<tr>
<td><strong>Ordering</strong></td>
<td>Queued async processing</td>
<td>Sequential event handling</td>
</tr>
<tr>
<td><strong>Filtering</strong></td>
<td>Separate emitters + filter predicates</td>
<td>Targeted subscriptions</td>
</tr>
<tr>
<td><strong>Once Semantics</strong></td>
<td><code>Once</code> listener variants</td>
<td>Single-shot reactions</td>
</tr>
<tr>
<td><strong>Bounded Queues</strong></td>
<td>MAX_EVENTS limits</td>
<td>Memory leak prevention</td>
</tr>
<tr>
<td><strong>Automated Reports</strong></td>
<td>Internal markdown consumers</td>
<td>Zero-config statistics</td>
</tr>
<tr>
<td><strong>Bidirectional</strong></td>
<td>walkerStopSubject</td>
<td>Graceful cancellation</td>
</tr>
</tbody>
</table>
<p>The architecture supports both internal framework operations (markdown reports, statistics) and user-defined event-driven logic (monitoring, alerting, custom analytics) through a consistent API.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#event-driven-architecture"><span>Event-<wbr/>Driven <wbr/>Architecture</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#overview"><span>Overview</span></a></li><li><a href="#event-emitter-taxonomy"><span>Event <wbr/>Emitter <wbr/>Taxonomy</span></a></li><li><a href="#event-producers"><span>Event <wbr/>Producers</span></a></li><li><a href="#event-listeners-and-public-api"><span>Event <wbr/>Listeners and <wbr/>Public API</span></a></li><li><a href="#queued-async-processing"><span>Queued <wbr/>Async <wbr/>Processing</span></a></li><li><a href="#event-payload-contracts"><span>Event <wbr/>Payload <wbr/>Contracts</span></a></li><li><a href="#internal-event-consumers"><span>Internal <wbr/>Event <wbr/>Consumers</span></a></li><li><a href="#common-event-flow-patterns"><span>Common <wbr/>Event <wbr/>Flow <wbr/>Patterns</span></a></li><li><ul><li><a href="#pattern-1-monitoring-all-signals"><span>Pattern 1: <wbr/>Monitoring <wbr/>All <wbr/>Signals</span></a></li><li><a href="#pattern-2-waiting-for-specific-event"><span>Pattern 2: <wbr/>Waiting for <wbr/>Specific <wbr/>Event</span></a></li><li><a href="#pattern-3-background-execution-with-completion"><span>Pattern 3: <wbr/>Background <wbr/>Execution with <wbr/>Completion</span></a></li><li><a href="#pattern-4-progress-tracking"><span>Pattern 4: <wbr/>Progress <wbr/>Tracking</span></a></li><li><a href="#pattern-5-risk-rejection-monitoring"><span>Pattern 5: <wbr/>Risk <wbr/>Rejection <wbr/>Monitoring</span></a></li><li><a href="#pattern-6-partial-profitloss-tracking"><span>Pattern 6: <wbr/>Partial <wbr/>Profit/<wbr/>Loss <wbr/>Tracking</span></a></li></ul></li><li><a href="#bidirectional-event-walker-stop"><span>Bidirectional <wbr/>Event: <wbr/>Walker <wbr/>Stop</span></a></li><li><a href="#summary"><span>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
