<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/54_backtesting | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_54_backtesting.html">design/54_backtesting</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="backtesting" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Backtesting<a href="#backtesting" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This document provides a comprehensive guide to backtesting mode in the backtest-kit framework. Backtesting executes trading strategies against historical market data to evaluate their performance before deploying them in live trading. This page covers the execution flow, timeframe iteration, fast-forward optimization, and the public API for running backtests.</p>
<p>For information about live trading execution, see <a href="design_58_live_trading.html">Live Trading</a>. For comparing multiple strategies simultaneously, see <a href="design_63_walker_mode.html">Walker Mode</a>. For the internal strategy logic that processes signals, see <a href="design_33_clientstrategy.html">ClientStrategy</a>.</p>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtesting mode processes historical candle data to simulate how a trading strategy would have performed. It differs from live trading in several key characteristics:</p>
<table>
<thead>
<tr>
<th>Characteristic</th>
<th>Backtest Mode</th>
<th>Live Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Data Source</strong></td>
<td>Historical candles from frame</td>
<td>Real-time <code>new Date()</code></td>
</tr>
<tr>
<td><strong>Execution</strong></td>
<td>Iterates predetermined timeframes</td>
<td>Infinite loop with sleep intervals</td>
</tr>
<tr>
<td><strong>Persistence</strong></td>
<td>In-memory only, no state saved</td>
<td>Crash-safe persistence to disk</td>
</tr>
<tr>
<td><strong>Signal States</strong></td>
<td>Only <code>closed</code> and <code>cancelled</code> yielded</td>
<td>All states (<code>idle</code>, <code>opened</code>, <code>active</code>, <code>scheduled</code>, <code>closed</code>, <code>cancelled</code>)</td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>Fast-forward skips timeframes during active signals</td>
<td>Monitors every tick continuously</td>
</tr>
<tr>
<td><strong>Determinism</strong></td>
<td>Deterministic results for same inputs</td>
<td>Non-deterministic (market conditions vary)</td>
</tr>
</tbody>
</table>
<p>Backtesting is designed for speed and reproducibility. It processes historical data as quickly as possible without waiting for real-time clock progression.</p>
<a id="system-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">System Architecture<a href="#system-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The backtest system is organized into distinct layers that separate API concerns from execution logic:</p>
<p><img src="../media/54_Backtesting_0.svg" alt="Mermaid Diagram"></p>
<p>The <code>BacktestUtils</code> singleton provides the main entry point, with memoized <code>BacktestInstance</code> objects managing isolated execution per symbol-strategy pair. The logic layer orchestrates timeframe iteration and signal processing, delegating to core services for strategy execution, candle fetching, and timeframe generation.</p>
<a id="execution-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Execution Flow<a href="#execution-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The backtest execution follows a multi-stage flow that processes historical timeframes sequentially:</p>
<p><img src="../media/54_Backtesting_1.svg" alt="Mermaid Diagram"></p>
<p>The flow consists of several key phases:</p>
<a id="1-initialization-phase" class="tsd-anchor"></a><h3 class="tsd-anchor-link">1. Initialization Phase<a href="#1-initialization-phase" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Before iteration begins, the system validates all registered components and clears any previous state:</p>
<ul>
<li><strong>Validation</strong>: Ensures <code>strategyName</code>, <code>exchangeName</code>, <code>frameName</code>, and optional <code>riskName</code> are registered</li>
<li><strong>State Clearing</strong>: Resets markdown services and strategy core service for clean run</li>
<li><strong>Timeframe Generation</strong>: Calls <code>FrameCoreService.getTimeframe()</code> to get complete array of historical timestamps</li>
</ul>
<a id="2-iteration-loop" class="tsd-anchor"></a><h3 class="tsd-anchor-link">2. Iteration Loop<a href="#2-iteration-loop" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The main loop iterates through timeframes with index <code>i</code>, processing each timestamp:</p>
<pre><code class="typescript"><span class="hl-5">while</span><span class="hl-2"> (</span><span class="hl-6">i</span><span class="hl-2"> &lt; </span><span class="hl-6">timeframes</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">when</span><span class="hl-2"> = </span><span class="hl-6">timeframes</span><span class="hl-2">[</span><span class="hl-6">i</span><span class="hl-2">];</span><br/><span class="hl-2">  </span><span class="hl-0">// Process timeframe...</span><br/><span class="hl-2">  </span><span class="hl-6">i</span><span class="hl-2">++;</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p>For each timeframe, the system:</p>
<ol>
<li>Emits progress event via <code>progressBacktestEmitter</code></li>
<li>Checks if user called <code>stop()</code> before processing</li>
<li>Calls <code>tick()</code> to check signal status</li>
<li>Processes result based on action type</li>
</ol>
<a id="3-signal-processing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">3. Signal Processing<a href="#3-signal-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>tick()</code> method returns different action types:</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>Meaning</th>
<th>Processing</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>idle</code></td>
<td>No active signal</td>
<td>Check stop flag, increment timeframe</td>
</tr>
<tr>
<td><code>opened</code></td>
<td>Signal just opened (market order)</td>
<td>Fetch candles, run <code>backtest()</code>, skip to close</td>
</tr>
<tr>
<td><code>scheduled</code></td>
<td>Signal awaiting activation (limit order)</td>
<td>Fetch candles with await window, run <code>backtest()</code>, skip to close</td>
</tr>
</tbody>
</table>
<a id="4-candle-fetching-strategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">4. Candle Fetching Strategy<a href="#4-candle-fetching-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When a signal opens or is scheduled, the system fetches 1-minute candles for detailed simulation:</p>
<p>For <strong>opened</strong> signals:</p>
<pre><code><span class="hl-6">bufferMinutes</span><span class="hl-2"> = </span><span class="hl-8">CC_AVG_PRICE_CANDLES_COUNT</span><span class="hl-2"> - </span><span class="hl-7">1</span><br/><span class="hl-6">bufferStartTime</span><span class="hl-2"> = </span><span class="hl-6">when</span><span class="hl-2"> - </span><span class="hl-6">bufferMinutes</span><span class="hl-2"> * 60</span><span class="hl-6">s</span><br/><span class="hl-6">totalCandles</span><span class="hl-2"> = </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">minuteEstimatedTime</span><span class="hl-2"> + </span><span class="hl-6">bufferMinutes</span>
</code><button>Copy</button></pre>

<p>For <strong>scheduled</strong> signals:</p>
<pre><code><span class="hl-6">bufferMinutes</span><span class="hl-2"> = </span><span class="hl-8">CC_AVG_PRICE_CANDLES_COUNT</span><span class="hl-2"> - </span><span class="hl-7">1</span><br/><span class="hl-6">bufferStartTime</span><span class="hl-2"> = </span><span class="hl-6">when</span><span class="hl-2"> - </span><span class="hl-6">bufferMinutes</span><span class="hl-2"> * 60</span><span class="hl-6">s</span><br/><span class="hl-6">candlesNeeded</span><span class="hl-2"> = </span><span class="hl-6">bufferMinutes</span><span class="hl-2"> + </span><span class="hl-8">CC_SCHEDULE_AWAIT_MINUTES</span><span class="hl-2"> + </span><span class="hl-6">signal</span><span class="hl-2">.</span><span class="hl-6">minuteEstimatedTime</span><span class="hl-2"> + </span><span class="hl-7">1</span>
</code><button>Copy</button></pre>

<p>The buffer provides historical candles for VWAP calculation. The scheduled signal needs extra candles to monitor activation timeout.</p>
<a id="5-fast-forward-optimization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">5. Fast-Forward Optimization<a href="#5-fast-forward-optimization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>After <code>backtest()</code> returns with <code>closeTimestamp</code>, the system skips all timeframes until that timestamp:</p>
<pre><code class="typescript"><span class="hl-5">while</span><span class="hl-2"> (</span><br/><span class="hl-2">  </span><span class="hl-6">i</span><span class="hl-2"> &lt; </span><span class="hl-6">timeframes</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2"> &amp;&amp;</span><br/><span class="hl-2">  </span><span class="hl-6">timeframes</span><span class="hl-2">[</span><span class="hl-6">i</span><span class="hl-2">].</span><span class="hl-1">getTime</span><span class="hl-2">() &lt; </span><span class="hl-6">backtestResult</span><span class="hl-2">.</span><span class="hl-6">closeTimestamp</span><br/><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">i</span><span class="hl-2">++;</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p>This optimization dramatically improves performance by avoiding unnecessary <code>tick()</code> calls during active signal monitoring. The <code>backtest()</code> method internally simulates all candles to determine when the signal closes.</p>
<a id="6-result-yielding" class="tsd-anchor"></a><h3 class="tsd-anchor-link">6. Result Yielding<a href="#6-result-yielding" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Only closed and cancelled signals are yielded to the consumer:</p>
<pre><code class="typescript"><span class="hl-5">yield</span><span class="hl-2"> </span><span class="hl-6">backtestResult</span><span class="hl-2">; </span><span class="hl-0">// IStrategyBacktestResult</span>
</code><button type="button">Copy</button></pre>

<p>The result contains:</p>
<ul>
<li><code>action</code>: Either <code>&quot;closed&quot;</code> or <code>&quot;cancelled&quot;</code></li>
<li><code>signal</code>: Full signal object with prices, timestamps, id</li>
<li><code>closeTimestamp</code>: When signal closed (milliseconds)</li>
<li><code>closeReason</code>: <code>&quot;take_profit&quot;</code>, <code>&quot;stop_loss&quot;</code>, or <code>&quot;time_expired&quot;</code> (if closed)</li>
<li><code>pnl</code>: Profit/loss calculation including fees</li>
</ul>
<a id="7-stop-handling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">7. Stop Handling<a href="#7-stop-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The system checks for stop requests at multiple safe points:</p>
<ol>
<li><strong>Before tick</strong>: Prevents starting new timeframe processing</li>
<li><strong>When idle</strong>: Allows clean exit with no active signal</li>
<li><strong>After signal closes</strong>: Allows stopping between signals</li>
</ol>
<p>This ensures graceful shutdown without interrupting active signal processing.</p>
<a id="public-api-usage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Public API Usage<a href="#public-api-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>Backtest</code> class provides a clean API for running backtests:</p>
<a id="basic-usage-with-run" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Usage with run()<a href="#basic-usage-with-run" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>run()</code> method returns an async generator that yields closed signals:</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">Backtest</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-4">&quot;binance&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">frameName:</span><span class="hl-2"> </span><span class="hl-4">&quot;2024-backtest&quot;</span><br/><span class="hl-2">})) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Signal </span><span class="hl-3">${</span><span class="hl-6">result</span><span class="hl-9">.</span><span class="hl-6">signal</span><span class="hl-9">.</span><span class="hl-6">id</span><span class="hl-3">}</span><span class="hl-4"> closed`</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`PNL: </span><span class="hl-3">${</span><span class="hl-6">result</span><span class="hl-9">.</span><span class="hl-6">pnl</span><span class="hl-9">.</span><span class="hl-6">pnlPercentage</span><span class="hl-3">}</span><span class="hl-4">%`</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`Reason: </span><span class="hl-3">${</span><span class="hl-6">result</span><span class="hl-9">.</span><span class="hl-6">closeReason</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p>The generator pattern allows early termination:</p>
<pre><code class="typescript"><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">)) {</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">result</span><span class="hl-2">.</span><span class="hl-6">pnl</span><span class="hl-2">.</span><span class="hl-6">pnlPercentage</span><span class="hl-2"> &lt; -</span><span class="hl-7">20</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">&quot;Max drawdown exceeded, stopping&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">break</span><span class="hl-2">; </span><span class="hl-0">// Generator stops iteration</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="background-execution" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Background Execution<a href="#background-execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>background()</code> method runs the backtest without yielding results, consuming them internally:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">cancel</span><span class="hl-2"> = </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">background</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-4">&quot;binance&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">frameName:</span><span class="hl-2"> </span><span class="hl-4">&quot;2024-backtest&quot;</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Stop at any time</span><br/><span class="hl-1">cancel</span><span class="hl-2">();</span>
</code><button type="button">Copy</button></pre>

<p>This is useful when you only care about side effects (callbacks, markdown reports) and don't need to process results in code.</p>
<a id="instance-isolation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Instance Isolation<a href="#instance-isolation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each symbol-strategy pair gets an isolated <code>BacktestInstance</code> via memoization:</p>
<pre><code class="typescript"><span class="hl-0">// These run independently with separate state</span><br/><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">background</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, { </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;strategy-a&quot;</span><span class="hl-2">, ... });</span><br/><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">background</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, { </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;strategy-b&quot;</span><span class="hl-2">, ... });</span><br/><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">background</span><span class="hl-2">(</span><span class="hl-4">&quot;ETHUSDT&quot;</span><span class="hl-2">, { </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;strategy-a&quot;</span><span class="hl-2">, ... });</span>
</code><button type="button">Copy</button></pre>

<p>The memoization key is <code>${symbol}:${strategyName}</code>, ensuring isolation and efficient reuse.</p>
<a id="stopping-execution" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Stopping Execution<a href="#stopping-execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>stop()</code> method sets an internal flag to prevent new signals:</p>
<pre><code class="typescript"><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">stop</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<p>The current active signal (if any) completes normally. The backtest stops at the next safe point:</p>
<ul>
<li>Before processing next timeframe</li>
<li>When strategy is idle (no signal)</li>
<li>After current signal closes</li>
</ul>
<a id="retrieving-results" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Retrieving Results<a href="#retrieving-results" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>After backtest completes, retrieve statistics and reports:</p>
<pre><code class="typescript"><span class="hl-0">// Get structured statistics</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">stats</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">getData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">stats</span><span class="hl-2">.</span><span class="hl-6">sharpeRatio</span><span class="hl-2">, </span><span class="hl-6">stats</span><span class="hl-2">.</span><span class="hl-6">winRate</span><span class="hl-2">, </span><span class="hl-6">stats</span><span class="hl-2">.</span><span class="hl-6">maxDrawdown</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Get markdown formatted report</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">markdown</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">getReport</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span><br/><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">markdown</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Save report to disk</span><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">dump</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;./custom/path&quot;</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<p>The statistics are aggregated by <code>BacktestMarkdownService</code> from all closed signals.</p>
<a id="listing-active-backtests" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Listing Active Backtests<a href="#listing-active-backtests" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Monitor all running backtest instances:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">statusList</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">list</span><span class="hl-2">();</span><br/><span class="hl-6">statusList</span><span class="hl-2">.</span><span class="hl-1">forEach</span><span class="hl-2">(</span><span class="hl-6">status</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-6">status</span><span class="hl-9">.</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4"> - </span><span class="hl-3">${</span><span class="hl-6">status</span><span class="hl-9">.</span><span class="hl-6">strategyName</span><span class="hl-3">}</span><span class="hl-4">: </span><span class="hl-3">${</span><span class="hl-6">status</span><span class="hl-9">.</span><span class="hl-6">status</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-0">// status.status can be &quot;idle&quot;, &quot;running&quot;, or &quot;done&quot;</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<a id="timeframe-generation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Timeframe Generation<a href="#timeframe-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Timeframes are generated by <code>FrameCoreService</code> based on the registered frame schema. The service produces an array of <code>Date</code> objects representing historical timestamps at the specified interval.</p>
<p>For a frame with:</p>
<ul>
<li><code>interval: &quot;1d&quot;</code> (daily)</li>
<li><code>startDate: new Date(&quot;2024-01-01&quot;)</code></li>
<li><code>endDate: new Date(&quot;2024-12-31&quot;)</code></li>
</ul>
<p>The output is:</p>
<pre><code class="typescript"><span class="hl-2">[</span><br/><span class="hl-2">  </span><span class="hl-1">Date</span><span class="hl-2">(</span><span class="hl-4">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">  </span><span class="hl-1">Date</span><span class="hl-2">(</span><span class="hl-4">&quot;2024-01-02T00:00:00Z&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">  </span><span class="hl-1">Date</span><span class="hl-2">(</span><span class="hl-4">&quot;2024-01-03T00:00:00Z&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">  </span><span class="hl-0">// ... one entry per day</span><br/><span class="hl-2">  </span><span class="hl-1">Date</span><span class="hl-2">(</span><span class="hl-4">&quot;2024-12-31T00:00:00Z&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">]</span>
</code><button type="button">Copy</button></pre>

<p>The complete array is generated upfront before iteration begins, enabling progress calculation:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">totalFrames</span><span class="hl-2"> = </span><span class="hl-6">timeframes</span><span class="hl-2">.</span><span class="hl-6">length</span><span class="hl-2">;</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">progress</span><span class="hl-2"> = </span><span class="hl-6">processedFrames</span><span class="hl-2"> / </span><span class="hl-6">totalFrames</span><span class="hl-2">;</span>
</code><button type="button">Copy</button></pre>

<a id="fast-forward-simulation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Fast-Forward Simulation<a href="#fast-forward-simulation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Fast-forward optimization is the key performance feature that distinguishes backtesting from live trading. When a signal opens, the system:</p>
<ol>
<li><strong>Fetches all candles</strong> needed for the signal's lifetime in one request</li>
<li><strong>Calls <code>backtest()</code></strong> which simulates the entire signal lifecycle using those candles</li>
<li><strong>Receives <code>closeTimestamp</code></strong> indicating when the signal closed</li>
<li><strong>Skips timeframes</strong> by advancing the index <code>i</code> until reaching or passing <code>closeTimestamp</code></li>
</ol>
<a id="performance-impact" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Performance Impact<a href="#performance-impact" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Without fast-forward:</p>
<pre><code><span class="hl-6">Process</span><span class="hl-2"> </span><span class="hl-7">365</span><span class="hl-2"> </span><span class="hl-6">daily</span><span class="hl-2"> </span><span class="hl-6">timeframes</span><br/><span class="hl-2">  → </span><span class="hl-6">Signal</span><span class="hl-2"> </span><span class="hl-6">opens</span><span class="hl-2"> </span><span class="hl-6">on</span><span class="hl-2"> </span><span class="hl-6">day</span><span class="hl-2"> </span><span class="hl-7">10</span><br/><span class="hl-2">  → </span><span class="hl-6">Signal</span><span class="hl-2"> </span><span class="hl-6">closes</span><span class="hl-2"> </span><span class="hl-6">on</span><span class="hl-2"> </span><span class="hl-6">day</span><span class="hl-2"> </span><span class="hl-7">50</span><span class="hl-2"> (</span><span class="hl-7">40</span><span class="hl-2"> </span><span class="hl-6">days</span><span class="hl-2"> </span><span class="hl-6">active</span><span class="hl-2">)</span><br/><span class="hl-2">  → </span><span class="hl-6">Call</span><span class="hl-2"> </span><span class="hl-1">tick</span><span class="hl-2">() </span><span class="hl-7">365</span><span class="hl-2"> </span><span class="hl-6">times</span><span class="hl-2"> </span><span class="hl-6">total</span>
</code><button>Copy</button></pre>

<p>With fast-forward:</p>
<pre><code><span class="hl-6">Process</span><span class="hl-2"> </span><span class="hl-7">365</span><span class="hl-2"> </span><span class="hl-6">daily</span><span class="hl-2"> </span><span class="hl-6">timeframes</span><br/><span class="hl-2">  → </span><span class="hl-6">Signal</span><span class="hl-2"> </span><span class="hl-6">opens</span><span class="hl-2"> </span><span class="hl-6">on</span><span class="hl-2"> </span><span class="hl-6">day</span><span class="hl-2"> </span><span class="hl-7">10</span><br/><span class="hl-2">  → </span><span class="hl-6">Call</span><span class="hl-2"> </span><span class="hl-1">backtest</span><span class="hl-2">() </span><span class="hl-6">once</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-7">40</span><span class="hl-2"> </span><span class="hl-6">days</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> 1</span><span class="hl-6">m</span><span class="hl-2"> </span><span class="hl-6">candles</span><br/><span class="hl-2">  → </span><span class="hl-6">Skip</span><span class="hl-2"> </span><span class="hl-6">to</span><span class="hl-2"> </span><span class="hl-6">day</span><span class="hl-2"> </span><span class="hl-7">50</span><br/><span class="hl-2">  → </span><span class="hl-6">Call</span><span class="hl-2"> </span><span class="hl-1">tick</span><span class="hl-2">() </span><span class="hl-6">only</span><span class="hl-2"> ~</span><span class="hl-7">325</span><span class="hl-2"> </span><span class="hl-6">times</span>
</code><button>Copy</button></pre>

<p>The <code>backtest()</code> method internally processes 1-minute candles to accurately simulate TP/SL/time monitoring, but this happens in a tight loop without the overhead of the outer timeframe iteration.</p>
<a id="close-timestamp-calculation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Close Timestamp Calculation<a href="#close-timestamp-calculation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>closeTimestamp</code> is determined by <code>ClientStrategy.backtest()</code> by scanning through 1-minute candles:</p>
<ul>
<li>For <strong>take profit</strong>: First candle where high &gt;= priceTakeProfit</li>
<li>For <strong>stop loss</strong>: First candle where low &lt;= priceStopLoss</li>
<li>For <strong>time expiration</strong>: Candle at minuteEstimatedTime offset</li>
<li>For <strong>scheduled activation</strong>: First candle where priceOpen is reached, then continue monitoring</li>
</ul>
<p>The timestamp is returned as milliseconds since epoch, allowing precise comparison with timeframe dates.</p>
<a id="performance-tracking" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Tracking<a href="#performance-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The backtest system emits performance metrics to identify bottlenecks:</p>
<table>
<thead>
<tr>
<th>Metric Type</th>
<th>Measured Duration</th>
<th>Trigger</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>backtest_timeframe</code></td>
<td>Single timeframe processing</td>
<td>After each timeframe</td>
</tr>
<tr>
<td><code>backtest_signal</code></td>
<td>Signal backtest execution</td>
<td>After <code>backtest()</code> completes</td>
</tr>
<tr>
<td><code>backtest_total</code></td>
<td>Entire backtest run</td>
<td>After all timeframes processed</td>
</tr>
</tbody>
</table>
<p>These metrics are emitted via <code>performanceEmitter</code> and aggregated by <code>PerformanceMarkdownService</code> for analysis. Each metric includes:</p>
<pre><code class="typescript"><span class="hl-2">{</span><br/><span class="hl-2">  </span><span class="hl-10">timestamp</span><span class="hl-2">: </span><span class="hl-6">Date</span><span class="hl-2">.</span><span class="hl-1">now</span><span class="hl-2">(),</span><br/><span class="hl-2">  </span><span class="hl-10">previousTimestamp</span><span class="hl-2">: </span><span class="hl-6">number</span><span class="hl-2"> | </span><span class="hl-3">null</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-10">metricType</span><span class="hl-2">: </span><span class="hl-4">&quot;backtest_timeframe&quot;</span><span class="hl-2"> | </span><span class="hl-4">&quot;backtest_signal&quot;</span><span class="hl-2"> | </span><span class="hl-4">&quot;backtest_total&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-10">duration</span><span class="hl-2">: </span><span class="hl-6">number</span><span class="hl-2">, </span><span class="hl-0">// milliseconds</span><br/><span class="hl-2">  </span><span class="hl-10">strategyName</span><span class="hl-2">: </span><span class="hl-6">string</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-10">exchangeName</span><span class="hl-2">: </span><span class="hl-6">string</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-10">symbol</span><span class="hl-2">: </span><span class="hl-6">string</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-10">backtest</span><span class="hl-2">: </span><span class="hl-3">true</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="error-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Error Handling<a href="#error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Errors during backtest execution are handled with recovery strategies:</p>
<a id="tick-failures" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Tick Failures<a href="#tick-failures" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If <code>tick()</code> throws an error:</p>
<ol>
<li>Log warning with error details</li>
<li>Emit error via <code>errorEmitter</code></li>
<li>Skip to next timeframe</li>
<li>Continue iteration</li>
</ol>
<pre><code class="typescript"><span class="hl-5">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">result</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">strategyCoreService</span><span class="hl-2">.</span><span class="hl-1">tick</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">when</span><span class="hl-2">, </span><span class="hl-3">true</span><span class="hl-2">);</span><br/><span class="hl-2">} </span><span class="hl-5">catch</span><span class="hl-2"> (</span><span class="hl-6">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">warn</span><span class="hl-2">(</span><span class="hl-4">`tick failed when=</span><span class="hl-3">${</span><span class="hl-6">when</span><span class="hl-9">.</span><span class="hl-1">toISOString</span><span class="hl-9">()</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">errorEmitter</span><span class="hl-2">.</span><span class="hl-1">next</span><span class="hl-2">(</span><span class="hl-6">error</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-6">i</span><span class="hl-2">++; </span><span class="hl-0">// Skip this timeframe</span><br/><span class="hl-2">  </span><span class="hl-5">continue</span><span class="hl-2">;</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="candle-fetch-failures" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Candle Fetch Failures<a href="#candle-fetch-failures" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If <code>getNextCandles()</code> fails:</p>
<ol>
<li>Log warning with requested candle count</li>
<li>Emit error via <code>errorEmitter</code></li>
<li>Skip to next timeframe</li>
<li>Continue iteration</li>
</ol>
<p>This prevents a single data fetch error from terminating the entire backtest.</p>
<a id="backtest-failures" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Failures<a href="#backtest-failures" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If <code>backtest()</code> throws an error:</p>
<ol>
<li>Log warning with signal details</li>
<li>Emit error via <code>errorEmitter</code></li>
<li>Skip to next timeframe</li>
<li>Continue iteration</li>
</ol>
<p>The signal is effectively abandoned, and processing continues with remaining timeframes.</p>
<a id="validation-requirements" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Requirements<a href="#validation-requirements" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Before a backtest runs, all components must be registered and validated:</p>
<p><img src="../media/54_Backtesting_2.svg" alt="Mermaid Diagram"></p>
<p>If any validation fails, an error is thrown immediately before execution begins. This fail-fast approach ensures configuration errors are caught early.</p>
<a id="progress-reporting" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Progress Reporting<a href="#progress-reporting" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The backtest engine emits progress events as it processes timeframes:</p>
<pre><code class="typescript"><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">progressBacktestEmitter</span><span class="hl-2">.</span><span class="hl-1">next</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-6">string</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-6">string</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">symbol:</span><span class="hl-2"> </span><span class="hl-6">string</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">totalFrames:</span><span class="hl-2"> </span><span class="hl-6">number</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">processedFrames:</span><span class="hl-2"> </span><span class="hl-6">number</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">progress:</span><span class="hl-2"> </span><span class="hl-6">number</span><span class="hl-2"> </span><span class="hl-0">// 0.0 to 1.0</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<p>Progress events are emitted:</p>
<ul>
<li>At the start of each timeframe iteration</li>
<li>At 100% when all timeframes are processed</li>
</ul>
<p>Consumers can subscribe to these events for UI updates or monitoring:</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">listenProgressBacktest</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&quot;backtest-kit&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-1">listenProgressBacktest</span><span class="hl-2">((</span><span class="hl-6">event</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">: </span><span class="hl-3">${</span><span class="hl-9">(</span><span class="hl-6">event</span><span class="hl-9">.</span><span class="hl-6">progress</span><span class="hl-9"> </span><span class="hl-2">*</span><span class="hl-9"> </span><span class="hl-7">100</span><span class="hl-9">).</span><span class="hl-1">toFixed</span><span class="hl-9">(</span><span class="hl-7">1</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">%`</span><span class="hl-2">);</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<a id="results-and-statistics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Results and Statistics<a href="#results-and-statistics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest results are aggregated by <code>BacktestMarkdownService</code> and include comprehensive statistics:</p>
<table>
<thead>
<tr>
<th>Statistic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>totalSignals</code></td>
<td>Total closed and cancelled signals</td>
</tr>
<tr>
<td><code>closedSignals</code></td>
<td>Signals that hit TP/SL/time</td>
</tr>
<tr>
<td><code>cancelledSignals</code></td>
<td>Scheduled signals that cancelled</td>
</tr>
<tr>
<td><code>winRate</code></td>
<td>Percentage of profitable closed signals</td>
</tr>
<tr>
<td><code>avgPnl</code></td>
<td>Average PNL across all closed signals</td>
</tr>
<tr>
<td><code>maxDrawdown</code></td>
<td>Maximum consecutive loss</td>
</tr>
<tr>
<td><code>sharpeRatio</code></td>
<td>Risk-adjusted return metric</td>
</tr>
<tr>
<td><code>totalPnl</code></td>
<td>Sum of all signal PNLs</td>
</tr>
<tr>
<td><code>totalFees</code></td>
<td>Sum of all fees paid</td>
</tr>
</tbody>
</table>
<p>These statistics are calculated from the stream of closed signals and are accessible via:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">stats</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">getData</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<p>Markdown reports provide formatted tables with signal details, timing, PNL breakdown, and summary statistics.</p>
<a id="memory-efficiency" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Memory Efficiency<a href="#memory-efficiency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The backtest engine is designed for memory efficiency through streaming:</p>
<ol>
<li><strong>Generator Pattern</strong>: Results are yielded one at a time, not accumulated in arrays</li>
<li><strong>No Persistence</strong>: State is not written to disk, reducing I/O overhead</li>
<li><strong>Candle Deallocation</strong>: Fetched candles are used once in <code>backtest()</code> then released</li>
<li><strong>Timeframe Reuse</strong>: The timeframe array is allocated once and reused via index</li>
</ol>
<p>For long backtests with thousands of timeframes, this approach prevents memory growth and enables processing of arbitrarily large historical periods.</p>
<a id="comparison-with-live-trading" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Comparison with Live Trading<a href="#comparison-with-live-trading" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Key differences in implementation:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Backtest</th>
<th>Live</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Time progression</strong></td>
<td><code>timeframes[i++]</code></td>
<td><code>new Date()</code></td>
</tr>
<tr>
<td><strong>Loop condition</strong></td>
<td><code>while (i &lt; timeframes.length)</code></td>
<td><code>while (true)</code></td>
</tr>
<tr>
<td><strong>Signal processing</strong></td>
<td><code>backtest()</code> fast-forward</td>
<td><code>tick()</code> continuous monitoring</td>
</tr>
<tr>
<td><strong>Results yielded</strong></td>
<td><code>closed</code>, <code>cancelled</code> only</td>
<td><code>opened</code>, <code>closed</code></td>
</tr>
<tr>
<td><strong>Persistence</strong></td>
<td>None</td>
<td><code>PersistSignalAdapter</code></td>
</tr>
<tr>
<td><strong>Delay between iterations</strong></td>
<td>None</td>
<td><code>sleep(TICK_TTL)</code></td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>CPU-bound, fast</td>
<td>I/O-bound, slow</td>
</tr>
</tbody>
</table>
<p>Both modes share the same <code>ClientStrategy</code> core logic, ensuring consistent signal validation and PNL calculation.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#backtesting"><span>Backtesting</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#overview"><span>Overview</span></a></li><li><a href="#system-architecture"><span>System <wbr/>Architecture</span></a></li><li><a href="#execution-flow"><span>Execution <wbr/>Flow</span></a></li><li><ul><li><a href="#1-initialization-phase"><span>1. <wbr/>Initialization <wbr/>Phase</span></a></li><li><a href="#2-iteration-loop"><span>2. <wbr/>Iteration <wbr/>Loop</span></a></li><li><a href="#3-signal-processing"><span>3. <wbr/>Signal <wbr/>Processing</span></a></li><li><a href="#4-candle-fetching-strategy"><span>4. <wbr/>Candle <wbr/>Fetching <wbr/>Strategy</span></a></li><li><a href="#5-fast-forward-optimization"><span>5. <wbr/>Fast-<wbr/>Forward <wbr/>Optimization</span></a></li><li><a href="#6-result-yielding"><span>6. <wbr/>Result <wbr/>Yielding</span></a></li><li><a href="#7-stop-handling"><span>7. <wbr/>Stop <wbr/>Handling</span></a></li></ul></li><li><a href="#public-api-usage"><span>Public API <wbr/>Usage</span></a></li><li><ul><li><a href="#basic-usage-with-run"><span>Basic <wbr/>Usage with run()</span></a></li><li><a href="#background-execution"><span>Background <wbr/>Execution</span></a></li><li><a href="#instance-isolation"><span>Instance <wbr/>Isolation</span></a></li><li><a href="#stopping-execution"><span>Stopping <wbr/>Execution</span></a></li><li><a href="#retrieving-results"><span>Retrieving <wbr/>Results</span></a></li><li><a href="#listing-active-backtests"><span>Listing <wbr/>Active <wbr/>Backtests</span></a></li></ul></li><li><a href="#timeframe-generation"><span>Timeframe <wbr/>Generation</span></a></li><li><a href="#fast-forward-simulation"><span>Fast-<wbr/>Forward <wbr/>Simulation</span></a></li><li><ul><li><a href="#performance-impact"><span>Performance <wbr/>Impact</span></a></li><li><a href="#close-timestamp-calculation"><span>Close <wbr/>Timestamp <wbr/>Calculation</span></a></li></ul></li><li><a href="#performance-tracking"><span>Performance <wbr/>Tracking</span></a></li><li><a href="#error-handling"><span>Error <wbr/>Handling</span></a></li><li><ul><li><a href="#tick-failures"><span>Tick <wbr/>Failures</span></a></li><li><a href="#candle-fetch-failures"><span>Candle <wbr/>Fetch <wbr/>Failures</span></a></li><li><a href="#backtest-failures"><span>Backtest <wbr/>Failures</span></a></li></ul></li><li><a href="#validation-requirements"><span>Validation <wbr/>Requirements</span></a></li><li><a href="#progress-reporting"><span>Progress <wbr/>Reporting</span></a></li><li><a href="#results-and-statistics"><span>Results and <wbr/>Statistics</span></a></li><li><a href="#memory-efficiency"><span>Memory <wbr/>Efficiency</span></a></li><li><a href="#comparison-with-live-trading"><span>Comparison with <wbr/>Live <wbr/>Trading</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
