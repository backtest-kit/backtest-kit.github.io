<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/17_backtest-mode | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_17_backtest-mode.html">design/17_backtest-mode</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="backtest-mode" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Backtest Mode<a href="#backtest-mode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This document describes the <strong>Backtest Mode</strong> execution system in backtest-kit, which simulates historical trading by iterating through pre-generated timeframes and processing trading signals against historical market data. Backtest Mode enables strategy validation and performance analysis without real-time market interaction.</p>
<p>For real-time trading execution with crash recovery, see <a href="design_18_live-trading-mode.html">Live Trading Mode</a>. For comparing multiple strategies, see <a href="design_19_walker-mode.html">Walker Mode</a>. For strategy lifecycle and signal generation, see <a href="design_13_strategy-execution-flow.html">Strategy Execution Flow</a>.</p>
<hr>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Mode processes historical market data by generating a fixed array of timeframes (e.g., every 1 minute for 30 days) and iterating through them sequentially. When a signal opens, the system fetches historical candle data and applies fast candle processing to determine the close reason (take profit, stop loss, or time expiration). A key optimization is skipping timeframes after signal closure until the <code>closeTimestamp</code>, significantly reducing computation time.</p>
<p>The system uses async generators for memory efficiency, yielding closed signals without accumulating results in memory. This enables early termination via loop breaks and streaming processing of large historical datasets.</p>
<p><strong>Key Characteristics:</strong></p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Data Source</strong></td>
<td>Historical market data via ExchangeCoreService</td>
</tr>
<tr>
<td><strong>Iteration</strong></td>
<td>Sequential timeframe array from FrameCoreService</td>
</tr>
<tr>
<td><strong>Signal Processing</strong></td>
<td>Fast candle processing with TP/SL/time monitoring</td>
</tr>
<tr>
<td><strong>Optimization</strong></td>
<td>Skip-to-close timestamp after signal completion</td>
</tr>
<tr>
<td><strong>Memory Model</strong></td>
<td>Async generator yielding closed signals only</td>
</tr>
<tr>
<td><strong>Completion</strong></td>
<td>Finite - ends when all timeframes processed</td>
</tr>
<tr>
<td><strong>State Persistence</strong></td>
<td>None - stateless execution</td>
</tr>
</tbody>
</table>
<hr>
<a id="architecture-components" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Components<a href="#architecture-components" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/17-backtest-mode_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Component Responsibilities:</strong></p>
<table>
<thead>
<tr>
<th>Component</th>
<th>File</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BacktestUtils</code></td>
<td><a href="">src/classes/Backtest.ts:355-593</a></td>
<td>Singleton API with validation and instance management</td>
</tr>
<tr>
<td><code>BacktestInstance</code></td>
<td><a href="">src/classes/Backtest.ts:73-334</a></td>
<td>Isolated execution context per symbol-strategy pair</td>
</tr>
<tr>
<td><code>BacktestCommandService</code></td>
<td>Service layer</td>
<td>Validates schemas and delegates to logic layer</td>
</tr>
<tr>
<td><code>BacktestLogicPublicService</code></td>
<td>Logic layer</td>
<td>Sets up MethodContext and ExecutionContext</td>
</tr>
<tr>
<td><code>BacktestLogicPrivateService</code></td>
<td><a href="">src/lib/services/logic/private/BacktestLogicPrivateService.ts:33-480</a></td>
<td>Core async generator orchestrating timeframe iteration</td>
</tr>
<tr>
<td><code>StrategyCoreService</code></td>
<td>Core services</td>
<td>Executes <code>tick()</code> and <code>backtest()</code> methods on strategies</td>
</tr>
<tr>
<td><code>ExchangeCoreService</code></td>
<td>Core services</td>
<td>Fetches historical candle data with buffering</td>
</tr>
<tr>
<td><code>FrameCoreService</code></td>
<td>Core services</td>
<td>Generates timeframe array for iteration</td>
</tr>
</tbody>
</table>
<hr>
<a id="execution-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Execution Flow<a href="#execution-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/17-backtest-mode_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Execution Phases:</strong></p>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Description</th>
<th>Key Operations</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1. Initialization</strong></td>
<td>Setup and validation</td>
<td>Validate schemas, clear state, create instance</td>
</tr>
<tr>
<td><strong>2. Timeframe Generation</strong></td>
<td>Create iteration array</td>
<td><code>FrameCoreService.getTimeframe()</code> returns <code>Date[]</code></td>
</tr>
<tr>
<td><strong>3. Sequential Iteration</strong></td>
<td>Loop through timeframes</td>
<td><code>while (i &lt; timeframes.length)</code> at <a href="">BacktestLogicPrivateService.ts:78</a></td>
</tr>
<tr>
<td><strong>4. Tick Processing</strong></td>
<td>Check signal status</td>
<td><code>StrategyCoreService.tick(symbol, when, true)</code></td>
</tr>
<tr>
<td><strong>5. Signal Opening</strong></td>
<td>Handle new signal</td>
<td>Fetch candles, call <code>backtest()</code>, yield closed result</td>
</tr>
<tr>
<td><strong>6. Timeframe Skipping</strong></td>
<td>Optimization</td>
<td>Skip to <code>closeTimestamp</code> via <a href="">BacktestLogicPrivateService.ts:403-409</a></td>
</tr>
<tr>
<td><strong>7. Progress Emission</strong></td>
<td>Monitoring</td>
<td>Emit events at <a href="">BacktestLogicPrivateService.ts:84-92</a></td>
</tr>
<tr>
<td><strong>8. Completion</strong></td>
<td>Finalize</td>
<td>Emit <code>doneBacktestSubject</code> at <a href="">BacktestLogicPrivateService.ts:452-461</a></td>
</tr>
</tbody>
</table>
<hr>
<a id="timeframe-iteration-and-skip-optimization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Timeframe Iteration and Skip Optimization<a href="#timeframe-iteration-and-skip-optimization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The backtest generator iterates through a pre-generated array of <code>Date</code> objects representing discrete time points. The <code>FrameCoreService</code> generates this array based on the frame configuration (e.g., every 1 minute from startDate to endDate).</p>
<p><strong>Timeframe Generation:</strong></p>
<p><img src="../media/17-backtest-mode_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Skip-to-Close Optimization:</strong></p>
<p>When a signal closes at timestamp <code>closeTimestamp</code>, the iterator skips all intermediate timeframes until reaching or passing that timestamp. This is implemented at <a href="">BacktestLogicPrivateService.ts:403-409</a>:</p>
<pre><code class="typescript"><span class="hl-5">// Skip timeframes until closeTimestamp</span><br/><span class="hl-3">while</span><span class="hl-1"> (</span><br/><span class="hl-1">  </span><span class="hl-4">i</span><span class="hl-1"> &lt; </span><span class="hl-4">timeframes</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">  </span><span class="hl-4">timeframes</span><span class="hl-1">[</span><span class="hl-4">i</span><span class="hl-1">].</span><span class="hl-0">getTime</span><span class="hl-1">() &lt; </span><span class="hl-4">backtestResult</span><span class="hl-1">.</span><span class="hl-4">closeTimestamp</span><br/><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">i</span><span class="hl-1">++;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Performance Impact:</strong></p>
<p>For a signal with <code>minuteEstimatedTime = 60</code> (1 hour), instead of calling <code>tick()</code> 60 times (once per minute), the system:</p>
<ol>
<li>Calls <code>tick()</code> once (signal opens)</li>
<li>Fetches 60 candles in one request</li>
<li>Processes all candles via <code>backtest()</code> method</li>
<li>Skips 60 timeframe iterations</li>
<li>Resumes iteration after the signal closes</li>
</ol>
<p>This reduces computational overhead by ~60x for typical signals.</p>
<hr>
<a id="signal-processing-tick-and-backtest" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Processing: tick() and backtest()<a href="#signal-processing-tick-and-backtest" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Mode uses two distinct methods for signal processing:</p>
<a id="tick-method" class="tsd-anchor"></a><h3 class="tsd-anchor-link">tick() Method<a href="#tick-method" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Called once per timeframe to determine signal state. Returns a discriminated union <code>IStrategyTickResult</code> with possible actions: <code>idle</code>, <code>opened</code>, <code>active</code>, <code>scheduled</code>, <code>closed</code>, <code>cancelled</code>.</p>
<p><strong>Invocation:</strong>
<a href="">BacktestLogicPrivateService.ts:115</a> calls:</p>
<pre><code class="typescript"><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">strategyCoreService</span><span class="hl-1">.</span><span class="hl-0">tick</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">, </span><span class="hl-7">true</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The third parameter <code>true</code> indicates backtest mode, affecting:</p>
<ul>
<li>VWAP calculation uses historical data</li>
<li>No persistence to disk</li>
<li>ExecutionContext has <code>backtest: true</code></li>
</ul>
<a id="backtest-method" class="tsd-anchor"></a><h3 class="tsd-anchor-link">backtest() Method<a href="#backtest-method" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Called once per signal (after <code>opened</code> or <code>scheduled</code>) to process all candles until signal closes. This method:</p>
<ol>
<li>Iterates through candle array sequentially</li>
<li>Calculates VWAP for each candle</li>
<li>Checks TP/SL/time conditions</li>
<li>Returns <code>IStrategyBacktestResult</code> (always <code>action: &quot;closed&quot;</code> or <code>action: &quot;cancelled&quot;</code>)</li>
</ol>
<p><strong>Invocation for Opened Signals:</strong>
<a href="">BacktestLogicPrivateService.ts:361-366</a>:</p>
<pre><code class="typescript"><span class="hl-4">backtestResult</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">strategyCoreService</span><span class="hl-1">.</span><span class="hl-0">backtest</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">candles</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">when</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">true</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Invocation for Scheduled Signals:</strong>
<a href="">BacktestLogicPrivateService.ts:223-228</a>:</p>
<pre><code class="typescript"><span class="hl-4">backtestResult</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">strategyCoreService</span><span class="hl-1">.</span><span class="hl-0">backtest</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">candles</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">when</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">true</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The <code>backtest()</code> method handles both regular and scheduled signals, automatically detecting activation conditions for scheduled signals before proceeding to TP/SL monitoring.</p>
<hr>
<a id="fast-candle-processing-and-buffering" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Fast Candle Processing and Buffering<a href="#fast-candle-processing-and-buffering" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When a signal opens, the system must fetch sufficient historical candles to:</p>
<ol>
<li>Provide VWAP calculation buffer (preceding candles)</li>
<li>Process the entire signal duration (until TP/SL/time)</li>
</ol>
<a id="buffer-calculation-for-opened-signals" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Buffer Calculation for Opened Signals<a href="#buffer-calculation-for-opened-signals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="">BacktestLogicPrivateService.ts:315-328</a>:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">bufferMinutes</span><span class="hl-1"> = </span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-1">.</span><span class="hl-8">CC_AVG_PRICE_CANDLES_COUNT</span><span class="hl-1"> - </span><span class="hl-6">1</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">bufferStartTime</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-4">when</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">() - </span><span class="hl-4">bufferMinutes</span><span class="hl-1"> * </span><span class="hl-6">60</span><span class="hl-1"> * </span><span class="hl-6">1000</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">totalCandles</span><span class="hl-1"> = </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">minuteEstimatedTime</span><span class="hl-1"> + </span><span class="hl-4">bufferMinutes</span><span class="hl-1">;</span><br/><br/><span class="hl-4">candles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">exchangeCoreService</span><span class="hl-1">.</span><span class="hl-0">getNextCandles</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">totalCandles</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">bufferStartTime</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">true</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Example:</strong></p>
<ul>
<li><code>when = 2024-01-15 10:00:00</code></li>
<li><code>CC_AVG_PRICE_CANDLES_COUNT = 5</code> (need 5 candles for VWAP)</li>
<li><code>minuteEstimatedTime = 60</code> (signal duration)</li>
</ul>
<p>The system fetches:</p>
<ul>
<li>Buffer: 4 candles before <code>when</code> (09:56, 09:57, 09:58, 09:59)</li>
<li>Signal: 60 candles from <code>when</code> onward (10:00 through 10:59)</li>
<li>Total: 64 candles in one request</li>
</ul>
<a id="buffer-calculation-for-scheduled-signals" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Buffer Calculation for Scheduled Signals<a href="#buffer-calculation-for-scheduled-signals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="">BacktestLogicPrivateService.ts:174-176</a>:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">bufferMinutes</span><span class="hl-1"> = </span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-1">.</span><span class="hl-8">CC_AVG_PRICE_CANDLES_COUNT</span><span class="hl-1"> - </span><span class="hl-6">1</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">bufferStartTime</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-4">when</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">() - </span><span class="hl-4">bufferMinutes</span><span class="hl-1"> * </span><span class="hl-6">60</span><span class="hl-1"> * </span><span class="hl-6">1000</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candlesNeeded</span><span class="hl-1"> = </span><span class="hl-4">bufferMinutes</span><span class="hl-1"> + </span><span class="hl-8">GLOBAL_CONFIG</span><span class="hl-1">.</span><span class="hl-8">CC_SCHEDULE_AWAIT_MINUTES</span><span class="hl-1"> + </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">minuteEstimatedTime</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>Scheduled signals require additional candles for the await period (<code>CC_SCHEDULE_AWAIT_MINUTES</code>) before potential activation.</p>
<a id="vwap-calculation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">VWAP Calculation<a href="#vwap-calculation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The buffer ensures that when processing the first candle at timestamp <code>when</code>, there are already 4 preceding candles in memory to calculate VWAP using the last 5 candles (including the current one). This maintains consistency with live mode, where VWAP always uses the most recent <code>CC_AVG_PRICE_CANDLES_COUNT</code> candles.</p>
<hr>
<a id="generator-pattern-and-memory-efficiency" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Generator Pattern and Memory Efficiency<a href="#generator-pattern-and-memory-efficiency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Mode uses async generators to stream results without accumulating them in memory. This enables:</p>
<ol>
<li><strong>Early Termination:</strong> Consumers can break out of the loop at any point</li>
<li><strong>Memory Bounds:</strong> Only current signal data held in memory, not entire backtest history</li>
<li><strong>Progressive Processing:</strong> Results available as soon as each signal closes</li>
</ol>
<a id="generator-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Generator Implementation<a href="#generator-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="">BacktestLogicPrivateService.ts:62-477</a> defines:</p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> *</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">// ... initialization</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">while</span><span class="hl-1"> (</span><span class="hl-4">i</span><span class="hl-1"> &lt; </span><span class="hl-4">timeframes</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// ... process timeframe</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-5">// ... fetch candles, call backtest()</span><br/><span class="hl-1">      </span><span class="hl-3">yield</span><span class="hl-1"> </span><span class="hl-4">backtestResult</span><span class="hl-1">; </span><span class="hl-5">// Yield point</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-4">i</span><span class="hl-1">++;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="consumer-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Consumer Patterns<a href="#consumer-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Pattern 1: Process All Results</strong></p>
<pre><code class="typescript"><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">)) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Pattern 2: Early Termination</strong></p>
<pre><code class="typescript"><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">)) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &lt; -</span><span class="hl-6">10</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">break</span><span class="hl-1">; </span><span class="hl-5">// Stop backtest if cumulative loss exceeds 10%</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Pattern 3: Background Execution</strong>
<a href="">Backtest.ts:199-234</a> implements <code>background()</code> which consumes the generator internally:</p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">background</span><span class="hl-1"> = (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">: {...}) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">task</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">).</span><span class="hl-0">catch</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">exitEmitter</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-0">getErrorMessage</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">)))</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> { </span><span class="hl-5">/* cancellation logic */</span><span class="hl-1"> };</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<a id="memory-comparison" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memory Comparison<a href="#memory-comparison" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Approach</th>
<th>Memory Usage</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Array Accumulation</strong></td>
<td>O(n) where n = total signals</td>
<td><code>results = []</code> then <code>results.push(signal)</code></td>
</tr>
<tr>
<td><strong>Generator (Current)</strong></td>
<td>O(1) constant per signal</td>
<td><code>yield signal</code> without storage</td>
</tr>
</tbody>
</table>
<p>For a 30-day backtest with 100 signals, the generator approach uses ~99% less memory for result storage.</p>
<hr>
<a id="event-system-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event System Integration<a href="#event-system-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Mode emits events throughout execution for monitoring and reporting:</p>
<p><img src="../media/17-backtest-mode_3.svg" alt="Mermaid Diagram"></p>
<a id="event-types-and-timing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Types and Timing<a href="#event-types-and-timing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Event</th>
<th>Emitted By</th>
<th>Timing</th>
<th>Payload</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>progressBacktestEmitter</code></td>
<td><a href="">BacktestLogicPrivateService.ts:84-92</a></td>
<td>Every timeframe</td>
<td><code>{processedFrames, totalFrames, progress, symbol, strategyName, exchangeName}</code></td>
</tr>
<tr>
<td><code>signalBacktestEmitter</code></td>
<td><code>StrategyCoreService</code> (indirectly)</td>
<td>Signal closes</td>
<td><code>IStrategyTickResultClosed</code></td>
</tr>
<tr>
<td><code>performanceEmitter</code></td>
<td><a href="">BacktestLogicPrivateService.ts:391-401</a></td>
<td>Signal/timeframe/total</td>
<td><code>{duration, metricType, timestamp, strategyName, exchangeName, symbol, backtest: true}</code></td>
</tr>
<tr>
<td><code>doneBacktestSubject</code></td>
<td><a href="">BacktestLogicPrivateService.ts:452-461</a> or <a href="">Backtest.ts:44-50</a></td>
<td>Completion</td>
<td><code>{symbol, strategyName, exchangeName, backtest: true}</code></td>
</tr>
<tr>
<td><code>errorEmitter</code></td>
<td><a href="">BacktestLogicPrivateService.ts:126</a></td>
<td>Recoverable errors</td>
<td><code>Error</code> object</td>
</tr>
</tbody>
</table>
<a id="listening-to-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Listening to Events<a href="#listening-to-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Users can subscribe via public API functions:</p>
<pre><code class="typescript"><span class="hl-0">listenSignalBacktest</span><span class="hl-1">((</span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal closed: </span><span class="hl-7">${</span><span class="hl-4">result</span><span class="hl-9">.</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">listenBacktestProgress</span><span class="hl-1">((</span><span class="hl-4">progress</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Progress: </span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">processedFrames</span><span class="hl-7">}</span><span class="hl-2">/</span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">totalFrames</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">listenDoneBacktest</span><span class="hl-1">((</span><span class="hl-4">done</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Backtest complete for </span><span class="hl-7">${</span><span class="hl-4">done</span><span class="hl-9">.</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="public-api-methods" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Public API Methods<a href="#public-api-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="run" class="tsd-anchor"></a><h3 class="tsd-anchor-link">run()<a href="#run" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Returns an async generator that yields closed signals. Intended for direct consumption by user code.</p>
<p><strong>Signature:</strong></p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1"> = (</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">context</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">AsyncGenerator</span><span class="hl-1">&lt;</span><span class="hl-4">IStrategyBacktestResult</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Usage:</strong></p>
<pre><code class="typescript"><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="background" class="tsd-anchor"></a><h3 class="tsd-anchor-link">background()<a href="#background" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Consumes the generator internally without exposing results. Returns a cancellation function. Useful for running backtests for side effects (callbacks, event listeners, report generation).</p>
<p><strong>Signature:</strong></p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">background</span><span class="hl-1"> = (</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">context</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span>
</code><button type="button">Copy</button></pre>

<p><strong>Usage:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">cancel</span><span class="hl-1"> = </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Later, to stop:</span><br/><span class="hl-0">cancel</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="stop" class="tsd-anchor"></a><h3 class="tsd-anchor-link">stop()<a href="#stop" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Sets internal flag to prevent strategy from generating new signals. Current active signal completes normally. Backtest stops at next safe point (idle state or after signal closes).</p>
<p><strong>Signature:</strong></p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">stop</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">StrategyName</span><br/><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">void</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="getdata" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getData()<a href="#getdata" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Retrieves statistical data calculated from all closed signals.</p>
<p><strong>Signature:</strong></p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">getData</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">StrategyName</span><br/><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">&lt;</span><span class="hl-4">BacktestStatistics</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Returns:</strong> <code>BacktestStatistics</code> object with metrics like <code>sharpeRatio</code>, <code>winRate</code>, <code>totalPnl</code>, etc.</p>
<a id="getreport" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getReport()<a href="#getreport" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Generates markdown-formatted report with signal table and statistics.</p>
<p><strong>Signature:</strong></p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">getReport</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">StrategyName</span><br/><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="dump" class="tsd-anchor"></a><h3 class="tsd-anchor-link">dump()<a href="#dump" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Saves markdown report to disk at specified path (default: <code>./dump/backtest/</code>).</p>
<p><strong>Signature:</strong></p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">dump</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">StrategyName</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">path</span><span class="hl-1">?: </span><span class="hl-13">string</span><br/><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">void</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="list" class="tsd-anchor"></a><h3 class="tsd-anchor-link">list()<a href="#list" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Lists all active backtest instances with their current status (<code>idle</code>, <code>running</code>, or <code>done</code>).</p>
<p><strong>Signature:</strong></p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">list</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">&lt;</span><span class="hl-0">Array</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">StrategyName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">status</span><span class="hl-1">: </span><span class="hl-2">&#39;idle&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;running&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;done&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">}&gt;&gt;</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="instance-management-and-isolation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Instance Management and Isolation<a href="#instance-management-and-isolation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>Backtest</code> singleton uses memoization to create isolated <code>BacktestInstance</code> objects per symbol-strategy pair. This ensures that multiple concurrent backtests don't interfere with each other.</p>
<a id="memoization-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoization Pattern<a href="#memoization-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="">Backtest.ts:360-365</a>:</p>
<pre><code class="typescript"><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">_getInstance</span><span class="hl-1"> = </span><span class="hl-4">memoize</span><span class="hl-1">&lt;</span><br/><span class="hl-1">  (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">StrategyName</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">BacktestInstance</span><br/><span class="hl-1">&gt;(</span><br/><span class="hl-1">  ([</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">:</span><span class="hl-7">${</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">  (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">StrategyName</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">BacktestInstance</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">)</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key:</strong> <code>&quot;${symbol}:${strategyName}&quot;</code> (e.g., <code>&quot;BTCUSDT:my-strategy&quot;</code>)</p>
<p><strong>Result:</strong> Each unique symbol-strategy combination gets exactly one <code>BacktestInstance</code>, cached for the lifetime of the process.</p>
<a id="state-isolation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">State Isolation<a href="#state-isolation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each <code>BacktestInstance</code> maintains isolated state:</p>
<p><a href="">Backtest.ts:161-174</a>:</p>
<pre><code class="typescript"><span class="hl-5">// Clear markdown services</span><br/><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">backtestMarkdownService</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1"> });</span><br/><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">scheduleMarkdownService</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// Clear strategy state</span><br/><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategyCoreService</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// Clear risk state</span><br/><span class="hl-7">const</span><span class="hl-1"> { </span><span class="hl-8">riskName</span><span class="hl-1">, </span><span class="hl-8">riskList</span><span class="hl-1"> } = </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategySchemaService</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-4">riskName</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">riskGlobalService</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">(</span><span class="hl-4">riskName</span><span class="hl-1">);</span><br/><span class="hl-4">riskList</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">riskList</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-4">riskName</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">riskGlobalService</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">(</span><span class="hl-4">riskName</span><span class="hl-1">));</span>
</code><button type="button">Copy</button></pre>

<p>This clearing happens at the start of each <code>run()</code> call, ensuring clean state for repeated backtests.</p>
<a id="concurrent-execution" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Concurrent Execution<a href="#concurrent-execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The memoization pattern enables:</p>
<pre><code class="typescript"><span class="hl-5">// These run independently without interference</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">gen1</span><span class="hl-1"> = </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, { </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;strategy-1&quot;</span><span class="hl-1">, ... });</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">gen2</span><span class="hl-1"> = </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;ETHUSDT&quot;</span><span class="hl-1">, { </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;strategy-1&quot;</span><span class="hl-1">, ... });</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">gen3</span><span class="hl-1"> = </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, { </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;strategy-2&quot;</span><span class="hl-1">, ... });</span>
</code><button type="button">Copy</button></pre>

<p>Each generator maintains its own iteration state (<code>i</code> variable in <code>BacktestLogicPrivateService</code>).</p>
<hr>
<a id="performance-optimizations" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Optimizations<a href="#performance-optimizations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Mode implements several optimizations for fast execution:</p>
<table>
<thead>
<tr>
<th>Optimization</th>
<th>Implementation</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Skip-to-Close</strong></td>
<td><a href="">BacktestLogicPrivateService.ts:403-409</a></td>
<td>Reduces iterations by ~60x per signal</td>
</tr>
<tr>
<td><strong>Single Candle Fetch</strong></td>
<td><a href="">BacktestLogicPrivateService.ts:323-329</a></td>
<td>Fetches entire signal duration in one request</td>
</tr>
<tr>
<td><strong>Fast Candle Processing</strong></td>
<td><code>backtest()</code> method replaces repeated <code>tick()</code> calls</td>
<td>O(n) instead of O(n) for monitoring</td>
</tr>
<tr>
<td><strong>Async Generator</strong></td>
<td>Streaming results without accumulation</td>
<td>O(1) memory per signal vs O(n) total</td>
</tr>
<tr>
<td><strong>Memoized Clients</strong></td>
<td>Connection services cache instances</td>
<td>Avoids repeated object creation</td>
</tr>
<tr>
<td><strong>VWAP Buffer</strong></td>
<td>Pre-fetch buffer candles</td>
<td>Eliminates additional requests during signal</td>
</tr>
<tr>
<td><strong>Early Termination</strong></td>
<td>User can break generator loop</td>
<td>Stops computation immediately</td>
</tr>
<tr>
<td><strong>Progress Tracking</strong></td>
<td><a href="">BacktestLogicPrivateService.ts:84-92</a></td>
<td>Enables progress bars without overhead</td>
</tr>
</tbody>
</table>
<a id="performance-metrics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Performance Metrics<a href="#performance-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The system tracks duration metrics via <code>performanceEmitter</code>:</p>
<p><img src="../media/17-backtest-mode_4.svg" alt="Mermaid Diagram"></p>
<p>Metrics emitted at:</p>
<ul>
<li><a href="">BacktestLogicPrivateService.ts:436-446</a> - Timeframe duration</li>
<li><a href="">BacktestLogicPrivateService.ts:391-401</a> - Signal duration</li>
<li><a href="">BacktestLogicPrivateService.ts:466-476</a> - Total backtest duration</li>
</ul>
<hr>
<a id="validation-and-error-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation and Error Handling<a href="#validation-and-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Before execution, Backtest Mode validates all schema references:</p>
<a id="validation-sequence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Sequence<a href="#validation-sequence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="">Backtest.ts:382-392</a>:</p>
<pre><code class="typescript"><span class="hl-5">// Validate strategy exists</span><br/><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategyValidationService</span><span class="hl-1">.</span><span class="hl-0">validate</span><span class="hl-1">(</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-8">BACKTEST_METHOD_NAME_RUN</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Validate exchange exists</span><br/><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">exchangeValidationService</span><span class="hl-1">.</span><span class="hl-0">validate</span><span class="hl-1">(</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-8">BACKTEST_METHOD_NAME_RUN</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Validate frame exists</span><br/><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">frameValidationService</span><span class="hl-1">.</span><span class="hl-0">validate</span><span class="hl-1">(</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">frameName</span><span class="hl-1">, </span><span class="hl-8">BACKTEST_METHOD_NAME_RUN</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Validate risk profiles if specified</span><br/><span class="hl-7">const</span><span class="hl-1"> { </span><span class="hl-8">riskName</span><span class="hl-1">, </span><span class="hl-8">riskList</span><span class="hl-1"> } = </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategySchemaService</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-4">riskName</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">riskValidationService</span><span class="hl-1">.</span><span class="hl-0">validate</span><span class="hl-1">(</span><span class="hl-4">riskName</span><span class="hl-1">, </span><span class="hl-8">BACKTEST_METHOD_NAME_RUN</span><span class="hl-1">);</span><br/><span class="hl-4">riskList</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">riskList</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-4">riskName</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">riskValidationService</span><span class="hl-1">.</span><span class="hl-0">validate</span><span class="hl-1">(</span><span class="hl-4">riskName</span><span class="hl-1">, </span><span class="hl-8">BACKTEST_METHOD_NAME_RUN</span><span class="hl-1">));</span>
</code><button type="button">Copy</button></pre>

<a id="error-handling-during-execution" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Handling During Execution<a href="#error-handling-during-execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Errors during timeframe iteration are caught and handled gracefully:</p>
<p><a href="">BacktestLogicPrivateService.ts:114-129</a>:</p>
<pre><code class="typescript"><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">strategyCoreService</span><span class="hl-1">.</span><span class="hl-0">tick</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">, </span><span class="hl-7">true</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`backtestLogicPrivateService tick failed, skipping timeframe...`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">&quot;backtestLogicPrivateService tick failed, skipping timeframe&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">when:</span><span class="hl-1"> </span><span class="hl-4">when</span><span class="hl-1">.</span><span class="hl-0">toISOString</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-0">errorData</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-0">getErrorMessage</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">),</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">errorEmitter</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">i</span><span class="hl-1">++; </span><span class="hl-5">// Skip this timeframe and continue</span><br/><span class="hl-1">  </span><span class="hl-3">continue</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Error Recovery Strategy:</strong></p>
<ol>
<li>Log warning with context</li>
<li>Emit error event for user notification</li>
<li>Skip problematic timeframe</li>
<li>Continue with next timeframe</li>
<li>Backtest completes with available data</li>
</ol>
<p>Similarly, errors during candle fetching or <code>backtest()</code> calls are caught and handled at <a href="">BacktestLogicPrivateService.ts:179-202</a> and <a href="">BacktestLogicPrivateService.ts:367-380</a>.</p>
<hr>
<a id="comparison-with-live-mode" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Comparison with Live Mode<a href="#comparison-with-live-mode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Aspect</th>
<th>Backtest Mode</th>
<th>Live Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Data Source</strong></td>
<td>Historical (pre-generated timeframes)</td>
<td>Real-time (<code>new Date()</code> per tick)</td>
</tr>
<tr>
<td><strong>Iteration</strong></td>
<td>Finite loop: <code>while (i &lt; timeframes.length)</code></td>
<td>Infinite loop: <code>while (true)</code></td>
</tr>
<tr>
<td><strong>State Persistence</strong></td>
<td>None (stateless)</td>
<td>Crash-safe persistence via <code>PersistSignalAdapter</code></td>
</tr>
<tr>
<td><strong>Signal Processing</strong></td>
<td>Fast: <code>backtest()</code> processes entire signal</td>
<td>Slow: <code>tick()</code> called every 61 seconds</td>
</tr>
<tr>
<td><strong>Yielded Results</strong></td>
<td>Closed signals only</td>
<td>Opened and closed signals</td>
</tr>
<tr>
<td><strong>Skip Optimization</strong></td>
<td>Yes (skip to <code>closeTimestamp</code>)</td>
<td>No (must check every tick)</td>
</tr>
<tr>
<td><strong>Recovery</strong></td>
<td>Not needed (stateless)</td>
<td><code>waitForInit()</code> loads persisted state</td>
</tr>
<tr>
<td><strong>Completion</strong></td>
<td>Finite (ends when data exhausted)</td>
<td>Infinite (runs until stopped)</td>
</tr>
<tr>
<td><strong>Use Case</strong></td>
<td>Strategy validation, historical analysis</td>
<td>Real-time trading, live monitoring</td>
</tr>
</tbody>
</table>
<p><strong>Shared Components:</strong> Both modes use identical validation, schema services, and core strategy/exchange/frame services. The only difference is in the orchestration logic (<a href="">BacktestLogicPrivateService.ts</a> vs <a href="">LiveLogicPrivateService.ts</a>).</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#backtest-mode"><span>Backtest <wbr/>Mode</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#overview"><span>Overview</span></a></li><li><a href="#architecture-components"><span>Architecture <wbr/>Components</span></a></li><li><a href="#execution-flow"><span>Execution <wbr/>Flow</span></a></li><li><a href="#timeframe-iteration-and-skip-optimization"><span>Timeframe <wbr/>Iteration and <wbr/>Skip <wbr/>Optimization</span></a></li><li><a href="#signal-processing-tick-and-backtest"><span>Signal <wbr/>Processing: tick() and backtest()</span></a></li><li><ul><li><a href="#tick-method"><span>tick() <wbr/>Method</span></a></li><li><a href="#backtest-method"><span>backtest() <wbr/>Method</span></a></li></ul></li><li><a href="#fast-candle-processing-and-buffering"><span>Fast <wbr/>Candle <wbr/>Processing and <wbr/>Buffering</span></a></li><li><ul><li><a href="#buffer-calculation-for-opened-signals"><span>Buffer <wbr/>Calculation for <wbr/>Opened <wbr/>Signals</span></a></li><li><a href="#buffer-calculation-for-scheduled-signals"><span>Buffer <wbr/>Calculation for <wbr/>Scheduled <wbr/>Signals</span></a></li><li><a href="#vwap-calculation"><span>VWAP <wbr/>Calculation</span></a></li></ul></li><li><a href="#generator-pattern-and-memory-efficiency"><span>Generator <wbr/>Pattern and <wbr/>Memory <wbr/>Efficiency</span></a></li><li><ul><li><a href="#generator-implementation"><span>Generator <wbr/>Implementation</span></a></li><li><a href="#consumer-patterns"><span>Consumer <wbr/>Patterns</span></a></li><li><a href="#memory-comparison"><span>Memory <wbr/>Comparison</span></a></li></ul></li><li><a href="#event-system-integration"><span>Event <wbr/>System <wbr/>Integration</span></a></li><li><ul><li><a href="#event-types-and-timing"><span>Event <wbr/>Types and <wbr/>Timing</span></a></li><li><a href="#listening-to-events"><span>Listening to <wbr/>Events</span></a></li></ul></li><li><a href="#public-api-methods"><span>Public API <wbr/>Methods</span></a></li><li><ul><li><a href="#run"><span>run()</span></a></li><li><a href="#background"><span>background()</span></a></li><li><a href="#stop"><span>stop()</span></a></li><li><a href="#getdata"><span>get<wbr/>Data()</span></a></li><li><a href="#getreport"><span>get<wbr/>Report()</span></a></li><li><a href="#dump"><span>dump()</span></a></li><li><a href="#list"><span>list()</span></a></li></ul></li><li><a href="#instance-management-and-isolation"><span>Instance <wbr/>Management and <wbr/>Isolation</span></a></li><li><ul><li><a href="#memoization-pattern"><span>Memoization <wbr/>Pattern</span></a></li><li><a href="#state-isolation"><span>State <wbr/>Isolation</span></a></li><li><a href="#concurrent-execution"><span>Concurrent <wbr/>Execution</span></a></li></ul></li><li><a href="#performance-optimizations"><span>Performance <wbr/>Optimizations</span></a></li><li><ul><li><a href="#performance-metrics"><span>Performance <wbr/>Metrics</span></a></li></ul></li><li><a href="#validation-and-error-handling"><span>Validation and <wbr/>Error <wbr/>Handling</span></a></li><li><ul><li><a href="#validation-sequence"><span>Validation <wbr/>Sequence</span></a></li><li><a href="#error-handling-during-execution"><span>Error <wbr/>Handling <wbr/>During <wbr/>Execution</span></a></li></ul></li><li><a href="#comparison-with-live-mode"><span>Comparison with <wbr/>Live <wbr/>Mode</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
