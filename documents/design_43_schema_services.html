<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/43_schema_services | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_43_schema_services.html">design/43_schema_services</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="schema-services" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Schema Services<a href="#schema-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Schema Services provide centralized in-memory storage for component configurations registered via the <code>add*</code> functions in the public API. Each schema service implements the ToolRegistry pattern to store, retrieve, and validate registered schemas before they are used by connection services to instantiate client implementations.</p>
<p>For information about how schemas are validated before registration, see <a href="design_44_validation_services.html">Validation Services</a>. For information about how registered schemas are used to create client instances, see <a href="design_42_connection_services.html">Connection Services</a>.</p>
<hr>
<a id="purpose-and-responsibilities" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Responsibilities<a href="#purpose-and-responsibilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Schema Services serve as the <strong>configuration registry layer</strong> in the service architecture. Their responsibilities include:</p>
<ol>
<li><strong>Storage</strong>: Maintain in-memory registries of validated component schemas</li>
<li><strong>Retrieval</strong>: Provide access to registered schemas by unique name identifiers</li>
<li><strong>Override Detection</strong>: Support replacing existing schemas with updated configurations</li>
<li><strong>Type Safety</strong>: Enforce schema interface contracts through TypeScript typing</li>
<li><strong>Lifecycle Management</strong>: Persist schemas throughout application lifetime (singleton pattern)</li>
</ol>
<p>Schema Services do <strong>not</strong> perform validation logic (delegated to Validation Services) or instantiate clients (delegated to Connection Services). They are pure storage and retrieval mechanisms.</p>
<hr>
<a id="schema-service-types" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Schema Service Types<a href="#schema-service-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides seven schema services, one for each registrable component type:</p>
<table>
<thead>
<tr>
<th>Schema Service</th>
<th>Schema Interface</th>
<th>Name Type</th>
<th>Registration Function</th>
<th>DI Symbol</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ExchangeSchemaService</code></td>
<td><code>IExchangeSchema</code></td>
<td><code>ExchangeName</code></td>
<td><code>addExchange()</code></td>
<td><code>TYPES.exchangeSchemaService</code></td>
</tr>
<tr>
<td><code>StrategySchemaService</code></td>
<td><code>IStrategySchema</code></td>
<td><code>StrategyName</code></td>
<td><code>addStrategy()</code></td>
<td><code>TYPES.strategySchemaService</code></td>
</tr>
<tr>
<td><code>FrameSchemaService</code></td>
<td><code>IFrameSchema</code></td>
<td><code>FrameName</code></td>
<td><code>addFrame()</code></td>
<td><code>TYPES.frameSchemaService</code></td>
</tr>
<tr>
<td><code>WalkerSchemaService</code></td>
<td><code>IWalkerSchema</code></td>
<td><code>WalkerName</code></td>
<td><code>addWalker()</code></td>
<td><code>TYPES.walkerSchemaService</code></td>
</tr>
<tr>
<td><code>SizingSchemaService</code></td>
<td><code>ISizingSchema</code></td>
<td><code>SizingName</code></td>
<td><code>addSizing()</code></td>
<td><code>TYPES.sizingSchemaService</code></td>
</tr>
<tr>
<td><code>RiskSchemaService</code></td>
<td><code>IRiskSchema</code></td>
<td><code>RiskName</code></td>
<td><code>addRisk()</code></td>
<td><code>TYPES.riskSchemaService</code></td>
</tr>
<tr>
<td><code>OptimizerSchemaService</code></td>
<td><code>IOptimizerSchema</code></td>
<td><code>OptimizerName</code></td>
<td><code>addOptimizer()</code></td>
<td><code>TYPES.optimizerSchemaService</code></td>
</tr>
</tbody>
</table>
<p>All schema services follow identical structural patterns but store different schema types.</p>
<hr>
<a id="service-architecture-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Architecture Integration<a href="#service-architecture-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/43_Schema_Services_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Schema Services in the Service Layer Hierarchy</strong></p>
<p>This diagram shows how schema services sit between validation and connection layers. The public API functions call validation services for checks, then schema services for storage. Later, connection services retrieve schemas to instantiate clients.</p>
<hr>
<a id="toolregistry-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ToolRegistry Pattern<a href="#toolregistry-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each schema service implements the <strong>ToolRegistry pattern</strong> for in-memory storage. This pattern provides:</p>
<ol>
<li><strong>Map-based storage</strong>: <code>Map&lt;string, TSchema&gt;</code> where key is the unique name</li>
<li><strong>Register operation</strong>: Store or overwrite schema by name</li>
<li><strong>Retrieve operation</strong>: Get schema by name, throw if not found</li>
<li><strong>List operation</strong>: Return all registered names</li>
<li><strong>Override support</strong>: Replacing existing schemas is allowed</li>
</ol>
<a id="core-toolregistry-interface" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Core ToolRegistry Interface<a href="#core-toolregistry-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/43_Schema_Services_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: ToolRegistry Storage Operations</strong></p>
<p>The ToolRegistry pattern provides a simple but consistent API across all schema services. Each operation interacts with the underlying Map storage.</p>
<hr>
<a id="registration-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Registration Flow<a href="#registration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The registration flow is consistent across all component types. Here is the detailed flow for strategy registration:</p>
<p><img src="../media/43_Schema_Services_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Strategy Registration Sequence</strong></p>
<p>The registration flow shows the orchestration between validation and storage. Validation occurs first (throwing errors if schema is invalid), followed by storage in the schema service's ToolRegistry.</p>
<hr>
<a id="schema-retrieval-by-connection-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Schema Retrieval by Connection Services<a href="#schema-retrieval-by-connection-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Connection services are the primary consumers of schema services. They retrieve stored schemas to create memoized client instances:</p>
<p><img src="../media/43_Schema_Services_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Schema Retrieval and Client Instantiation Flow</strong></p>
<p>Connection services use <code>MethodContextService</code> to determine which schema to retrieve, then fetch it from the appropriate schema service. The retrieved schema is combined with runtime dependencies (logger, context services) to instantiate a memoized client.</p>
<hr>
<a id="individual-schema-service-responsibilities" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Individual Schema Service Responsibilities<a href="#individual-schema-service-responsibilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="strategyschemaservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">StrategySchemaService<a href="#strategyschemaservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Stores</strong>: <code>IStrategySchema</code> configurations with signal generation logic</p>
<p><strong>Key Fields</strong>:</p>
<ul>
<li><code>strategyName</code>: Unique identifier</li>
<li><code>interval</code>: Signal generation throttle interval (<code>&quot;1m&quot; | &quot;3m&quot; | &quot;5m&quot; | &quot;15m&quot; | &quot;30m&quot; | &quot;1h&quot;</code>)</li>
<li><code>getSignal</code>: Async function returning <code>ISignalDto | null</code></li>
<li><code>callbacks</code>: Optional lifecycle hooks (<code>onOpen</code>, <code>onClose</code>, <code>onActive</code>, etc.)</li>
<li><code>riskName</code> / <code>riskList</code>: Optional risk profile references</li>
</ul>
<p><strong>Used By</strong>: <code>StrategyConnectionService</code> to create <code>ClientStrategy</code> instances</p>
<hr>
<a id="exchangeschemaservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ExchangeSchemaService<a href="#exchangeschemaservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Stores</strong>: <code>IExchangeSchema</code> configurations for market data access</p>
<p><strong>Key Fields</strong>:</p>
<ul>
<li><code>exchangeName</code>: Unique identifier</li>
<li><code>getCandles</code>: Async function fetching OHLCV data</li>
<li><code>formatPrice</code>: Price formatting for exchange precision</li>
<li><code>formatQuantity</code>: Quantity formatting for exchange precision</li>
<li><code>callbacks</code>: Optional hooks (<code>onCandleData</code>)</li>
</ul>
<p><strong>Used By</strong>: <code>ExchangeConnectionService</code> to create <code>ClientExchange</code> instances</p>
<hr>
<a id="frameschemaservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">FrameSchemaService<a href="#frameschemaservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Stores</strong>: <code>IFrameSchema</code> configurations for backtest timeframe generation</p>
<p><strong>Key Fields</strong>:</p>
<ul>
<li><code>frameName</code>: Unique identifier</li>
<li><code>interval</code>: Timeframe granularity (<code>&quot;1m&quot; | &quot;3m&quot; | &quot;5m&quot; | ... | &quot;1d&quot; | &quot;3d&quot;</code>)</li>
<li><code>startDate</code>: Backtest period start</li>
<li><code>endDate</code>: Backtest period end</li>
<li><code>callbacks</code>: Optional hooks (<code>onTimeframe</code>)</li>
</ul>
<p><strong>Used By</strong>: <code>FrameConnectionService</code> to create <code>ClientFrame</code> instances</p>
<hr>
<a id="riskschemaservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">RiskSchemaService<a href="#riskschemaservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Stores</strong>: <code>IRiskSchema</code> configurations for portfolio risk management</p>
<p><strong>Key Fields</strong>:</p>
<ul>
<li><code>riskName</code>: Unique identifier</li>
<li><code>validations</code>: Array of <code>IRiskValidation</code> functions</li>
<li><code>callbacks</code>: Optional hooks (<code>onRejected</code>, <code>onAllowed</code>)</li>
</ul>
<p><strong>Used By</strong>: <code>RiskConnectionService</code> to create <code>ClientRisk</code> instances shared across strategies</p>
<hr>
<a id="sizingschemaservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">SizingSchemaService<a href="#sizingschemaservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Stores</strong>: <code>ISizingSchema</code> configurations for position sizing calculations</p>
<p><strong>Key Fields</strong>:</p>
<ul>
<li><code>sizingName</code>: Unique identifier</li>
<li><code>method</code>: Sizing algorithm (<code>&quot;fixed-percentage&quot; | &quot;kelly-criterion&quot; | &quot;atr-based&quot;</code>)</li>
<li>Method-specific parameters (risk percentages, multipliers, constraints)</li>
<li><code>callbacks</code>: Optional hooks (<code>onCalculate</code>)</li>
</ul>
<p><strong>Used By</strong>: <code>SizingConnectionService</code> to create <code>ClientSizing</code> instances</p>
<hr>
<a id="walkerschemaservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">WalkerSchemaService<a href="#walkerschemaservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Stores</strong>: <code>IWalkerSchema</code> configurations for strategy comparison</p>
<p><strong>Key Fields</strong>:</p>
<ul>
<li><code>walkerName</code>: Unique identifier</li>
<li><code>strategies</code>: Array of strategy names to compare</li>
<li><code>exchangeName</code>: Exchange to use for all backtests</li>
<li><code>frameName</code>: Timeframe to use for all backtests</li>
<li><code>metric</code>: Optimization metric (default: <code>&quot;sharpeRatio&quot;</code>)</li>
<li><code>callbacks</code>: Optional hooks (<code>onStrategyComplete</code>, <code>onComplete</code>)</li>
</ul>
<p><strong>Used By</strong>: <code>WalkerCommandService</code> for orchestrating multi-strategy backtests</p>
<hr>
<a id="optimizerschemaservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">OptimizerSchemaService<a href="#optimizerschemaservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Stores</strong>: <code>IOptimizerSchema</code> configurations for LLM-based strategy generation</p>
<p><strong>Key Fields</strong>:</p>
<ul>
<li><code>optimizerName</code>: Unique identifier</li>
<li><code>rangeTrain</code>: Array of training periods (generates strategy variants)</li>
<li><code>rangeTest</code>: Testing period for validation</li>
<li><code>source</code>: Array of data sources for LLM conversation building</li>
<li><code>getPrompt</code>: Function generating strategy prompts from conversation history</li>
<li><code>template</code>: Optional code generation template overrides</li>
<li><code>callbacks</code>: Optional hooks (<code>onData</code>, <code>onCode</code>, <code>onDump</code>, <code>onSourceData</code>)</li>
</ul>
<p><strong>Used By</strong>: <code>OptimizerConnectionService</code> to create <code>ClientOptimizer</code> instances</p>
<hr>
<a id="dependency-injection-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Dependency Injection Integration<a href="#dependency-injection-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Schema services are registered in the DI container as singleton instances:</p>
<p><img src="../media/43_Schema_Services_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Schema Services Dependency Injection Flow</strong></p>
<p>Schema services are registered once at application startup via <code>provide()</code> calls, creating singleton instances. The <code>inject()</code> function retrieves these instances using TYPES symbols, making them available throughout the application.</p>
<hr>
<a id="schema-override-mechanism" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Schema Override Mechanism<a href="#schema-override-mechanism" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Schema services support <strong>schema replacement</strong> through re-registration. When <code>register(name, schema)</code> is called with an existing name, the new schema overwrites the old one:</p>
<p><img src="../media/43_Schema_Services_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Schema Override and Cache Invalidation</strong></p>
<p>When a schema is re-registered, the ToolRegistry overwrites the previous version. Connection services that memoize client instances must invalidate their caches to ensure new instances use the updated schema.</p>
<hr>
<a id="error-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Error Handling<a href="#error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Schema services throw errors in two primary scenarios:</p>
<a id="schema-not-found" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schema Not Found<a href="#schema-not-found" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Attempting to retrieve non-existent schema</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">schema</span><span class="hl-1"> = </span><span class="hl-4">schemaService</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">&quot;non-existent-name&quot;</span><span class="hl-1">);</span><br/><span class="hl-5">// Throws: Error(&quot;Schema &#39;non-existent-name&#39; not found in StrategySchemaService&quot;)</span>
</code><button type="button">Copy</button></pre>

<p>This error occurs when connection services attempt to retrieve a schema that was never registered. The error message includes the schema name and service type for debugging.</p>
<a id="validation-failures" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Failures<a href="#validation-failures" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Validation errors occur <strong>before</strong> schema registration, in the validation service layer:</p>
<pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;invalid&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;INVALID_INTERVAL&quot;</span><span class="hl-1">, </span><span class="hl-5">// Type error: not a valid SignalInterval</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-5">// Throws in StrategyValidationService.addStrategy() before reaching schema service</span>
</code><button type="button">Copy</button></pre>

<p>Schema services themselves do not perform validation—they assume incoming schemas have already been validated.</p>
<hr>
<a id="listing-registered-schemas" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Listing Registered Schemas<a href="#listing-registered-schemas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each schema service provides a method to list all registered names:</p>
<pre><code class="typescript"><span class="hl-5">// List all registered strategies</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">strategies</span><span class="hl-1">: </span><span class="hl-11">StrategyName</span><span class="hl-1">[] = </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategySchemaService</span><span class="hl-1">.</span><span class="hl-0">list</span><span class="hl-1">();</span><br/><span class="hl-5">// Returns: [&quot;strategy-v1&quot;, &quot;strategy-v2&quot;, &quot;strategy-v3&quot;]</span><br/><br/><span class="hl-5">// List all registered exchanges</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">exchanges</span><span class="hl-1">: </span><span class="hl-11">ExchangeName</span><span class="hl-1">[] = </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">exchangeSchemaService</span><span class="hl-1">.</span><span class="hl-0">list</span><span class="hl-1">();</span><br/><span class="hl-5">// Returns: [&quot;binance&quot;, &quot;coinbase&quot;, &quot;kraken&quot;]</span>
</code><button type="button">Copy</button></pre>

<p>This is useful for:</p>
<ul>
<li>Debugging: Confirming which components are registered</li>
<li>Dynamic selection: Building UI dropdowns or CLI menus</li>
<li>Validation: Checking if a name exists before retrieval</li>
</ul>
<p>The framework also exposes public <code>list*</code> functions that wrap schema service list methods:</p>
<table>
<thead>
<tr>
<th>Public Function</th>
<th>Schema Service Method</th>
<th>Return Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>listStrategies()</code></td>
<td><code>strategySchemaService.list()</code></td>
<td><code>StrategyName[]</code></td>
</tr>
<tr>
<td><code>listExchanges()</code></td>
<td><code>exchangeSchemaService.list()</code></td>
<td><code>ExchangeName[]</code></td>
</tr>
<tr>
<td><code>listFrames()</code></td>
<td><code>frameSchemaService.list()</code></td>
<td><code>FrameName[]</code></td>
</tr>
<tr>
<td><code>listWalkers()</code></td>
<td><code>walkerSchemaService.list()</code></td>
<td><code>WalkerName[]</code></td>
</tr>
<tr>
<td><code>listSizings()</code></td>
<td><code>sizingSchemaService.list()</code></td>
<td><code>SizingName[]</code></td>
</tr>
<tr>
<td><code>listRisks()</code></td>
<td><code>riskSchemaService.list()</code></td>
<td><code>RiskName[]</code></td>
</tr>
<tr>
<td><code>listOptimizers()</code></td>
<td><code>optimizerSchemaService.list()</code></td>
<td><code>OptimizerName[]</code></td>
</tr>
</tbody>
</table>
<hr>
<a id="performance-characteristics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Characteristics<a href="#performance-characteristics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Schema services are designed for high-performance retrieval:</p>
<a id="storage-complexity" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Storage Complexity<a href="#storage-complexity" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Operation</th>
<th>Time Complexity</th>
<th>Space Complexity</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>register(name, schema)</code></td>
<td>O(1)</td>
<td>O(1) per schema</td>
</tr>
<tr>
<td><code>get(name)</code></td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr>
<td><code>list()</code></td>
<td>O(n) where n = schema count</td>
<td>O(n)</td>
</tr>
<tr>
<td><code>has(name)</code></td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<a id="singleton-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Singleton Pattern<a href="#singleton-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Schema services are <strong>singleton instances</strong> created once at application startup. All <code>add*</code> calls modify the same service instance, ensuring:</p>
<ul>
<li><strong>Consistent state</strong>: All parts of the application see the same registered schemas</li>
<li><strong>Memory efficiency</strong>: No duplicate schema storage</li>
<li><strong>Fast lookups</strong>: Map-based retrieval is O(1) for all consumers</li>
</ul>
<a id="no-persistence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">No Persistence<a href="#no-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Schema services store configurations <strong>only in memory</strong>. Schemas are lost on process restart. This design is intentional because:</p>
<ol>
<li>Schemas contain executable code (<code>getSignal</code>, <code>getCandles</code> functions)</li>
<li>Serializing functions is unsafe and non-portable</li>
<li>Applications should re-register schemas on startup via configuration files</li>
</ol>
<hr>
<a id="usage-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage Patterns<a href="#usage-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="basic-registration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Registration<a href="#basic-registration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addStrategy</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;momentum-long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Strategy logic here</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-6">51000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-6">49000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-6">60</span><span class="hl-1">,</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="schema-override-hot-reload" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schema Override (Hot Reload)<a href="#schema-override-hot-reload" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Initial registration</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;v1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({ </span><span class="hl-5">/* v1 logic */</span><span class="hl-1"> }),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Later: Update strategy logic</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;v1&quot;</span><span class="hl-1">, </span><span class="hl-5">// Same name = override</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;3m&quot;</span><span class="hl-1">, </span><span class="hl-5">// Can change any field</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({ </span><span class="hl-5">/* v2 logic */</span><span class="hl-1"> }),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// All future executions use updated schema</span>
</code><button type="button">Copy</button></pre>

<a id="conditional-registration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Conditional Registration<a href="#conditional-registration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">strategies</span><span class="hl-1"> = [</span><br/><span class="hl-1">  { </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative&quot;</span><span class="hl-1">, </span><span class="hl-4">risk:</span><span class="hl-1"> </span><span class="hl-6">1</span><span class="hl-1"> },</span><br/><span class="hl-1">  { </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;aggressive&quot;</span><span class="hl-1">, </span><span class="hl-4">risk:</span><span class="hl-1"> </span><span class="hl-6">5</span><span class="hl-1"> },</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-4">strategies</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">(({ </span><span class="hl-4">name</span><span class="hl-1">, </span><span class="hl-4">risk</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">name</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-4">risk</span><span class="hl-1"> &gt; </span><span class="hl-6">2</span><span class="hl-1"> ? </span><span class="hl-2">&quot;high-risk&quot;</span><span class="hl-1"> : </span><span class="hl-2">&quot;low-risk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({ </span><span class="hl-5">/* ... */</span><span class="hl-1"> }),</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="relationship-to-other-service-layers" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Relationship to Other Service Layers<a href="#relationship-to-other-service-layers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Schema Services interact with multiple service layers:</p>
<table>
<thead>
<tr>
<th>Service Layer</th>
<th>Relationship</th>
<th>Direction</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Validation Services</strong></td>
<td>Schemas are validated before storage</td>
<td>Validation → Schema</td>
</tr>
<tr>
<td><strong>Connection Services</strong></td>
<td>Schemas are retrieved to create clients</td>
<td>Schema → Connection</td>
</tr>
<tr>
<td><strong>Global Services</strong></td>
<td>Global services orchestrate validation + storage</td>
<td>Public API → Global → Schema</td>
</tr>
<tr>
<td><strong>Core Services</strong></td>
<td>Core services use connection services (which use schemas)</td>
<td>Schema → Connection → Core</td>
</tr>
<tr>
<td><strong>Command Services</strong></td>
<td>Commands retrieve schemas via connection services</td>
<td>Schema → Connection → Command</td>
</tr>
</tbody>
</table>
<p>Schema Services are <strong>pure storage</strong> with no business logic. They do not:</p>
<ul>
<li>Validate schemas (Validation Services)</li>
<li>Create client instances (Connection Services)</li>
<li>Execute strategies (Core Services)</li>
<li>Orchestrate workflows (Command Services)</li>
</ul>
<hr>
<a id="summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Summary<a href="#summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Schema Services implement the ToolRegistry pattern to provide centralized, in-memory storage for component configurations. They offer:</p>
<ol>
<li><strong>Consistent API</strong>: All services follow the <code>register(name, schema)</code> and <code>get(name)</code> pattern</li>
<li><strong>Type Safety</strong>: Each service stores a specific schema interface</li>
<li><strong>Singleton Instances</strong>: One service instance per application lifecycle</li>
<li><strong>O(1) Retrieval</strong>: Map-based storage for fast lookups</li>
<li><strong>Override Support</strong>: Re-registration replaces existing schemas</li>
<li><strong>DI Integration</strong>: Services are injected via TYPES symbols</li>
<li><strong>No Validation</strong>: Assumes schemas are pre-validated by Validation Services</li>
<li><strong>No Instantiation</strong>: Connection Services handle client creation</li>
</ol>
<p>Schema Services serve as the <strong>configuration registry</strong> that bridges the public API (<code>add*</code> functions) with the internal service architecture (connection/core/command layers).</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#schema-services"><span>Schema <wbr/>Services</span></a><ul><li><a href="#purpose-and-responsibilities"><span>Purpose and <wbr/>Responsibilities</span></a></li><li><a href="#schema-service-types"><span>Schema <wbr/>Service <wbr/>Types</span></a></li><li><a href="#service-architecture-integration"><span>Service <wbr/>Architecture <wbr/>Integration</span></a></li><li><a href="#toolregistry-pattern"><span>Tool<wbr/>Registry <wbr/>Pattern</span></a></li><li><ul><li><a href="#core-toolregistry-interface"><span>Core <wbr/>Tool<wbr/>Registry <wbr/>Interface</span></a></li></ul></li><li><a href="#registration-flow"><span>Registration <wbr/>Flow</span></a></li><li><a href="#schema-retrieval-by-connection-services"><span>Schema <wbr/>Retrieval by <wbr/>Connection <wbr/>Services</span></a></li><li><a href="#individual-schema-service-responsibilities"><span>Individual <wbr/>Schema <wbr/>Service <wbr/>Responsibilities</span></a></li><li><ul><li><a href="#strategyschemaservice"><span>Strategy<wbr/>Schema<wbr/>Service</span></a></li><li><a href="#exchangeschemaservice"><span>Exchange<wbr/>Schema<wbr/>Service</span></a></li><li><a href="#frameschemaservice"><span>Frame<wbr/>Schema<wbr/>Service</span></a></li><li><a href="#riskschemaservice"><span>Risk<wbr/>Schema<wbr/>Service</span></a></li><li><a href="#sizingschemaservice"><span>Sizing<wbr/>Schema<wbr/>Service</span></a></li><li><a href="#walkerschemaservice"><span>Walker<wbr/>Schema<wbr/>Service</span></a></li><li><a href="#optimizerschemaservice"><span>Optimizer<wbr/>Schema<wbr/>Service</span></a></li></ul></li><li><a href="#dependency-injection-integration"><span>Dependency <wbr/>Injection <wbr/>Integration</span></a></li><li><a href="#schema-override-mechanism"><span>Schema <wbr/>Override <wbr/>Mechanism</span></a></li><li><a href="#error-handling"><span>Error <wbr/>Handling</span></a></li><li><ul><li><a href="#schema-not-found"><span>Schema <wbr/>Not <wbr/>Found</span></a></li><li><a href="#validation-failures"><span>Validation <wbr/>Failures</span></a></li></ul></li><li><a href="#listing-registered-schemas"><span>Listing <wbr/>Registered <wbr/>Schemas</span></a></li><li><a href="#performance-characteristics"><span>Performance <wbr/>Characteristics</span></a></li><li><ul><li><a href="#storage-complexity"><span>Storage <wbr/>Complexity</span></a></li><li><a href="#singleton-pattern"><span>Singleton <wbr/>Pattern</span></a></li><li><a href="#no-persistence"><span>No <wbr/>Persistence</span></a></li></ul></li><li><a href="#usage-patterns"><span>Usage <wbr/>Patterns</span></a></li><li><ul><li><a href="#basic-registration"><span>Basic <wbr/>Registration</span></a></li><li><a href="#schema-override-hot-reload"><span>Schema <wbr/>Override (<wbr/>Hot <wbr/>Reload)</span></a></li><li><a href="#conditional-registration"><span>Conditional <wbr/>Registration</span></a></li></ul></li><li><a href="#relationship-to-other-service-layers"><span>Relationship to <wbr/>Other <wbr/>Service <wbr/>Layers</span></a></li><li><a href="#summary"><span>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
