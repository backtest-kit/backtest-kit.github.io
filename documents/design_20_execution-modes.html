<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/20_execution-modes | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_20_execution-modes.html">design/20_execution-modes</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="execution-modes" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Execution Modes<a href="#execution-modes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This document describes the three execution modes provided by Backtest Kit: <strong>Backtest</strong>, <strong>Live</strong>, and <strong>Walker</strong>. Each mode uses the same core strategy execution logic but differs in orchestration, time progression, and result streaming patterns. For details on the strategy lifecycle within these modes, see <a href="design_08_core-concepts.html">Signals &amp; Signal Lifecycle</a>. For information on async generator implementation details, see <a href="design_20_execution-modes.html">Async Generator Patterns</a>.</p>
<hr>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest Kit provides three distinct execution modes, each optimized for different use cases:</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Purpose</th>
<th>Time Progression</th>
<th>Generator Type</th>
<th>Primary Output</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Backtest</strong></td>
<td>Historical simulation</td>
<td>Pre-determined timeframes</td>
<td>Finite async generator</td>
<td>Closed signals with PNL</td>
</tr>
<tr>
<td><strong>Live</strong></td>
<td>Real-time trading</td>
<td>Real-time (<code>new Date()</code>)</td>
<td>Infinite async generator</td>
<td>Opened/closed signals</td>
</tr>
<tr>
<td><strong>Walker</strong></td>
<td>Strategy comparison</td>
<td>Orchestrates multiple backtests</td>
<td>Finite async generator</td>
<td>Comparative statistics</td>
</tr>
</tbody>
</table>
<p>All three modes share the same core execution components (<code>StrategyCoreService</code>, <code>ClientStrategy</code>) to ensure identical signal logic between testing and production.</p>
<hr>
<a id="architecture-mode-specific-orchestration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture: Mode-Specific Orchestration<a href="#architecture-mode-specific-orchestration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/20_execution-modes_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Execution Mode Architecture</strong></p>
<p>This diagram shows how each execution mode uses mode-specific orchestration services while sharing the same core strategy execution logic. Instance management ensures isolated state per symbol-strategy or symbol-walker pair.</p>
<hr>
<a id="backtest-mode-historical-simulation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Backtest Mode: Historical Simulation<a href="#backtest-mode-historical-simulation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Backtest mode executes strategies over historical data with deterministic time progression. It iterates through pre-defined timeframes minute-by-minute, calling strategy logic at each interval.</p>
<a id="entry-points" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Entry Points<a href="#entry-points" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>Backtest</code> singleton provides two methods for execution:</p>
<pre><code class="typescript"><span class="hl-5">// Async iterator pattern - yields results</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-4">frameName</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Background execution - fire and forget</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">cancel</span><span class="hl-1"> = </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-4">frameName</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Both methods delegate to <code>BacktestInstance</code> which maintains isolated state per <code>symbol:strategyName</code> pair using memoization.</p>
<a id="orchestration-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Orchestration Flow<a href="#orchestration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>BacktestLogicPrivateService.run()</code> method implements the core backtest loop:</p>
<p><img src="../media/20_execution-modes_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Backtest Orchestration Flow</strong></p>
<p>This diagram shows the complete backtest loop including the &quot;fast backtest&quot; optimization that skips timeframes while a signal is active.</p>
<a id="fast-backtest-optimization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Fast Backtest Optimization<a href="#fast-backtest-optimization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When a signal opens, the orchestrator switches to &quot;fast mode&quot;:</p>
<ol>
<li><strong>Calculates candles needed:</strong> <code>bufferMinutes + CC_SCHEDULE_AWAIT_MINUTES + minuteEstimatedTime + 1</code></li>
<li><strong>Fetches bulk candles:</strong> Via <code>ExchangeCoreService.getNextCandles()</code></li>
<li><strong>Processes in one call:</strong> <code>StrategyCoreService.backtest()</code> handles TP/SL detection across all candles</li>
<li><strong>Skips timeframes:</strong> <code>i += minutesUsed</code> to jump to signal closure timestamp</li>
</ol>
<p>This optimization dramatically improves performance for long-running signals by avoiding per-minute <code>tick()</code> calls during active signal monitoring.</p>
<a id="progress-tracking" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Progress Tracking<a href="#progress-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The orchestrator emits progress events after processing each timeframe:</p>
<pre><code class="typescript"><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">progressBacktestEmitter</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">totalFrames</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">processedFrames:</span><span class="hl-1"> </span><span class="hl-4">i</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">progress:</span><span class="hl-1"> </span><span class="hl-4">totalFrames</span><span class="hl-1"> &gt; </span><span class="hl-6">0</span><span class="hl-1"> ? </span><span class="hl-4">i</span><span class="hl-1"> / </span><span class="hl-4">totalFrames</span><span class="hl-1"> : </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Consumer code can listen via <code>listenProgressBacktest()</code> to display real-time progress indicators.</p>
<a id="graceful-shutdown" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Graceful Shutdown<a href="#graceful-shutdown" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Backtest supports graceful shutdown via <code>Backtest.stop(symbol, strategyName)</code>:</p>
<ul>
<li>Sets internal <code>stopped</code> flag in <code>StrategyCoreService</code></li>
<li>Checks flag at two points: <strong>before tick</strong> and <strong>when idle</strong></li>
<li>Current active signal completes normally before stopping</li>
<li>Prevents partial results from incomplete backtests</li>
</ul>
<hr>
<a id="live-trading-mode-real-time-execution" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Live Trading Mode: Real-Time Execution<a href="#live-trading-mode-real-time-execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Live mode executes strategies continuously in real-time using an infinite loop pattern. It progresses time with <code>new Date()</code> on each iteration and includes crash-safe persistence.</p>
<a id="entry-points-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Entry Points<a href="#entry-points-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>Live</code> singleton provides two methods:</p>
<pre><code class="typescript"><span class="hl-5">// Async iterator - yields opened and closed signals</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;New signal:&quot;</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;PNL:&quot;</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Background execution - infinite until stopped</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">cancel</span><span class="hl-1"> = </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Both methods delegate to <code>LiveInstance</code> which maintains isolated state per <code>symbol:strategyName</code> pair.</p>
<a id="orchestration-flow-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Orchestration Flow<a href="#orchestration-flow-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>LiveLogicPrivateService.run()</code> method implements the infinite monitoring loop:</p>
<p><img src="../media/20_execution-modes_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Live Trading Orchestration Flow</strong></p>
<p>This diagram shows the infinite loop pattern with sleep intervals and graceful shutdown checkpoints.</p>
<a id="sleep-interval-configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Sleep Interval Configuration<a href="#sleep-interval-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The orchestrator sleeps between ticks using a constant defined at the module level:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">TICK_TTL</span><span class="hl-1"> = </span><span class="hl-6">1</span><span class="hl-1"> * </span><span class="hl-6">60</span><span class="hl-1"> * </span><span class="hl-6">1_000</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">; </span><span class="hl-5">// 1 minute + 1ms</span>
</code><button type="button">Copy</button></pre>

<p>This interval balances responsiveness with API rate limiting. The extra 1ms prevents exact-minute boundary issues.</p>
<a id="crash-safe-persistence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Crash-Safe Persistence<a href="#crash-safe-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Live mode automatically persists active signals to disk for crash recovery:</p>
<ul>
<li><strong>Signal opened:</strong> <code>ClientStrategy</code> calls <code>PersistSignalAdapter.set()</code> to save signal state</li>
<li><strong>Process crashes:</strong> On restart, <code>ClientStrategy.waitForInit()</code> loads persisted signal</li>
<li><strong>Signal closed:</strong> <code>PersistSignalAdapter.delete()</code> removes from storage</li>
<li><strong>Scheduled signals NOT persisted:</strong> Only active (opened) signals are saved</li>
</ul>
<p>This ensures crash recovery without data loss or duplicate positions.</p>
<a id="result-streaming" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Result Streaming<a href="#result-streaming" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Live mode yields only <strong>opened</strong> and <strong>closed</strong> results, skipping <strong>idle</strong>, <strong>active</strong>, and <strong>scheduled</strong> states to reduce noise:</p>
<pre><code class="typescript"><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;idle&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">sleep</span><span class="hl-1">(</span><span class="hl-8">TICK_TTL</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">continue</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">sleep</span><span class="hl-1">(</span><span class="hl-8">TICK_TTL</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">continue</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;scheduled&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">sleep</span><span class="hl-1">(</span><span class="hl-8">TICK_TTL</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">continue</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><span class="hl-5">// Yield opened, closed results</span><br/><span class="hl-3">yield</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-11">IStrategyTickResultClosed</span><span class="hl-1"> | </span><span class="hl-11">IStrategyTickResultOpened</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<a id="graceful-shutdown-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Graceful Shutdown<a href="#graceful-shutdown-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Live mode supports graceful shutdown via <code>Live.stop(symbol, strategyName)</code>:</p>
<ul>
<li><strong>When idle:</strong> Stops immediately after setting flag</li>
<li><strong>When active:</strong> Waits for signal to close before stopping</li>
<li><strong>After closed:</strong> Checks flag and stops if set</li>
</ul>
<p>This ensures positions close properly before the trading bot terminates.</p>
<hr>
<a id="walker-mode-strategy-comparison" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Walker Mode: Strategy Comparison<a href="#walker-mode-strategy-comparison" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Walker mode orchestrates multiple backtests sequentially to compare strategy performance. It executes each strategy's backtest, collects statistics, and ranks results by a configurable metric.</p>
<a id="entry-points-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Entry Points<a href="#entry-points-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>Walker</code> singleton provides two methods:</p>
<pre><code class="typescript"><span class="hl-5">// Async iterator - yields progress after each strategy</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">progress</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">strategiesTested</span><span class="hl-7">}</span><span class="hl-2">/</span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">totalStrategies</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Best:&quot;</span><span class="hl-1">, </span><span class="hl-4">progress</span><span class="hl-1">.</span><span class="hl-4">bestStrategy</span><span class="hl-1">, </span><span class="hl-4">progress</span><span class="hl-1">.</span><span class="hl-4">bestMetric</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Background execution</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">cancel</span><span class="hl-1"> = </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, { </span><span class="hl-4">walkerName</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<p>Walker configuration is defined via <code>addWalker()</code>:</p>
<pre><code class="typescript"><span class="hl-0">addWalker</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;optimizer-v1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategies:</span><span class="hl-1"> [</span><span class="hl-2">&quot;strat-a&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;strat-b&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;strat-c&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">metric:</span><span class="hl-1"> </span><span class="hl-2">&quot;sharpeRatio&quot;</span><span class="hl-1">, </span><span class="hl-5">// or &quot;winRate&quot;, &quot;totalPnl&quot;, etc.</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="orchestration-flow-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Orchestration Flow<a href="#orchestration-flow-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>WalkerLogicPrivateService.run()</code> method iterates through strategies:</p>
<p><img src="../media/20_execution-modes_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Walker Orchestration Flow</strong></p>
<p>This diagram shows the sequential strategy testing pattern with real-time metric comparison and progressive result streaming.</p>
<a id="metric-comparison" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Metric Comparison<a href="#metric-comparison" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Walker supports multiple comparison metrics defined in the walker schema:</p>
<pre><code class="typescript"><span class="hl-7">type</span><span class="hl-1"> </span><span class="hl-11">WalkerMetric</span><span class="hl-1"> = </span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;sharpeRatio&quot;</span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;winRate&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;totalPnl&quot;</span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;avgPnl&quot;</span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;maxDrawdown&quot;</span><br/><span class="hl-1">  | </span><span class="hl-2">&quot;totalTrades&quot;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>The orchestrator extracts the configured metric from <code>BacktestStatisticsModel</code> and tracks the best performer:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">value</span><span class="hl-1"> = </span><span class="hl-4">stats</span><span class="hl-1">[</span><span class="hl-4">metric</span><span class="hl-1">];</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">metricValue</span><span class="hl-1"> = </span><span class="hl-4">value</span><span class="hl-1"> !== </span><span class="hl-7">null</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">value</span><span class="hl-1"> !== </span><span class="hl-7">undefined</span><span class="hl-1"> ? </span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">bestMetric</span><span class="hl-1"> === </span><span class="hl-7">null</span><span class="hl-1"> || </span><span class="hl-4">metricValue</span><span class="hl-1"> &gt; </span><span class="hl-4">bestMetric</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">bestMetric</span><span class="hl-1"> = </span><span class="hl-4">metricValue</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">bestStrategy</span><span class="hl-1"> = </span><span class="hl-4">strategyName</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="progressive-result-streaming" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Progressive Result Streaming<a href="#progressive-result-streaming" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Walker yields <code>WalkerContract</code> after each strategy completes, enabling real-time monitoring:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">contract</span><span class="hl-1">: </span><span class="hl-11">WalkerContract</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">totalStrategies:</span><span class="hl-1"> </span><span class="hl-4">strategies</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategiesTested</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">bestStrategy</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">bestMetric</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">metric</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">currentStrategyName</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">currentMetric:</span><span class="hl-1"> </span><span class="hl-4">metricValue</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">walkerEmitter</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">contract</span><span class="hl-1">);</span><br/><span class="hl-3">yield</span><span class="hl-1"> </span><span class="hl-4">contract</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>Consumer code receives incremental updates as each strategy finishes.</p>
<a id="multi-walker-stop-signals" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Multi-Walker Stop Signals<a href="#multi-walker-stop-signals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Walker supports multiple concurrent walkers on the same symbol by filtering stop signals by both <code>symbol</code> AND <code>walkerName</code>:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">unsubscribe</span><span class="hl-1"> = </span><span class="hl-4">walkerStopSubject</span><br/><span class="hl-1">  .</span><span class="hl-0">filter</span><span class="hl-1">((</span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><br/><span class="hl-1">    </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1"> === </span><span class="hl-4">symbol</span><span class="hl-1"> &amp;&amp; </span><br/><span class="hl-1">    </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">walkerName</span><span class="hl-1"> === </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">walkerName</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">  .</span><span class="hl-0">connect</span><span class="hl-1">((</span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">stoppedStrategies</span><span class="hl-1">.</span><span class="hl-0">add</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span>
</code><button type="button">Copy</button></pre>

<p>This prevents crosstalk when running multiple optimization experiments simultaneously.</p>
<a id="strategy-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Strategy Callbacks<a href="#strategy-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Walker supports optional callbacks for tracking progress:</p>
<pre><code class="typescript"><span class="hl-0">addWalker</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;optimizer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategies:</span><span class="hl-1"> [...],</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onStrategyStart</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Testing </span><span class="hl-7">${</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2">...`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onStrategyComplete</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">stats</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2"> Sharpe: </span><span class="hl-7">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">sharpeRatio</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onStrategyError</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2"> failed:`</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="async-generator-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Async Generator Patterns<a href="#async-generator-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All three execution modes use async generators for memory-efficient streaming. This section compares their generator characteristics.</p>
<a id="generator-type-comparison" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Generator Type Comparison<a href="#generator-type-comparison" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Mode</th>
<th>Generator Type</th>
<th>Completion</th>
<th>Early Termination</th>
</tr>
</thead>
<tbody>
<tr>
<td>Backtest</td>
<td><strong>Finite</strong> - ends after last timeframe</td>
<td>Automatically completes when <code>i &gt;= timeframes.length</code></td>
<td>Supported via <code>break</code> in consumer or <code>Backtest.stop()</code></td>
</tr>
<tr>
<td>Live</td>
<td><strong>Infinite</strong> - never completes naturally</td>
<td>Only stops via graceful shutdown</td>
<td>Supported via <code>break</code> in consumer or <code>Live.stop()</code></td>
</tr>
<tr>
<td>Walker</td>
<td><strong>Finite</strong> - ends after last strategy</td>
<td>Automatically completes when all strategies tested</td>
<td>Supported via <code>break</code> in consumer or <code>Walker.stop()</code></td>
</tr>
</tbody>
</table>
<a id="memory-efficiency" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memory Efficiency<a href="#memory-efficiency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Async generators enable streaming without accumulating results:</p>
<pre><code class="typescript"><span class="hl-5">// ❌ Memory-intensive: Accumulates all results in array</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">backtestLogic</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">BacktestLogicPrivateService</span><span class="hl-1">();</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">allResults</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">resolveDocuments</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">backtestLogic</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">)</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-5">// ✅ Memory-efficient: Processes results one at a time</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">backtestLogic</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">)) {</span><br/><span class="hl-1">  </span><span class="hl-0">processResult</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">// Previous results are garbage-collected</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>This is critical for large backtests with thousands of signals.</p>
<a id="early-termination-support" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Early Termination Support<a href="#early-termination-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All modes support early termination via consumer-side <code>break</code>:</p>
<pre><code class="typescript"><span class="hl-5">// Stop backtest after 10% drawdown</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">)) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &lt; -</span><span class="hl-6">10</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Drawdown exceeded, stopping backtest&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">break</span><span class="hl-1">; </span><span class="hl-5">// Generator cleanup happens automatically</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Consumer break triggers generator cleanup (destructors, unsubscriptions) without requiring explicit shutdown.</p>
<a id="background-execution-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Background Execution Pattern<a href="#background-execution-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>background()</code> methods consume generators internally using <code>singlerun</code> wrapper:</p>
<pre><code class="typescript"><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">task</span><span class="hl-1"> = </span><span class="hl-0">singlerun</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">: </span><span class="hl-11">any</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_isStopped</span><span class="hl-1"> = </span><span class="hl-7">false</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_isDone</span><span class="hl-1"> = </span><span class="hl-7">false</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">_</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_isStopped</span><span class="hl-1">) </span><span class="hl-3">break</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Emit completion event</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">doneBacktestSubject</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">({...});</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_isDone</span><span class="hl-1"> = </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">background</span><span class="hl-1"> = (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">: </span><span class="hl-11">any</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">task</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">).</span><span class="hl-0">catch</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">exitEmitter</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-0">getErrorMessage</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">)))</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_isStopped</span><span class="hl-1"> = </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>The <code>singlerun</code> wrapper from <code>functools-kit</code> ensures only one execution per instance and provides status tracking.</p>
<hr>
<a id="shared-core-strategy-execution" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Shared Core Strategy Execution<a href="#shared-core-strategy-execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Despite different orchestration patterns, all three modes delegate to the same core services for strategy execution:</p>
<p><img src="../media/20_execution-modes_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Shared Core Execution Architecture</strong></p>
<p>This diagram shows how mode-specific orchestration services converge on the same <code>StrategyCoreService</code> and <code>ClientStrategy</code> implementations.</p>
<a id="key-shared-components" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Key Shared Components<a href="#key-shared-components" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Shared Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>StrategyCoreService</code></td>
<td>Strategy orchestration, state machine progression</td>
<td>Same <code>tick()</code> and <code>backtest()</code> logic across all modes</td>
</tr>
<tr>
<td><code>ClientStrategy</code></td>
<td>Signal lifecycle, validation, pricing</td>
<td>Identical validation rules, VWAP calculation, TP/SL logic</td>
</tr>
<tr>
<td><code>StrategyConnectionService</code></td>
<td>Memoized client factory</td>
<td>Same instance caching mechanism per <code>symbol:strategyName</code></td>
</tr>
<tr>
<td><code>ExchangeConnectionService</code></td>
<td>Exchange client factory</td>
<td>Shared candle fetching and price formatting</td>
</tr>
<tr>
<td><code>RiskConnectionService</code></td>
<td>Risk client factory</td>
<td>Unified risk validation pipeline</td>
</tr>
</tbody>
</table>
<p>This architecture ensures <strong>identical behavior</strong> between backtest simulation and live trading, preventing discrepancies that could lead to unexpected production results.</p>
<hr>
<a id="api-method-comparison" class="tsd-anchor"></a><h2 class="tsd-anchor-link">API Method Comparison<a href="#api-method-comparison" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following table summarizes the public API methods across all three execution modes:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Backtest</th>
<th>Live</th>
<th>Walker</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>run(symbol, context)</code></td>
<td>✅ Returns finite async generator</td>
<td>✅ Returns infinite async generator</td>
<td>✅ Returns finite async generator</td>
<td>Primary execution method - yields results</td>
</tr>
<tr>
<td><code>background(symbol, context)</code></td>
<td>✅ Returns cancellation closure</td>
<td>✅ Returns cancellation closure</td>
<td>✅ Returns cancellation closure</td>
<td>Background execution - fire and forget</td>
</tr>
<tr>
<td><code>stop(symbol, name)</code></td>
<td>✅ Graceful shutdown</td>
<td>✅ Graceful shutdown</td>
<td>✅ Stops all strategies in walker</td>
<td>Sets stop flag, waits for safe point</td>
</tr>
<tr>
<td><code>getData(symbol, name)</code></td>
<td>✅ Returns <code>BacktestStatisticsModel</code></td>
<td>✅ Returns <code>LiveStatisticsModel</code></td>
<td>✅ Returns <code>WalkerResultsModel</code></td>
<td>Extracts accumulated statistics</td>
</tr>
<tr>
<td><code>getReport(symbol, name, columns?)</code></td>
<td>✅ Markdown report</td>
<td>✅ Markdown report</td>
<td>✅ Markdown report</td>
<td>Generates formatted report string</td>
</tr>
<tr>
<td><code>dump(symbol, name, path?, columns?)</code></td>
<td>✅ Saves to <code>./dump/backtest/</code></td>
<td>✅ Saves to <code>./dump/live/</code></td>
<td>✅ Saves to <code>./dump/walker/</code></td>
<td>Writes report to disk</td>
</tr>
<tr>
<td><code>list()</code></td>
<td>✅ Returns all instance statuses</td>
<td>✅ Returns all instance statuses</td>
<td>✅ Returns all instance statuses</td>
<td>Lists active executions</td>
</tr>
</tbody>
</table>
<a id="context-parameter-differences" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Parameter Differences<a href="#context-parameter-differences" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Backtest requires frameName for timeframe generation</span><br/><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;strat-1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><span class="hl-1"> </span><span class="hl-5">// Required</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Live does not require frameName (uses real-time)</span><br/><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;strat-1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><br/><span class="hl-1">  </span><span class="hl-5">// No frameName needed</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Walker only requires walkerName (pulls config from schema)</span><br/><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;optimizer-v1&quot;</span><br/><span class="hl-1">  </span><span class="hl-5">// exchangeName and frameName pulled from walker schema</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="mode-selection-guide" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Mode Selection Guide<a href="#mode-selection-guide" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Use the following criteria to choose the appropriate execution mode:</p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Recommended Mode</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td>Testing strategy logic on historical data</td>
<td><strong>Backtest</strong></td>
<td>Fast, deterministic, complete PNL statistics</td>
</tr>
<tr>
<td>Validating strategy performance metrics</td>
<td><strong>Backtest</strong></td>
<td>Accurate Sharpe ratio, drawdown, win rate calculations</td>
</tr>
<tr>
<td>Production trading deployment</td>
<td><strong>Live</strong></td>
<td>Real-time execution, crash recovery, persistence</td>
</tr>
<tr>
<td>Comparing multiple strategy variants</td>
<td><strong>Walker</strong></td>
<td>Automated comparison, metric-based ranking</td>
</tr>
<tr>
<td>Parameter optimization</td>
<td><strong>Walker</strong></td>
<td>Sequential testing of parameter combinations</td>
</tr>
<tr>
<td>Strategy development iteration</td>
<td><strong>Backtest</strong></td>
<td>Fastest feedback loop during development</td>
</tr>
<tr>
<td>Paper trading / dry run</td>
<td><strong>Live</strong> with mock exchange</td>
<td>Real-time behavior without capital risk</td>
</tr>
</tbody>
</table>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#execution-modes"><span>Execution <wbr/>Modes</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#architecture-mode-specific-orchestration"><span>Architecture: <wbr/>Mode-<wbr/>Specific <wbr/>Orchestration</span></a></li><li><a href="#backtest-mode-historical-simulation"><span>Backtest <wbr/>Mode: <wbr/>Historical <wbr/>Simulation</span></a></li><li><ul><li><a href="#entry-points"><span>Entry <wbr/>Points</span></a></li><li><a href="#orchestration-flow"><span>Orchestration <wbr/>Flow</span></a></li><li><a href="#fast-backtest-optimization"><span>Fast <wbr/>Backtest <wbr/>Optimization</span></a></li><li><a href="#progress-tracking"><span>Progress <wbr/>Tracking</span></a></li><li><a href="#graceful-shutdown"><span>Graceful <wbr/>Shutdown</span></a></li></ul></li><li><a href="#live-trading-mode-real-time-execution"><span>Live <wbr/>Trading <wbr/>Mode: <wbr/>Real-<wbr/>Time <wbr/>Execution</span></a></li><li><ul><li><a href="#entry-points-1"><span>Entry <wbr/>Points</span></a></li><li><a href="#orchestration-flow-1"><span>Orchestration <wbr/>Flow</span></a></li><li><a href="#sleep-interval-configuration"><span>Sleep <wbr/>Interval <wbr/>Configuration</span></a></li><li><a href="#crash-safe-persistence"><span>Crash-<wbr/>Safe <wbr/>Persistence</span></a></li><li><a href="#result-streaming"><span>Result <wbr/>Streaming</span></a></li><li><a href="#graceful-shutdown-1"><span>Graceful <wbr/>Shutdown</span></a></li></ul></li><li><a href="#walker-mode-strategy-comparison"><span>Walker <wbr/>Mode: <wbr/>Strategy <wbr/>Comparison</span></a></li><li><ul><li><a href="#entry-points-2"><span>Entry <wbr/>Points</span></a></li><li><a href="#orchestration-flow-2"><span>Orchestration <wbr/>Flow</span></a></li><li><a href="#metric-comparison"><span>Metric <wbr/>Comparison</span></a></li><li><a href="#progressive-result-streaming"><span>Progressive <wbr/>Result <wbr/>Streaming</span></a></li><li><a href="#multi-walker-stop-signals"><span>Multi-<wbr/>Walker <wbr/>Stop <wbr/>Signals</span></a></li><li><a href="#strategy-callbacks"><span>Strategy <wbr/>Callbacks</span></a></li></ul></li><li><a href="#async-generator-patterns"><span>Async <wbr/>Generator <wbr/>Patterns</span></a></li><li><ul><li><a href="#generator-type-comparison"><span>Generator <wbr/>Type <wbr/>Comparison</span></a></li><li><a href="#memory-efficiency"><span>Memory <wbr/>Efficiency</span></a></li><li><a href="#early-termination-support"><span>Early <wbr/>Termination <wbr/>Support</span></a></li><li><a href="#background-execution-pattern"><span>Background <wbr/>Execution <wbr/>Pattern</span></a></li></ul></li><li><a href="#shared-core-strategy-execution"><span>Shared <wbr/>Core <wbr/>Strategy <wbr/>Execution</span></a></li><li><ul><li><a href="#key-shared-components"><span>Key <wbr/>Shared <wbr/>Components</span></a></li></ul></li><li><a href="#api-method-comparison"><span>API <wbr/>Method <wbr/>Comparison</span></a></li><li><ul><li><a href="#context-parameter-differences"><span>Context <wbr/>Parameter <wbr/>Differences</span></a></li></ul></li><li><a href="#mode-selection-guide"><span>Mode <wbr/>Selection <wbr/>Guide</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
