<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/08_component_registration | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_08_component_registration.html">design/08_component_registration</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="component-registration" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Component Registration<a href="#component-registration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This page explains how to register components in backtest-kit using the <code>add*</code> family of functions. Component registration is the first step in using the frameworkâ€”you define strategies, exchanges, frames, risk profiles, sizing configurations, and walkers before running backtests or live trading.</p>
<p>For information about the structure and properties of each component type, see <a href="design_23_component_types.html">Component Types</a>. For details on how registered components are instantiated during execution, see <a href="design_38_connection_services.html">Connection Services</a>.</p>
<hr>
<a id="component-types-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Component Types Overview<a href="#component-types-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework supports six types of components that can be registered:</p>
<table>
<thead>
<tr>
<th>Component Type</th>
<th>Add Function</th>
<th>Purpose</th>
<th>Required For</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Strategy</strong></td>
<td><code>addStrategy()</code></td>
<td>Signal generation logic and lifecycle callbacks</td>
<td>Backtest, Live</td>
</tr>
<tr>
<td><strong>Exchange</strong></td>
<td><code>addExchange()</code></td>
<td>Market data source and price/quantity formatting</td>
<td>Backtest, Live, Walker</td>
</tr>
<tr>
<td><strong>Frame</strong></td>
<td><code>addFrame()</code></td>
<td>Backtest timeframe generation (start/end dates, interval)</td>
<td>Backtest, Walker</td>
</tr>
<tr>
<td><strong>Risk</strong></td>
<td><code>addRisk()</code></td>
<td>Portfolio-level risk management and custom validations</td>
<td>Optional (strategy-level)</td>
</tr>
<tr>
<td><strong>Sizing</strong></td>
<td><code>addSizing()</code></td>
<td>Position size calculation methods</td>
<td>Optional (strategy-level)</td>
</tr>
<tr>
<td><strong>Walker</strong></td>
<td><code>addWalker()</code></td>
<td>Multi-strategy comparison configuration</td>
<td>Walker mode only</td>
</tr>
</tbody>
</table>
<p>Each component is identified by a unique name (<code>strategyName</code>, <code>exchangeName</code>, etc.) and stored in a corresponding schema service.</p>
<hr>
<a id="registration-functions" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Registration Functions<a href="#registration-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="function-signatures" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Function Signatures<a href="#function-signatures" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All registration functions follow the same pattern: accept a schema object and store it in the framework's internal registry.</p>
<p><img src="../media/08_Component_Registration_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Registration Function Flow</strong></p>
<a id="addstrategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">addStrategy<a href="#addstrategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Registers a trading strategy with signal generation logic and lifecycle callbacks.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>strategyName</code>: Unique identifier (string)</li>
<li><code>interval</code>: Signal generation throttle interval (<code>SignalInterval</code>)</li>
<li><code>getSignal</code>: Async function returning <code>ISignalDto | null</code></li>
<li><code>callbacks</code>: Optional lifecycle hooks (<code>onTick</code>, <code>onOpen</code>, <code>onClose</code>, <code>onSchedule</code>, <code>onCancel</code>)</li>
<li><code>riskName</code>: Optional risk profile name to use</li>
<li><code>sizingName</code>: Optional sizing configuration name to use</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;momentum-breakout&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">priceOpen:</span><span class="hl-1"> </span><span class="hl-8">50000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-8">51000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-8">49000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-8">60</span><span class="hl-1">,</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onOpen</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[</span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">] Signal opened at </span><span class="hl-6">${</span><span class="hl-4">price</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="addexchange" class="tsd-anchor"></a><h3 class="tsd-anchor-link">addExchange<a href="#addexchange" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Registers a market data source with candle fetching and formatting functions.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>exchangeName</code>: Unique identifier (string)</li>
<li><code>getCandles</code>: Async function fetching <code>ICandleData[]</code></li>
<li><code>formatPrice</code>: Async function formatting prices for exchange precision</li>
<li><code>formatQuantity</code>: Async function formatting quantities for exchange precision</li>
<li><code>callbacks</code>: Optional <code>onCandleData</code> callback</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-0">addExchange</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getCandles</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">since</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Fetch from API or database</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> [...];</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">formatPrice</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">price</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">price</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-8">2</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-0">formatQuantity</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">quantity</span><span class="hl-1">.</span><span class="hl-0">toFixed</span><span class="hl-1">(</span><span class="hl-8">8</span><span class="hl-1">),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="addframe" class="tsd-anchor"></a><h3 class="tsd-anchor-link">addFrame<a href="#addframe" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Registers a backtest timeframe with start/end dates and interval.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>frameName</code>: Unique identifier (string)</li>
<li><code>interval</code>: Timeframe granularity (<code>FrameInterval</code>)</li>
<li><code>startDate</code>: Backtest period start (Date)</li>
<li><code>endDate</code>: Backtest period end (Date)</li>
<li><code>callbacks</code>: Optional <code>onTimeframe</code> callback</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;2024-q1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-03-31T23:59:59Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="addrisk" class="tsd-anchor"></a><h3 class="tsd-anchor-link">addRisk<a href="#addrisk" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Registers a risk management profile with custom validations.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>riskName</code>: Unique identifier (string)</li>
<li><code>validations</code>: Array of <code>IRiskValidation</code> or <code>IRiskValidationFn</code></li>
<li><code>callbacks</code>: Optional <code>onRejected</code> and <code>onAllowed</code> callbacks</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-0">validate</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-8">5</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Max 5 concurrent positions&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Portfolio-level position limit&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="addsizing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">addSizing<a href="#addsizing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Registers a position sizing configuration (fixed-percentage, kelly-criterion, or atr-based).</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>sizingName</code>: Unique identifier (string)</li>
<li><code>method</code>: Sizing method discriminator</li>
<li>Method-specific parameters (see <a href="design_28_sizing_schemas.html">Sizing Schemas</a>)</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-0">addSizing</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">sizingName:</span><span class="hl-1"> </span><span class="hl-2">&quot;fixed-1pct&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;fixed-percentage&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskPercentage:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">maxPositionPercentage:</span><span class="hl-1"> </span><span class="hl-8">10</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="addwalker" class="tsd-anchor"></a><h3 class="tsd-anchor-link">addWalker<a href="#addwalker" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Registers a walker for multi-strategy comparison.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>walkerName</code>: Unique identifier (string)</li>
<li><code>exchangeName</code>: Exchange to use for all backtests</li>
<li><code>frameName</code>: Frame to use for all backtests</li>
<li><code>strategies</code>: Array of strategy names to compare</li>
<li><code>metric</code>: Optimization metric (<code>WalkerMetric</code>)</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-0">addWalker</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;strategy-optimizer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;2024-q1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategies:</span><span class="hl-1"> [</span><span class="hl-2">&quot;momentum-v1&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;momentum-v2&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;momentum-v3&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">metric:</span><span class="hl-1"> </span><span class="hl-2">&quot;sharpeRatio&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="registration-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Registration Flow<a href="#registration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="internal-mechanics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Internal Mechanics<a href="#internal-mechanics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When a component is registered via an <code>add*</code> function, the framework performs two operations:</p>
<ol>
<li><strong>Validation</strong>: Schema is validated and stored in a validation service</li>
<li><strong>Registration</strong>: Schema is stored in a schema service for later retrieval</li>
</ol>
<p><img src="../media/08_Component_Registration_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Registration Sequence</strong></p>
<p>Each <code>add*</code> function follows this pattern in <a href="">src/function/add.ts:50-341</a>:</p>
<pre><code class="typescript"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">addStrategy</span><span class="hl-1">(</span><span class="hl-4">strategySchema</span><span class="hl-1">: </span><span class="hl-10">IStrategySchema</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">// 1. Log registration</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-7">ADD_STRATEGY_METHOD_NAME</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-4">strategySchema</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// 2. Validate schema</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategyValidationService</span><span class="hl-1">.</span><span class="hl-0">addStrategy</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">strategySchema</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">strategySchema</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// 3. Store in registry</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">strategySchemaService</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">strategySchema</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">strategySchema</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="schema-storage-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Schema Storage Architecture<a href="#schema-storage-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="service-layer-organization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Layer Organization<a href="#service-layer-organization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Registered schemas are stored in schema services that follow the ToolRegistry pattern. Each component type has a dedicated schema service:</p>
<p><img src="../media/08_Component_Registration_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Schema Service Architecture</strong></p>
<p>The dependency injection configuration is defined in:</p>
<ul>
<li>Symbol definitions: <a href="">src/lib/core/types.ts:18-25</a></li>
<li>Service binding: <a href="">src/lib/core/provide.ts:62-68</a></li>
<li>Service injection: <a href="">src/lib/index.ts:80-91</a></li>
</ul>
<a id="toolregistry-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ToolRegistry Pattern<a href="#toolregistry-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Schema services use the ToolRegistry pattern for name-based storage and retrieval:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>register(name, schema)</code></td>
<td>Store schema by unique name</td>
</tr>
<tr>
<td><code>get(name)</code></td>
<td>Retrieve schema by name (throws if not found)</td>
</tr>
<tr>
<td><code>has(name)</code></td>
<td>Check if schema exists</td>
</tr>
<tr>
<td><code>list()</code></td>
<td>Get all registered schemas</td>
</tr>
</tbody>
</table>
<p>This pattern enables:</p>
<ul>
<li><strong>Name-based lookup</strong>: Components retrieved by string identifier during execution</li>
<li><strong>Duplicate prevention</strong>: Registration fails if name already exists</li>
<li><strong>Runtime introspection</strong>: All schemas can be listed for debugging</li>
</ul>
<hr>
<a id="validation-layer" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Layer<a href="#validation-layer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="validation-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Services<a href="#validation-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each component type has a corresponding validation service that performs schema validation during registration:</p>
<p><img src="../media/08_Component_Registration_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Validation Layer</strong></p>
<p>Validation services are bound in the DI container:</p>
<ul>
<li>Symbol definitions: <a href="">src/lib/core/types.ts:59-66</a></li>
<li>Service binding: <a href="">src/lib/core/provide.ts:103-109</a></li>
<li>Service injection: <a href="">src/lib/index.ts:143-150</a></li>
</ul>
<a id="memoization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoization<a href="#memoization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Validation services use memoization to cache validation results per component name. This ensures validation only runs once per component, even if the schema is retrieved multiple times during execution.</p>
<hr>
<a id="component-introspection" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Component Introspection<a href="#component-introspection" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="list-functions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">List Functions<a href="#list-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework provides <code>list*</code> functions for runtime introspection of registered components:</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Returns</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>listStrategies()</code></td>
<td><code>Promise&lt;IStrategySchema[]&gt;</code></td>
<td>All registered strategies</td>
</tr>
<tr>
<td><code>listExchanges()</code></td>
<td><code>Promise&lt;IExchangeSchema[]&gt;</code></td>
<td>All registered exchanges</td>
</tr>
<tr>
<td><code>listFrames()</code></td>
<td><code>Promise&lt;IFrameSchema[]&gt;</code></td>
<td>All registered frames</td>
</tr>
<tr>
<td><code>listRisks()</code></td>
<td><code>Promise&lt;IRiskSchema[]&gt;</code></td>
<td>All registered risk profiles</td>
</tr>
<tr>
<td><code>listSizings()</code></td>
<td><code>Promise&lt;ISizingSchema[]&gt;</code></td>
<td>All registered sizing configs</td>
</tr>
<tr>
<td><code>listWalkers()</code></td>
<td><code>Promise&lt;IWalkerSchema[]&gt;</code></td>
<td>All registered walkers</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addStrategy</span><span class="hl-1">, </span><span class="hl-4">listStrategies</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;momentum&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({ </span><span class="hl-5">/* ... */</span><span class="hl-1"> }),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">strategies</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">listStrategies</span><span class="hl-1">();</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">strategies</span><span class="hl-1">);</span><br/><span class="hl-5">// [{ strategyName: &quot;momentum&quot;, interval: &quot;5m&quot;, ... }]</span>
</code><button type="button">Copy</button></pre>

<p>These functions delegate to the validation services' <code>list()</code> method, which returns all schemas stored in the registry.</p>
<hr>
<a id="registration-and-execution-lifecycle" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Registration and Execution Lifecycle<a href="#registration-and-execution-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="timeline-overview" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Timeline Overview<a href="#timeline-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The relationship between registration and execution follows this sequence:</p>
<p><img src="../media/08_Component_Registration_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Registration to Execution Lifecycle</strong></p>
<p>Key points:</p>
<ol>
<li><strong>Registration phase</strong> (user calls <code>add*</code>): Schemas validated and stored</li>
<li><strong>Ready phase</strong>: No client instances created, schemas in memory</li>
<li><strong>Execution phase</strong> (user calls <code>Backtest.run</code> or <code>Live.run</code>): Connection services retrieve schemas and create memoized client instances</li>
</ol>
<p>For details on client instantiation, see <a href="design_38_connection_services.html">Connection Services</a>. For execution orchestration, see <a href="design_06_execution_modes.html">Execution Modes</a>.</p>
<hr>
<a id="symbol-based-dependency-injection" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Symbol-Based Dependency Injection<a href="#symbol-based-dependency-injection" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="di-token-system" class="tsd-anchor"></a><h3 class="tsd-anchor-link">DI Token System<a href="#di-token-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All schema services and validation services are bound using Symbol-based tokens in the DI container. This prevents naming collisions and provides type safety:</p>
<p><img src="../media/08_Component_Registration_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Symbol-Based DI Token Flow</strong></p>
<p>The complete DI setup is defined across three files:</p>
<ol>
<li>Token symbols: <a href="">src/lib/core/types.ts:1-81</a></li>
<li>Service binding: <a href="">src/lib/core/provide.ts:1-111</a></li>
<li>Service injection: <a href="">src/lib/index.ts:1-170</a></li>
</ol>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#component-registration"><span>Component <wbr/>Registration</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#component-types-overview"><span>Component <wbr/>Types <wbr/>Overview</span></a></li><li><a href="#registration-functions"><span>Registration <wbr/>Functions</span></a></li><li><ul><li><a href="#function-signatures"><span>Function <wbr/>Signatures</span></a></li><li><a href="#addstrategy"><span>add<wbr/>Strategy</span></a></li><li><a href="#addexchange"><span>add<wbr/>Exchange</span></a></li><li><a href="#addframe"><span>add<wbr/>Frame</span></a></li><li><a href="#addrisk"><span>add<wbr/>Risk</span></a></li><li><a href="#addsizing"><span>add<wbr/>Sizing</span></a></li><li><a href="#addwalker"><span>add<wbr/>Walker</span></a></li></ul></li><li><a href="#registration-flow"><span>Registration <wbr/>Flow</span></a></li><li><ul><li><a href="#internal-mechanics"><span>Internal <wbr/>Mechanics</span></a></li></ul></li><li><a href="#schema-storage-architecture"><span>Schema <wbr/>Storage <wbr/>Architecture</span></a></li><li><ul><li><a href="#service-layer-organization"><span>Service <wbr/>Layer <wbr/>Organization</span></a></li><li><a href="#toolregistry-pattern"><span>Tool<wbr/>Registry <wbr/>Pattern</span></a></li></ul></li><li><a href="#validation-layer"><span>Validation <wbr/>Layer</span></a></li><li><ul><li><a href="#validation-services"><span>Validation <wbr/>Services</span></a></li><li><a href="#memoization"><span>Memoization</span></a></li></ul></li><li><a href="#component-introspection"><span>Component <wbr/>Introspection</span></a></li><li><ul><li><a href="#list-functions"><span>List <wbr/>Functions</span></a></li></ul></li><li><a href="#registration-and-execution-lifecycle"><span>Registration and <wbr/>Execution <wbr/>Lifecycle</span></a></li><li><ul><li><a href="#timeline-overview"><span>Timeline <wbr/>Overview</span></a></li></ul></li><li><a href="#symbol-based-dependency-injection"><span>Symbol-<wbr/>Based <wbr/>Dependency <wbr/>Injection</span></a></li><li><ul><li><a href="#di-token-system"><span>DI <wbr/>Token <wbr/>System</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
