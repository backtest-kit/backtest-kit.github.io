<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/65_risk_validation | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_65_risk_validation.html">design/65_risk_validation</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="risk-validation" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Risk Validation<a href="#risk-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents the risk validation flow in <code>backtest-kit</code>, specifically how custom validation functions are executed to approve or reject trading signals before they are opened. Risk validation occurs after signal generation but before position opening, providing portfolio-level risk controls.</p>
<p>For information about defining risk profiles and their structure, see <a href="design_64_risk_profiles.html">Risk Profiles</a>. For details on how active positions are tracked across strategies, see <a href="design_66_position_tracking.html">Position Tracking</a>.</p>
<hr>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Risk validation is the process by which <code>ClientRisk</code> evaluates whether a new signal should be allowed to open based on custom validation logic. When a strategy generates a signal, the following sequence occurs:</p>
<ol>
<li><strong>Signal Generation</strong>: Strategy's <code>getSignal()</code> returns a signal DTO</li>
<li><strong>Signal Validation</strong>: Framework validates price logic, distances, and lifetime</li>
<li><strong>Risk Check</strong>: <code>ClientRisk.checkSignal()</code> executes custom validations with portfolio context</li>
<li><strong>Decision</strong>: Signal is either approved (opens position) or rejected (returns to idle)</li>
</ol>
<p>The risk validation system provides access to:</p>
<ul>
<li>Signal parameters (symbol, strategy, exchange, current price, timestamp)</li>
<li>Portfolio state (active position count, list of all active positions)</li>
<li>Ability to throw errors to reject signals with descriptive messages</li>
</ul>
<hr>
<a id="validation-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Flow<a href="#validation-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/65_Risk_Validation_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="validation-payload-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Payload Structure<a href="#validation-payload-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>IRiskValidationPayload</code> interface extends <code>IRiskCheckArgs</code> with portfolio state information. This is the argument passed to every validation function.</p>
<a id="iriskcheckargs-base-context" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IRiskCheckArgs (Base Context)<a href="#iriskcheckargs-base-context" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskCheckArgs</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;           </span><span class="hl-5">// Trading pair (e.g., &quot;BTCUSDT&quot;)</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">StrategyName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">ExchangeName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;     </span><span class="hl-5">// Current VWAP price</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;        </span><span class="hl-5">// Current timestamp</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>These fields are passed directly from <code>ClientStrategy</code> context and represent the current signal request parameters.</p>
<a id="iriskvalidationpayload-full-context" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IRiskValidationPayload (Full Context)<a href="#iriskvalidationpayload-full-context" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskValidationPayload</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-10">IRiskCheckArgs</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">activePositionCount</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;        </span><span class="hl-5">// Total active positions</span><br/><span class="hl-1">  </span><span class="hl-4">activePositions</span><span class="hl-1">: </span><span class="hl-10">IRiskActivePosition</span><span class="hl-1">[];  </span><span class="hl-5">// Full position details</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The payload is constructed in <code>ClientRisk.checkSignal()</code> by augmenting <code>IRiskCheckArgs</code> with portfolio state:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>activePositionCount</code></td>
<td><code>number</code></td>
<td>Number of currently open positions across all strategies sharing this risk profile</td>
</tr>
<tr>
<td><code>activePositions</code></td>
<td><code>IRiskActivePosition[]</code></td>
<td>Array of all active position objects with signal details, strategy names, and timestamps</td>
</tr>
</tbody>
</table>
<a id="iriskactiveposition-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IRiskActivePosition Structure<a href="#iriskactiveposition-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskActivePosition</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">signal</span><span class="hl-1">: </span><span class="hl-10">ISignalRow</span><span class="hl-1">;        </span><span class="hl-5">// Full signal details</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;      </span><span class="hl-5">// Strategy owning this position</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">;      </span><span class="hl-5">// Exchange for this position</span><br/><span class="hl-1">  </span><span class="hl-4">openTimestamp</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;     </span><span class="hl-5">// When position opened</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>This allows validations to inspect individual positions, check per-strategy exposure, or implement complex portfolio logic.</p>
<hr>
<a id="validation-function-types" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Function Types<a href="#validation-function-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Risk validations can be defined in two forms: as standalone functions or as objects with metadata.</p>
<a id="function-form" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Function Form<a href="#function-form" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">IRiskValidationFn</span><span class="hl-1"> = (</span><span class="hl-4">payload</span><span class="hl-1">: </span><span class="hl-10">IRiskValidationPayload</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1"> | </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">void</span><span class="hl-1">&gt;;</span><br/><br/><span class="hl-5">// Example</span><br/><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-risk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-8">5</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Maximum 5 concurrent positions allowed&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="object-form-with-note" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Object Form (with note)<a href="#object-form-with-note" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskValidation</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">validate</span><span class="hl-1">: </span><span class="hl-10">IRiskValidationFn</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Example</span><br/><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-risk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-0">validate</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-8">5</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Max positions reached&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Limit concurrent positions to 5&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The object form allows documentation of validation logic. The framework normalizes both forms internally.</p>
<hr>
<a id="do_validation_fn-wrapper" class="tsd-anchor"></a><h2 class="tsd-anchor-link">DO_VALIDATION_FN Wrapper<a href="#do_validation_fn-wrapper" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>DO_VALIDATION_FN</code> is a <code>trycatch</code> wrapper that executes validation functions with error handling and logging.</p>
<p><img src="../media/65_Risk_Validation_1.svg" alt="Mermaid Diagram"></p>
<a id="implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Implementation<a href="#implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The wrapper is defined at <a href="">src/client/ClientRisk.ts:31-46</a>:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">DO_VALIDATION_FN</span><span class="hl-1"> = </span><span class="hl-0">trycatch</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">validation</span><span class="hl-1">: </span><span class="hl-10">IRiskValidationFn</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-10">IRiskValidationPayload</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">validation</span><span class="hl-1">(</span><span class="hl-4">params</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">defaultValue:</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">fallback</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">backtest</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">&quot;ClientRisk exception thrown&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-0">errorData</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-0">getErrorMessage</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">),</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-4">validationSubject</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="behavior" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Behavior<a href="#behavior" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Validation Result</th>
<th>Return Value</th>
<th>Side Effects</th>
</tr>
</thead>
<tbody>
<tr>
<td>No error thrown</td>
<td><code>true</code></td>
<td>None</td>
</tr>
<tr>
<td>Error thrown</td>
<td><code>false</code></td>
<td>Logs warning, emits to <code>validationSubject</code></td>
</tr>
</tbody>
</table>
<p>This ensures that validation errors never crash the system but are properly logged and observable via <code>listenValidation()</code>.</p>
<hr>
<a id="clientriskchecksignal-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ClientRisk.checkSignal Implementation<a href="#clientriskchecksignal-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>checkSignal</code> method is the core validation orchestration function in <code>ClientRisk</code>.</p>
<a id="method-signature" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Method Signature<a href="#method-signature" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">checkSignal</span><span class="hl-1"> = </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-10">IRiskCheckArgs</span><span class="hl-1">): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">boolean</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="execution-steps" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Execution Steps<a href="#execution-steps" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/65_Risk_Validation_2.svg" alt="Mermaid Diagram"></p>
<a id="code-walkthrough" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Code Walkthrough<a href="#code-walkthrough" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="1-initialize-active-positions" class="tsd-anchor"></a><h4 class="tsd-anchor-link">1. Initialize Active Positions<a href="#1-initialize-active-positions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_activePositions</span><span class="hl-1"> === </span><span class="hl-7">POSITION_NEED_FETCH</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">waitForInit</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Lazy initialization loads persisted positions from disk on first use. See <a href="design_66_position_tracking.html">Position Tracking</a> for details.</p>
<a id="2-build-validation-payload" class="tsd-anchor"></a><h4 class="tsd-anchor-link">2. Build Validation Payload<a href="#2-build-validation-payload" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">riskMap</span><span class="hl-1"> = &lt;</span><span class="hl-10">RiskMap</span><span class="hl-1">&gt;</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_activePositions</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">payload</span><span class="hl-1">: </span><span class="hl-10">IRiskValidationPayload</span><span class="hl-1"> = {</span><br/><span class="hl-1">  ...</span><span class="hl-4">params</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">activePositionCount:</span><span class="hl-1"> </span><span class="hl-4">riskMap</span><span class="hl-1">.</span><span class="hl-4">size</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">activePositions:</span><span class="hl-1"> </span><span class="hl-4">Array</span><span class="hl-1">.</span><span class="hl-0">from</span><span class="hl-1">(</span><span class="hl-4">riskMap</span><span class="hl-1">.</span><span class="hl-0">values</span><span class="hl-1">()),</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>The payload combines passthrough arguments from <code>ClientStrategy</code> with current portfolio state.</p>
<a id="3-execute-validations" class="tsd-anchor"></a><h4 class="tsd-anchor-link">3. Execute Validations<a href="#3-execute-validations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-4">isValid</span><span class="hl-1"> = </span><span class="hl-6">true</span><span class="hl-1">;</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">validations</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">validation</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">validations</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><br/><span class="hl-1">      </span><span class="hl-0">not</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">DO_VALIDATION_FN</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-6">typeof</span><span class="hl-1"> </span><span class="hl-4">validation</span><span class="hl-1"> === </span><span class="hl-2">&quot;function&quot;</span><br/><span class="hl-1">            ? </span><span class="hl-4">validation</span><br/><span class="hl-1">            : </span><span class="hl-4">validation</span><span class="hl-1">.</span><span class="hl-4">validate</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">payload</span><br/><span class="hl-1">        )</span><br/><span class="hl-1">      )</span><br/><span class="hl-1">    ) {</span><br/><span class="hl-1">      </span><span class="hl-4">isValid</span><span class="hl-1"> = </span><span class="hl-6">false</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">break</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Validations execute sequentially. The loop breaks immediately on first failure (short-circuit evaluation). Both function and object forms are normalized to extract the validation function.</p>
<a id="4-handle-result" class="tsd-anchor"></a><h4 class="tsd-anchor-link">4. Handle Result<a href="#4-handle-result" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">isValid</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">callbacks</span><span class="hl-1">?.</span><span class="hl-4">onRejected</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">callbacks</span><span class="hl-1">.</span><span class="hl-0">onRejected</span><span class="hl-1">(</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// All checks passed</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">callbacks</span><span class="hl-1">?.</span><span class="hl-4">onAllowed</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">callbacks</span><span class="hl-1">.</span><span class="hl-0">onAllowed</span><span class="hl-1">(</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>Callbacks fire based on validation result. The method returns <code>true</code> for approval, <code>false</code> for rejection.</p>
<hr>
<a id="validation-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Patterns<a href="#validation-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="pattern-1-position-count-limits" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 1: Position Count Limits<a href="#pattern-1-position-count-limits" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;max-positions&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-8">3</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Maximum 3 concurrent positions allowed&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Most common pattern. Prevents excessive portfolio exposure by limiting total open positions.</p>
<a id="pattern-2-symbol-filtering" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 2: Symbol Filtering<a href="#pattern-2-symbol-filtering" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;symbol-filter&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">symbol</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1"> === </span><span class="hl-2">&quot;DOGEUSDT&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;DOGE trading not allowed&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Reject signals for specific trading pairs based on symbol name.</p>
<a id="pattern-3-per-strategy-position-tracking" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 3: Per-Strategy Position Tracking<a href="#pattern-3-per-strategy-position-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;per-strategy-limit&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">activePositions</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">strategyPositions</span><span class="hl-1"> = </span><span class="hl-4">activePositions</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-4">pos</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">pos</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1"> === </span><span class="hl-4">strategyName</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">strategyPositions</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt;= </span><span class="hl-8">2</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`Strategy </span><span class="hl-6">${</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2"> already has 2 positions`</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Limit positions per individual strategy using the <code>activePositions</code> array.</p>
<a id="pattern-4-time-based-filtering" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 4: Time-Based Filtering<a href="#pattern-4-time-based-filtering" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;time-filter&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">timestamp</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">hour</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-4">timestamp</span><span class="hl-1">).</span><span class="hl-0">getHours</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">hour</span><span class="hl-1"> &lt; </span><span class="hl-8">8</span><span class="hl-1"> || </span><span class="hl-4">hour</span><span class="hl-1"> &gt; </span><span class="hl-8">16</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Trading only allowed during business hours&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Use the <code>timestamp</code> field to implement time-of-day restrictions.</p>
<hr>
<a id="service-layer-routing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Layer Routing<a href="#service-layer-routing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Risk validation requests flow through multiple service layers before reaching <code>ClientRisk</code>.</p>
<p><img src="../media/65_Risk_Validation_3.svg" alt="Mermaid Diagram"></p>
<a id="service-responsibilities" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Responsibilities<a href="#service-responsibilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Service</th>
<th>File</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>RiskGlobalService</code></td>
<td><a href="">src/lib/services/global/RiskGlobalService.ts:15-114</a></td>
<td>Public API, memoized validation</td>
</tr>
<tr>
<td><code>RiskValidationService</code></td>
<td><a href="">src/lib/services/validation/RiskValidationService.ts</a></td>
<td>Schema existence checks</td>
</tr>
<tr>
<td><code>RiskConnectionService</code></td>
<td><a href="">src/lib/services/connection/RiskConnectionService.ts:41-135</a></td>
<td>Memoized <code>ClientRisk</code> instances</td>
</tr>
<tr>
<td><code>ClientRisk</code></td>
<td><a href="">src/client/ClientRisk.ts:73-218</a></td>
<td>Validation execution, position tracking</td>
</tr>
</tbody>
</table>
<hr>
<a id="callbacks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Callbacks<a href="#callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Risk schemas support two optional callbacks that fire based on validation results.</p>
<a id="onrejected-callback" class="tsd-anchor"></a><h3 class="tsd-anchor-link">onRejected Callback<a href="#onrejected-callback" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onRejected</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-10">IRiskCheckArgs</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Fires when any validation throws an error. Receives:</p>
<ul>
<li><code>symbol</code>: Trading pair that was rejected</li>
<li><code>params</code>: Full <code>IRiskCheckArgs</code> with rejection context</li>
</ul>
<p><strong>Use case</strong>: Log rejected signals, track rejection reasons, send alerts.</p>
<a id="onallowed-callback" class="tsd-anchor"></a><h3 class="tsd-anchor-link">onAllowed Callback<a href="#onallowed-callback" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IRiskCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onAllowed</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-10">IRiskCheckArgs</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Fires when all validations pass. Receives same parameters as <code>onRejected</code>.</p>
<p><strong>Use case</strong>: Track approved signals, monitor validation pass rate, log portfolio changes.</p>
<a id="example-usage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example Usage<a href="#example-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;monitored-risk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-8">5</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Max positions&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onRejected</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`REJECTED: </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2"> (</span><span class="hl-6">${</span><span class="hl-4">params</span><span class="hl-9">.</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">)`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onAllowed</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`APPROVED: </span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2"> (</span><span class="hl-6">${</span><span class="hl-4">params</span><span class="hl-9">.</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">)`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="validation-error-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Error Handling<a href="#validation-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Validation errors are caught and emitted via the event system, allowing external monitoring.</p>
<a id="error-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Flow<a href="#error-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/65_Risk_Validation_4.svg" alt="Mermaid Diagram"></p>
<a id="subscribing-to-validation-errors" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Subscribing to Validation Errors<a href="#subscribing-to-validation-errors" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenValidation</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;backtest-kit&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">unsubscribe</span><span class="hl-1"> = </span><span class="hl-0">listenValidation</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Risk validation error:&#39;</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Send to monitoring system</span><br/><span class="hl-1">  </span><span class="hl-0">sendAlert</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;RISK_VALIDATION_ERROR&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">()</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The <code>listenValidation</code> function subscribes to the <code>validationSubject</code> emitter, receiving all validation errors across all risk profiles.</p>
<hr>
<a id="testing-validation-logic" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Testing Validation Logic<a href="#testing-validation-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Risk validations are deterministic and testable by simulating portfolio state.</p>
<a id="example-test-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example Test Pattern<a href="#example-test-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">test</span><span class="hl-1">(</span><span class="hl-2">&quot;Risk validation rejects when limit exceeded&quot;</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">pass</span><span class="hl-1">, </span><span class="hl-4">fail</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-4">rejectedSymbol</span><span class="hl-1"> = </span><span class="hl-6">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-risk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">      ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-8">3</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Max 3 positions&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">onRejected</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">rejectedSymbol</span><span class="hl-1"> = </span><span class="hl-4">symbol</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-7">riskGlobalService</span><span class="hl-1"> } = </span><span class="hl-4">lib</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Add 3 positions</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">riskGlobalService</span><span class="hl-1">.</span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, { </span><br/><span class="hl-1">    </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-strategy-1&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">    </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-risk&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">riskGlobalService</span><span class="hl-1">.</span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-2">&quot;ETHUSDT&quot;</span><span class="hl-1">, { </span><br/><span class="hl-1">    </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-strategy-2&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">    </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-risk&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">riskGlobalService</span><span class="hl-1">.</span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-2">&quot;BNBUSDT&quot;</span><span class="hl-1">, { </span><br/><span class="hl-1">    </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-strategy-3&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">    </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-risk&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// 4th signal should fail</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">riskGlobalService</span><span class="hl-1">.</span><span class="hl-0">checkSignal</span><span class="hl-1">(</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-2">&quot;SOLUSDT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-strategy-4&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">currentPrice:</span><span class="hl-1"> </span><span class="hl-8">100</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">()</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    { </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-risk&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">result</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">rejectedSymbol</span><span class="hl-1"> === </span><span class="hl-2">&quot;SOLUSDT&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">pass</span><span class="hl-1">(</span><span class="hl-2">&quot;Validation correctly rejected 4th position&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="validation-best-practices" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Best Practices<a href="#validation-best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="1-throw-descriptive-errors" class="tsd-anchor"></a><h3 class="tsd-anchor-link">1. Throw Descriptive Errors<a href="#1-throw-descriptive-errors" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Good: Clear error message</span><br/><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Maximum 5 concurrent positions exceeded (current: 6)&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Bad: Generic error</span><br/><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Failed&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Error messages appear in logs and validation events, aiding debugging.</p>
<a id="2-use-short-circuit-evaluation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">2. Use Short-Circuit Evaluation<a href="#2-use-short-circuit-evaluation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Validations execute sequentially and stop at first failure. Place most restrictive checks first:</p>
<pre><code class="typescript"><span class="hl-12">validations</span><span class="hl-1">: [</span><br/><span class="hl-1">  </span><span class="hl-5">// Check count first (fast, common rejection)</span><br/><span class="hl-1">  ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-8">5</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Max positions&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// Then check complex portfolio logic (slower, rare rejection)</span><br/><span class="hl-1">  ({ </span><span class="hl-4">activePositions</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// ... expensive calculation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">]</span>
</code><button type="button">Copy</button></pre>

<a id="3-validate-all-required-fields" class="tsd-anchor"></a><h3 class="tsd-anchor-link">3. Validate All Required Fields<a href="#3-validate-all-required-fields" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-1">({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">activePositionCount</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">symbol</span><span class="hl-1"> || </span><span class="hl-6">typeof</span><span class="hl-1"> </span><span class="hl-4">activePositionCount</span><span class="hl-1"> !== </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Invalid risk check payload&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-5">// ... validation logic</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="4-isolate-risk-profiles" class="tsd-anchor"></a><h3 class="tsd-anchor-link">4. Isolate Risk Profiles<a href="#4-isolate-risk-profiles" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each <code>riskName</code> has independent position tracking. Use separate risk profiles for different strategies or portfolio sections:</p>
<pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({ </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative&quot;</span><span class="hl-1">, </span><span class="hl-4">validations:</span><span class="hl-1"> [...] });</span><br/><span class="hl-0">addRisk</span><span class="hl-1">({ </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;aggressive&quot;</span><span class="hl-1">, </span><span class="hl-4">validations:</span><span class="hl-1"> [...] });</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({ </span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;safe-strategy&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({ </span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;risky-strategy&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;aggressive&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#risk-validation"><span>Risk <wbr/>Validation</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#validation-flow"><span>Validation <wbr/>Flow</span></a></li><li><a href="#validation-payload-structure"><span>Validation <wbr/>Payload <wbr/>Structure</span></a></li><li><ul><li><a href="#iriskcheckargs-base-context"><span>IRisk<wbr/>Check<wbr/>Args (<wbr/>Base <wbr/>Context)</span></a></li><li><a href="#iriskvalidationpayload-full-context"><span>IRisk<wbr/>Validation<wbr/>Payload (<wbr/>Full <wbr/>Context)</span></a></li><li><a href="#iriskactiveposition-structure"><span>IRisk<wbr/>Active<wbr/>Position <wbr/>Structure</span></a></li></ul></li><li><a href="#validation-function-types"><span>Validation <wbr/>Function <wbr/>Types</span></a></li><li><ul><li><a href="#function-form"><span>Function <wbr/>Form</span></a></li><li><a href="#object-form-with-note"><span>Object <wbr/>Form (with note)</span></a></li></ul></li><li><a href="#do_validation_fn-wrapper"><span>DO_<wbr/>VALIDATION_<wbr/>FN <wbr/>Wrapper</span></a></li><li><ul><li><a href="#implementation"><span>Implementation</span></a></li><li><a href="#behavior"><span>Behavior</span></a></li></ul></li><li><a href="#clientriskchecksignal-implementation"><span>Client<wbr/>Risk.check<wbr/>Signal <wbr/>Implementation</span></a></li><li><ul><li><a href="#method-signature"><span>Method <wbr/>Signature</span></a></li><li><a href="#execution-steps"><span>Execution <wbr/>Steps</span></a></li><li><a href="#code-walkthrough"><span>Code <wbr/>Walkthrough</span></a></li><li><ul><li><a href="#1-initialize-active-positions"><span>1. <wbr/>Initialize <wbr/>Active <wbr/>Positions</span></a></li><li><a href="#2-build-validation-payload"><span>2. <wbr/>Build <wbr/>Validation <wbr/>Payload</span></a></li><li><a href="#3-execute-validations"><span>3. <wbr/>Execute <wbr/>Validations</span></a></li><li><a href="#4-handle-result"><span>4. <wbr/>Handle <wbr/>Result</span></a></li></ul></li></ul></li><li><a href="#validation-patterns"><span>Validation <wbr/>Patterns</span></a></li><li><ul><li><a href="#pattern-1-position-count-limits"><span>Pattern 1: <wbr/>Position <wbr/>Count <wbr/>Limits</span></a></li><li><a href="#pattern-2-symbol-filtering"><span>Pattern 2: <wbr/>Symbol <wbr/>Filtering</span></a></li><li><a href="#pattern-3-per-strategy-position-tracking"><span>Pattern 3: <wbr/>Per-<wbr/>Strategy <wbr/>Position <wbr/>Tracking</span></a></li><li><a href="#pattern-4-time-based-filtering"><span>Pattern 4: <wbr/>Time-<wbr/>Based <wbr/>Filtering</span></a></li></ul></li><li><a href="#service-layer-routing"><span>Service <wbr/>Layer <wbr/>Routing</span></a></li><li><ul><li><a href="#service-responsibilities"><span>Service <wbr/>Responsibilities</span></a></li></ul></li><li><a href="#callbacks"><span>Callbacks</span></a></li><li><ul><li><a href="#onrejected-callback"><span>on<wbr/>Rejected <wbr/>Callback</span></a></li><li><a href="#onallowed-callback"><span>on<wbr/>Allowed <wbr/>Callback</span></a></li><li><a href="#example-usage"><span>Example <wbr/>Usage</span></a></li></ul></li><li><a href="#validation-error-handling"><span>Validation <wbr/>Error <wbr/>Handling</span></a></li><li><ul><li><a href="#error-flow"><span>Error <wbr/>Flow</span></a></li><li><a href="#subscribing-to-validation-errors"><span>Subscribing to <wbr/>Validation <wbr/>Errors</span></a></li></ul></li><li><a href="#testing-validation-logic"><span>Testing <wbr/>Validation <wbr/>Logic</span></a></li><li><ul><li><a href="#example-test-pattern"><span>Example <wbr/>Test <wbr/>Pattern</span></a></li></ul></li><li><a href="#validation-best-practices"><span>Validation <wbr/>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#1-throw-descriptive-errors"><span>1. <wbr/>Throw <wbr/>Descriptive <wbr/>Errors</span></a></li><li><a href="#2-use-short-circuit-evaluation"><span>2. <wbr/>Use <wbr/>Short-<wbr/>Circuit <wbr/>Evaluation</span></a></li><li><a href="#3-validate-all-required-fields"><span>3. <wbr/>Validate <wbr/>All <wbr/>Required <wbr/>Fields</span></a></li><li><a href="#4-isolate-risk-profiles"><span>4. <wbr/>Isolate <wbr/>Risk <wbr/>Profiles</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
