<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/41_global_services | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_41_global_services.html">design/41_global_services</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="global-services" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Global Services<a href="#global-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Global Services form Layer 1 of the service architecture, serving as public API entry points that orchestrate validation and delegate operations to lower-level services. These services provide a consistent interface for component registration, validation, and execution across the framework.</p>
<p>For information about the overall service layer organization, see <a href="design_37_service_architecture_overview.html">Service Architecture Overview</a>. For details on the services that Global Services delegate to, see <a href="design_38_connection_services.html">Connection Services</a>, <a href="design_39_schema_services.html">Schema Services</a>, <a href="design_40_validation_services.html">Validation Services</a>, and <a href="design_42_logic_services.html">Logic Services</a>.</p>
<hr>
<a id="service-categories" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Categories<a href="#service-categories" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides two categories of Global Services, each serving distinct purposes in the architecture.</p>
<a id="component-global-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Component Global Services<a href="#component-global-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Component Global Services manage the lifecycle and access patterns for registered components (strategies, exchanges, frames, risk profiles, sizing configurations, walkers). Each component type has a corresponding Global Service:</p>
<table>
<thead>
<tr>
<th>Global Service Class</th>
<th>Component Type</th>
<th>Primary Responsibilities</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>StrategyGlobalService</code></td>
<td>Trading strategies</td>
<td>Validation orchestration, delegation to StrategyConnectionService</td>
</tr>
<tr>
<td><code>ExchangeGlobalService</code></td>
<td>Market data sources</td>
<td>Validation orchestration, delegation to ExchangeConnectionService</td>
</tr>
<tr>
<td><code>FrameGlobalService</code></td>
<td>Backtest timeframes</td>
<td>Validation orchestration, delegation to FrameConnectionService</td>
</tr>
<tr>
<td><code>RiskGlobalService</code></td>
<td>Risk profiles</td>
<td>Validation orchestration, position tracking delegation</td>
</tr>
<tr>
<td><code>SizingGlobalService</code></td>
<td>Position sizing</td>
<td>Validation orchestration, sizing calculation delegation</td>
</tr>
<tr>
<td><code>WalkerGlobalService</code></td>
<td>Strategy comparisons</td>
<td>Validation orchestration, multi-strategy execution</td>
</tr>
</tbody>
</table>
<a id="execution-mode-global-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Execution Mode Global Services<a href="#execution-mode-global-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Execution Mode Global Services provide entry points for running backtests and live trading:</p>
<table>
<thead>
<tr>
<th>Global Service Class</th>
<th>Execution Mode</th>
<th>Primary Responsibilities</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BacktestGlobalService</code></td>
<td>Historical simulation</td>
<td>Delegates to BacktestLogicPublicService</td>
</tr>
<tr>
<td><code>LiveGlobalService</code></td>
<td>Real-time trading</td>
<td>Delegates to LiveLogicPublicService</td>
</tr>
<tr>
<td><code>WalkerGlobalService</code></td>
<td>Strategy comparison</td>
<td>Also serves as execution mode service</td>
</tr>
</tbody>
</table>
<hr>
<a id="global-service-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Global Service Architecture<a href="#global-service-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/41_Global_Services_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Purpose</strong>: This diagram illustrates how Global Services act as an intermediary layer between public APIs and lower-level services. Component Global Services orchestrate validation and delegate to Connection Services, while Execution Global Services delegate to Logic Services.</p>
<hr>
<a id="component-global-service-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Component Global Service Pattern<a href="#component-global-service-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Component Global Services follow a consistent implementation pattern with three key responsibilities: dependency injection, validation orchestration, and operation delegation.</p>
<a id="standard-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Standard Structure<a href="#standard-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/41_Global_Services_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Purpose</strong>: This diagram shows the standard implementation pattern for Component Global Services using RiskGlobalService as an example. All public methods follow the log-validate-delegate sequence.</p>
<a id="dependency-injection-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Dependency Injection Pattern<a href="#dependency-injection-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Component Global Services inject three types of dependencies:</p>
<pre><code class="typescript"><span class="hl-5">// Pattern from RiskGlobalService</span><br/><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">readonly</span><span class="hl-1"> </span><span class="hl-4">loggerService</span><span class="hl-1"> = </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">LoggerService</span><span class="hl-1">&gt;(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">);</span><br/><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">readonly</span><span class="hl-1"> </span><span class="hl-4">riskConnectionService</span><span class="hl-1"> = </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">RiskConnectionService</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">  </span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">riskConnectionService</span><br/><span class="hl-1">);</span><br/><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">readonly</span><span class="hl-1"> </span><span class="hl-4">riskValidationService</span><span class="hl-1"> = </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">RiskValidationService</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">  </span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">riskValidationService</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<table>
<thead>
<tr>
<th>Dependency Type</th>
<th>Purpose</th>
<th>Usage Pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>LoggerService</code></td>
<td>Operation logging</td>
<td>Every public method logs entry with context</td>
</tr>
<tr>
<td><code>*ConnectionService</code></td>
<td>Client instance management</td>
<td>Delegate actual operations after validation</td>
</tr>
<tr>
<td><code>*ValidationService</code></td>
<td>Schema validation</td>
<td>Called by memoized <code>validate()</code> method</td>
</tr>
</tbody>
</table>
<a id="validation-orchestration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Orchestration<a href="#validation-orchestration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The validation pattern uses memoization to avoid redundant schema checks:</p>
<p><img src="../media/41_Global_Services_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Purpose</strong>: This sequence diagram demonstrates the validation orchestration pattern. The first call to <code>validate()</code> for a given component name performs validation and caches the result. Subsequent calls return immediately from cache.</p>
<a id="implementation-example-riskglobalservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Implementation Example: RiskGlobalService<a href="#implementation-example-riskglobalservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>RiskGlobalService</code> exemplifies the Component Global Service pattern:</p>
<p><a href="">src/lib/services/global/RiskGlobalService.ts:15-114</a></p>
<p><strong>Key methods:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Parameters</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>validate()</code></td>
<td><code>riskName: RiskName</code></td>
<td>Memoized validation call to <code>RiskValidationService.validate()</code></td>
</tr>
<tr>
<td><code>checkSignal()</code></td>
<td><code>params: IRiskCheckArgs</code>, <code>context: {riskName}</code></td>
<td>Log → Validate → Delegate to <code>RiskConnectionService.checkSignal()</code></td>
</tr>
<tr>
<td><code>addSignal()</code></td>
<td><code>symbol: string</code>, <code>context: {strategyName, riskName}</code></td>
<td>Log → Validate → Delegate to <code>RiskConnectionService.addSignal()</code></td>
</tr>
<tr>
<td><code>removeSignal()</code></td>
<td><code>symbol: string</code>, <code>context: {strategyName, riskName}</code></td>
<td>Log → Validate → Delegate to <code>RiskConnectionService.removeSignal()</code></td>
</tr>
<tr>
<td><code>clear()</code></td>
<td><code>riskName?: RiskName</code></td>
<td>Optional validation → Delegate to <code>RiskConnectionService.clear()</code></td>
</tr>
</tbody>
</table>
<p><strong>Validation flow:</strong></p>
<ol>
<li>Public method receives component name (e.g., <code>riskName</code>)</li>
<li>Calls <code>this.validate(riskName)</code> before operation</li>
<li>Memoized <code>validate()</code> checks if validation already performed</li>
<li>First call: delegates to <code>riskValidationService.validate(riskName, source)</code></li>
<li>Subsequent calls: returns immediately (no-op)</li>
<li>After validation: delegates operation to Connection Service</li>
</ol>
<hr>
<a id="integration-with-public-api" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Public API<a href="#integration-with-public-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Global Services are used internally by the framework but can also be accessed directly through the exported <code>lib</code> object for advanced use cases.</p>
<a id="direct-access-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Direct Access Pattern<a href="#direct-access-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/41_Global_Services_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Purpose</strong>: This diagram shows how Global Services fit into the public API. The <code>add*</code> and <code>list*</code> functions bypass Global Services and access Validation/Schema services directly, while test code and advanced users can access Global Services through the <code>lib</code> export.</p>
<a id="test-usage-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Test Usage Example<a href="#test-usage-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tests demonstrate direct Global Service usage:</p>
<p><a href="">test/spec/risk.test.mjs:67-92</a></p>
<pre><code class="javascript"><span class="hl-5">// Direct access via lib export</span><br/><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-7">riskGlobalService</span><span class="hl-1"> } = </span><span class="hl-4">lib</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Add positions</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">riskGlobalService</span><span class="hl-1">.</span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, { </span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-strategy-1&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-max-positions&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Check risk limits</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">riskGlobalService</span><span class="hl-1">.</span><span class="hl-0">checkSignal</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-2">&quot;SOLUSDT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-strategy-4&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">currentPrice:</span><span class="hl-1"> </span><span class="hl-8">100</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">(),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;test-max-positions&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>This pattern is useful for:</p>
<ul>
<li>Unit testing individual services</li>
<li>Building custom orchestration logic</li>
<li>Debugging component behavior</li>
<li>Implementing advanced workflows</li>
</ul>
<hr>
<a id="execution-mode-global-services-1" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Execution Mode Global Services<a href="#execution-mode-global-services-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Execution Mode Global Services differ from Component Global Services by delegating to Logic Services rather than Connection Services.</p>
<a id="backtestglobalservice-and-liveglobalservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">BacktestGlobalService and LiveGlobalService<a href="#backtestglobalservice-and-liveglobalservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>These services provide the entry points for <code>Backtest.run()</code> and <code>Live.run()</code> operations:</p>
<p><img src="../media/41_Global_Services_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Purpose</strong>: This diagram illustrates the delegation chain from Execution Mode Global Services through Logic Services. Unlike Component Global Services that delegate to Connection Services, these delegate to Logic Services which manage context propagation and execution orchestration.</p>
<a id="walkerglobalservice-dual-role" class="tsd-anchor"></a><h3 class="tsd-anchor-link">WalkerGlobalService Dual Role<a href="#walkerglobalservice-dual-role" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>WalkerGlobalService</code> serves both as a Component Global Service (for walker registration) and an Execution Mode Global Service (for multi-strategy comparison):</p>
<table>
<thead>
<tr>
<th>Role</th>
<th>Methods</th>
<th>Delegation Target</th>
</tr>
</thead>
<tbody>
<tr>
<td>Component Service</td>
<td><code>validate()</code></td>
<td><code>WalkerValidationService</code></td>
</tr>
<tr>
<td>Execution Service</td>
<td><code>run()</code></td>
<td><code>WalkerLogicPublicService</code></td>
</tr>
</tbody>
</table>
<hr>
<a id="service-registration-and-discovery" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Registration and Discovery<a href="#service-registration-and-discovery" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Global Services are registered in the dependency injection container and made available through the <code>backtest</code> export.</p>
<a id="registration-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Pattern<a href="#registration-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="">src/lib/core/provide.ts:70-79</a></p>
<pre><code class="typescript"><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">exchangeGlobalService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">ExchangeGlobalService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">strategyGlobalService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">StrategyGlobalService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">frameGlobalService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">FrameGlobalService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">liveGlobalService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">LiveGlobalService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">backtestGlobalService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">BacktestGlobalService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">walkerGlobalService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">WalkerGlobalService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">sizingGlobalService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SizingGlobalService</span><span class="hl-1">());</span><br/><span class="hl-1">    </span><span class="hl-0">provide</span><span class="hl-1">(</span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">riskGlobalService</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">RiskGlobalService</span><span class="hl-1">());</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="export-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Export Pattern<a href="#export-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="">src/lib/index.ts:93-108</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">globalServices</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeGlobalService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">ExchangeGlobalService</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">    </span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">exchangeGlobalService</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">strategyGlobalService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">StrategyGlobalService</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">    </span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">strategyGlobalService</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">frameGlobalService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">FrameGlobalService</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">    </span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">frameGlobalService</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">liveGlobalService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">LiveGlobalService</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">    </span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">liveGlobalService</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">backtestGlobalService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">BacktestGlobalService</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">    </span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">backtestGlobalService</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">walkerGlobalService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">WalkerGlobalService</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">    </span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">walkerGlobalService</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">sizingGlobalService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">SizingGlobalService</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">    </span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">sizingGlobalService</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">riskGlobalService:</span><span class="hl-1"> </span><span class="hl-0">inject</span><span class="hl-1">&lt;</span><span class="hl-10">RiskGlobalService</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">    </span><span class="hl-7">TYPES</span><span class="hl-1">.</span><span class="hl-4">riskGlobalService</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>All services are included in the <code>backtest</code> export object <a href="">src/lib/index.ts:152-162</a>, making them accessible as <code>backtest.riskGlobalService</code>, <code>backtest.strategyGlobalService</code>, etc.</p>
<hr>
<a id="key-characteristics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Key Characteristics<a href="#key-characteristics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Global Services exhibit these consistent patterns across the framework:</p>
<a id="stateless-operation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Stateless Operation<a href="#stateless-operation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Global Services maintain no state themselves. They delegate state management to:</p>
<ul>
<li>Schema Services (component configurations)</li>
<li>Connection Services (memoized client instances)</li>
<li>Client Classes (signal state, position tracking)</li>
</ul>
<a id="memoized-validation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoized Validation<a href="#memoized-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Validation is memoized by component name to avoid redundant schema checks:</p>
<pre><code class="typescript"><span class="hl-5">// Pattern from RiskGlobalService</span><br/><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">validate</span><span class="hl-1"> = </span><span class="hl-0">memoize</span><span class="hl-1">(</span><br/><span class="hl-1">  ([</span><span class="hl-4">riskName</span><span class="hl-1">]) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">riskName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,  </span><span class="hl-5">// Cache key</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">riskName</span><span class="hl-1">: </span><span class="hl-10">RiskName</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;riskGlobalService validate&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">riskName</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">riskValidationService</span><span class="hl-1">.</span><span class="hl-0">validate</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">riskName</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;riskGlobalService validate&quot;</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The cache key is the component name string. First invocation performs validation, subsequent calls return immediately.</p>
<a id="consistent-logging" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Consistent Logging<a href="#consistent-logging" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Every public method logs its invocation with context:</p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">checkSignal</span><span class="hl-1"> = </span><span class="hl-6">async</span><span class="hl-1"> (</span><br/><span class="hl-1">  </span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-10">IRiskCheckArgs</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">context</span><span class="hl-1">: { </span><span class="hl-4">riskName</span><span class="hl-1">: </span><span class="hl-10">RiskName</span><span class="hl-1"> }</span><br/><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">loggerService</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;riskGlobalService checkSignal&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">context</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">validate</span><span class="hl-1">(</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">riskName</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">riskConnectionService</span><span class="hl-1">.</span><span class="hl-0">checkSignal</span><span class="hl-1">(</span><span class="hl-4">params</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>Log entries include:</p>
<ul>
<li>Service and method name (e.g., <code>&quot;riskGlobalService checkSignal&quot;</code>)</li>
<li>Operation-specific context (symbol, component names)</li>
<li>Structured data for debugging</li>
</ul>
<a id="single-responsibility" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Single Responsibility<a href="#single-responsibility" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each Global Service manages exactly one component type or execution mode:</p>
<ul>
<li><code>RiskGlobalService</code> → Risk profiles only</li>
<li><code>StrategyGlobalService</code> → Strategies only</li>
<li><code>BacktestGlobalService</code> → Backtest execution only</li>
<li><code>WalkerGlobalService</code> → Both walker components AND walker execution (special case)</li>
</ul>
<hr>
<a id="delegation-flow-summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Delegation Flow Summary<a href="#delegation-flow-summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/41_Global_Services_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Purpose</strong>: This diagram summarizes the complete delegation flow for both Component and Execution Global Services. Both types perform validation first, but Component services delegate to Connection Services while Execution services delegate to Logic Services.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#global-services"><span>Global <wbr/>Services</span></a><ul><li><a href="#service-categories"><span>Service <wbr/>Categories</span></a></li><li><ul><li><a href="#component-global-services"><span>Component <wbr/>Global <wbr/>Services</span></a></li><li><a href="#execution-mode-global-services"><span>Execution <wbr/>Mode <wbr/>Global <wbr/>Services</span></a></li></ul></li><li><a href="#global-service-architecture"><span>Global <wbr/>Service <wbr/>Architecture</span></a></li><li><a href="#component-global-service-pattern"><span>Component <wbr/>Global <wbr/>Service <wbr/>Pattern</span></a></li><li><ul><li><a href="#standard-structure"><span>Standard <wbr/>Structure</span></a></li><li><a href="#dependency-injection-pattern"><span>Dependency <wbr/>Injection <wbr/>Pattern</span></a></li><li><a href="#validation-orchestration"><span>Validation <wbr/>Orchestration</span></a></li><li><a href="#implementation-example-riskglobalservice"><span>Implementation <wbr/>Example: <wbr/>Risk<wbr/>Global<wbr/>Service</span></a></li></ul></li><li><a href="#integration-with-public-api"><span>Integration with <wbr/>Public API</span></a></li><li><ul><li><a href="#direct-access-pattern"><span>Direct <wbr/>Access <wbr/>Pattern</span></a></li><li><a href="#test-usage-example"><span>Test <wbr/>Usage <wbr/>Example</span></a></li></ul></li><li><a href="#execution-mode-global-services-1"><span>Execution <wbr/>Mode <wbr/>Global <wbr/>Services</span></a></li><li><ul><li><a href="#backtestglobalservice-and-liveglobalservice"><span>Backtest<wbr/>Global<wbr/>Service and <wbr/>Live<wbr/>Global<wbr/>Service</span></a></li><li><a href="#walkerglobalservice-dual-role"><span>Walker<wbr/>Global<wbr/>Service <wbr/>Dual <wbr/>Role</span></a></li></ul></li><li><a href="#service-registration-and-discovery"><span>Service <wbr/>Registration and <wbr/>Discovery</span></a></li><li><ul><li><a href="#registration-pattern"><span>Registration <wbr/>Pattern</span></a></li><li><a href="#export-pattern"><span>Export <wbr/>Pattern</span></a></li></ul></li><li><a href="#key-characteristics"><span>Key <wbr/>Characteristics</span></a></li><li><ul><li><a href="#stateless-operation"><span>Stateless <wbr/>Operation</span></a></li><li><a href="#memoized-validation"><span>Memoized <wbr/>Validation</span></a></li><li><a href="#consistent-logging"><span>Consistent <wbr/>Logging</span></a></li><li><a href="#single-responsibility"><span>Single <wbr/>Responsibility</span></a></li></ul></li><li><a href="#delegation-flow-summary"><span>Delegation <wbr/>Flow <wbr/>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
