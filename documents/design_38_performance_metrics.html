<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/38_performance_metrics | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_38_performance_metrics.html">design/38_performance_metrics</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="performance-metrics" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Performance Metrics<a href="#performance-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents the performance metrics calculated and reported by the framework, including win rate, average PNL, and signal outcome distributions. These metrics are automatically computed from closed signal data and included in markdown reports generated by <code>BacktestMarkdownService</code> and <code>LiveMarkdownService</code>.</p>
<p>For details on the markdown report generation process itself, see <a href="design_37_markdown_report_generation.html">Markdown Report Generation</a>. For information on how PNL values are calculated with fees and slippage, see <a href="design_27_pnl_calculation.html">PnL Calculation</a>.</p>
<hr>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides two levels of performance metric calculation depending on execution mode:</p>
<table>
<thead>
<tr>
<th>Execution Mode</th>
<th>Service</th>
<th>Metrics Calculated</th>
<th>File Location</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Live Trading</strong></td>
<td><code>LiveMarkdownService</code></td>
<td>Total events, closed signals, win rate, average PNL</td>
<td><a href="">src/lib/services/markdown/LiveMarkdownService.ts:1-511</a></td>
</tr>
<tr>
<td><strong>Backtesting</strong></td>
<td><code>BacktestMarkdownService</code></td>
<td>Total signals only</td>
<td><a href="">src/lib/services/markdown/BacktestMarkdownService.ts:1-349</a></td>
</tr>
</tbody>
</table>
<p>Live trading reports include comprehensive statistics calculated from all closed signals. Backtest reports provide raw signal data in tabular form, allowing users to perform their own analysis. Both services accumulate signal data per strategy using memoized storage instances.</p>
<hr>
<a id="live-trading-metrics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Live Trading Metrics<a href="#live-trading-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>LiveMarkdownService</code> calculates four primary performance metrics from closed signals:</p>
<a id="metrics-summary-table" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Metrics Summary Table<a href="#metrics-summary-table" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Metric</th>
<th>Description</th>
<th>Calculation</th>
<th>Example Output</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Total Events</strong></td>
<td>Count of all tick events (idle, opened, active, closed)</td>
<td><code>_eventList.length</code></td>
<td><code>Total events: 15</code></td>
</tr>
<tr>
<td><strong>Closed Signals</strong></td>
<td>Count of signals that reached a close condition</td>
<td><code>filter(e =&gt; e.action === &quot;closed&quot;).length</code></td>
<td><code>Closed signals: 5</code></td>
</tr>
<tr>
<td><strong>Win Rate</strong></td>
<td>Percentage of profitable trades with win/loss breakdown</td>
<td><code>(winCount / totalClosed) * 100</code></td>
<td><code>Win rate: 60.00% (3W / 2L)</code></td>
</tr>
<tr>
<td><strong>Average PNL</strong></td>
<td>Mean PNL percentage across all closed signals</td>
<td><code>sum(pnl) / totalClosed</code></td>
<td><code>Average PNL: +1.23%</code></td>
</tr>
</tbody>
</table>
<a id="win-rate-calculation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Win Rate Calculation<a href="#win-rate-calculation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/38_Performance_Metrics_0.svg" alt="Mermaid Diagram"></p>
<a id="average-pnl-calculation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Average PNL Calculation<a href="#average-pnl-calculation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The average PNL is computed as the arithmetic mean of all closed signal PNL percentages:</p>
<pre><code class="typescript"><span class="hl-5">// From LiveMarkdownService.ts:280-283</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">avgPnl</span><span class="hl-1"> = </span><span class="hl-4">totalClosed</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><br/><span class="hl-1">  ? </span><span class="hl-4">closedEvents</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">e</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + (</span><span class="hl-4">e</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1"> || </span><span class="hl-8">0</span><span class="hl-1">), </span><span class="hl-8">0</span><span class="hl-1">) / </span><span class="hl-4">totalClosed</span><br/><span class="hl-1">  : </span><span class="hl-8">0</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>The calculation:</p>
<ol>
<li>Filters all events to get only <code>closed</code> actions</li>
<li>Sums the <code>pnl</code> field (percentage value) from each closed event</li>
<li>Divides by the count of closed events</li>
<li>Formats with sign prefix: <code>+1.23%</code> or <code>-2.45%</code></li>
</ol>
<hr>
<a id="metric-calculation-pipeline" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Metric Calculation Pipeline<a href="#metric-calculation-pipeline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/38_Performance_Metrics_1.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="tickevent-data-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">TickEvent Data Structure<a href="#tickevent-data-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>LiveMarkdownService</code> uses a unified <code>TickEvent</code> interface to store all event data:</p>
<p><img src="../media/38_Performance_Metrics_2.svg" alt="Mermaid Diagram"></p>
<p>The transformation from <code>IStrategyTickResultClosed</code> to <code>TickEvent</code> extracts relevant fields:</p>
<pre><code class="typescript"><span class="hl-5">// From LiveMarkdownService.ts:228-242</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">newEvent</span><span class="hl-1">: </span><span class="hl-11">TickEvent</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">closeTimestamp</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">action:</span><span class="hl-1"> </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">signalId:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">position</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">note</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">currentPrice:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">currentPrice</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">openPrice:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">priceOpen</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">takeProfit:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">priceTakeProfit</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">stopLoss:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">priceStopLoss</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">pnl:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">,  </span><span class="hl-5">// ← Used for metrics</span><br/><span class="hl-1">  </span><span class="hl-4">closeReason:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">duration:</span><span class="hl-1"> </span><span class="hl-4">durationMin</span><span class="hl-1">,</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="backtest-metrics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Backtest Metrics<a href="#backtest-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>BacktestMarkdownService</code> provides a simpler reporting model focused on raw signal data:</p>
<a id="backtest-report-contents" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Report Contents<a href="#backtest-report-contents" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Total Signals</strong></td>
<td>Count of closed signals</td>
<td><code>_signalList.length</code></td>
</tr>
<tr>
<td><strong>Signal Table</strong></td>
<td>All signal details in tabular format</td>
<td>Markdown table with 13 columns</td>
</tr>
<tr>
<td><strong>No Statistics</strong></td>
<td>Win rate and average PNL not calculated</td>
<td>Users must analyze raw data</td>
</tr>
</tbody>
</table>
<p>The backtest report includes all data needed for metric calculation (PNL percentages, close reasons, timestamps) but does not compute aggregated statistics. This design allows users to perform custom analysis on historical data.</p>
<p><strong>Report Generation:</strong></p>
<pre><code class="typescript"><span class="hl-5">// From BacktestMarkdownService.ts:125-152</span><br/><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-4">StrategyName</span><span class="hl-1">): </span><span class="hl-4">string</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">`# Backtest Report: </span><span class="hl-6">${</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;No signals closed yet.&quot;</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">header</span><span class="hl-1"> = </span><span class="hl-4">columns</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-4">col</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">col</span><span class="hl-1">.</span><span class="hl-4">label</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">rows</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-4">closedSignal</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">columns</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-4">col</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">col</span><span class="hl-1">.</span><span class="hl-0">format</span><span class="hl-1">(</span><span class="hl-4">closedSignal</span><span class="hl-1">))</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">tableData</span><span class="hl-1"> = [</span><span class="hl-4">header</span><span class="hl-1">, ...</span><span class="hl-4">rows</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">table</span><span class="hl-1"> = </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">table</span><span class="hl-1">(</span><span class="hl-4">tableData</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-2">`# Backtest Report: </span><span class="hl-6">${</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">`Total signals: </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-4">_signalList</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,  </span><span class="hl-5">// ← Only metric</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">table</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">`*Generated: </span><span class="hl-6">${</span><span class="hl-6">new</span><span class="hl-9"> </span><span class="hl-0">Date</span><span class="hl-9">().</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-6">}</span><span class="hl-2">*`</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="column-configuration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Column Configuration<a href="#column-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Both services use a <code>Column</code> interface to define how to extract and format data from signals:</p>
<p><img src="../media/38_Performance_Metrics_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Example PNL Column:</strong></p>
<pre><code class="typescript"><span class="hl-5">// From BacktestMarkdownService.ts:68-75</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">key</span><span class="hl-1">: </span><span class="hl-2">&quot;pnl&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">label</span><span class="hl-1">: </span><span class="hl-2">&quot;PNL (net)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">format</span><span class="hl-1">: (</span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">pnlPercentage</span><span class="hl-1"> = </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">pnlPercentage</span><span class="hl-9"> </span><span class="hl-1">&gt;</span><span class="hl-9"> </span><span class="hl-8">0</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;+&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">&quot;&quot;</span><span class="hl-6">}${</span><span class="hl-4">pnlPercentage</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The column definitions for backtest <a href="">BacktestMarkdownService.ts:27-100</a> and live <a href="">LiveMarkdownService.ts:62-137</a> are similar but differ in data sources (<code>IStrategyTickResultClosed</code> vs <code>TickEvent</code>).</p>
<hr>
<a id="storage-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Storage Architecture<a href="#storage-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Both markdown services use memoized storage instances per strategy:</p>
<p><img src="../media/38_Performance_Metrics_4.svg" alt="Mermaid Diagram"></p>
<p>The memoization pattern ensures:</p>
<ul>
<li>One storage instance per strategy name</li>
<li>Isolation between strategies</li>
<li>Efficient memory usage</li>
<li>Cache clearing with <code>clear(strategyName)</code></li>
</ul>
<hr>
<a id="usage-examples" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage Examples<a href="#usage-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="accessing-live-trading-metrics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Accessing Live Trading Metrics<a href="#accessing-live-trading-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Live</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Run live trading</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Get report with metrics</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">report</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">report</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// Output includes:</span><br/><span class="hl-1">    </span><span class="hl-5">// - Win rate: 60.00% (3W / 2L)</span><br/><span class="hl-1">    </span><span class="hl-5">// - Average PNL: +1.23%</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="saving-reports-to-disk" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Saving Reports to Disk<a href="#saving-reports-to-disk" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Backtest</span><span class="hl-1">, </span><span class="hl-4">Live</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Backtest report (no statistics)</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-5">// Saves to: ./logs/backtest/my-strategy.md</span><br/><span class="hl-5">// Contains: Total signals + table of all signals</span><br/><br/><span class="hl-5">// Live report (with statistics)</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-5">// Saves to: ./logs/live/my-strategy.md</span><br/><span class="hl-5">// Contains: Win rate, avg PNL, total events + table</span>
</code><button type="button">Copy</button></pre>

<a id="clearing-accumulated-data" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Clearing Accumulated Data<a href="#clearing-accumulated-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Backtest</span><span class="hl-1">, </span><span class="hl-4">Live</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Clear specific strategy</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Clear all strategies</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">();</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="metric-calculation-details" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Metric Calculation Details<a href="#metric-calculation-details" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="win-classification" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Win Classification<a href="#win-classification" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>A signal is classified as a <strong>win</strong> if <code>pnl &gt; 0</code> and a <strong>loss</strong> if <code>pnl &lt; 0</code>:</p>
<pre><code class="typescript"><span class="hl-5">// From LiveMarkdownService.ts:278-279</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">winCount</span><span class="hl-1"> = </span><span class="hl-4">closedEvents</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">((</span><span class="hl-4">e</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">e</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">e</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lossCount</span><span class="hl-1"> = </span><span class="hl-4">closedEvents</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">((</span><span class="hl-4">e</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">e</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">e</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>Signals with exactly <code>pnl === 0</code> (breakeven after fees/slippage) are not counted as wins or losses in the win rate calculation, but are included in the total closed count.</p>
<a id="pnl-values-source" class="tsd-anchor"></a><h3 class="tsd-anchor-link">PNL Values Source<a href="#pnl-values-source" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The PNL percentage values used in metrics come from the <code>toProfitLossDto</code> helper, which applies:</p>
<ul>
<li><strong>Slippage:</strong> 0.1% (0.001)</li>
<li><strong>Fees:</strong> 0.1% (0.001) on both entry and exit</li>
</ul>
<p>For details on the exact calculation formula, see <a href="design_27_pnl_calculation.html">PnL Calculation</a>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#performance-metrics"><span>Performance <wbr/>Metrics</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#live-trading-metrics"><span>Live <wbr/>Trading <wbr/>Metrics</span></a></li><li><ul><li><a href="#metrics-summary-table"><span>Metrics <wbr/>Summary <wbr/>Table</span></a></li><li><a href="#win-rate-calculation"><span>Win <wbr/>Rate <wbr/>Calculation</span></a></li><li><a href="#average-pnl-calculation"><span>Average PNL <wbr/>Calculation</span></a></li></ul></li><li><a href="#metric-calculation-pipeline"><span>Metric <wbr/>Calculation <wbr/>Pipeline</span></a></li><li><a href="#tickevent-data-structure"><span>Tick<wbr/>Event <wbr/>Data <wbr/>Structure</span></a></li><li><a href="#backtest-metrics"><span>Backtest <wbr/>Metrics</span></a></li><li><ul><li><a href="#backtest-report-contents"><span>Backtest <wbr/>Report <wbr/>Contents</span></a></li></ul></li><li><a href="#column-configuration"><span>Column <wbr/>Configuration</span></a></li><li><a href="#storage-architecture"><span>Storage <wbr/>Architecture</span></a></li><li><a href="#usage-examples"><span>Usage <wbr/>Examples</span></a></li><li><ul><li><a href="#accessing-live-trading-metrics"><span>Accessing <wbr/>Live <wbr/>Trading <wbr/>Metrics</span></a></li><li><a href="#saving-reports-to-disk"><span>Saving <wbr/>Reports to <wbr/>Disk</span></a></li><li><a href="#clearing-accumulated-data"><span>Clearing <wbr/>Accumulated <wbr/>Data</span></a></li></ul></li><li><a href="#metric-calculation-details"><span>Metric <wbr/>Calculation <wbr/>Details</span></a></li><li><ul><li><a href="#win-classification"><span>Win <wbr/>Classification</span></a></li><li><a href="#pnl-values-source"><span>PNL <wbr/>Values <wbr/>Source</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
