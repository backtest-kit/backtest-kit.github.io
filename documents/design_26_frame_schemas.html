<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/26_frame_schemas | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_26_frame_schemas.html">design/26_frame_schemas</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="frame-schemas" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Frame Schemas<a href="#frame-schemas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Frame schemas define backtesting periods by specifying start dates, end dates, and intervals for timestamp generation. They control the temporal boundaries and granularity of historical simulation, enabling strategies to iterate through specific time windows with configurable step sizes.</p>
<p>For information about backtesting execution flow using frames, see <a href="design_51_backtest_execution_flow.html">Backtest Execution Flow</a>. For frame timeframe generation implementation details, see <a href="design_52_timeframe_generation.html">Timeframe Generation</a>.</p>
<hr>
<a id="schema-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Schema Structure<a href="#schema-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frame schemas are registered via the <code>addFrame()</code> function and conform to the <code>IFrameSchema</code> interface. Each schema defines a named backtesting period with temporal boundaries and iteration granularity.</p>
<p><strong>Core Schema Definition</strong></p>
<p><img src="../media/26_Frame_Schemas_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Schema Fields</strong></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>frameName</code></td>
<td><code>FrameName</code> (string)</td>
<td>Yes</td>
<td>Unique identifier for frame registration and retrieval</td>
</tr>
<tr>
<td><code>note</code></td>
<td><code>string</code></td>
<td>No</td>
<td>Developer documentation for the frame's purpose</td>
</tr>
<tr>
<td><code>interval</code></td>
<td><code>FrameInterval</code></td>
<td>Yes</td>
<td>Granularity for timestamp generation (minutes, hours, days)</td>
</tr>
<tr>
<td><code>startDate</code></td>
<td><code>Date</code></td>
<td>Yes</td>
<td>Inclusive start boundary for the backtesting period</td>
</tr>
<tr>
<td><code>endDate</code></td>
<td><code>Date</code></td>
<td>Yes</td>
<td>Inclusive end boundary for the backtesting period</td>
</tr>
<tr>
<td><code>callbacks</code></td>
<td><code>Partial&lt;IFrameCallbacks&gt;</code></td>
<td>No</td>
<td>Optional lifecycle event handlers</td>
</tr>
</tbody>
</table>
<hr>
<a id="frame-intervals" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Frame Intervals<a href="#frame-intervals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>FrameInterval</code> type defines the step size for timeframe generation. Each interval value determines the spacing between consecutive timestamps in the generated array.</p>
<p><strong>Available Intervals</strong></p>
<p><img src="../media/26_Frame_Schemas_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Interval Selection Guidelines</strong></p>
<ul>
<li><strong>1m-5m</strong>: High-frequency strategies, scalping, minute-level precision</li>
<li><strong>15m-1h</strong>: Intraday strategies, standard frequency</li>
<li><strong>2h-12h</strong>: Swing trading, reduced computation for long backtests</li>
<li><strong>1d-3d</strong>: Position trading, long-term strategy validation</li>
</ul>
<p>Smaller intervals generate more timestamps and require more computation. A 1-day backtest with 1-minute intervals produces 1,440 timestamps, while 1-hour intervals produce only 24 timestamps.</p>
<hr>
<a id="registration-and-usage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Registration and Usage<a href="#registration-and-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frame schemas are registered via <code>addFrame()</code> and retrieved by name during backtest execution. The framework validates schema structure, stores the configuration, and provides lazy instantiation of <code>ClientFrame</code> instances.</p>
<p><strong>Registration Flow</strong></p>
<p><img src="../media/26_Frame_Schemas_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Registration Example</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addFrame</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;One-day backtest for rapid strategy validation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-02T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onTimeframe</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">timeframe</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-6">${</span><span class="hl-4">timeframe</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> timestamps from </span><span class="hl-6">${</span><span class="hl-4">startDate</span><span class="hl-6">}</span><span class="hl-2"> to </span><span class="hl-6">${</span><span class="hl-4">endDate</span><span class="hl-6">}</span><span class="hl-2"> at </span><span class="hl-6">${</span><span class="hl-4">interval</span><span class="hl-6">}</span><span class="hl-2"> interval`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Retrieval in Backtest Context</strong></p>
<p>Frames are accessed by name when executing backtests:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Backtest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Frame retrieved via frameName in context</span><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><span class="hl-1">, </span><span class="hl-5">// References registered frame</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-5">// result contains closed signals</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="timeframe-generation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Timeframe Generation<a href="#timeframe-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frames generate arrays of <code>Date</code> objects representing tick timestamps. The <code>ClientFrame.getTimeframe()</code> method produces timestamps spaced according to the configured interval, bounded by <code>startDate</code> and <code>endDate</code>.</p>
<p><strong>Generation Process</strong></p>
<p><img src="../media/26_Frame_Schemas_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Example Timeframe Output</strong></p>
<p>For a frame with:</p>
<ul>
<li><code>startDate</code>: <code>2024-01-01T00:00:00Z</code></li>
<li><code>endDate</code>: <code>2024-01-01T00:05:00Z</code></li>
<li><code>interval</code>: <code>1m</code></li>
</ul>
<p>Generated timeframe:</p>
<pre><code class="typescript"><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:01:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:02:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:03:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:04:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:05:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">]</span><br/><span class="hl-5">// 6 timestamps total (inclusive of boundaries)</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="lifecycle-callbacks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Lifecycle Callbacks<a href="#lifecycle-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frame schemas support an optional <code>onTimeframe</code> callback invoked after timeframe array generation. This enables logging, validation, or external integrations during backtest initialization.</p>
<p><strong>Callback Interface</strong></p>
<p><img src="../media/26_Frame_Schemas_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Callback Parameters</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>timeframe</code></td>
<td><code>Date[]</code></td>
<td>Complete array of generated timestamps</td>
</tr>
<tr>
<td><code>startDate</code></td>
<td><code>Date</code></td>
<td>Start boundary from schema</td>
</tr>
<tr>
<td><code>endDate</code></td>
<td><code>Date</code></td>
<td>End boundary from schema</td>
</tr>
<tr>
<td><code>interval</code></td>
<td><code>FrameInterval</code></td>
<td>Interval used for generation</td>
</tr>
</tbody>
</table>
<p><strong>Usage Example</strong></p>
<pre><code class="typescript"><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-02T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onTimeframe</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">timeframe</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">duration</span><span class="hl-1"> = (</span><span class="hl-4">endDate</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">() - </span><span class="hl-4">startDate</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">()) / (</span><span class="hl-8">1000</span><span class="hl-1"> * </span><span class="hl-8">60</span><span class="hl-1"> * </span><span class="hl-8">60</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[FRAME] Timeframe generated`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Period: </span><span class="hl-6">${</span><span class="hl-4">startDate</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-6">}</span><span class="hl-2"> → </span><span class="hl-6">${</span><span class="hl-4">endDate</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Duration: </span><span class="hl-6">${</span><span class="hl-4">duration</span><span class="hl-6">}</span><span class="hl-2"> hours`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Interval: </span><span class="hl-6">${</span><span class="hl-4">interval</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Timestamps: </span><span class="hl-6">${</span><span class="hl-4">timeframe</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="implementation-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Implementation Architecture<a href="#implementation-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frame functionality is implemented through a layered service architecture with schema storage, validation, lazy instantiation, and client execution.</p>
<p><strong>Service Layer Mapping</strong></p>
<p><img src="../media/26_Frame_Schemas_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Layer Responsibilities</strong></p>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Service</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td>Public API</td>
<td><code>addFrame()</code></td>
<td>User-facing registration function</td>
</tr>
<tr>
<td>Public API</td>
<td><code>listFrames()</code></td>
<td>Returns all registered frame schemas</td>
</tr>
<tr>
<td>Validation</td>
<td><code>FrameValidationService</code></td>
<td>Schema structure validation, registry checks</td>
</tr>
<tr>
<td>Schema</td>
<td><code>FrameSchemaService</code></td>
<td>Storage via <code>ToolRegistry</code> pattern</td>
</tr>
<tr>
<td>Connection</td>
<td><code>FrameConnectionService</code></td>
<td>Memoized <code>ClientFrame</code> instance management</td>
</tr>
<tr>
<td>Client</td>
<td><code>ClientFrame</code></td>
<td>Timeframe generation business logic</td>
</tr>
<tr>
<td>Global</td>
<td><code>FrameGlobalService</code></td>
<td>API orchestration, context management</td>
</tr>
</tbody>
</table>
<p><strong>Key Code Entities</strong></p>
<table>
<thead>
<tr>
<th>Entity</th>
<th>File Path</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IFrameSchema</code></td>
<td><a href="">types.d.ts:328-341</a></td>
<td>Schema interface definition</td>
</tr>
<tr>
<td><code>FrameInterval</code></td>
<td><a href="">types.d.ts:285</a></td>
<td>Interval enum type</td>
</tr>
<tr>
<td><code>IFrameCallbacks</code></td>
<td><a href="">types.d.ts:296-308</a></td>
<td>Callback interface</td>
</tr>
<tr>
<td><code>addFrame()</code></td>
<td><a href="">src/function/add.ts:143-149</a></td>
<td>Registration function</td>
</tr>
<tr>
<td><code>listFrames()</code></td>
<td><a href="">src/function/list.ts:106-109</a></td>
<td>List function</td>
</tr>
<tr>
<td><code>FrameValidationService</code></td>
<td><a href="">src/lib/index.ts:44</a></td>
<td>Validation service DI binding</td>
</tr>
<tr>
<td><code>FrameSchemaService</code></td>
<td><a href="">src/lib/index.ts:24</a></td>
<td>Schema service DI binding</td>
</tr>
<tr>
<td><code>FrameConnectionService</code></td>
<td><a href="">src/lib/index.ts:7</a></td>
<td>Connection service DI binding</td>
</tr>
<tr>
<td><code>ClientFrame</code></td>
<td>N/A (internal)</td>
<td>Timeframe generation implementation</td>
</tr>
</tbody>
</table>
<hr>
<a id="frame-parameters" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Frame Parameters<a href="#frame-parameters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When <code>ClientFrame</code> is instantiated via <code>FrameConnectionService</code>, the schema is augmented with runtime dependencies to form <code>IFrameParams</code>.</p>
<p><strong>Parameter Augmentation</strong></p>
<p><img src="../media/26_Frame_Schemas_6.svg" alt="Mermaid Diagram"></p>
<p><strong>IFrameParams Structure</strong></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Source</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>frameName</code></td>
<td>Schema</td>
<td>Unique frame identifier</td>
</tr>
<tr>
<td><code>interval</code></td>
<td>Schema</td>
<td>Timeframe interval</td>
</tr>
<tr>
<td><code>startDate</code></td>
<td>Schema</td>
<td>Period start boundary</td>
</tr>
<tr>
<td><code>endDate</code></td>
<td>Schema</td>
<td>Period end boundary</td>
</tr>
<tr>
<td><code>callbacks</code></td>
<td>Schema</td>
<td>Optional lifecycle callbacks</td>
</tr>
<tr>
<td><code>logger</code></td>
<td>DI</td>
<td>Logger service for debug output</td>
</tr>
</tbody>
</table>
<hr>
<a id="usage-in-backtest-execution" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage in Backtest Execution<a href="#usage-in-backtest-execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frames are consumed by <code>BacktestLogicPrivateService</code> to generate the iteration array for historical simulation. Each timestamp becomes the <code>ExecutionContext.when</code> value for a strategy tick.</p>
<p><strong>Backtest Integration Flow</strong></p>
<p><img src="../media/26_Frame_Schemas_7.svg" alt="Mermaid Diagram"></p>
<p>The <code>frameName</code> from <code>MethodContext</code> determines which frame to use. The generated timeframe array drives the iteration loop, with each timestamp representing a simulated &quot;now&quot; moment for strategy execution.</p>
<hr>
<a id="example-multi-period-frame-configuration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Example: Multi-Period Frame Configuration<a href="#example-multi-period-frame-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Frames enable testing strategies across different time periods with varying granularities. Multiple frames can be registered and selected at runtime.</p>
<p><strong>Multiple Frame Registration</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addFrame</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// High-frequency 1-hour test</span><br/><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1h-scalping&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T10:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T11:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Intraday 1-day test</span><br/><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-intraday&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-02T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Multi-day swing test</span><br/><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;7d-swing&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-08T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Long-term position test</span><br/><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;30d-position&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-31T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Runtime Frame Selection</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Backtest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Test same strategy on different timeframes</span><br/><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">frameName</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> [</span><span class="hl-2">&quot;1h-scalping&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;1d-intraday&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;7d-swing&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;30d-position&quot;</span><span class="hl-1">]) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-11">\n</span><span class="hl-2">=== Testing </span><span class="hl-6">${</span><span class="hl-4">frameName</span><span class="hl-6">}</span><span class="hl-2"> ===`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">frameName</span><span class="hl-1">, </span><span class="hl-5">// Different frame each iteration</span><br/><span class="hl-1">  })) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal closed: </span><span class="hl-6">${</span><span class="hl-4">result</span><span class="hl-9">.</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Sharpe Ratio: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">sharpeRatio</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="validation-rules" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Rules<a href="#validation-rules" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>FrameValidationService</code> enforces structural and semantic validation rules during registration.</p>
<p><strong>Validation Checks</strong></p>
<table>
<thead>
<tr>
<th>Rule</th>
<th>Check</th>
<th>Error Condition</th>
</tr>
</thead>
<tbody>
<tr>
<td>Unique Name</td>
<td><code>frameName</code> not already registered</td>
<td>Duplicate registration throws error</td>
</tr>
<tr>
<td>Required Fields</td>
<td>All required fields present</td>
<td>Missing <code>frameName</code>, <code>interval</code>, <code>startDate</code>, <code>endDate</code></td>
</tr>
<tr>
<td>Date Order</td>
<td><code>startDate &lt; endDate</code></td>
<td>Start date must precede end date</td>
</tr>
<tr>
<td>Interval Valid</td>
<td><code>interval</code> in <code>FrameInterval</code> enum</td>
<td>Invalid interval string</td>
</tr>
</tbody>
</table>
<p><strong>Validation Example</strong></p>
<pre><code class="typescript"><span class="hl-5">// Valid registration</span><br/><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;valid-frame&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-02T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">}); </span><span class="hl-5">// ✓ Success</span><br/><br/><span class="hl-5">// Invalid: duplicate name</span><br/><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;valid-frame&quot;</span><span class="hl-1">, </span><span class="hl-5">// Same name</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-03T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-04T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">}); </span><span class="hl-5">// ✗ Throws validation error</span><br/><br/><span class="hl-5">// Invalid: end before start</span><br/><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;invalid-dates&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-02T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">), </span><span class="hl-5">// Before start</span><br/><span class="hl-1">}); </span><span class="hl-5">// ✗ Throws validation error</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#frame-schemas"><span>Frame <wbr/>Schemas</span></a><ul><li><a href="#schema-structure"><span>Schema <wbr/>Structure</span></a></li><li><a href="#frame-intervals"><span>Frame <wbr/>Intervals</span></a></li><li><a href="#registration-and-usage"><span>Registration and <wbr/>Usage</span></a></li><li><a href="#timeframe-generation"><span>Timeframe <wbr/>Generation</span></a></li><li><a href="#lifecycle-callbacks"><span>Lifecycle <wbr/>Callbacks</span></a></li><li><a href="#implementation-architecture"><span>Implementation <wbr/>Architecture</span></a></li><li><a href="#frame-parameters"><span>Frame <wbr/>Parameters</span></a></li><li><a href="#usage-in-backtest-execution"><span>Usage in <wbr/>Backtest <wbr/>Execution</span></a></li><li><a href="#example-multi-period-frame-configuration"><span>Example: <wbr/>Multi-<wbr/>Period <wbr/>Frame <wbr/>Configuration</span></a></li><li><a href="#validation-rules"><span>Validation <wbr/>Rules</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
