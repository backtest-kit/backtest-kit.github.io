<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/12_defining-strategies | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_12_defining-strategies.html">design/12_defining-strategies</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="defining-strategies" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Defining Strategies<a href="#defining-strategies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents how to define and register trading strategies in the framework. It covers the <code>IStrategySchema</code> structure, the <code>addStrategy()</code> registration function, the <code>getSignal</code> callback for signal generation, interval-based throttling, and lifecycle callbacks for strategy events.</p>
<p>For information about how strategies are executed internally, see <a href="design_13_strategy-execution-flow.html">Strategy Execution Flow</a>. For risk management integration, see <a href="design_14_risk-management.html">Risk Management</a>. For position sizing integration, see <a href="design_15_position-sizing.html">Position Sizing</a>.</p>
<hr>
<a id="strategy-schema-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Strategy Schema Structure<a href="#strategy-schema-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Strategies are defined using the <code>IStrategySchema</code> interface, which specifies all configuration and behavior for a trading strategy. The schema is registered via <code>addStrategy()</code> and validated by <code>StrategyValidationService</code> before being stored in <code>StrategySchemaService</code>.</p>
<p><img src="../media/12-defining-strategies_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="strategy-registration-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Strategy Registration Flow<a href="#strategy-registration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Strategies are registered using the <code>addStrategy()</code> function, which validates the schema and stores it in the dependency injection container. The registration process ensures that strategy names are unique and all required fields are present.</p>
<p><img src="../media/12-defining-strategies_1.svg" alt="Mermaid Diagram"></p>
<a id="registration-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Example<a href="#registration-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addStrategy</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;momentum-breakout&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Enters on momentum breakout with volume confirmation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-13">Date</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Signal generation logic</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">shouldEnter</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">checkBreakoutConditions</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">shouldEnter</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">; </span><span class="hl-5">// No signal</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceOpen:</span><span class="hl-1"> </span><span class="hl-6">50000</span><span class="hl-1">, </span><span class="hl-5">// Optional - creates scheduled signal</span><br/><span class="hl-1">      </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-6">52000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-6">48500</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-6">120</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Volume breakout confirmed&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative&quot;</span><span class="hl-1">, </span><span class="hl-5">// Optional risk profile</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onOpen</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal opened: </span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onClose</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">priceClose</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal closed at </span><span class="hl-7">${</span><span class="hl-4">priceClose</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="signal-generation-callback" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Generation Callback<a href="#signal-generation-callback" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>getSignal</code> callback is the core of strategy logic. It is called by <code>ClientStrategy.tick()</code> when the interval throttling allows, and must return either a signal DTO or <code>null</code> if no signal should be generated.</p>
<a id="getsignal-function-signature" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getSignal Function Signature<a href="#getsignal-function-signature" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>symbol</code></td>
<td><code>string</code></td>
<td>Trading pair symbol (e.g., &quot;BTCUSDT&quot;)</td>
</tr>
<tr>
<td><code>when</code></td>
<td><code>Date</code></td>
<td>Current timestamp for signal generation</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><code>Promise&lt;ISignalDto | null&gt;</code></td>
<td>Signal DTO if conditions met, <code>null</code> otherwise</td>
</tr>
</tbody>
</table>
<p><img src="../media/12-defining-strategies_2.svg" alt="Mermaid Diagram"></p>
<a id="signal-validation-rules" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signal Validation Rules<a href="#signal-validation-rules" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When <code>getSignal</code> returns a signal DTO, the framework validates:</p>
<table>
<thead>
<tr>
<th>Rule</th>
<th>Description</th>
<th>Configuration</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>TP Distance</strong></td>
<td><code>priceTakeProfit</code> must be &gt; <code>priceOpen</code> for long, &lt; <code>priceOpen</code> for short</td>
<td><code>CC_MIN_TAKEPROFIT_DISTANCE_PERCENT</code></td>
</tr>
<tr>
<td><strong>SL Distance</strong></td>
<td><code>priceStopLoss</code> must be &lt; <code>priceOpen</code> for long, &gt; <code>priceOpen</code> for short</td>
<td><code>CC_MIN_STOPLOSS_DISTANCE_PERCENT</code>, <code>CC_MAX_STOPLOSS_DISTANCE_PERCENT</code></td>
</tr>
<tr>
<td><strong>Economic Viability</strong></td>
<td>TP distance must cover slippage + fees + minimum profit</td>
<td>Calculated by <code>ConfigValidationService</code></td>
</tr>
<tr>
<td><strong>Time Constraints</strong></td>
<td><code>minuteEstimatedTime</code> must be &gt; 0 and &lt; <code>CC_MAX_SIGNAL_LIFETIME_MINUTES</code></td>
<td>Default: 1440 minutes (1 day)</td>
</tr>
</tbody>
</table>
<hr>
<a id="interval-throttling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Interval Throttling<a href="#interval-throttling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>interval</code> property controls the minimum time between <code>getSignal</code> invocations. This prevents signal spam and reduces computational overhead during strategy execution.</p>
<a id="signalinterval-type" class="tsd-anchor"></a><h3 class="tsd-anchor-link">SignalInterval Type<a href="#signalinterval-type" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-7">type</span><span class="hl-1"> </span><span class="hl-13">SignalInterval</span><span class="hl-1"> = </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;3m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;30m&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><img src="../media/12-defining-strategies_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Interval Behavior:</strong></p>
<ul>
<li><code>ClientStrategy</code> tracks <code>_lastSignalTime</code> for each symbol</li>
<li>On each tick, checks if <code>(currentTime - _lastSignalTime) &gt;= interval</code></li>
<li>If throttled, skips <code>getSignal</code> and returns current signal state (idle/active/closed)</li>
<li>If allowed, calls <code>getSignal</code> and updates <code>_lastSignalTime</code></li>
</ul>
<a id="choosing-an-interval" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Choosing an Interval<a href="#choosing-an-interval" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Interval</th>
<th>Use Case</th>
<th>Tick Frequency (Live Mode)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&quot;1m&quot;</code></td>
<td>High-frequency strategies, scalping</td>
<td>Every 61 seconds</td>
</tr>
<tr>
<td><code>&quot;5m&quot;</code></td>
<td>Medium-frequency, momentum strategies</td>
<td>Every 61 seconds (checks every 5 minutes)</td>
</tr>
<tr>
<td><code>&quot;15m&quot;</code></td>
<td>Swing trading, trend following</td>
<td>Every 61 seconds (checks every 15 minutes)</td>
</tr>
<tr>
<td><code>&quot;1h&quot;</code></td>
<td>Position trading, low-frequency</td>
<td>Every 61 seconds (checks every hour)</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Live mode ticks occur every <code>TICK_TTL</code> (61 seconds) regardless of interval. The interval only controls how often <code>getSignal</code> is invoked during those ticks.</p>
<hr>
<a id="lifecycle-callbacks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Lifecycle Callbacks<a href="#lifecycle-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>callbacks</code> property provides event hooks for monitoring strategy execution. All callbacks are optional and receive consistent parameters.</p>
<a id="available-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Available Callbacks<a href="#available-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/12-defining-strategies_4.svg" alt="Mermaid Diagram"></p>
<a id="callback-parameters" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Callback Parameters<a href="#callback-parameters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Callback</th>
<th>Parameters</th>
<th>When Called</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>onTick</code></td>
<td><code>(symbol, result, backtest)</code></td>
<td>Every tick, with full tick result</td>
</tr>
<tr>
<td><code>onOpen</code></td>
<td><code>(symbol, data, currentPrice, backtest)</code></td>
<td>Signal opened at <code>currentPrice</code></td>
</tr>
<tr>
<td><code>onActive</code></td>
<td><code>(symbol, data, currentPrice, backtest)</code></td>
<td>Signal being monitored (each tick)</td>
</tr>
<tr>
<td><code>onIdle</code></td>
<td><code>(symbol, currentPrice, backtest)</code></td>
<td>No active signal exists</td>
</tr>
<tr>
<td><code>onClose</code></td>
<td><code>(symbol, data, priceClose, backtest)</code></td>
<td>Signal closed at <code>priceClose</code></td>
</tr>
<tr>
<td><code>onSchedule</code></td>
<td><code>(symbol, data, currentPrice, backtest)</code></td>
<td>Scheduled signal created</td>
</tr>
<tr>
<td><code>onCancel</code></td>
<td><code>(symbol, data, currentPrice, backtest)</code></td>
<td>Scheduled signal cancelled</td>
</tr>
<tr>
<td><code>onWrite</code></td>
<td><code>(symbol, data, backtest)</code></td>
<td>State persisted to disk (live mode)</td>
</tr>
<tr>
<td><code>onPartialProfit</code></td>
<td><code>(symbol, data, currentPrice, revenuePercent, backtest)</code></td>
<td>Profit milestone reached (10%, 20%, etc.)</td>
</tr>
<tr>
<td><code>onPartialLoss</code></td>
<td><code>(symbol, data, currentPrice, lossPercent, backtest)</code></td>
<td>Loss milestone reached (-10%, -20%, etc.)</td>
</tr>
</tbody>
</table>
<p><strong>Common Parameters:</strong></p>
<ul>
<li><code>symbol</code>: Trading pair (e.g., &quot;BTCUSDT&quot;)</li>
<li><code>data</code>: <code>ISignalRow</code> with signal details (id, prices, timestamps)</li>
<li><code>currentPrice</code>: Current VWAP price from <code>ClientExchange.getAveragePrice()</code></li>
<li><code>backtest</code>: <code>true</code> for backtest mode, <code>false</code> for live mode</li>
</ul>
<a id="callback-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Callback Example<a href="#callback-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;monitored-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// ... signal logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onTick</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[TICK] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> action=</span><span class="hl-7">${</span><span class="hl-4">result</span><span class="hl-9">.</span><span class="hl-4">action</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onOpen</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[OPEN] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> signal=</span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-7">}</span><span class="hl-2"> price=</span><span class="hl-7">${</span><span class="hl-4">currentPrice</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-5">// Log to external monitoring system</span><br/><span class="hl-1">      </span><span class="hl-0">logToMonitoring</span><span class="hl-1">(</span><span class="hl-2">&quot;signal_opened&quot;</span><span class="hl-1">, { </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signalId:</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1"> });</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Monitor signal progress</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">pnl</span><span class="hl-1"> = </span><span class="hl-0">calculatePnL</span><span class="hl-1">(</span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">abs</span><span class="hl-1">(</span><span class="hl-4">pnl</span><span class="hl-1">) &gt; </span><span class="hl-6">5</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[ACTIVE] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> signal=</span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-7">}</span><span class="hl-2"> pnl=</span><span class="hl-7">${</span><span class="hl-4">pnl</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onClose</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">priceClose</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">duration</span><span class="hl-1"> = (</span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() - </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">pendingAt</span><span class="hl-1">) / </span><span class="hl-6">60000</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[CLOSE] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> signal=</span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-7">}</span><span class="hl-2"> price=</span><span class="hl-7">${</span><span class="hl-4">priceClose</span><span class="hl-7">}</span><span class="hl-2"> duration=</span><span class="hl-7">${</span><span class="hl-4">duration</span><span class="hl-7">}</span><span class="hl-2">m`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-5">// Update external tracking</span><br/><span class="hl-1">      </span><span class="hl-0">logToMonitoring</span><span class="hl-1">(</span><span class="hl-2">&quot;signal_closed&quot;</span><span class="hl-1">, { </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signalId:</span><span class="hl-1"> </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">priceClose</span><span class="hl-1">, </span><span class="hl-4">duration</span><span class="hl-1"> });</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onPartialProfit</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">revenuePercent</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[PROFIT] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> signal=</span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-7">}</span><span class="hl-2"> revenue=</span><span class="hl-7">${</span><span class="hl-4">revenuePercent</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-5">// Adjust external trailing stops or alerts</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onPartialLoss</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">lossPercent</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[LOSS] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> signal=</span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-7">}</span><span class="hl-2"> loss=</span><span class="hl-7">${</span><span class="hl-4">lossPercent</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-5">// Send alert if loss exceeds threshold</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">abs</span><span class="hl-1">(</span><span class="hl-4">lossPercent</span><span class="hl-1">) &gt; </span><span class="hl-6">15</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">sendAlert</span><span class="hl-1">(</span><span class="hl-2">`High loss detected: </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> at </span><span class="hl-7">${</span><span class="hl-4">lossPercent</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="risk-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Risk Integration<a href="#risk-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Strategies can integrate with the risk management system by specifying <code>riskName</code> or <code>riskList</code> in the schema. This enables portfolio-level validation before signals are opened.</p>
<a id="single-risk-profile" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Single Risk Profile<a href="#single-risk-profile" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative-trend&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative&quot;</span><span class="hl-1">, </span><span class="hl-5">// Single risk profile</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// ... signal logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="multiple-risk-profiles" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Multiple Risk Profiles<a href="#multiple-risk-profiles" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;multi-check-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskList:</span><span class="hl-1"> [</span><span class="hl-2">&quot;max-positions&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;drawdown-limit&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;correlation-check&quot;</span><span class="hl-1">], </span><span class="hl-5">// Multiple risk profiles</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// ... signal logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Risk Check Flow:</strong></p>
<ol>
<li><code>getSignal</code> returns <code>ISignalDto</code></li>
<li><code>ClientStrategy</code> validates signal structure</li>
<li>If <code>riskName</code> or <code>riskList</code> present, calls <code>ClientRisk.checkSignal()</code></li>
<li><code>ClientRisk</code> runs all validations from specified risk profiles</li>
<li>If any validation throws, signal is rejected and <code>riskSubject</code> emits event</li>
<li>If all validations pass, signal proceeds to opened/scheduled state</li>
</ol>
<hr>
<a id="signal-types-immediate-vs-scheduled" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Types: Immediate vs Scheduled<a href="#signal-types-immediate-vs-scheduled" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Signals can be either <strong>immediate</strong> (open at current price) or <strong>scheduled</strong> (wait for price to reach <code>priceOpen</code>). This is determined by the presence of the <code>priceOpen</code> field in <code>ISignalDto</code>.</p>
<p><img src="../media/12-defining-strategies_5.svg" alt="Mermaid Diagram"></p>
<a id="immediate-signal-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Immediate Signal Example<a href="#immediate-signal-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">// priceOpen omitted - opens immediately at current price</span><br/><span class="hl-1">    </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-6">52000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-6">48000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-6">120</span><span class="hl-1">,</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="scheduled-signal-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Scheduled Signal Example<a href="#scheduled-signal-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-1">: </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">priceOpen:</span><span class="hl-1"> </span><span class="hl-6">50500</span><span class="hl-1">, </span><span class="hl-5">// Wait for price to reach 50500</span><br/><span class="hl-1">    </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-6">52000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-6">48000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-6">120</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Wait for breakout confirmation at 50500&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Scheduled Signal Behavior:</strong></p>
<ul>
<li>Signal created in <code>scheduled</code> state with <code>_isScheduled = true</code></li>
<li><code>ClientStrategy.backtest()</code> monitors each candle for price touching <code>priceOpen</code></li>
<li>If long: activation when <code>candle.low &lt;= priceOpen</code></li>
<li>If short: activation when <code>candle.high &gt;= priceOpen</code></li>
<li>On activation: converts to opened signal, calls <code>onOpen</code>, begins TP/SL monitoring</li>
<li>If not activated within <code>CC_SCHEDULE_AWAIT_MINUTES</code>, calls <code>onCancel</code> and removes signal</li>
</ul>
<hr>
<a id="complete-strategy-definition-example" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Complete Strategy Definition Example<a href="#complete-strategy-definition-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addStrategy</span><span class="hl-1">, </span><span class="hl-4">getCandles</span><span class="hl-1">, </span><span class="hl-4">getAveragePrice</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">// Basic identification</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;rsi-momentum&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Enters on RSI oversold with volume confirmation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Throttling configuration</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">, </span><span class="hl-5">// Check for signals every 5 minutes</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Signal generation logic</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">: </span><span class="hl-13">Date</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Fetch historical data</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">candles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1">, </span><span class="hl-6">50</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">currentPrice</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getAveragePrice</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Calculate indicators</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">rsi</span><span class="hl-1"> = </span><span class="hl-0">calculateRSI</span><span class="hl-1">(</span><span class="hl-4">candles</span><span class="hl-1">, </span><span class="hl-6">14</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">volume</span><span class="hl-1"> = </span><span class="hl-4">candles</span><span class="hl-1">[</span><span class="hl-4">candles</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> - </span><span class="hl-6">1</span><span class="hl-1">].</span><span class="hl-4">volume</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgVolume</span><span class="hl-1"> = </span><span class="hl-4">candles</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(-</span><span class="hl-6">20</span><span class="hl-1">).</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">c</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">c</span><span class="hl-1">.</span><span class="hl-4">volume</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-6">20</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Entry conditions</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">isOversold</span><span class="hl-1"> = </span><span class="hl-4">rsi</span><span class="hl-1"> &lt; </span><span class="hl-6">30</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">isVolumeConfirmed</span><span class="hl-1"> = </span><span class="hl-4">volume</span><span class="hl-1"> &gt; </span><span class="hl-4">avgVolume</span><span class="hl-1"> * </span><span class="hl-6">1.5</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">isOversold</span><span class="hl-1"> || !</span><span class="hl-4">isVolumeConfirmed</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">; </span><span class="hl-5">// No signal</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Calculate targets</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">atr</span><span class="hl-1"> = </span><span class="hl-0">calculateATR</span><span class="hl-1">(</span><span class="hl-4">candles</span><span class="hl-1">, </span><span class="hl-6">14</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">stopDistance</span><span class="hl-1"> = </span><span class="hl-4">atr</span><span class="hl-1"> * </span><span class="hl-6">2</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">profitDistance</span><span class="hl-1"> = </span><span class="hl-4">atr</span><span class="hl-1"> * </span><span class="hl-6">3</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">position:</span><span class="hl-1"> </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">// Immediate entry (no priceOpen)</span><br/><span class="hl-1">      </span><span class="hl-4">priceTakeProfit:</span><span class="hl-1"> </span><span class="hl-4">currentPrice</span><span class="hl-1"> + </span><span class="hl-4">profitDistance</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">priceStopLoss:</span><span class="hl-1"> </span><span class="hl-4">currentPrice</span><span class="hl-1"> - </span><span class="hl-4">stopDistance</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">minuteEstimatedTime:</span><span class="hl-1"> </span><span class="hl-6">240</span><span class="hl-1">, </span><span class="hl-5">// 4 hours</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">`RSI=</span><span class="hl-7">${</span><span class="hl-4">rsi</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2"> Volume=</span><span class="hl-7">${</span><span class="hl-9">(</span><span class="hl-4">volume</span><span class="hl-1">/</span><span class="hl-4">avgVolume</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">x`</span><span class="hl-1">,</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Risk management integration</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&quot;conservative&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Lifecycle event monitoring</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onOpen</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[OPEN] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> @ </span><span class="hl-7">${</span><span class="hl-4">currentPrice</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  TP: </span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">priceTakeProfit</span><span class="hl-7">}</span><span class="hl-2"> (+</span><span class="hl-7">${</span><span class="hl-9">((</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">priceTakeProfit</span><span class="hl-1">/</span><span class="hl-4">currentPrice</span><span class="hl-9"> </span><span class="hl-1">-</span><span class="hl-9"> </span><span class="hl-6">1</span><span class="hl-9">) </span><span class="hl-1">*</span><span class="hl-9"> </span><span class="hl-6">100</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%)`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  SL: </span><span class="hl-7">${</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">priceStopLoss</span><span class="hl-7">}</span><span class="hl-2"> (</span><span class="hl-7">${</span><span class="hl-9">((</span><span class="hl-4">signal</span><span class="hl-9">.</span><span class="hl-4">priceStopLoss</span><span class="hl-1">/</span><span class="hl-4">currentPrice</span><span class="hl-9"> </span><span class="hl-1">-</span><span class="hl-9"> </span><span class="hl-6">1</span><span class="hl-9">) </span><span class="hl-1">*</span><span class="hl-9"> </span><span class="hl-6">100</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%)`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">backtest</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">// Log to external monitoring in live mode</span><br/><span class="hl-1">        </span><span class="hl-0">logToDatabase</span><span class="hl-1">({ </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-2">&quot;signal_opened&quot;</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onActive</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Monitor progress (called every tick)</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">pnl</span><span class="hl-1"> = ((</span><span class="hl-4">currentPrice</span><span class="hl-1"> / </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">priceOpen</span><span class="hl-1">) - </span><span class="hl-6">1</span><span class="hl-1">) * </span><span class="hl-6">100</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">abs</span><span class="hl-1">(</span><span class="hl-4">pnl</span><span class="hl-1">) &gt; </span><span class="hl-6">3</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[ACTIVE] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> PNL: </span><span class="hl-7">${</span><span class="hl-4">pnl</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onClose</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">priceClose</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">pnl</span><span class="hl-1"> = ((</span><span class="hl-4">priceClose</span><span class="hl-1"> / </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">priceOpen</span><span class="hl-1">) - </span><span class="hl-6">1</span><span class="hl-1">) * </span><span class="hl-6">100</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">duration</span><span class="hl-1"> = (</span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() - </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">pendingAt</span><span class="hl-1">) / </span><span class="hl-6">60000</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[CLOSE] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> @ </span><span class="hl-7">${</span><span class="hl-4">priceClose</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  PNL: </span><span class="hl-7">${</span><span class="hl-4">pnl</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Duration: </span><span class="hl-7">${</span><span class="hl-4">duration</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">0</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2"> minutes`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">backtest</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">// Update external tracking</span><br/><span class="hl-1">        </span><span class="hl-0">logToDatabase</span><span class="hl-1">({ </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-2">&quot;signal_closed&quot;</span><span class="hl-1">, </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">priceClose</span><span class="hl-1">, </span><span class="hl-4">pnl</span><span class="hl-1">, </span><span class="hl-4">duration</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onPartialProfit</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">revenuePercent</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[PROFIT] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> reached </span><span class="hl-7">${</span><span class="hl-4">revenuePercent</span><span class="hl-7">}</span><span class="hl-2">% profit`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-5">// Could adjust trailing stops or send alerts</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onPartialLoss</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-4">lossPercent</span><span class="hl-1">, </span><span class="hl-4">backtest</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[LOSS] </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> reached </span><span class="hl-7">${</span><span class="hl-4">lossPercent</span><span class="hl-7">}</span><span class="hl-2">% loss`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">abs</span><span class="hl-1">(</span><span class="hl-4">lossPercent</span><span class="hl-1">) &gt; </span><span class="hl-6">15</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">backtest</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">sendAlert</span><span class="hl-1">(</span><span class="hl-2">`High loss: </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> at </span><span class="hl-7">${</span><span class="hl-4">lossPercent</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#defining-strategies"><span>Defining <wbr/>Strategies</span></a><ul><li><a href="#strategy-schema-structure"><span>Strategy <wbr/>Schema <wbr/>Structure</span></a></li><li><a href="#strategy-registration-flow"><span>Strategy <wbr/>Registration <wbr/>Flow</span></a></li><li><ul><li><a href="#registration-example"><span>Registration <wbr/>Example</span></a></li></ul></li><li><a href="#signal-generation-callback"><span>Signal <wbr/>Generation <wbr/>Callback</span></a></li><li><ul><li><a href="#getsignal-function-signature"><span>get<wbr/>Signal <wbr/>Function <wbr/>Signature</span></a></li><li><a href="#signal-validation-rules"><span>Signal <wbr/>Validation <wbr/>Rules</span></a></li></ul></li><li><a href="#interval-throttling"><span>Interval <wbr/>Throttling</span></a></li><li><ul><li><a href="#signalinterval-type"><span>Signal<wbr/>Interval <wbr/>Type</span></a></li><li><a href="#choosing-an-interval"><span>Choosing an <wbr/>Interval</span></a></li></ul></li><li><a href="#lifecycle-callbacks"><span>Lifecycle <wbr/>Callbacks</span></a></li><li><ul><li><a href="#available-callbacks"><span>Available <wbr/>Callbacks</span></a></li><li><a href="#callback-parameters"><span>Callback <wbr/>Parameters</span></a></li><li><a href="#callback-example"><span>Callback <wbr/>Example</span></a></li></ul></li><li><a href="#risk-integration"><span>Risk <wbr/>Integration</span></a></li><li><ul><li><a href="#single-risk-profile"><span>Single <wbr/>Risk <wbr/>Profile</span></a></li><li><a href="#multiple-risk-profiles"><span>Multiple <wbr/>Risk <wbr/>Profiles</span></a></li></ul></li><li><a href="#signal-types-immediate-vs-scheduled"><span>Signal <wbr/>Types: <wbr/>Immediate vs <wbr/>Scheduled</span></a></li><li><ul><li><a href="#immediate-signal-example"><span>Immediate <wbr/>Signal <wbr/>Example</span></a></li><li><a href="#scheduled-signal-example"><span>Scheduled <wbr/>Signal <wbr/>Example</span></a></li></ul></li><li><a href="#complete-strategy-definition-example"><span>Complete <wbr/>Strategy <wbr/>Definition <wbr/>Example</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
