<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/07_context_propagation | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_07_context_propagation.html">design/07_context_propagation</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="context-propagation" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Context Propagation<a href="#context-propagation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Context propagation in backtest-kit enables implicit passing of runtime parameters through the service call stack without explicit function arguments. The system uses two context types: <strong>MethodContext</strong> for schema routing (which strategy/exchange/frame to use) and <strong>ExecutionContext</strong> for runtime state (backtest mode, current date). This eliminates manual parameter threading across dozens of function calls while maintaining type safety.</p>
<p>For dependency injection mechanics, see <a href="design_06_dependency_injection_system.html">Dependency Injection System</a>. For how services use context to route to specific implementations, see <a href="design_19_connection_services.html">Connection Services</a>.</p>
<hr>
<a id="context-types-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Types Overview<a href="#context-types-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework maintains two distinct context scopes that serve different purposes in the execution pipeline:</p>
<table>
<thead>
<tr>
<th>Context Type</th>
<th>Scope</th>
<th>Purpose</th>
<th>Key Properties</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>MethodContext</strong></td>
<td>Per-operation</td>
<td>Routes to correct schema instances</td>
<td><code>strategyName</code>, <code>exchangeName</code>, <code>frameName</code></td>
</tr>
<tr>
<td><strong>ExecutionContext</strong></td>
<td>Per-tick</td>
<td>Provides runtime execution state</td>
<td><code>date</code>, <code>backtestMode</code>, <code>symbol</code></td>
</tr>
</tbody>
</table>
<hr>
<a id="methodcontextservice-schema-routing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">MethodContextService: Schema Routing<a href="#methodcontextservice-schema-routing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="architecture" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Architecture<a href="#architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>MethodContextService</code> uses the <code>di-scoped</code> library to create ambient context that flows through async operations without explicit parameters. The service contains an <code>IMethodContext</code> object with three schema names that determine which registered implementations to use.</p>
<p><img src="../media/07_Context_Propagation_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: MethodContextService propagates schema names through async generator execution</strong></p>
<hr>
<a id="imethodcontext-interface" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IMethodContext Interface<a href="#imethodcontext-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>IMethodContext</code> interface defines the schema routing parameters:</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-11">IMethodContext</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-11">ExchangeName</span><span class="hl-1">;  </span><span class="hl-5">// Which exchange schema to use</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">StrategyName</span><span class="hl-1">;  </span><span class="hl-5">// Which strategy schema to use</span><br/><span class="hl-1">  </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-11">FrameName</span><span class="hl-1">;        </span><span class="hl-5">// Which frame schema to use (empty for live)</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Each property corresponds to a schema registered via <code>addStrategy()</code>, <code>addExchange()</code>, or <code>addFrame()</code>. Connection services retrieve this context to determine which cached client instance to return.</p>
<hr>
<a id="context-propagation-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Propagation Flow<a href="#context-propagation-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The following sequence shows how context flows from public API to connection services:</p>
<p><img src="../media/07_Context_Propagation_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Context propagation through service layers using di-scoped ambient context</strong></p>
<hr>
<a id="executioncontextservice-runtime-state" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ExecutionContextService: Runtime State<a href="#executioncontextservice-runtime-state" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="purpose" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Purpose<a href="#purpose" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>ExecutionContextService</code> provides execution-specific state such as the current timestamp (for backtest simulation or live trading) and the execution mode (backtest vs. live). Unlike <code>MethodContext</code>, which remains constant for an entire run, <code>ExecutionContext</code> can change per tick.</p>
<a id="context-properties" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Properties<a href="#context-properties" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Purpose</th>
<th>Set By</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date</code></td>
<td><code>Date</code></td>
<td>Current execution timestamp</td>
<td><code>BacktestLogicPrivateService</code> or <code>LiveLogicPrivateService</code></td>
</tr>
<tr>
<td><code>backtestMode</code></td>
<td><code>boolean</code></td>
<td>Whether running in backtest mode</td>
<td>Logic services</td>
</tr>
<tr>
<td><code>symbol</code></td>
<td><code>string</code></td>
<td>Current trading pair</td>
<td>Logic services</td>
</tr>
</tbody>
</table>
<hr>
<a id="usage-in-logic-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Usage in Logic Services<a href="#usage-in-logic-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The private logic services set execution context before each tick operation:</p>
<p><strong>Backtest Mode:</strong></p>
<pre><code class="typescript"><span class="hl-5">// BacktestLogicPrivateService iterates through historical timeframes</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">when</span><span class="hl-1"> = </span><span class="hl-4">timeframes</span><span class="hl-1">[</span><span class="hl-4">i</span><span class="hl-1">];  </span><span class="hl-5">// Historical timestamp</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">strategyGlobalService</span><span class="hl-1">.</span><span class="hl-0">tick</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">, </span><span class="hl-6">true</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Live Mode:</strong></p>
<pre><code class="typescript"><span class="hl-5">// LiveLogicPrivateService uses real-time dates</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">when</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">();  </span><span class="hl-5">// Current timestamp</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">strategyGlobalService</span><span class="hl-1">.</span><span class="hl-0">tick</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">when</span><span class="hl-1">, </span><span class="hl-6">false</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Global services inject this context into client instances, allowing functions like <code>getCandles()</code> to fetch data for the correct timestamp without receiving explicit date parameters.</p>
<hr>
<a id="context-propagation-in-async-generators" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Propagation in Async Generators<a href="#context-propagation-in-async-generators" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="challenge" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Challenge<a href="#challenge" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>JavaScript async generators introduce complexity for context propagation because each <code>yield</code> pauses execution and resumes later. Standard dependency injection would lose context across these boundaries.</p>
<a id="solution-runasynciterator" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Solution: runAsyncIterator<a href="#solution-runasynciterator" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>MethodContextService.runAsyncIterator()</code> method wraps async generators to maintain context across yields:</p>
<p><img src="../media/07_Context_Propagation_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: runAsyncIterator maintains context across async generator yields</strong></p>
<hr>
<a id="implementation-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Implementation Pattern<a href="#implementation-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Both public logic services follow the same pattern:</p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1"> = (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">: { </span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">exchangeName</span><span class="hl-1">, </span><span class="hl-4">frameName</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">MethodContextService</span><span class="hl-1">.</span><span class="hl-0">runAsyncIterator</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">privateLogicService</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">),  </span><span class="hl-5">// Async generator</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">exchangeName</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">frameName</span><span class="hl-1">,</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>The <code>runAsyncIterator</code> method:</p>
<ol>
<li>Captures the provided context object</li>
<li>Wraps the async generator</li>
<li>Re-injects context on each iteration</li>
<li>Returns a new async generator with transparent context propagation</li>
</ol>
<hr>
<a id="service-context-consumption" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Context Consumption<a href="#service-context-consumption" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="connection-services-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Connection Services Pattern<a href="#connection-services-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Connection services are the primary consumers of <code>MethodContext</code>. They use the context to determine which cached client instance to return:</p>
<p><img src="../media/07_Context_Propagation_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Connection services consume MethodContext to route to correct client instances</strong></p>
<hr>
<a id="context-free-client-layer" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context-Free Client Layer<a href="#context-free-client-layer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>A key architectural principle: <strong>client classes never access context services</strong>. This keeps business logic pure and testable:</p>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Context Access</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Public Logic Services</strong></td>
<td>Sets context via <code>runAsyncIterator()</code></td>
<td>Provides user-facing API with explicit parameters</td>
</tr>
<tr>
<td><strong>Private Logic Services</strong></td>
<td>No context access</td>
<td>Pure orchestration logic</td>
</tr>
<tr>
<td><strong>Global Services</strong></td>
<td>Injects <code>ExecutionContext</code></td>
<td>Bridges context to clients</td>
</tr>
<tr>
<td><strong>Connection Services</strong></td>
<td>Reads <code>MethodContext</code></td>
<td>Routes to correct schema</td>
</tr>
<tr>
<td><strong>Client Classes</strong></td>
<td><strong>No context access</strong></td>
<td>Pure business logic, fully testable</td>
</tr>
</tbody>
</table>
<p>This separation enables unit testing clients without mocking the DI system.</p>
<hr>
<a id="implementation-details" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Implementation Details<a href="#implementation-details" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="di-scoped-library" class="tsd-anchor"></a><h3 class="tsd-anchor-link">di-scoped Library<a href="#di-scoped-library" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The framework uses the <code>di-scoped</code> library for ambient context management. The <code>scoped()</code> function creates context-aware service classes:</p>
<pre><code class="typescript"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">MethodContextService</span><span class="hl-1"> = </span><span class="hl-0">scoped</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">class</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">constructor</span><span class="hl-1">(</span><span class="hl-6">readonly</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">: </span><span class="hl-11">IMethodContext</span><span class="hl-1">) {}</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Key features:</p>
<ul>
<li><strong>Static methods</strong>: <code>MethodContextService.run()</code>, <code>MethodContextService.runAsyncIterator()</code></li>
<li><strong>Instance retrieval</strong>: <code>MethodContextService.get()</code> returns current instance</li>
<li><strong>Type safety</strong>: <code>TMethodContextService</code> type helper for injection</li>
</ul>
<hr>
<a id="context-lifecycle" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Lifecycle<a href="#context-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/07_Context_Propagation_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Context lifecycle from creation through generator completion</strong></p>
<hr>
<a id="service-registration-and-context" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Registration and Context<a href="#service-registration-and-context" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The DI system registers context services as singletons but their scoped instances vary per operation:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Registration Type</th>
<th>Instance Scope</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ExecutionContextService</code></td>
<td>Singleton</td>
<td>Global</td>
<td>Stores current execution state</td>
</tr>
<tr>
<td><code>MethodContextService</code></td>
<td>Scoped constructor</td>
<td>Per-operation</td>
<td>Provides schema routing</td>
</tr>
</tbody>
</table>
<hr>
<a id="context-in-logic-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context in Logic Flow<a href="#context-in-logic-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The complete flow showing both context types in action:</p>
<p><img src="../media/07_Context_Propagation_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Interaction between MethodContext and ExecutionContext during execution</strong></p>
<hr>
<a id="benefits-and-trade-offs" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Benefits and Trade-offs<a href="#benefits-and-trade-offs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="benefits" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Benefits<a href="#benefits" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Reduced Parameter Pollution</strong>: Functions don't need 3-5 extra parameters threaded through every call</li>
<li><strong>Type Safety</strong>: <code>MethodContextService.get()</code> returns typed context with IDE autocomplete</li>
<li><strong>Async-Safe</strong>: Works correctly with async generators and Promises</li>
<li><strong>Testability</strong>: Client layer remains pure without DI dependencies</li>
<li><strong>Flexibility</strong>: Context can be changed per-operation without modifying signatures</li>
</ol>
<a id="trade-offs" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Trade-offs<a href="#trade-offs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Implicit Dependencies</strong>: Context access is not visible in function signatures</li>
<li><strong>Debugging Complexity</strong>: Stack traces don't show context propagation</li>
<li><strong>Learning Curve</strong>: Developers must understand ambient context patterns</li>
<li><strong>Runtime Dependency</strong>: Requires <code>di-scoped</code> library for scoped context</li>
</ol>
<hr>
<a id="related-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Related Patterns<a href="#related-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>For information about:</p>
<ul>
<li>Service instantiation and caching: See <a href="design_19_connection_services.html">Connection Services</a></li>
<li>Schema registration: See <a href="design_20_schema_services.html">Schema Services</a></li>
<li>DI container configuration: See <a href="design_06_dependency_injection_system.html">Dependency Injection System</a></li>
<li>How global services inject context into clients: See <a href="design_21_global_services.html">Global Services</a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#context-propagation"><span>Context <wbr/>Propagation</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#context-types-overview"><span>Context <wbr/>Types <wbr/>Overview</span></a></li><li><a href="#methodcontextservice-schema-routing"><span>Method<wbr/>Context<wbr/>Service: <wbr/>Schema <wbr/>Routing</span></a></li><li><ul><li><a href="#architecture"><span>Architecture</span></a></li><li><a href="#imethodcontext-interface"><span>IMethod<wbr/>Context <wbr/>Interface</span></a></li><li><a href="#context-propagation-flow"><span>Context <wbr/>Propagation <wbr/>Flow</span></a></li></ul></li><li><a href="#executioncontextservice-runtime-state"><span>Execution<wbr/>Context<wbr/>Service: <wbr/>Runtime <wbr/>State</span></a></li><li><ul><li><a href="#purpose"><span>Purpose</span></a></li><li><a href="#context-properties"><span>Context <wbr/>Properties</span></a></li><li><a href="#usage-in-logic-services"><span>Usage in <wbr/>Logic <wbr/>Services</span></a></li></ul></li><li><a href="#context-propagation-in-async-generators"><span>Context <wbr/>Propagation in <wbr/>Async <wbr/>Generators</span></a></li><li><ul><li><a href="#challenge"><span>Challenge</span></a></li><li><a href="#solution-runasynciterator"><span>Solution: run<wbr/>Async<wbr/>Iterator</span></a></li><li><a href="#implementation-pattern"><span>Implementation <wbr/>Pattern</span></a></li></ul></li><li><a href="#service-context-consumption"><span>Service <wbr/>Context <wbr/>Consumption</span></a></li><li><ul><li><a href="#connection-services-pattern"><span>Connection <wbr/>Services <wbr/>Pattern</span></a></li><li><a href="#context-free-client-layer"><span>Context-<wbr/>Free <wbr/>Client <wbr/>Layer</span></a></li></ul></li><li><a href="#implementation-details"><span>Implementation <wbr/>Details</span></a></li><li><ul><li><a href="#di-scoped-library"><span>di-<wbr/>scoped <wbr/>Library</span></a></li><li><a href="#context-lifecycle"><span>Context <wbr/>Lifecycle</span></a></li></ul></li><li><a href="#service-registration-and-context"><span>Service <wbr/>Registration and <wbr/>Context</span></a></li><li><a href="#context-in-logic-flow"><span>Context in <wbr/>Logic <wbr/>Flow</span></a></li><li><a href="#benefits-and-trade-offs"><span>Benefits and <wbr/>Trade-<wbr/>offs</span></a></li><li><ul><li><a href="#benefits"><span>Benefits</span></a></li><li><a href="#trade-offs"><span>Trade-<wbr/>offs</span></a></li></ul></li><li><a href="#related-patterns"><span>Related <wbr/>Patterns</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
