<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/69_performance_metrics | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_69_performance_metrics.html">design/69_performance_metrics</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="performance-metrics" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Performance Metrics<a href="#performance-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose<a href="#purpose" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This document describes the performance metrics system in backtest-kit, which tracks execution timing and duration analysis for strategy operations. Performance metrics provide timing data for identifying bottlenecks, analyzing execution patterns, and optimizing strategy performance. These metrics are distinct from trading statistics (see <a href="design_49_pnl_calculation.html">13.3</a> for PNL calculations and trading performance).</p>
<p>For general reporting capabilities, see <a href="design_67_reporting_and_analytics.html">13.1</a>. For event system architecture, see <a href="design_13_event_system.html">3.4</a>.</p>
<hr>
<a id="performance-metric-types" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Metric Types<a href="#performance-metric-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework tracks four types of performance metrics, defined by the <code>PerformanceMetricType</code> enum:</p>
<table>
<thead>
<tr>
<th>Metric Type</th>
<th>Scope</th>
<th>Description</th>
<th>Execution Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>backtest_total</code></td>
<td>Entire backtest</td>
<td>Total duration from start to completion of all timeframes</td>
<td>Backtest only</td>
</tr>
<tr>
<td><code>backtest_timeframe</code></td>
<td>Single timeframe</td>
<td>Duration to process one timestamp (tick + potential signal handling)</td>
<td>Backtest only</td>
</tr>
<tr>
<td><code>backtest_signal</code></td>
<td>Single signal</td>
<td>Duration to process signal lifecycle (from open to close via backtest method)</td>
<td>Backtest only</td>
</tr>
<tr>
<td><code>live_tick</code></td>
<td>Single tick</td>
<td>Duration to execute one tick cycle in live trading</td>
<td>Live only</td>
</tr>
</tbody>
</table>
<hr>
<a id="performance-tracking-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Tracking Architecture<a href="#performance-tracking-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/69_Performance_Metrics_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Performance Tracking Flow</strong></p>
<p>The framework instruments critical operations by recording <code>performance.now()</code> timestamps at operation boundaries, calculating duration, and emitting structured events via <code>performanceEmitter</code>.</p>
<hr>
<a id="backtest-performance-tracking" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Backtest Performance Tracking<a href="#backtest-performance-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="total-backtest-duration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Total Backtest Duration<a href="#total-backtest-duration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tracks the complete execution time from the first timeframe to the last:</p>
<p><img src="../media/69_Performance_Metrics_1.svg" alt="Mermaid Diagram"></p>
<a id="timeframe-processing-duration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Timeframe Processing Duration<a href="#timeframe-processing-duration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tracks the time to process a single timestamp, including tick execution and potential signal handling:</p>
<p><img src="../media/69_Performance_Metrics_2.svg" alt="Mermaid Diagram"></p>
<a id="signal-processing-duration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signal Processing Duration<a href="#signal-processing-duration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tracks the time to execute the fast-forward backtest simulation for a single signal from open to close:</p>
<p><img src="../media/69_Performance_Metrics_3.svg" alt="Mermaid Diagram"></p>
<p>This metric captures the duration of the optimized backtest path, including candle fetching and TP/SL detection via high/low analysis.</p>
<hr>
<a id="live-trading-performance-tracking" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Live Trading Performance Tracking<a href="#live-trading-performance-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="tick-duration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Tick Duration<a href="#tick-duration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tracks the time to execute a complete tick cycle in live trading, including signal generation, risk checks, and TP/SL monitoring:</p>
<p><img src="../media/69_Performance_Metrics_4.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="performance-contract-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Contract Structure<a href="#performance-contract-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>PerformanceContract</code> interface defines the structure of emitted performance events:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>timestamp</code></td>
<td><code>number</code></td>
<td>Unix timestamp (milliseconds) when event was emitted</td>
</tr>
<tr>
<td><code>previousTimestamp</code></td>
<td><code>number | null</code></td>
<td>Timestamp of previous performance event for calculating gaps</td>
</tr>
<tr>
<td><code>metricType</code></td>
<td><code>PerformanceMetricType</code></td>
<td>Type of metric: <code>backtest_total</code>, <code>backtest_timeframe</code>, <code>backtest_signal</code>, <code>live_tick</code></td>
</tr>
<tr>
<td><code>duration</code></td>
<td><code>number</code></td>
<td>Execution duration in milliseconds</td>
</tr>
<tr>
<td><code>strategyName</code></td>
<td><code>string</code></td>
<td>Strategy name being executed</td>
</tr>
<tr>
<td><code>exchangeName</code></td>
<td><code>string</code></td>
<td>Exchange name being used</td>
</tr>
<tr>
<td><code>symbol</code></td>
<td><code>string</code></td>
<td>Trading pair symbol (e.g., &quot;BTCUSDT&quot;)</td>
</tr>
<tr>
<td><code>backtest</code></td>
<td><code>boolean</code></td>
<td><code>true</code> for backtest mode, <code>false</code> for live mode</td>
</tr>
</tbody>
</table>
<a id="previous-timestamp-tracking" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Previous Timestamp Tracking<a href="#previous-timestamp-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each service maintains <code>previousEventTimestamp</code> to track the time between successive performance events. This enables analysis of execution gaps and idle time:</p>
<pre><code class="typescript"><span class="hl-5">// From BacktestLogicPrivateService</span><br/><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-4">previousEventTimestamp</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1"> = </span><span class="hl-6">null</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// ... later in code</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">currentTimestamp</span><span class="hl-1"> = </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">();</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">performanceEmitter</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">currentTimestamp</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">previousTimestamp:</span><span class="hl-1"> </span><span class="hl-4">previousEventTimestamp</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">metricType:</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest_timeframe&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">duration:</span><span class="hl-1"> </span><span class="hl-4">timeframeEndTime</span><span class="hl-1"> - </span><span class="hl-4">timeframeStartTime</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">// ... other fields</span><br/><span class="hl-1">});</span><br/><span class="hl-4">previousEventTimestamp</span><span class="hl-1"> = </span><span class="hl-4">currentTimestamp</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="subscribing-to-performance-events" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Subscribing to Performance Events<a href="#subscribing-to-performance-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="using-listenperformance" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using listenPerformance<a href="#using-listenperformance" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>listenPerformance()</code> function subscribes to all performance metric events:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenPerformance</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">listenPerformance</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[</span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">metricType</span><span class="hl-6">}</span><span class="hl-2">] </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">strategyName</span><span class="hl-6">}</span><span class="hl-2"> - </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">duration</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">previousTimestamp</span><span class="hl-1"> !== </span><span class="hl-6">null</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">gap</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">timestamp</span><span class="hl-1"> - </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">previousTimestamp</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`  Time since last event: </span><span class="hl-6">${</span><span class="hl-4">gap</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="performance-event-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Performance Event Flow<a href="#performance-event-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/69_Performance_Metrics_5.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="use-cases-and-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Use Cases and Patterns<a href="#use-cases-and-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="identifying-bottlenecks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Identifying Bottlenecks<a href="#identifying-bottlenecks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Track which operations consume the most time:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenPerformance</span><span class="hl-1">, </span><span class="hl-4">PerformanceContract</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">durations</span><span class="hl-1">: </span><span class="hl-10">Record</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-10">number</span><span class="hl-1">[]&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-4">backtest_total:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  </span><span class="hl-4">backtest_timeframe:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  </span><span class="hl-4">backtest_signal:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  </span><span class="hl-4">live_tick:</span><span class="hl-1"> [],</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">listenPerformance</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-10">PerformanceContract</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">durations</span><span class="hl-1">[</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">metricType</span><span class="hl-1">].</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// After execution, analyze</span><br/><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-0">entries</span><span class="hl-1">(</span><span class="hl-4">durations</span><span class="hl-1">).</span><span class="hl-0">forEach</span><span class="hl-1">(([</span><span class="hl-4">type</span><span class="hl-1">, </span><span class="hl-4">values</span><span class="hl-1">]) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">avg</span><span class="hl-1"> = </span><span class="hl-4">values</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">a</span><span class="hl-1"> + </span><span class="hl-4">b</span><span class="hl-1">, </span><span class="hl-8">0</span><span class="hl-1">) / </span><span class="hl-4">values</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">max</span><span class="hl-1"> = </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">max</span><span class="hl-1">(...</span><span class="hl-4">values</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">type</span><span class="hl-6">}</span><span class="hl-2">: avg=</span><span class="hl-6">${</span><span class="hl-4">avg</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">ms, max=</span><span class="hl-6">${</span><span class="hl-4">max</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="detecting-performance-degradation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Detecting Performance Degradation<a href="#detecting-performance-degradation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Monitor execution time increases over the course of a backtest:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenPerformance</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">timeframeMetrics</span><span class="hl-1">: { </span><span class="hl-4">index</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">; </span><span class="hl-4">duration</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> }[] = [];</span><br/><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-4">frameIndex</span><span class="hl-1"> = </span><span class="hl-8">0</span><span class="hl-1">;</span><br/><br/><span class="hl-0">listenPerformance</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">metricType</span><span class="hl-1"> === </span><span class="hl-2">&quot;backtest_timeframe&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">timeframeMetrics</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">({ </span><span class="hl-4">index:</span><span class="hl-1"> </span><span class="hl-4">frameIndex</span><span class="hl-1">++, </span><span class="hl-4">duration:</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Check if last 100 frames are 2x slower than first 100</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">frameIndex</span><span class="hl-1"> === </span><span class="hl-8">200</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">first100Avg</span><span class="hl-1"> = </span><span class="hl-4">timeframeMetrics</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-8">100</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">m</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">m</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1">, </span><span class="hl-8">0</span><span class="hl-1">) / </span><span class="hl-8">100</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">last100Avg</span><span class="hl-1"> = </span><span class="hl-4">timeframeMetrics</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-8">100</span><span class="hl-1">, </span><span class="hl-8">200</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">m</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">m</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1">, </span><span class="hl-8">0</span><span class="hl-1">) / </span><span class="hl-8">100</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">last100Avg</span><span class="hl-1"> &gt; </span><span class="hl-4">first100Avg</span><span class="hl-1"> * </span><span class="hl-8">2</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">&quot;Performance degradation detected!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="comparing-strategy-performance" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Comparing Strategy Performance<a href="#comparing-strategy-performance" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Track execution time across multiple strategies in Walker mode:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenPerformance</span><span class="hl-1">, </span><span class="hl-4">Walker</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">strategyTimings</span><span class="hl-1">: </span><span class="hl-10">Record</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-10">number</span><span class="hl-1">&gt; = {};</span><br/><br/><span class="hl-0">listenPerformance</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">metricType</span><span class="hl-1"> === </span><span class="hl-2">&quot;backtest_total&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">strategyTimings</span><span class="hl-1">[</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">] = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// After walker completion</span><br/><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-0">entries</span><span class="hl-1">(</span><span class="hl-4">strategyTimings</span><span class="hl-1">).</span><span class="hl-0">forEach</span><span class="hl-1">(([</span><span class="hl-4">strategy</span><span class="hl-1">, </span><span class="hl-4">duration</span><span class="hl-1">]) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">strategy</span><span class="hl-6">}</span><span class="hl-2">: </span><span class="hl-6">${</span><span class="hl-9">(</span><span class="hl-4">duration</span><span class="hl-9"> </span><span class="hl-1">/</span><span class="hl-9"> </span><span class="hl-8">1000</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2"> seconds`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="real-time-performance-monitoring" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Real-time Performance Monitoring<a href="#real-time-performance-monitoring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Track live trading tick performance:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenPerformance</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">recentTicks</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">[] = [];</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">WINDOW_SIZE</span><span class="hl-1"> = </span><span class="hl-8">100</span><span class="hl-1">;</span><br/><br/><span class="hl-0">listenPerformance</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">metricType</span><span class="hl-1"> === </span><span class="hl-2">&quot;live_tick&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">recentTicks</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">recentTicks</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-7">WINDOW_SIZE</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">recentTicks</span><span class="hl-1">.</span><span class="hl-0">shift</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">avg</span><span class="hl-1"> = </span><span class="hl-4">recentTicks</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">a</span><span class="hl-1"> + </span><span class="hl-4">b</span><span class="hl-1">, </span><span class="hl-8">0</span><span class="hl-1">) / </span><span class="hl-4">recentTicks</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Alert if tick takes too long</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1"> &gt; </span><span class="hl-4">avg</span><span class="hl-1"> * </span><span class="hl-8">3</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Slow tick detected: </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">duration</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">ms (avg: </span><span class="hl-6">${</span><span class="hl-4">avg</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">ms)`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="performance-data-accumulation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Data Accumulation<a href="#performance-data-accumulation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>PerformanceMarkdownService</code> subscribes to performance events and accumulates metrics for later analysis. The service maintains a separate storage instance per strategy, allowing isolated performance tracking across multiple concurrent executions.</p>
<hr>
<a id="timing-precision" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Timing Precision<a href="#timing-precision" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework uses <code>performance.now()</code> from Node.js for high-resolution timing:</p>
<ul>
<li><strong>Resolution</strong>: Microsecond precision (typically 0.001ms)</li>
<li><strong>Monotonic</strong>: Not affected by system clock adjustments</li>
<li><strong>Isolated</strong>: Each measurement is self-contained</li>
</ul>
<a id="example-timing-instrumentation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example Timing Instrumentation<a href="#example-timing-instrumentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// From BacktestLogicPrivateService.ts</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">backtestStartTime</span><span class="hl-1"> = </span><span class="hl-4">performance</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// ... execute operations ...</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">backtestEndTime</span><span class="hl-1"> = </span><span class="hl-4">performance</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">();</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">duration</span><span class="hl-1"> = </span><span class="hl-4">backtestEndTime</span><span class="hl-1"> - </span><span class="hl-4">backtestStartTime</span><span class="hl-1">;</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">performanceEmitter</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-4">previousTimestamp:</span><span class="hl-1"> </span><span class="hl-4">previousEventTimestamp</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">metricType:</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest_total&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">duration</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">methodContextService</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">methodContextService</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">exchangeName</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">backtest:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="integration-with-other-systems" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Other Systems<a href="#integration-with-other-systems" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Performance metrics integrate with the broader framework architecture:</p>
<table>
<thead>
<tr>
<th>System</th>
<th>Integration Point</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Event System</td>
<td><code>performanceEmitter</code> (Subject)</td>
<td>Publish-subscribe for metrics distribution</td>
</tr>
<tr>
<td>Reporting</td>
<td><code>PerformanceMarkdownService</code></td>
<td>Accumulate and format performance reports</td>
</tr>
<tr>
<td>Context Propagation</td>
<td><code>MethodContextService</code></td>
<td>Inject strategy/exchange names into metrics</td>
</tr>
<tr>
<td>Execution Modes</td>
<td><code>BacktestLogicPrivateService</code>, <code>LiveLogicPrivateService</code></td>
<td>Instrument operations with timing</td>
</tr>
</tbody>
</table>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#performance-metrics"><span>Performance <wbr/>Metrics</span></a><ul><li><a href="#purpose"><span>Purpose</span></a></li><li><a href="#performance-metric-types"><span>Performance <wbr/>Metric <wbr/>Types</span></a></li><li><a href="#performance-tracking-architecture"><span>Performance <wbr/>Tracking <wbr/>Architecture</span></a></li><li><a href="#backtest-performance-tracking"><span>Backtest <wbr/>Performance <wbr/>Tracking</span></a></li><li><ul><li><a href="#total-backtest-duration"><span>Total <wbr/>Backtest <wbr/>Duration</span></a></li><li><a href="#timeframe-processing-duration"><span>Timeframe <wbr/>Processing <wbr/>Duration</span></a></li><li><a href="#signal-processing-duration"><span>Signal <wbr/>Processing <wbr/>Duration</span></a></li></ul></li><li><a href="#live-trading-performance-tracking"><span>Live <wbr/>Trading <wbr/>Performance <wbr/>Tracking</span></a></li><li><ul><li><a href="#tick-duration"><span>Tick <wbr/>Duration</span></a></li></ul></li><li><a href="#performance-contract-structure"><span>Performance <wbr/>Contract <wbr/>Structure</span></a></li><li><ul><li><a href="#previous-timestamp-tracking"><span>Previous <wbr/>Timestamp <wbr/>Tracking</span></a></li></ul></li><li><a href="#subscribing-to-performance-events"><span>Subscribing to <wbr/>Performance <wbr/>Events</span></a></li><li><ul><li><a href="#using-listenperformance"><span>Using listen<wbr/>Performance</span></a></li><li><a href="#performance-event-flow"><span>Performance <wbr/>Event <wbr/>Flow</span></a></li></ul></li><li><a href="#use-cases-and-patterns"><span>Use <wbr/>Cases and <wbr/>Patterns</span></a></li><li><ul><li><a href="#identifying-bottlenecks"><span>Identifying <wbr/>Bottlenecks</span></a></li><li><a href="#detecting-performance-degradation"><span>Detecting <wbr/>Performance <wbr/>Degradation</span></a></li><li><a href="#comparing-strategy-performance"><span>Comparing <wbr/>Strategy <wbr/>Performance</span></a></li><li><a href="#real-time-performance-monitoring"><span>Real-<wbr/>time <wbr/>Performance <wbr/>Monitoring</span></a></li></ul></li><li><a href="#performance-data-accumulation"><span>Performance <wbr/>Data <wbr/>Accumulation</span></a></li><li><a href="#timing-precision"><span>Timing <wbr/>Precision</span></a></li><li><ul><li><a href="#example-timing-instrumentation"><span>Example <wbr/>Timing <wbr/>Instrumentation</span></a></li></ul></li><li><a href="#integration-with-other-systems"><span>Integration with <wbr/>Other <wbr/>Systems</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
