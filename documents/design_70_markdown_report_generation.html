<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/70_markdown_report_generation | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_70_markdown_report_generation.html">design/70_markdown_report_generation</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="markdown-report-generation" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Markdown Report Generation<a href="#markdown-report-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents the markdown report generation system that transforms trading execution events into human-readable reports with statistical analysis. The system provides three report types: backtest reports (historical simulation), live trading reports (real-time execution), and schedule reports (limit order tracking).</p>
<p>For statistical metric calculations (Sharpe Ratio, Certainty Ratio, etc.), see <a href="design_71_performance_metrics.html">Performance Metrics</a>. For partial profit/loss milestone tracking, see <a href="design_73_partial_profit_loss_tracking.html">Partial Profit/Loss Tracking</a>. For walker strategy comparison reports, see <a href="design_64_walker_reports.html">Walker Reports</a>.</p>
<hr>
<a id="architecture-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Overview<a href="#architecture-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The markdown generation system consists of three independent service classes that follow identical architectural patterns. Each service subscribes to event emitters, accumulates events in per-strategy storage, and provides three methods for data access (<code>getData</code>), report generation (<code>getReport</code>), and file persistence (<code>dump</code>).</p>
<p><img src="../media/70_Markdown_Report_Generation_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="event-accumulation-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Accumulation System<a href="#event-accumulation-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each markdown service subscribes to event emitters during initialization using the <code>singleshot</code> pattern to ensure single subscription. Events are processed by a private <code>tick()</code> method that routes them to per-strategy storage instances.</p>
<a id="backtest-event-accumulation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Event Accumulation<a href="#backtest-event-accumulation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>BacktestMarkdownService</code> only accumulates <code>closed</code> events (signals that have reached TP, SL, or timeout). Idle, opened, and active events are ignored since backtest execution skips timeframes once a signal opens.</p>
<p><img src="../media/70_Markdown_Report_Generation_1.svg" alt="Mermaid Diagram"></p>
<a id="live-event-accumulation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live Event Accumulation<a href="#live-event-accumulation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>LiveMarkdownService</code> accumulates all four event types: <code>idle</code>, <code>opened</code>, <code>active</code>, and <code>closed</code>. The service implements special logic to replace consecutive idle events (no signal activity) to prevent unbounded memory growth, while preserving opened/active/closed events.</p>
<p><img src="../media/70_Markdown_Report_Generation_2.svg" alt="Mermaid Diagram"></p>
<p>The <code>MAX_EVENTS = 250</code> constant limits memory usage by removing the oldest event when capacity is exceeded. This circular buffer approach ensures bounded memory consumption for long-running live strategies.</p>
<a id="schedule-event-accumulation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schedule Event Accumulation<a href="#schedule-event-accumulation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>ScheduleMarkdownService</code> tracks scheduled signals (limit orders waiting for entry price) and their cancellations. When a scheduled signal is cancelled, the service replaces the original scheduled event with a cancelled event containing cancellation metadata.</p>
<hr>
<a id="report-generation-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Report Generation Services<a href="#report-generation-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each markdown service contains an inner <code>ReportStorage</code> class that encapsulates event accumulation logic and report generation. The service class itself acts as a facade that manages per-strategy storage instances using memoization.</p>
<a id="backtestmarkdownservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">BacktestMarkdownService<a href="#backtestmarkdownservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The backtest service generates reports with closed signal data in a tabular format. Each row represents a completed trade with open/close prices, PNL, duration, and close reason.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Code Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BacktestMarkdownService</code></td>
<td>Facade service managing storage instances</td>
<td><a href="">BacktestMarkdownService.ts:370-542</a></td>
</tr>
<tr>
<td><code>ReportStorage</code></td>
<td>Inner class storing signal list</td>
<td><a href="">BacktestMarkdownService.ts:183-341</a></td>
</tr>
<tr>
<td><code>BacktestStatistics</code></td>
<td>Interface for statistical data</td>
<td><a href="">BacktestMarkdownService.ts:66-102</a></td>
</tr>
<tr>
<td><code>Column[]</code></td>
<td>Table column definitions</td>
<td><a href="">BacktestMarkdownService.ts:104-177</a></td>
</tr>
<tr>
<td><code>getStorage()</code></td>
<td>Memoized storage retriever</td>
<td><a href="">BacktestMarkdownService.ts:378-381</a></td>
</tr>
</tbody>
</table>
<a id="livemarkdownservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">LiveMarkdownService<a href="#livemarkdownservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The live service generates reports with all event types (idle, opened, active, closed). The report shows strategy activity timeline including periods of inactivity and active position monitoring.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Code Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>LiveMarkdownService</code></td>
<td>Facade service managing storage instances</td>
<td><a href="">LiveMarkdownService.ts:567-746</a></td>
</tr>
<tr>
<td><code>ReportStorage</code></td>
<td>Inner class storing event list</td>
<td><a href="">LiveMarkdownService.ts:229-535</a></td>
</tr>
<tr>
<td><code>LiveStatistics</code></td>
<td>Interface for statistical data</td>
<td><a href="">LiveMarkdownService.ts:91-130</a></td>
</tr>
<tr>
<td><code>TickEvent</code></td>
<td>Unified event data structure</td>
<td><a href="">LiveMarkdownService.ts:39-66</a></td>
</tr>
<tr>
<td><code>Column[]</code></td>
<td>Table column definitions</td>
<td><a href="">LiveMarkdownService.ts:145-220</a></td>
</tr>
<tr>
<td><code>MAX_EVENTS</code></td>
<td>Event queue capacity (250)</td>
<td><a href="">LiveMarkdownService.ts:223</a></td>
</tr>
</tbody>
</table>
<a id="schedulemarkdownservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ScheduleMarkdownService<a href="#schedulemarkdownservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The schedule service tracks scheduled signals and their cancellation metrics. Reports include cancellation rate and average wait time for cancelled orders.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Code Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ScheduleMarkdownService</code></td>
<td>Facade service managing storage instances</td>
<td><a href="">ScheduleMarkdownService.ts:374-545</a></td>
</tr>
<tr>
<td><code>ReportStorage</code></td>
<td>Inner class storing scheduled events</td>
<td><a href="">ScheduleMarkdownService.ts:167-351</a></td>
</tr>
<tr>
<td><code>ScheduleStatistics</code></td>
<td>Interface for statistical data</td>
<td><a href="">ScheduleMarkdownService.ts:68-86</a></td>
</tr>
<tr>
<td><code>ScheduledEvent</code></td>
<td>Scheduled/cancelled event data</td>
<td><a href="">ScheduleMarkdownService.ts:19-44</a></td>
</tr>
<tr>
<td><code>Column[]</code></td>
<td>Table column definitions</td>
<td><a href="">ScheduleMarkdownService.ts:101-158</a></td>
</tr>
</tbody>
</table>
<hr>
<a id="three-method-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Three-Method Pattern<a href="#three-method-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All markdown services implement a consistent three-method API pattern: <code>getData()</code>, <code>getReport()</code>, and <code>dump()</code>. This separation of concerns enables flexible data access for different use cases.</p>
<p><img src="../media/70_Markdown_Report_Generation_3.svg" alt="Mermaid Diagram"></p>
<a id="getdata---statistical-data-access" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getData() - Statistical Data Access<a href="#getdata---statistical-data-access" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>getData()</code> method returns a statistics object containing raw event data and calculated metrics. This method is used for programmatic access to report data without markdown formatting.</p>
<pre><code class="typescript"><span class="hl-5">// Example: BacktestStatistics interface</span><br/><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-13">BacktestStatistics</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">signalList</span><span class="hl-1">: </span><span class="hl-13">IStrategyTickResultClosed</span><span class="hl-1">[];  </span><span class="hl-5">// Raw event data</span><br/><span class="hl-1">  </span><span class="hl-4">totalSignals</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">winCount</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">lossCount</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">winRate</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1">;        </span><span class="hl-5">// null if unsafe (NaN/Infinity)</span><br/><span class="hl-1">  </span><span class="hl-4">avgPnl</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalPnl</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">stdDev</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">sharpeRatio</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">annualizedSharpeRatio</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">certaintyRatio</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">expectedYearlyReturns</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>All numeric metrics use the <code>isUnsafe()</code> guard function to return <code>null</code> instead of <code>NaN</code> or <code>Infinity</code>. This prevents downstream errors when metrics cannot be calculated (e.g., Sharpe Ratio with zero standard deviation).</p>
<a id="getreport---markdown-generation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getReport() - Markdown Generation<a href="#getreport---markdown-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>getReport()</code> method formats statistical data into markdown tables with human-readable formatting. The method delegates to <code>ReportStorage.getReport()</code> which constructs the markdown string.</p>
<p><strong>Markdown Structure:</strong></p>
<ol>
<li>Title: <code># Backtest Report: {strategyName}</code></li>
<li>Data table with formatted columns</li>
<li>Statistics summary with formatted percentages</li>
</ol>
<p><strong>Column Formatting:</strong></p>
<ul>
<li>Prices: 8 decimal places with &quot;USD&quot; suffix</li>
<li>PNL: 2 decimal places with +/- prefix and &quot;%&quot; suffix</li>
<li>Timestamps: ISO 8601 format</li>
<li>Duration: Integer minutes</li>
</ul>
<a id="dump---file-persistence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">dump() - File Persistence<a href="#dump---file-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>dump()</code> method writes markdown reports to disk using Node.js file system APIs. The method creates directories recursively if they don't exist and uses UTF-8 encoding.</p>
<p><strong>Default Paths:</strong></p>
<ul>
<li>Backtest: <code>./dump/backtest/{strategyName}.md</code></li>
<li>Live: <code>./dump/live/{strategyName}.md</code></li>
<li>Schedule: <code>./dump/schedule/{strategyName}.md</code></li>
</ul>
<hr>
<a id="markdown-table-generation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Markdown Table Generation<a href="#markdown-table-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Tables are generated using a column configuration system that defines label, key, and formatting function for each column. The system maps event data to table rows using these column definitions.</p>
<p><img src="../media/70_Markdown_Report_Generation_4.svg" alt="Mermaid Diagram"></p>
<a id="backtest-columns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Columns<a href="#backtest-columns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The backtest table includes 12 columns showing complete signal lifecycle data:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Signal ID</td>
<td>UUID string</td>
<td><code>abc123-def456</code></td>
</tr>
<tr>
<td>Symbol</td>
<td>Trading pair</td>
<td><code>BTCUSDT</code></td>
</tr>
<tr>
<td>Position</td>
<td>LONG/SHORT</td>
<td><code>LONG</code></td>
</tr>
<tr>
<td>Note</td>
<td>User-provided string</td>
<td><code>Breakout entry</code></td>
</tr>
<tr>
<td>Open Price</td>
<td>8 decimals + USD</td>
<td><code>50000.12345678 USD</code></td>
</tr>
<tr>
<td>Close Price</td>
<td>8 decimals + USD</td>
<td><code>51500.00000000 USD</code></td>
</tr>
<tr>
<td>Take Profit</td>
<td>8 decimals + USD</td>
<td><code>52000.00000000 USD</code></td>
</tr>
<tr>
<td>Stop Loss</td>
<td>8 decimals + USD</td>
<td><code>49000.00000000 USD</code></td>
</tr>
<tr>
<td>PNL (net)</td>
<td>+/- 2 decimals + %</td>
<td><code>+3.00%</code></td>
</tr>
<tr>
<td>Close Reason</td>
<td>Enum string</td>
<td><code>TAKEPROFIT</code> / <code>STOPLOSS</code> / <code>TIMEOUT</code></td>
</tr>
<tr>
<td>Duration (min)</td>
<td>Integer minutes</td>
<td><code>120</code></td>
</tr>
<tr>
<td>Open Time</td>
<td>ISO 8601</td>
<td><code>2024-01-15T10:30:00.000Z</code></td>
</tr>
<tr>
<td>Close Time</td>
<td>ISO 8601</td>
<td><code>2024-01-15T12:30:00.000Z</code></td>
</tr>
</tbody>
</table>
<a id="live-columns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live Columns<a href="#live-columns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The live table includes 13 columns showing all event types including idle periods:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Timestamp</td>
<td>ISO 8601</td>
<td><code>2024-01-15T10:30:00.000Z</code></td>
</tr>
<tr>
<td>Action</td>
<td>IDLE/OPENED/ACTIVE/CLOSED</td>
<td><code>CLOSED</code></td>
</tr>
<tr>
<td>Symbol</td>
<td>Trading pair or N/A</td>
<td><code>BTCUSDT</code></td>
</tr>
<tr>
<td>Signal ID</td>
<td>UUID or N/A</td>
<td><code>abc123-def456</code></td>
</tr>
<tr>
<td>Position</td>
<td>LONG/SHORT or N/A</td>
<td><code>LONG</code></td>
</tr>
<tr>
<td>Note</td>
<td>User string or N/A</td>
<td><code>Breakout entry</code></td>
</tr>
<tr>
<td>Current Price</td>
<td>8 decimals + USD</td>
<td><code>51500.00000000 USD</code></td>
</tr>
<tr>
<td>Open Price</td>
<td>8 decimals + USD or N/A</td>
<td><code>50000.12345678 USD</code></td>
</tr>
<tr>
<td>Take Profit</td>
<td>8 decimals + USD or N/A</td>
<td><code>52000.00000000 USD</code></td>
</tr>
<tr>
<td>Stop Loss</td>
<td>8 decimals + USD or N/A</td>
<td><code>49000.00000000 USD</code></td>
</tr>
<tr>
<td>PNL (net)</td>
<td>+/- 2 decimals + % or N/A</td>
<td><code>+3.00%</code></td>
</tr>
<tr>
<td>Close Reason</td>
<td>Enum or N/A</td>
<td><code>TAKEPROFIT</code></td>
</tr>
<tr>
<td>Duration (min)</td>
<td>Integer or N/A</td>
<td><code>120</code></td>
</tr>
</tbody>
</table>
<a id="schedule-columns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schedule Columns<a href="#schedule-columns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The schedule table includes 11 columns focused on scheduled signal lifecycle:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Timestamp</td>
<td>ISO 8601</td>
<td><code>2024-01-15T10:30:00.000Z</code></td>
</tr>
<tr>
<td>Action</td>
<td>SCHEDULED/CANCELLED</td>
<td><code>CANCELLED</code></td>
</tr>
<tr>
<td>Symbol</td>
<td>Trading pair</td>
<td><code>BTCUSDT</code></td>
</tr>
<tr>
<td>Signal ID</td>
<td>UUID string</td>
<td><code>abc123-def456</code></td>
</tr>
<tr>
<td>Position</td>
<td>LONG/SHORT</td>
<td><code>LONG</code></td>
</tr>
<tr>
<td>Note</td>
<td>User string or N/A</td>
<td><code>Limit order</code></td>
</tr>
<tr>
<td>Current Price</td>
<td>8 decimals + USD</td>
<td><code>50500.00000000 USD</code></td>
</tr>
<tr>
<td>Entry Price</td>
<td>8 decimals + USD</td>
<td><code>50000.00000000 USD</code></td>
</tr>
<tr>
<td>Take Profit</td>
<td>8 decimals + USD</td>
<td><code>52000.00000000 USD</code></td>
</tr>
<tr>
<td>Stop Loss</td>
<td>8 decimals + USD</td>
<td><code>49000.00000000 USD</code></td>
</tr>
<tr>
<td>Wait Time (min)</td>
<td>Integer or N/A</td>
<td><code>45</code></td>
</tr>
</tbody>
</table>
<hr>
<a id="storage-management" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Storage Management<a href="#storage-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each markdown service uses memoized storage to maintain per-symbol-strategy isolation. This prevents data mixing between different trading pairs and strategies running in parallel.</p>
<a id="memoization-strategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoization Strategy<a href="#memoization-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Storage instances are memoized using the key pattern <code>&quot;symbol:strategyName&quot;</code>. The memoization ensures that repeated calls for the same symbol-strategy pair return the same storage instance, while different pairs get isolated storage.</p>
<pre><code class="typescript"><span class="hl-5">// Memoized storage retrieval pattern (all services)</span><br/><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-4">getStorage</span><span class="hl-1"> = </span><span class="hl-0">memoize</span><span class="hl-1">&lt;(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-13">ReportStorage</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">  ([</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyName</span><span class="hl-1">]) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">:</span><span class="hl-7">${</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">  () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">ReportStorage</span><span class="hl-1">()</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="clear-operation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Clear Operation<a href="#clear-operation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>clear()</code> method provides two modes of operation:</p>
<ol>
<li><strong>Targeted Clear</strong>: Clear specific symbol-strategy pair by providing context</li>
<li><strong>Global Clear</strong>: Clear all storage instances when no context provided</li>
</ol>
<pre><code class="typescript"><span class="hl-5">// Clear specific pair</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">service</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">({ </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// Clear all pairs</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">service</span><span class="hl-1">.</span><span class="hl-0">clear</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>The clear operation directly calls <code>memoize.clear()</code> which removes entries from the internal cache, allowing garbage collection of storage instances.</p>
<hr>
<a id="event-type-processing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Type Processing<a href="#event-type-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each service processes different subsets of the event action types emitted by <code>ClientStrategy</code>. The action filtering determines which events contribute to the report.</p>
<a id="backtest-event-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Event Types<a href="#backtest-event-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Backtest only processes <code>action === &quot;closed&quot;</code> events. All other actions (<code>idle</code>, <code>opened</code>, <code>active</code>) are ignored because backtest execution uses fast-forward simulation that skips timeframes once a signal opens.</p>
<pre><code class="typescript"><span class="hl-4">private</span><span class="hl-1"> </span><span class="hl-0">tick</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-13">IStrategyTickResult</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> !== </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1">;  </span><span class="hl-5">// Ignore non-closed events</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">storage</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">getStorage</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">storage</span><span class="hl-1">.</span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<a id="live-event-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live Event Types<a href="#live-event-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Live processes all four action types with specialized handling for each:</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>Handling Logic</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>idle</code></td>
<td>Replace last idle if no opened/active after it</td>
<td>Prevent unbounded idle event accumulation</td>
</tr>
<tr>
<td><code>opened</code></td>
<td>Push new event</td>
<td>Track signal opening</td>
</tr>
<tr>
<td><code>active</code></td>
<td>Find by signalId and replace</td>
<td>Update position monitoring state</td>
</tr>
<tr>
<td><code>closed</code></td>
<td>Find by signalId and replace</td>
<td>Record final PNL and close reason</td>
</tr>
</tbody>
</table>
<a id="schedule-event-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schedule Event Types<a href="#schedule-event-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Schedule processes two action types related to limit orders:</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>Handling Logic</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scheduled</code></td>
<td>Push new event</td>
<td>Track limit order creation</td>
</tr>
<tr>
<td><code>cancelled</code></td>
<td>Find by signalId and replace</td>
<td>Record cancellation with wait time</td>
</tr>
</tbody>
</table>
<p>The service subscribes to <code>signalEmitter</code> (universal emitter) instead of mode-specific emitters since scheduled signals can occur in both backtest and live modes.</p>
<hr>
<a id="initialization-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Initialization Pattern<a href="#initialization-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All markdown services use the <code>singleshot</code> pattern from <code>functools-kit</code> to ensure event subscription happens exactly once. The <code>init()</code> method is marked protected and called automatically on first data access.</p>
<p><img src="../media/70_Markdown_Report_Generation_5.svg" alt="Mermaid Diagram"></p>
<p>The protected visibility (<code>protected init</code>) allows subclass testing while preventing external calls. The automatic initialization ensures services are ready without explicit setup calls.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#markdown-report-generation"><span>Markdown <wbr/>Report <wbr/>Generation</span></a><ul><li><a href="#architecture-overview"><span>Architecture <wbr/>Overview</span></a></li><li><a href="#event-accumulation-system"><span>Event <wbr/>Accumulation <wbr/>System</span></a></li><li><ul><li><a href="#backtest-event-accumulation"><span>Backtest <wbr/>Event <wbr/>Accumulation</span></a></li><li><a href="#live-event-accumulation"><span>Live <wbr/>Event <wbr/>Accumulation</span></a></li><li><a href="#schedule-event-accumulation"><span>Schedule <wbr/>Event <wbr/>Accumulation</span></a></li></ul></li><li><a href="#report-generation-services"><span>Report <wbr/>Generation <wbr/>Services</span></a></li><li><ul><li><a href="#backtestmarkdownservice"><span>Backtest<wbr/>Markdown<wbr/>Service</span></a></li><li><a href="#livemarkdownservice"><span>Live<wbr/>Markdown<wbr/>Service</span></a></li><li><a href="#schedulemarkdownservice"><span>Schedule<wbr/>Markdown<wbr/>Service</span></a></li></ul></li><li><a href="#three-method-pattern"><span>Three-<wbr/>Method <wbr/>Pattern</span></a></li><li><ul><li><a href="#getdata---statistical-data-access"><span>get<wbr/>Data() -<wbr/> <wbr/>Statistical <wbr/>Data <wbr/>Access</span></a></li><li><a href="#getreport---markdown-generation"><span>get<wbr/>Report() -<wbr/> <wbr/>Markdown <wbr/>Generation</span></a></li><li><a href="#dump---file-persistence"><span>dump() -<wbr/> <wbr/>File <wbr/>Persistence</span></a></li></ul></li><li><a href="#markdown-table-generation"><span>Markdown <wbr/>Table <wbr/>Generation</span></a></li><li><ul><li><a href="#backtest-columns"><span>Backtest <wbr/>Columns</span></a></li><li><a href="#live-columns"><span>Live <wbr/>Columns</span></a></li><li><a href="#schedule-columns"><span>Schedule <wbr/>Columns</span></a></li></ul></li><li><a href="#storage-management"><span>Storage <wbr/>Management</span></a></li><li><ul><li><a href="#memoization-strategy"><span>Memoization <wbr/>Strategy</span></a></li><li><a href="#clear-operation"><span>Clear <wbr/>Operation</span></a></li></ul></li><li><a href="#event-type-processing"><span>Event <wbr/>Type <wbr/>Processing</span></a></li><li><ul><li><a href="#backtest-event-types"><span>Backtest <wbr/>Event <wbr/>Types</span></a></li><li><a href="#live-event-types"><span>Live <wbr/>Event <wbr/>Types</span></a></li><li><a href="#schedule-event-types"><span>Schedule <wbr/>Event <wbr/>Types</span></a></li></ul></li><li><a href="#initialization-pattern"><span>Initialization <wbr/>Pattern</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
