<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/32_risk-profiles-validation | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_32_risk-profiles-validation.html">design/32_risk-profiles-validation</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="risk-profiles--validation" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Risk Profiles &amp; Validation<a href="#risk-profiles--validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page covers the <strong>risk profile system</strong> in Backtest Kit: defining custom validation rules via <code>IRiskSchema</code>, combining multiple risk profiles with <code>MergeRisk</code>, and the lifecycle methods (<code>checkSignal</code>, <code>addSignal</code>, <code>removeSignal</code>) that track portfolio-wide risk state.</p>
<p><strong>Scope:</strong> This page focuses on user-defined risk profiles registered via <code>addRisk()</code>. For built-in signal validation (TP/SL logic, price checks, GLOBAL_CONFIG enforcement), see <a href="design_31_risk-management.html">Signal Validation Pipeline</a>. For position sizing calculations, see <a href="design_31_risk-management.html">Position Sizing</a>. For portfolio-wide tracking via <code>RiskGlobalService</code>, see <a href="design_31_risk-management.html">Portfolio-Wide Limits</a>.</p>
<hr>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Risk profiles enable <strong>portfolio-level risk management</strong> beyond per-signal validation. While the signal validation pipeline (<a href="design_31_risk-management.html">#7.2</a>) enforces basic constraints like TP/SL logic and price bounds, risk profiles add:</p>
<ul>
<li><strong>Concurrent position limits</strong> (e.g., max 3 open positions)</li>
<li><strong>Exposure limits</strong> (e.g., max 20% portfolio allocation)</li>
<li><strong>Time-based rules</strong> (e.g., no trading during news events)</li>
<li><strong>Correlation constraints</strong> (e.g., max 2 correlated positions)</li>
<li><strong>Custom business logic</strong> (any validation that accesses portfolio state)</li>
</ul>
<p>Risk profiles are <strong>registered once</strong> via <code>addRisk()</code> and then <strong>referenced</strong> by strategies using <code>riskName</code> or <code>riskList</code> fields in <code>IStrategySchema</code>.</p>
<hr>
<a id="core-interfaces" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Interfaces<a href="#core-interfaces" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="iriskschema" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IRiskSchema<a href="#iriskschema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The schema registered via <code>addRisk()</code>:</p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IRiskSchema</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">riskName</span><span class="hl-1">: </span><span class="hl-11">RiskName</span><span class="hl-1">;                           </span><span class="hl-5">// Unique identifier</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-11">string</span><span class="hl-1">;                                 </span><span class="hl-5">// Optional description</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks</span><span class="hl-1">?: </span><span class="hl-11">Partial</span><span class="hl-1">&lt;</span><span class="hl-11">IRiskCallbacks</span><span class="hl-1">&gt;;           </span><span class="hl-5">// onRejected, onAllowed</span><br/><span class="hl-1">  </span><span class="hl-4">validations</span><span class="hl-1">: (</span><span class="hl-11">IRiskValidation</span><span class="hl-1"> | </span><span class="hl-11">IRiskValidationFn</span><span class="hl-1">)[]; </span><span class="hl-5">// Validation rules</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Fields:</strong></p>
<ul>
<li><strong><code>riskName</code></strong>: Unique identifier for this risk profile</li>
<li><strong><code>validations</code></strong>: Array of validation rules (functions or objects with <code>validate</code> + <code>note</code>)</li>
<li><strong><code>callbacks</code></strong>: Optional lifecycle hooks for rejected/allowed signals</li>
<li><strong><code>note</code></strong>: Developer comment for documentation</li>
</ul>
<hr>
<a id="iriskvalidation-vs-iriskvalidationfn" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IRiskValidation vs IRiskValidationFn<a href="#iriskvalidation-vs-iriskvalidationfn" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Validations can be defined in <strong>two forms</strong>:</p>
<a id="1-function-form-iriskvalidationfn" class="tsd-anchor"></a><h4 class="tsd-anchor-link">1. Function Form (IRiskValidationFn)<a href="#1-function-form-iriskvalidationfn" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-7">type</span><span class="hl-1"> </span><span class="hl-11">IRiskValidationFn</span><span class="hl-1"> = (</span><span class="hl-4">payload</span><span class="hl-1">: </span><span class="hl-11">IRiskValidationPayload</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">void</span><span class="hl-1"> | </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">void</span><span class="hl-1">&gt;;</span>
</code><button type="button">Copy</button></pre>

<p>A function that <strong>throws an error</strong> to reject the signal:</p>
<pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;max-positions&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-6">3</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Max 3 positions exceeded&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="2-object-form-iriskvalidation" class="tsd-anchor"></a><h4 class="tsd-anchor-link">2. Object Form (IRiskValidation)<a href="#2-object-form-iriskvalidation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IRiskValidation</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">validate</span><span class="hl-1">: </span><span class="hl-11">IRiskValidationFn</span><span class="hl-1">;  </span><span class="hl-5">// Validation function</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-11">string</span><span class="hl-1">;                 </span><span class="hl-5">// Description (used in rejection message)</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Adds a <code>note</code> field for better error messages:</p>
<pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;max-positions&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-0">validate</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-6">3</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Exceeded limit&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&#39;Max 3 concurrent positions&#39;</span><span class="hl-1">  </span><span class="hl-5">// Included in RiskContract events</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="iriskvalidationpayload" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IRiskValidationPayload<a href="#iriskvalidationpayload" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The payload passed to <strong>all validation functions</strong>:</p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IRiskValidationPayload</span><span class="hl-1"> </span><span class="hl-7">extends</span><span class="hl-1"> </span><span class="hl-11">IRiskCheckArgs</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">pendingSignal</span><span class="hl-1">: </span><span class="hl-11">ISignalDto</span><span class="hl-1">;                </span><span class="hl-5">// Signal to validate</span><br/><span class="hl-1">  </span><span class="hl-4">activePositionCount</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;              </span><span class="hl-5">// Current open positions</span><br/><span class="hl-1">  </span><span class="hl-4">activePositions</span><span class="hl-1">: </span><span class="hl-11">IRiskActivePosition</span><span class="hl-1">[];   </span><span class="hl-5">// List of open positions</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IRiskCheckArgs</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">pendingSignal</span><span class="hl-1">: </span><span class="hl-11">ISignalDto</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">StrategyName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-11">ExchangeName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IRiskActivePosition</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">signal</span><span class="hl-1">: </span><span class="hl-11">ISignalRow</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">openTimestamp</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Available Data:</strong></p>
<ul>
<li><strong><code>pendingSignal</code></strong>: The signal being validated (TP, SL, position, etc.)</li>
<li><strong><code>currentPrice</code></strong>: Current VWAP price</li>
<li><strong><code>activePositionCount</code></strong>: Number of currently open positions (all strategies)</li>
<li><strong><code>activePositions</code></strong>: Full list of open positions with details</li>
<li><strong><code>symbol</code></strong>, <strong><code>strategyName</code></strong>, <strong><code>exchangeName</code></strong>: Context information</li>
<li><strong><code>timestamp</code></strong>: Current time (milliseconds)</li>
</ul>
<hr>
<a id="diagram-risk-validation-data-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Diagram: Risk Validation Data Flow<a href="#diagram-risk-validation-data-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/32_risk-profiles-validation_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="the-irisk-interface" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The IRisk Interface<a href="#the-irisk-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All risk implementations (both <code>ClientRisk</code> and <code>MergeRisk</code>) conform to <code>IRisk</code>:</p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IRisk</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">checkSignal</span><span class="hl-1">(</span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-11">IRiskCheckArgs</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">boolean</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">: { </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">; </span><span class="hl-4">riskName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1"> }): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">void</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">removeSignal</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">: { </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">; </span><span class="hl-4">riskName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1"> }): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">void</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="method-checksignal" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Method: checkSignal<a href="#method-checksignal" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Purpose:</strong> Determine if a new signal should be allowed based on current portfolio state.</p>
<p><strong>Behavior:</strong></p>
<ul>
<li>Runs <strong>all validations</strong> in sequence</li>
<li>If <strong>any validation throws</strong>, the signal is <strong>rejected</strong> (returns <code>false</code>)</li>
<li>If <strong>all validations pass</strong>, the signal is <strong>allowed</strong> (returns <code>true</code>)</li>
<li>Triggers <code>onRejected</code> or <code>onAllowed</code> callbacks</li>
</ul>
<p><strong>When Called:</strong> Before opening a new position (after signal validation pipeline passes)</p>
<hr>
<a id="method-addsignal" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Method: addSignal<a href="#method-addsignal" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Purpose:</strong> Register a newly opened position with the risk system.</p>
<p><strong>Behavior:</strong></p>
<ul>
<li>Called <strong>after</strong> signal opens successfully</li>
<li>Updates <code>activePositionCount</code> and <code>activePositions[]</code> in <code>RiskGlobalService</code></li>
<li>Enables future <code>checkSignal</code> calls to see this position</li>
</ul>
<p><strong>When Called:</strong> Immediately after opening a signal (when action = &quot;opened&quot;)</p>
<hr>
<a id="method-removesignal" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Method: removeSignal<a href="#method-removesignal" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Purpose:</strong> Unregister a closed position from the risk system.</p>
<p><strong>Behavior:</strong></p>
<ul>
<li>Called <strong>after</strong> signal closes (TP/SL/time_expired)</li>
<li>Decrements <code>activePositionCount</code> and removes from <code>activePositions[]</code></li>
<li>Frees up capacity for new positions</li>
</ul>
<p><strong>When Called:</strong> Immediately after closing a signal (when action = &quot;closed&quot;)</p>
<hr>
<a id="diagram-risk-lifecycle-state-machine" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Diagram: Risk Lifecycle State Machine<a href="#diagram-risk-lifecycle-state-machine" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/32_risk-profiles-validation_1.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="creating-custom-risk-profiles" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Creating Custom Risk Profiles<a href="#creating-custom-risk-profiles" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="basic-example-max-positions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Example: Max Positions<a href="#basic-example-max-positions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addRisk</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;backtest-kit&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;max-3-positions&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-6">3</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Max 3 positions exceeded&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="example-riskreward-ratio" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example: Risk/Reward Ratio<a href="#example-riskreward-ratio" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;min-rr-2to1&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">pendingSignal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> { </span><span class="hl-8">priceOpen</span><span class="hl-1"> = </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-8">priceTakeProfit</span><span class="hl-1">, </span><span class="hl-8">priceStopLoss</span><span class="hl-1">, </span><span class="hl-8">position</span><span class="hl-1"> } = </span><span class="hl-4">pendingSignal</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">reward</span><span class="hl-1"> = </span><span class="hl-4">position</span><span class="hl-1"> === </span><span class="hl-2">&#39;long&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">        ? </span><span class="hl-4">priceTakeProfit</span><span class="hl-1"> - </span><span class="hl-4">priceOpen</span><span class="hl-1"> </span><br/><span class="hl-1">        : </span><span class="hl-4">priceOpen</span><span class="hl-1"> - </span><span class="hl-4">priceTakeProfit</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">risk</span><span class="hl-1"> = </span><span class="hl-4">position</span><span class="hl-1"> === </span><span class="hl-2">&#39;long&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">        ? </span><span class="hl-4">priceOpen</span><span class="hl-1"> - </span><span class="hl-4">priceStopLoss</span><span class="hl-1"> </span><br/><span class="hl-1">        : </span><span class="hl-4">priceStopLoss</span><span class="hl-1"> - </span><span class="hl-4">priceOpen</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">reward</span><span class="hl-1"> / </span><span class="hl-4">risk</span><span class="hl-1"> &lt; </span><span class="hl-6">2</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`Poor R/R: </span><span class="hl-7">${</span><span class="hl-9">(</span><span class="hl-4">reward</span><span class="hl-1">/</span><span class="hl-4">risk</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">:1`</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="example-time-based-rules" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example: Time-Based Rules<a href="#example-time-based-rules" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;no-trading-weekends&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">timestamp</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">day</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-4">timestamp</span><span class="hl-1">).</span><span class="hl-0">getDay</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">day</span><span class="hl-1"> === </span><span class="hl-6">0</span><span class="hl-1"> || </span><span class="hl-4">day</span><span class="hl-1"> === </span><span class="hl-6">6</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;No trading on weekends&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="example-correlation-limits" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example: Correlation Limits<a href="#example-correlation-limits" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;max-correlated&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">activePositions</span><span class="hl-1">, </span><span class="hl-4">pendingSignal</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">sameDirection</span><span class="hl-1"> = </span><span class="hl-4">activePositions</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">pos</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><br/><span class="hl-1">        </span><span class="hl-4">pos</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">position</span><span class="hl-1"> === </span><span class="hl-4">pendingSignal</span><span class="hl-1">.</span><span class="hl-4">position</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">sameDirection</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt;= </span><span class="hl-6">2</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Max 2 positions in same direction&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="risk-callbacks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Risk Callbacks<a href="#risk-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>IRiskCallbacks</code> interface provides hooks for rejected and allowed signals:</p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IRiskCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onRejected</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-11">IRiskCheckArgs</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">void</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onAllowed</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-11">IRiskCheckArgs</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="example-logging-rejections" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example: Logging Rejections<a href="#example-logging-rejections" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;max-positions&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><br/><span class="hl-1">    ({ </span><span class="hl-4">activePositionCount</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">activePositionCount</span><span class="hl-1"> &gt;= </span><span class="hl-6">3</span><span class="hl-1">) </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Max 3 exceeded&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onRejected</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Signal rejected for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Active positions: </span><span class="hl-7">${</span><span class="hl-4">params</span><span class="hl-9">.</span><span class="hl-4">activePositionCount</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onAllowed</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal allowed for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Note:</strong> These are <strong>schema-level callbacks</strong> (defined in <code>IRiskSchema</code>). They differ from the <strong>service-level <code>onRejected</code> callback</strong> in <code>IRiskParams</code>, which is used internally to emit events to <code>riskSubject</code>.</p>
<hr>
<a id="combining-multiple-risks-mergerisk" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Combining Multiple Risks: MergeRisk<a href="#combining-multiple-risks-mergerisk" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="the-composite-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">The Composite Pattern<a href="#the-composite-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>MergeRisk</code> combines multiple <code>IRisk</code> instances into a single risk checker using the <strong>Composite pattern</strong>:</p>
<pre><code class="typescript"><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-11">MergeRisk</span><span class="hl-1"> </span><span class="hl-7">implements</span><span class="hl-1"> </span><span class="hl-11">IRisk</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">constructor</span><span class="hl-1">(</span><span class="hl-7">readonly</span><span class="hl-1"> </span><span class="hl-4">_riskList</span><span class="hl-1">: </span><span class="hl-11">IRisk</span><span class="hl-1">[]) {}</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">checkSignal</span><span class="hl-1">(</span><span class="hl-4">params</span><span class="hl-1">: </span><span class="hl-11">IRiskCheckArgs</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-11">boolean</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">riskCheck</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_riskList</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">risk</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">risk</span><span class="hl-1">.</span><span class="hl-0">checkSignal</span><span class="hl-1">(</span><span class="hl-4">params</span><span class="hl-1">))</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">riskCheck</span><span class="hl-1">.</span><span class="hl-0">every</span><span class="hl-1">((</span><span class="hl-4">isSafe</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">isSafe</span><span class="hl-1">);  </span><span class="hl-5">// Logical AND</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">: { </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">; </span><span class="hl-4">riskName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1"> }) {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_riskList</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">risk</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">risk</span><span class="hl-1">.</span><span class="hl-0">addSignal</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">))</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">removeSignal</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">: { </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">; </span><span class="hl-4">riskName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1"> }) {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">_riskList</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">risk</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">risk</span><span class="hl-1">.</span><span class="hl-0">removeSignal</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">))</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Behavior:</strong></p>
<ul>
<li><strong><code>checkSignal</code></strong>: Signal is allowed <strong>only if ALL</strong> child risks approve (logical AND)</li>
<li><strong><code>addSignal</code></strong>: Propagates to <strong>all</strong> child risks in parallel</li>
<li><strong><code>removeSignal</code></strong>: Propagates to <strong>all</strong> child risks in parallel</li>
</ul>
<hr>
<a id="using-risklist-in-strategies" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using riskList in Strategies<a href="#using-risklist-in-strategies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Strategies can reference <strong>multiple risk profiles</strong> using <code>riskList</code>:</p>
<pre><code class="typescript"><span class="hl-5">// Define multiple risk profiles</span><br/><span class="hl-0">addRisk</span><span class="hl-1">({ </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;max-positions&#39;</span><span class="hl-1">, </span><span class="hl-4">validations:</span><span class="hl-1"> [...] });</span><br/><span class="hl-0">addRisk</span><span class="hl-1">({ </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;min-rr-ratio&#39;</span><span class="hl-1">, </span><span class="hl-4">validations:</span><span class="hl-1"> [...] });</span><br/><span class="hl-0">addRisk</span><span class="hl-1">({ </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;time-limits&#39;</span><span class="hl-1">, </span><span class="hl-4">validations:</span><span class="hl-1"> [...] });</span><br/><br/><span class="hl-5">// Combine them in a strategy</span><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-strategy&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskList:</span><span class="hl-1"> [</span><span class="hl-2">&#39;max-positions&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;min-rr-ratio&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;time-limits&#39;</span><span class="hl-1">],  </span><span class="hl-5">// Logical AND</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> { </span><span class="hl-5">/* ... */</span><span class="hl-1"> }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Internally</strong>, the framework creates a <code>MergeRisk</code> instance when <code>riskList</code> is used:</p>
<pre><code class="typescript"><span class="hl-5">// Pseudo-code representation</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">risks</span><span class="hl-1"> = </span><span class="hl-4">riskList</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">riskName</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-0">getRiskInstance</span><span class="hl-1">(</span><span class="hl-4">riskName</span><span class="hl-1">));</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">mergedRisk</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">MergeRisk</span><span class="hl-1">(</span><span class="hl-4">risks</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">canTrade</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">mergedRisk</span><span class="hl-1">.</span><span class="hl-0">checkSignal</span><span class="hl-1">(</span><span class="hl-4">params</span><span class="hl-1">);  </span><span class="hl-5">// All must pass</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="diagram-mergerisk-composite-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Diagram: MergeRisk Composite Pattern<a href="#diagram-mergerisk-composite-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/32_risk-profiles-validation_2.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="risk-event-emission" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Risk Event Emission<a href="#risk-event-emission" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="risksubject-emitter" class="tsd-anchor"></a><h3 class="tsd-anchor-link">riskSubject Emitter<a href="#risksubject-emitter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When a signal is <strong>rejected</strong> by risk validation, the framework emits a <code>RiskContract</code> event:</p>
<pre><code class="typescript"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">riskSubject</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Subject</span><span class="hl-1">&lt;</span><span class="hl-11">RiskContract</span><span class="hl-1">&gt;();</span>
</code><button type="button">Copy</button></pre>

<p><strong>Event Payload (RiskContract):</strong></p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">RiskContract</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">activePositionCount</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">comment</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;        </span><span class="hl-5">// Rejection reason (from validation.note or &quot;N/A&quot;)</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;      </span><span class="hl-5">// Event time (milliseconds)</span><br/><span class="hl-1">  </span><span class="hl-4">backtest</span><span class="hl-1">: </span><span class="hl-11">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Listening for Risk Events:</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenRisk</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;backtest-kit&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">listenRisk</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Signal rejected for </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Reason: </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">comment</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Active positions: </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">activePositionCount</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="when-are-risk-events-emitted" class="tsd-anchor"></a><h3 class="tsd-anchor-link">When Are Risk Events Emitted?<a href="#when-are-risk-events-emitted" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Risk events are emitted <strong>only when signals are rejected</strong>, not when allowed. This prevents spam:</p>
<pre><code class="typescript"><span class="hl-5">// Inside ClientRisk.checkSignal()</span><br/><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Run all validations</span><br/><span class="hl-1">  </span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">validation</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">validations</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">validation</span><span class="hl-1">.</span><span class="hl-0">validate</span><span class="hl-1">(</span><span class="hl-4">payload</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-5">// All passed - call onAllowed but DO NOT emit event</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">callbacks</span><span class="hl-1">?.</span><span class="hl-0">onAllowed</span><span class="hl-1">?.(</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">// Validation threw - call onRejected AND emit riskSubject event</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">callbacks</span><span class="hl-1">?.</span><span class="hl-0">onRejected</span><span class="hl-1">?.(</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">onRejected</span><span class="hl-1">(</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">, </span><span class="hl-4">activePositionCount</span><span class="hl-1">, </span><span class="hl-4">comment</span><span class="hl-1">, </span><span class="hl-4">timestamp</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">false</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="integration-with-strategies" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Strategies<a href="#integration-with-strategies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="using-riskname-single-risk" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using riskName (Single Risk)<a href="#using-riskname-single-risk" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-risk&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><span class="hl-5">/* ... */</span><span class="hl-1">]</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-strategy&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-risk&#39;</span><span class="hl-1">,  </span><span class="hl-5">// Reference single risk profile</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> { </span><span class="hl-5">/* ... */</span><span class="hl-1"> }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="using-risklist-multiple-risks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using riskList (Multiple Risks)<a href="#using-risklist-multiple-risks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addRisk</span><span class="hl-1">({ </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;risk-a&#39;</span><span class="hl-1">, </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><span class="hl-5">/* ... */</span><span class="hl-1">] });</span><br/><span class="hl-0">addRisk</span><span class="hl-1">({ </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;risk-b&#39;</span><span class="hl-1">, </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><span class="hl-5">/* ... */</span><span class="hl-1">] });</span><br/><span class="hl-0">addRisk</span><span class="hl-1">({ </span><span class="hl-4">riskName:</span><span class="hl-1"> </span><span class="hl-2">&#39;risk-c&#39;</span><span class="hl-1">, </span><span class="hl-4">validations:</span><span class="hl-1"> [</span><span class="hl-5">/* ... */</span><span class="hl-1">] });</span><br/><br/><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-strategy&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">riskList:</span><span class="hl-1"> [</span><span class="hl-2">&#39;risk-a&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;risk-b&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;risk-c&#39;</span><span class="hl-1">],  </span><span class="hl-5">// ALL must pass</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> { </span><span class="hl-5">/* ... */</span><span class="hl-1"> }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Note:</strong> You <strong>cannot use both</strong> <code>riskName</code> and <code>riskList</code> in the same strategy. Use <code>riskList</code> for multiple risks.</p>
<hr>
<a id="diagram-code-entity-map" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Diagram: Code Entity Map<a href="#diagram-code-entity-map" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/32_risk-profiles-validation_3.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="key-implementation-details" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Key Implementation Details<a href="#key-implementation-details" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="validation-execution-order" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Execution Order<a href="#validation-execution-order" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Validations are executed <strong>sequentially</strong> (not in parallel):</p>
<pre><code class="typescript"><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">validation</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-4">validations</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">validateFn</span><span class="hl-1"> = </span><span class="hl-7">typeof</span><span class="hl-1"> </span><span class="hl-4">validation</span><span class="hl-1"> === </span><span class="hl-2">&#39;function&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">    ? </span><span class="hl-4">validation</span><span class="hl-1"> </span><br/><span class="hl-1">    : </span><span class="hl-4">validation</span><span class="hl-1">.</span><span class="hl-4">validate</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">validateFn</span><span class="hl-1">(</span><span class="hl-4">payload</span><span class="hl-1">);  </span><span class="hl-5">// Await each validation</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>This ensures <strong>deterministic behavior</strong> and allows early exit on first failure.</p>
<hr>
<a id="error-handling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Handling<a href="#error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Risk validations use <strong>exception-based control flow</strong>:</p>
<ul>
<li><strong>Throw error</strong>  Signal rejected (<code>checkSignal</code> returns <code>false</code>)</li>
<li><strong>Return normally</strong>  Validation passed (continue to next validation)</li>
<li><strong>Async functions</strong>  Fully supported (validations can be async)</li>
</ul>
<hr>
<a id="performance-considerations" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Performance Considerations<a href="#performance-considerations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Memoization</strong>: <code>RiskConnectionService</code> caches <code>ClientRisk</code> and <code>MergeRisk</code> instances by key</li>
<li><strong>Parallel execution</strong>: <code>MergeRisk</code> runs child risk checks in parallel via <code>Promise.all()</code></li>
<li><strong>Early exit</strong>: Sequential validation stops at first failure</li>
</ul>
<hr>
<a id="comparison-table-risk-features" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Comparison Table: Risk Features<a href="#comparison-table-risk-features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Feature</th>
<th>riskName (Single)</th>
<th>riskList (Multiple)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Implementation</strong></td>
<td><code>ClientRisk</code></td>
<td><code>MergeRisk</code> wrapping multiple <code>ClientRisk</code></td>
</tr>
<tr>
<td><strong>Logic</strong></td>
<td>Run validations sequentially</td>
<td>Run all child risks in parallel, then AND results</td>
</tr>
<tr>
<td><strong>Behavior</strong></td>
<td>Reject if any validation throws</td>
<td>Reject if any child risk rejects</td>
</tr>
<tr>
<td><strong>Use Case</strong></td>
<td>Simple risk profile</td>
<td>Complex multi-dimensional risk</td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>Direct execution</td>
<td>Small overhead from composite pattern</td>
</tr>
<tr>
<td><strong>Callbacks</strong></td>
<td>Per-risk callbacks fire</td>
<td>Each child risk's callbacks fire independently</td>
</tr>
</tbody>
</table>
<hr>
<a id="summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Summary<a href="#summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>Risk profiles</strong> enable portfolio-level validation beyond per-signal checks</li>
<li><strong><code>IRiskSchema</code></strong> defines validations via <code>addRisk()</code>, referenced by strategies via <code>riskName</code> or <code>riskList</code></li>
<li><strong>Validations</strong> receive <code>IRiskValidationPayload</code> with portfolio state (<code>activePositions</code>, <code>activePositionCount</code>)</li>
<li><strong>Exception-based</strong>: Throw error to reject, return normally to pass</li>
<li><strong><code>MergeRisk</code></strong> combines multiple risks with logical AND (all must pass)</li>
<li><strong>Lifecycle</strong>: <code>checkSignal()</code>  <code>addSignal()</code>  <code>removeSignal()</code></li>
<li><strong>Events</strong>: Rejected signals emit to <code>riskSubject</code> (listen via <code>listenRisk()</code>)</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#risk-profiles--validation"><span>Risk <wbr/>Profiles &amp; <wbr/>Validation</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#core-interfaces"><span>Core <wbr/>Interfaces</span></a></li><li><ul><li><a href="#iriskschema"><span>IRisk<wbr/>Schema</span></a></li><li><a href="#iriskvalidation-vs-iriskvalidationfn"><span>IRisk<wbr/>Validation vs IRisk<wbr/>Validation<wbr/>Fn</span></a></li><li><ul><li><a href="#1-function-form-iriskvalidationfn"><span>1. <wbr/>Function <wbr/>Form (IRisk<wbr/>Validation<wbr/>Fn)</span></a></li><li><a href="#2-object-form-iriskvalidation"><span>2. <wbr/>Object <wbr/>Form (IRisk<wbr/>Validation)</span></a></li></ul></li><li><a href="#iriskvalidationpayload"><span>IRisk<wbr/>Validation<wbr/>Payload</span></a></li></ul></li><li><a href="#diagram-risk-validation-data-flow"><span>Diagram: <wbr/>Risk <wbr/>Validation <wbr/>Data <wbr/>Flow</span></a></li><li><a href="#the-irisk-interface"><span>The IRisk <wbr/>Interface</span></a></li><li><ul><li><a href="#method-checksignal"><span>Method: check<wbr/>Signal</span></a></li><li><a href="#method-addsignal"><span>Method: add<wbr/>Signal</span></a></li><li><a href="#method-removesignal"><span>Method: remove<wbr/>Signal</span></a></li></ul></li><li><a href="#diagram-risk-lifecycle-state-machine"><span>Diagram: <wbr/>Risk <wbr/>Lifecycle <wbr/>State <wbr/>Machine</span></a></li><li><a href="#creating-custom-risk-profiles"><span>Creating <wbr/>Custom <wbr/>Risk <wbr/>Profiles</span></a></li><li><ul><li><a href="#basic-example-max-positions"><span>Basic <wbr/>Example: <wbr/>Max <wbr/>Positions</span></a></li><li><a href="#example-riskreward-ratio"><span>Example: <wbr/>Risk/<wbr/>Reward <wbr/>Ratio</span></a></li><li><a href="#example-time-based-rules"><span>Example: <wbr/>Time-<wbr/>Based <wbr/>Rules</span></a></li><li><a href="#example-correlation-limits"><span>Example: <wbr/>Correlation <wbr/>Limits</span></a></li></ul></li><li><a href="#risk-callbacks"><span>Risk <wbr/>Callbacks</span></a></li><li><ul><li><a href="#example-logging-rejections"><span>Example: <wbr/>Logging <wbr/>Rejections</span></a></li></ul></li><li><a href="#combining-multiple-risks-mergerisk"><span>Combining <wbr/>Multiple <wbr/>Risks: <wbr/>Merge<wbr/>Risk</span></a></li><li><ul><li><a href="#the-composite-pattern"><span>The <wbr/>Composite <wbr/>Pattern</span></a></li><li><a href="#using-risklist-in-strategies"><span>Using risk<wbr/>List in <wbr/>Strategies</span></a></li></ul></li><li><a href="#diagram-mergerisk-composite-pattern"><span>Diagram: <wbr/>Merge<wbr/>Risk <wbr/>Composite <wbr/>Pattern</span></a></li><li><a href="#risk-event-emission"><span>Risk <wbr/>Event <wbr/>Emission</span></a></li><li><ul><li><a href="#risksubject-emitter"><span>risk<wbr/>Subject <wbr/>Emitter</span></a></li><li><a href="#when-are-risk-events-emitted"><span>When <wbr/>Are <wbr/>Risk <wbr/>Events <wbr/>Emitted?</span></a></li></ul></li><li><a href="#integration-with-strategies"><span>Integration with <wbr/>Strategies</span></a></li><li><ul><li><a href="#using-riskname-single-risk"><span>Using risk<wbr/>Name (<wbr/>Single <wbr/>Risk)</span></a></li><li><a href="#using-risklist-multiple-risks"><span>Using risk<wbr/>List (<wbr/>Multiple <wbr/>Risks)</span></a></li></ul></li><li><a href="#diagram-code-entity-map"><span>Diagram: <wbr/>Code <wbr/>Entity <wbr/>Map</span></a></li><li><a href="#key-implementation-details"><span>Key <wbr/>Implementation <wbr/>Details</span></a></li><li><ul><li><a href="#validation-execution-order"><span>Validation <wbr/>Execution <wbr/>Order</span></a></li><li><a href="#error-handling"><span>Error <wbr/>Handling</span></a></li><li><a href="#performance-considerations"><span>Performance <wbr/>Considerations</span></a></li></ul></li><li><a href="#comparison-table-risk-features"><span>Comparison <wbr/>Table: <wbr/>Risk <wbr/>Features</span></a></li><li><a href="#summary"><span>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
