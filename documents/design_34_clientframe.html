<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/34_clientframe | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_34_clientframe.html">design/34_clientframe</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="clientframe" class="tsd-anchor"></a><h1 class="tsd-anchor-link">ClientFrame<a href="#clientframe" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This document describes <code>ClientFrame</code>, the timeframe generator component responsible for creating arrays of <code>Date</code> objects for backtest execution. ClientFrame converts a date range (<code>startDate</code>, <code>endDate</code>) and a time interval (e.g., <code>&quot;1m&quot;</code>, <code>&quot;1h&quot;</code>) into a chronologically ordered sequence of timestamps that the backtest engine uses to simulate historical trading.</p>
<p>For configuration schemas and registration patterns, see <a href="design_26_frame_schemas.html">Frame Schemas</a>. For how the generated timeframes are consumed during backtest execution, see <a href="design_52_backtesting.html">Backtesting</a>.</p>
<hr>
<a id="component-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Component Overview<a href="#component-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ClientFrame implements the <code>IFrame</code> interface and provides a single primary method: <code>getTimeframe()</code>. This method performs date arithmetic to generate a complete array of tick timestamps spanning the configured period at the specified interval granularity.</p>
<p>The component is instantiated by <code>FrameConnectionService</code> with memoization, ensuring that each unique <code>frameName</code> receives a single reusable instance. The <code>FrameGlobalService</code> orchestrates context injection and provides the bridge between the backtest orchestration layer and the frame instances.</p>
<p><strong>Key Responsibilities:</strong></p>
<ul>
<li>Parse <code>startDate</code> and <code>endDate</code> boundaries</li>
<li>Calculate millisecond offsets for each <code>FrameInterval</code> type</li>
<li>Generate chronologically ordered <code>Date</code> array</li>
<li>Invoke <code>onTimeframe</code> callback with generated timestamps</li>
<li>Validate configuration parameters (interval, date range)</li>
</ul>
<hr>
<a id="frame-configuration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Frame Configuration<a href="#frame-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="iframeschema" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IFrameSchema<a href="#iframeschema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The frame schema defines the complete configuration for timeframe generation:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>frameName</code></td>
<td><code>FrameName</code></td>
<td>Yes</td>
<td>Unique identifier for this frame configuration</td>
</tr>
<tr>
<td><code>interval</code></td>
<td><code>FrameInterval</code></td>
<td>Yes</td>
<td>Time interval between consecutive timestamps</td>
</tr>
<tr>
<td><code>startDate</code></td>
<td><code>Date</code></td>
<td>Yes</td>
<td>Start of backtest period (inclusive)</td>
</tr>
<tr>
<td><code>endDate</code></td>
<td><code>Date</code></td>
<td>Yes</td>
<td>End of backtest period (inclusive)</td>
</tr>
<tr>
<td><code>note</code></td>
<td><code>string</code></td>
<td>No</td>
<td>Optional documentation string</td>
</tr>
<tr>
<td><code>callbacks</code></td>
<td><code>Partial&lt;IFrameCallbacks&gt;</code></td>
<td>No</td>
<td>Optional lifecycle event handlers</td>
</tr>
</tbody>
</table>
<a id="frameinterval-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">FrameInterval Types<a href="#frameinterval-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>ClientFrame supports the following interval granularities:</p>
<pre><code><span class="hl-12">Minutes</span><span class="hl-1">: </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;3m&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;30m&quot;</span><br/><span class="hl-12">Hours</span><span class="hl-1">:   </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;2h&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;4h&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;6h&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;8h&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;12h&quot;</span><br/><span class="hl-12">Days</span><span class="hl-1">:    </span><span class="hl-2">&quot;1d&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;3d&quot;</span>
</code><button>Copy</button></pre>

<p>Each interval string is internally converted to milliseconds for date arithmetic. For example:</p>
<ul>
<li><code>&quot;1m&quot;</code> → 60,000 ms</li>
<li><code>&quot;1h&quot;</code> → 3,600,000 ms</li>
<li><code>&quot;1d&quot;</code> → 86,400,000 ms</li>
</ul>
<a id="iframeparams" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IFrameParams<a href="#iframeparams" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The runtime parameters passed to ClientFrame constructor extend the schema with dependency injection:</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IFrameParams</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-10">IFrameSchema</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">logger</span><span class="hl-1">: </span><span class="hl-10">ILogger</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The <code>logger</code> instance is provided by the dependency injection container and used for debugging timeframe generation operations.</p>
<hr>
<a id="timeframe-generation-process" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Timeframe Generation Process<a href="#timeframe-generation-process" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="gettimeframe-method" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getTimeframe Method<a href="#gettimeframe-method" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/34_ClientFrame_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Algorithm Steps:</strong></p>
<ol>
<li><strong>Interval Conversion:</strong> Convert <code>FrameInterval</code> string to milliseconds using a lookup table</li>
<li><strong>Boundary Extraction:</strong> Extract Unix timestamps from <code>startDate</code> and <code>endDate</code></li>
<li><strong>Iteration:</strong> Starting from <code>startDate</code>, increment by <code>intervalMs</code> until exceeding <code>endDate</code></li>
<li><strong>Date Construction:</strong> Create new <code>Date</code> object for each timestamp and append to result array</li>
<li><strong>Callback Invocation:</strong> If <code>callbacks.onTimeframe</code> is defined, invoke it with the complete array</li>
<li><strong>Return:</strong> Return the chronologically ordered <code>Date[]</code> array</li>
</ol>
<p><strong>Edge Cases Handled:</strong></p>
<ul>
<li>Empty range (startDate ≥ endDate): Returns empty array</li>
<li>Non-standard intervals: Logs warning and uses default interval</li>
<li>Invalid dates: Throws validation error during schema registration</li>
</ul>
<hr>
<a id="integration-with-backtest-engine" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Backtest Engine<a href="#integration-with-backtest-engine" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="backtest-orchestration-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Backtest Orchestration Flow<a href="#backtest-orchestration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/34_ClientFrame_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Integration Points:</strong></p>
<ol>
<li><strong>FrameGlobalService:</strong> Wraps ClientFrame with ExecutionContext injection (symbol, when, backtest=true)</li>
<li><strong>Memoization:</strong> FrameConnectionService caches ClientFrame instances by <code>frameName</code> to avoid redundant instantiation</li>
<li><strong>Sequential Iteration:</strong> BacktestLogicPrivateService iterates through the timeframe array, setting <code>ExecutionContext.when</code> for each timestamp</li>
<li><strong>Skip-Ahead Optimization:</strong> When a signal opens, the backtest engine skips intermediate timeframes until signal closure, then resumes iteration</li>
</ol>
<hr>
<a id="callbacks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Callbacks<a href="#callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="ontimeframe-callback" class="tsd-anchor"></a><h3 class="tsd-anchor-link">onTimeframe Callback<a href="#ontimeframe-callback" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>IFrameCallbacks</code> interface defines a single optional callback invoked after timeframe generation:</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IFrameCallbacks</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">onTimeframe</span><span class="hl-1">: (</span><br/><span class="hl-1">    </span><span class="hl-4">timeframe</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">[],</span><br/><span class="hl-1">    </span><span class="hl-4">startDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">endDate</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">interval</span><span class="hl-1">: </span><span class="hl-10">FrameInterval</span><br/><span class="hl-1">  ) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">void</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Use Cases:</strong></p>
<ul>
<li>Logging the number of generated timestamps for debugging</li>
<li>Validating that the generated timeframe matches expectations</li>
<li>Storing timeframe metadata for reporting purposes</li>
<li>Monitoring timeframe generation performance</li>
</ul>
<p><strong>Invocation Timing:</strong></p>
<ul>
<li>Called synchronously after the <code>Date[]</code> array is fully constructed</li>
<li>Invoked before <code>getTimeframe()</code> returns to the caller</li>
<li>Not called if timeframe generation fails with an error</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="typescript"><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;2024-jan-1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-02T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onTimeframe</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">timeframe</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-6">${</span><span class="hl-4">timeframe</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> timestamps`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`First: </span><span class="hl-6">${</span><span class="hl-4">timeframe</span><span class="hl-9">[</span><span class="hl-8">0</span><span class="hl-9">].</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Last: </span><span class="hl-6">${</span><span class="hl-4">timeframe</span><span class="hl-9">[</span><span class="hl-4">timeframe</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-9"> </span><span class="hl-1">-</span><span class="hl-9"> </span><span class="hl-8">1</span><span class="hl-9">].</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="service-architecture-context" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Architecture Context<a href="#service-architecture-context" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="frame-service-hierarchy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Frame Service Hierarchy<a href="#frame-service-hierarchy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/34_ClientFrame_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Layer Descriptions:</strong></p>
<ul>
<li><strong>FrameSchemaService:</strong> Maintains the registry mapping <code>frameName → IFrameSchema</code></li>
<li><strong>FrameValidationService:</strong> Validates schema fields (dates, interval, frameName uniqueness)</li>
<li><strong>FrameConnectionService:</strong> Creates and memoizes ClientFrame instances, keyed by <code>frameName</code></li>
<li><strong>FrameGlobalService:</strong> Provides ExecutionContext-aware access to frame instances</li>
<li><strong>ClientFrame:</strong> Implements the actual timeframe generation algorithm</li>
<li><strong>BacktestLogicPrivateService:</strong> Consumes generated timeframes for backtest orchestration</li>
</ul>
<hr>
<a id="configuration-examples" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Configuration Examples<a href="#configuration-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="minute-level-backtest" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Minute-Level Backtest<a href="#minute-level-backtest" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;btc-day-1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T23:59:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Full day of 1-minute candles for BTC&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onTimeframe</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">timeframe</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Expected: 1440 timestamps (24h * 60m)</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-6">${</span><span class="hl-4">timeframe</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> 1m timestamps`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Expected Output:</strong> 1440 timestamps (24 hours × 60 minutes)</p>
<a id="multi-week-hourly-backtest" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Multi-Week Hourly Backtest<a href="#multi-week-hourly-backtest" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;btc-month-1h&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-31T23:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;January 2024 hourly timeframes&quot;</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Expected Output:</strong> 744 timestamps (31 days × 24 hours)</p>
<a id="daily-aggregation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Daily Aggregation<a href="#daily-aggregation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">addFrame</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;btc-year-1d&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2023-01-01T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2023-12-31T00:00:00Z&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Full year of daily candles&quot;</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Expected Output:</strong> 365 timestamps (1 per day)</p>
<hr>
<a id="relationship-to-other-components" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Relationship to Other Components<a href="#relationship-to-other-components" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="clientstrategy-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ClientStrategy Integration<a href="#clientstrategy-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>ClientFrame does <strong>not</strong> directly interact with ClientStrategy. The integration is mediated by BacktestLogicPrivateService:</p>
<ol>
<li>BacktestLogicPrivateService retrieves timeframe from ClientFrame via FrameGlobalService</li>
<li>BacktestLogicPrivateService iterates through timeframe timestamps</li>
<li>For each timestamp, BacktestLogicPrivateService sets <code>ExecutionContext.when</code></li>
<li>BacktestLogicPrivateService calls <code>ClientStrategy.tick()</code> with the current timestamp</li>
</ol>
<p>This separation ensures that ClientFrame remains a pure timeframe generator without strategy execution concerns.</p>
<a id="clientexchange-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ClientExchange Integration<a href="#clientexchange-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>ClientFrame generates the timestamps that ClientExchange uses to fetch historical candles:</p>
<ul>
<li>When <code>ClientStrategy.tick()</code> is called at timestamp <code>T</code>, <code>ClientExchange.getCandles()</code> fetches candles <strong>backward</strong> from <code>T</code></li>
<li>When a signal opens, <code>ClientExchange.getNextCandles()</code> fetches candles <strong>forward</strong> from <code>T</code> for backtesting</li>
<li>The interval used by ClientExchange (<code>CandleInterval</code>) is independent of the frame interval (<code>FrameInterval</code>)</li>
</ul>
<p>For example:</p>
<ul>
<li>Frame interval: <code>&quot;1h&quot;</code> (tick every hour)</li>
<li>Candle interval: <code>&quot;1m&quot;</code> (fetch 1-minute candles for VWAP calculation)</li>
</ul>
<hr>
<a id="type-definitions" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Type Definitions<a href="#type-definitions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="framename" class="tsd-anchor"></a><h3 class="tsd-anchor-link">FrameName<a href="#framename" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-10">FrameName</span><span class="hl-1"> = </span><span class="hl-10">string</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>Unique identifier for a registered frame schema. Used as the key in FrameSchemaService registry and for memoization in FrameConnectionService.</p>
<a id="iframe-interface" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IFrame Interface<a href="#iframe-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">IFrame</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">getTimeframe</span><span class="hl-1">: (</span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-4">frameName</span><span class="hl-1">: </span><span class="hl-10">FrameName</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">Date</span><span class="hl-1">[]&gt;;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The core interface implemented by ClientFrame. The <code>symbol</code> parameter is included for API consistency but typically unused in timeframe generation (timeframes are symbol-agnostic).</p>
<hr>
<a id="summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Summary<a href="#summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ClientFrame is a focused utility component that converts date ranges and time intervals into ordered arrays of timestamps for backtest execution. Its design emphasizes:</p>
<ul>
<li><strong>Simplicity:</strong> Single-purpose component with minimal dependencies</li>
<li><strong>Reusability:</strong> Memoized instances shared across backtest runs</li>
<li><strong>Composability:</strong> Clean integration with FrameGlobalService and BacktestLogicPrivateService</li>
<li><strong>Testability:</strong> Pure function behavior (same inputs → same outputs)</li>
</ul>
<p>The generated timeframes form the temporal backbone of the backtest engine, enabling precise historical simulation at configurable granularities from 1-minute to 3-day intervals.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#clientframe"><span>Client<wbr/>Frame</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#component-overview"><span>Component <wbr/>Overview</span></a></li><li><a href="#frame-configuration"><span>Frame <wbr/>Configuration</span></a></li><li><ul><li><a href="#iframeschema"><span>IFrame<wbr/>Schema</span></a></li><li><a href="#frameinterval-types"><span>Frame<wbr/>Interval <wbr/>Types</span></a></li><li><a href="#iframeparams"><span>IFrame<wbr/>Params</span></a></li></ul></li><li><a href="#timeframe-generation-process"><span>Timeframe <wbr/>Generation <wbr/>Process</span></a></li><li><ul><li><a href="#gettimeframe-method"><span>get<wbr/>Timeframe <wbr/>Method</span></a></li></ul></li><li><a href="#integration-with-backtest-engine"><span>Integration with <wbr/>Backtest <wbr/>Engine</span></a></li><li><ul><li><a href="#backtest-orchestration-flow"><span>Backtest <wbr/>Orchestration <wbr/>Flow</span></a></li></ul></li><li><a href="#callbacks"><span>Callbacks</span></a></li><li><ul><li><a href="#ontimeframe-callback"><span>on<wbr/>Timeframe <wbr/>Callback</span></a></li></ul></li><li><a href="#service-architecture-context"><span>Service <wbr/>Architecture <wbr/>Context</span></a></li><li><ul><li><a href="#frame-service-hierarchy"><span>Frame <wbr/>Service <wbr/>Hierarchy</span></a></li></ul></li><li><a href="#configuration-examples"><span>Configuration <wbr/>Examples</span></a></li><li><ul><li><a href="#minute-level-backtest"><span>Minute-<wbr/>Level <wbr/>Backtest</span></a></li><li><a href="#multi-week-hourly-backtest"><span>Multi-<wbr/>Week <wbr/>Hourly <wbr/>Backtest</span></a></li><li><a href="#daily-aggregation"><span>Daily <wbr/>Aggregation</span></a></li></ul></li><li><a href="#relationship-to-other-components"><span>Relationship to <wbr/>Other <wbr/>Components</span></a></li><li><ul><li><a href="#clientstrategy-integration"><span>Client<wbr/>Strategy <wbr/>Integration</span></a></li><li><a href="#clientexchange-integration"><span>Client<wbr/>Exchange <wbr/>Integration</span></a></li></ul></li><li><a href="#type-definitions"><span>Type <wbr/>Definitions</span></a></li><li><ul><li><a href="#framename"><span>Frame<wbr/>Name</span></a></li><li><a href="#iframe-interface"><span>IFrame <wbr/>Interface</span></a></li></ul></li><li><a href="#summary"><span>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
