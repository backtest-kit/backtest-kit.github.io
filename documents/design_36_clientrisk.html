<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/36_clientrisk | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_36_clientrisk.html">design/36_clientrisk</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="clientrisk" class="tsd-anchor"></a><h1 class="tsd-anchor-link">ClientRisk<a href="#clientrisk" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>ClientRisk</code> is the core implementation of the <code>IRisk</code> interface responsible for <strong>signal validation</strong> and <strong>position tracking</strong> within the <code>backtest-kit</code> framework. This class executes user-defined validation rules, enforces risk management policies, and maintains active position counts across trading strategies.</p>
<p>This document covers the internal implementation of <code>ClientRisk</code> and how it integrates with the signal lifecycle. For information about:</p>
<ul>
<li>Defining risk schemas via <code>addRisk()</code>, see <a href="design_28_risk_schemas.html">Risk Schemas</a></li>
<li>The broader risk management system, see <a href="design_67_risk_management.html">Risk Management</a></li>
<li>Position tracking mechanisms, see <a href="design_70_position_tracking.html">Position Tracking</a></li>
</ul>
<hr>
<a id="irisk-interface-contract" class="tsd-anchor"></a><h2 class="tsd-anchor-link">IRisk Interface Contract<a href="#irisk-interface-contract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>ClientRisk</code> implements the <code>IRisk</code> interface, which defines three core methods for risk management:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
<th>When Called</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>checkSignal</code></td>
<td>Validates pending signal against risk rules</td>
<td>Before opening position (immediate or scheduled)</td>
</tr>
<tr>
<td><code>addSignal</code></td>
<td>Tracks new active position</td>
<td>After signal validation passes</td>
</tr>
<tr>
<td><code>removeSignal</code></td>
<td>Removes position from tracking</td>
<td>When signal closes (TP/SL/timeout)</td>
</tr>
</tbody>
</table>
<p><img src="../media/36_ClientRisk_0.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="risk-schema-execution-model" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Risk Schema Execution Model<a href="#risk-schema-execution-model" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>ClientRisk</code> wraps user-defined risk schemas registered via <code>addRisk()</code>. Each schema contains an array of validation rules that are executed sequentially:</p>
<p><img src="../media/36_ClientRisk_1.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="signal-validation-flow-checksignal" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal Validation Flow (checkSignal)<a href="#signal-validation-flow-checksignal" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>checkSignal</code> method is the primary entry point for risk validation. It receives a validation payload and executes all registered validation rules:</p>
<a id="validation-payload-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Payload Structure<a href="#validation-payload-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">ICheckSignalPayload</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">pendingSignal</span><span class="hl-1">: </span><span class="hl-11">ISignalDto</span><span class="hl-1">;        </span><span class="hl-5">// Signal to validate</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;                   </span><span class="hl-5">// Trading pair (e.g., &quot;BTCUSDT&quot;)</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">StrategyName</span><span class="hl-1">;       </span><span class="hl-5">// Strategy identifier</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-11">ExchangeName</span><span class="hl-1">;       </span><span class="hl-5">// Exchange identifier</span><br/><span class="hl-1">  </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;             </span><span class="hl-5">// Current VWAP price</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;                </span><span class="hl-5">// Unix timestamp (ms)</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="validation-execution-sequence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Execution Sequence<a href="#validation-execution-sequence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/36_ClientRisk_2.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="validation-rule-examples" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Rule Examples<a href="#validation-rule-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Risk schemas define validation functions that throw errors on failure. Common validation patterns include:</p>
<a id="distance-validation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Distance Validation<a href="#distance-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Ensures take profit and stop loss are sufficiently distant from entry price to avoid micro-profits and instant stop-outs:</p>
<pre><code class="javascript"><span class="hl-5">// Example: Minimum TP distance validation</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">validate</span><span class="hl-1">: ({ </span><span class="hl-4">pendingSignal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> { </span><span class="hl-8">priceOpen</span><span class="hl-1"> = </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-8">priceTakeProfit</span><span class="hl-1">, </span><span class="hl-8">position</span><span class="hl-1"> } = </span><span class="hl-4">pendingSignal</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">tpDistance</span><span class="hl-1"> = </span><span class="hl-4">position</span><span class="hl-1"> === </span><span class="hl-2">&quot;long&quot;</span><br/><span class="hl-1">      ? ((</span><span class="hl-4">priceTakeProfit</span><span class="hl-1"> - </span><span class="hl-4">priceOpen</span><span class="hl-1">) / </span><span class="hl-4">priceOpen</span><span class="hl-1">) * </span><span class="hl-6">100</span><br/><span class="hl-1">      : ((</span><span class="hl-4">priceOpen</span><span class="hl-1"> - </span><span class="hl-4">priceTakeProfit</span><span class="hl-1">) / </span><span class="hl-4">priceOpen</span><span class="hl-1">) * </span><span class="hl-6">100</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">tpDistance</span><span class="hl-1"> &lt; </span><span class="hl-6">1</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`TP distance </span><span class="hl-7">${</span><span class="hl-4">tpDistance</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">% &lt; 1%`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-10">note</span><span class="hl-1">: </span><span class="hl-2">&quot;TP distance must be at least 1%&quot;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="risk-reward-ratio-validation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Risk-Reward Ratio Validation<a href="#risk-reward-ratio-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Ensures favorable risk-reward ratio:</p>
<pre><code class="javascript"><span class="hl-5">// Example: Minimum 1:2 RR ratio validation</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">validate</span><span class="hl-1">: ({ </span><span class="hl-4">pendingSignal</span><span class="hl-1">, </span><span class="hl-4">currentPrice</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> { </span><span class="hl-8">priceOpen</span><span class="hl-1"> = </span><span class="hl-4">currentPrice</span><span class="hl-1">, </span><span class="hl-8">priceTakeProfit</span><span class="hl-1">, </span><span class="hl-8">priceStopLoss</span><span class="hl-1">, </span><span class="hl-8">position</span><span class="hl-1"> } = </span><span class="hl-4">pendingSignal</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">reward</span><span class="hl-1"> = </span><span class="hl-4">position</span><span class="hl-1"> === </span><span class="hl-2">&quot;long&quot;</span><br/><span class="hl-1">      ? </span><span class="hl-4">priceTakeProfit</span><span class="hl-1"> - </span><span class="hl-4">priceOpen</span><br/><span class="hl-1">      : </span><span class="hl-4">priceOpen</span><span class="hl-1"> - </span><span class="hl-4">priceTakeProfit</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">risk</span><span class="hl-1"> = </span><span class="hl-4">position</span><span class="hl-1"> === </span><span class="hl-2">&quot;long&quot;</span><br/><span class="hl-1">      ? </span><span class="hl-4">priceOpen</span><span class="hl-1"> - </span><span class="hl-4">priceStopLoss</span><br/><span class="hl-1">      : </span><span class="hl-4">priceStopLoss</span><span class="hl-1"> - </span><span class="hl-4">priceOpen</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">rrRatio</span><span class="hl-1"> = </span><span class="hl-4">reward</span><span class="hl-1"> / </span><span class="hl-4">risk</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">rrRatio</span><span class="hl-1"> &lt; </span><span class="hl-6">2</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`RR ratio </span><span class="hl-7">${</span><span class="hl-4">rrRatio</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2"> &lt; 2:1`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-10">note</span><span class="hl-1">: </span><span class="hl-2">&quot;Risk-Reward ratio must be at least 1:2&quot;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="position-tracking-addsignal--removesignal" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Position Tracking (addSignal / removeSignal)<a href="#position-tracking-addsignal--removesignal" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>ClientRisk</code> maintains active position counts per symbol-strategy pair to enforce concurrent position limits:</p>
<p><img src="../media/36_ClientRisk_3.svg" alt="Mermaid Diagram"></p>
<a id="position-tracking-methods" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Position Tracking Methods<a href="#position-tracking-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Method</th>
<th>Signature</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>addSignal</code></td>
<td><code>(symbol: string, ctx: {strategyName, riskName}) =&gt; Promise&lt;void&gt;</code></td>
<td>Increments position counter for symbol-strategy pair</td>
</tr>
<tr>
<td><code>removeSignal</code></td>
<td><code>(symbol: string, ctx: {strategyName, riskName}) =&gt; Promise&lt;void&gt;</code></td>
<td>Decrements position counter when signal closes</td>
</tr>
</tbody>
</table>
<a id="integration-points" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Integration Points<a href="#integration-points" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/36_ClientRisk_4.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="fail-fast-validation-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Fail-Fast Validation Pattern<a href="#fail-fast-validation-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>ClientRisk</code> implements a <strong>fail-fast</strong> validation pattern where the first validation failure immediately stops execution:</p>
<p><img src="../media/36_ClientRisk_5.svg" alt="Mermaid Diagram"></p>
<p>This pattern ensures:</p>
<ol>
<li><strong>Early termination</strong> on first rule violation</li>
<li><strong>Single rejection event</strong> emitted per validation attempt</li>
<li><strong>Diagnostic information</strong> via <code>note</code> field in validation rule</li>
<li><strong>Optional callbacks</strong> via <code>onReject</code> for custom handling</li>
</ol>
<hr>
<a id="noop-risk-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">NOOP Risk Implementation<a href="#noop-risk-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When a strategy has no <code>riskName</code> configured, <code>ClientRisk</code> is replaced with a no-op implementation that always passes validation:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">NOOP_RISK</span><span class="hl-1">: </span><span class="hl-11">IRisk</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">checkSignal</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">(</span><span class="hl-7">true</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-0">addSignal</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-0">removeSignal</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">(),</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>This allows strategies to operate without risk management while maintaining the same interface contract.</p>
<hr>
<a id="integration-with-riskconnectionservice" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with RiskConnectionService<a href="#integration-with-riskconnectionservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>ClientRisk</code> instances are managed by <code>RiskConnectionService</code>, which provides routing and memoization:</p>
<p><img src="../media/36_ClientRisk_6.svg" alt="Mermaid Diagram"></p>
<p>The connection service ensures:</p>
<ul>
<li><strong>One instance per risk profile</strong> via memoization</li>
<li><strong>Efficient routing</strong> based on <code>riskName</code> string</li>
<li><strong>Fallback to NOOP</strong> when no risk profile assigned</li>
</ul>
<hr>
<a id="risk-event-emission" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Risk Event Emission<a href="#risk-event-emission" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When validation fails, <code>ClientRisk</code> emits rejection events through the <code>riskSubject</code> event emitter:</p>
<p><img src="../media/36_ClientRisk_7.svg" alt="Mermaid Diagram"></p>
<a id="risk-event-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Risk Event Structure<a href="#risk-event-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IRiskEvent</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">StrategyName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-11">ExchangeName</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">pendingSignal</span><span class="hl-1">: </span><span class="hl-11">ISignalDto</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">currentPrice</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">rejectionReason</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;  </span><span class="hl-5">// Error message from validation</span><br/><span class="hl-1">  </span><span class="hl-4">validationNote</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;    </span><span class="hl-5">// &quot;note&quot; field from validation rule</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Summary<a href="#summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>ClientRisk</code> serves as the <strong>gatekeeper</strong> for signal execution, enforcing user-defined risk policies before positions are opened. Key characteristics:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Interface</strong></td>
<td>Implements <code>IRisk</code> with three methods</td>
</tr>
<tr>
<td><strong>Validation Model</strong></td>
<td>Sequential execution with fail-fast pattern</td>
</tr>
<tr>
<td><strong>Position Tracking</strong></td>
<td>Maintains active position counts per symbol-strategy</td>
</tr>
<tr>
<td><strong>Integration</strong></td>
<td>Called by <code>ClientStrategy</code> during signal lifecycle</td>
</tr>
<tr>
<td><strong>Event System</strong></td>
<td>Emits rejection events through <code>riskSubject</code></td>
</tr>
<tr>
<td><strong>Flexibility</strong></td>
<td>Supports custom validation logic via schemas</td>
</tr>
<tr>
<td><strong>Fallback</strong></td>
<td>NOOP implementation when no risk profile assigned</td>
</tr>
</tbody>
</table>
<p>The separation of <code>ClientRisk</code> from dependency injection allows risk logic to be <strong>pure, testable, and reusable</strong> across different execution contexts (backtest, live, walker).</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#clientrisk"><span>Client<wbr/>Risk</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#irisk-interface-contract"><span>IRisk <wbr/>Interface <wbr/>Contract</span></a></li><li><a href="#risk-schema-execution-model"><span>Risk <wbr/>Schema <wbr/>Execution <wbr/>Model</span></a></li><li><a href="#signal-validation-flow-checksignal"><span>Signal <wbr/>Validation <wbr/>Flow (check<wbr/>Signal)</span></a></li><li><ul><li><a href="#validation-payload-structure"><span>Validation <wbr/>Payload <wbr/>Structure</span></a></li><li><a href="#validation-execution-sequence"><span>Validation <wbr/>Execution <wbr/>Sequence</span></a></li></ul></li><li><a href="#validation-rule-examples"><span>Validation <wbr/>Rule <wbr/>Examples</span></a></li><li><ul><li><a href="#distance-validation"><span>Distance <wbr/>Validation</span></a></li><li><a href="#risk-reward-ratio-validation"><span>Risk-<wbr/>Reward <wbr/>Ratio <wbr/>Validation</span></a></li></ul></li><li><a href="#position-tracking-addsignal--removesignal"><span>Position <wbr/>Tracking (add<wbr/>Signal / remove<wbr/>Signal)</span></a></li><li><ul><li><a href="#position-tracking-methods"><span>Position <wbr/>Tracking <wbr/>Methods</span></a></li><li><a href="#integration-points"><span>Integration <wbr/>Points</span></a></li></ul></li><li><a href="#fail-fast-validation-pattern"><span>Fail-<wbr/>Fast <wbr/>Validation <wbr/>Pattern</span></a></li><li><a href="#noop-risk-implementation"><span>NOOP <wbr/>Risk <wbr/>Implementation</span></a></li><li><a href="#integration-with-riskconnectionservice"><span>Integration with <wbr/>Risk<wbr/>Connection<wbr/>Service</span></a></li><li><a href="#risk-event-emission"><span>Risk <wbr/>Event <wbr/>Emission</span></a></li><li><ul><li><a href="#risk-event-structure"><span>Risk <wbr/>Event <wbr/>Structure</span></a></li></ul></li><li><a href="#summary"><span>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
