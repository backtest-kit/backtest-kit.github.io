<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/13_event_listeners | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_13_event_listeners.html">design/13_event_listeners</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="event-listeners" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Event Listeners<a href="#event-listeners" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents the event listener system for subscribing to signal events. Event listeners allow users to react to strategy signals asynchronously as they occur, enabling patterns like background execution monitoring, conditional early termination, and event-driven workflows.</p>
<p>For information about running strategies, see <a href="design_10_backtest_api.html">Backtest API</a> and <a href="design_11_live_trading_api.html">Live Trading API</a>. For information about signal states and transitions, see <a href="design_24_signal_states.html">Signal States</a>.</p>
<hr>
<a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The event listener system provides six public functions for subscribing to <code>IStrategyTickResult</code> events emitted during strategy execution:</p>
<ul>
<li><strong>All events</strong>: <code>listenSignal()</code>, <code>listenSignalOnce()</code></li>
<li><strong>Backtest events only</strong>: <code>listenSignalBacktest()</code>, <code>listenSignalBacktestOnce()</code></li>
<li><strong>Live events only</strong>: <code>listenSignalLive()</code>, <code>listenSignalLiveOnce()</code></li>
</ul>
<p>Event listeners use queued async processing to ensure sequential execution, preventing race conditions. All listener functions return an unsubscribe function that removes the listener when called.</p>
<hr>
<a id="event-listener-functions-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Listener Functions Overview<a href="#event-listener-functions-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/13_Event_Listeners_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Event Listener Architecture</strong></p>
<p>The event listener system bridges strategy execution to user code. Events originate from <code>BacktestLogicPrivateService</code> and <code>LiveLogicPrivateService</code>, which emit <code>IStrategyTickResult</code> events during <code>tick()</code> execution. The six listener functions filter and route events to user-provided callbacks based on execution mode (backtest/live) and subscription type (continuous/once).</p>
<hr>
<a id="listener-function-variants" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Listener Function Variants<a href="#listener-function-variants" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Function</th>
<th>Mode Filter</th>
<th>Execution</th>
<th>Filter Predicate</th>
<th>Auto-Unsubscribe</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>listenSignal</code></td>
<td>All (backtest + live)</td>
<td>Continuous</td>
<td>No</td>
<td>Manual only</td>
</tr>
<tr>
<td><code>listenSignalOnce</code></td>
<td>All (backtest + live)</td>
<td>One-time</td>
<td>Yes</td>
<td>After first match</td>
</tr>
<tr>
<td><code>listenSignalBacktest</code></td>
<td>Backtest only</td>
<td>Continuous</td>
<td>No</td>
<td>Manual only</td>
</tr>
<tr>
<td><code>listenSignalBacktestOnce</code></td>
<td>Backtest only</td>
<td>One-time</td>
<td>Yes</td>
<td>After first match</td>
</tr>
<tr>
<td><code>listenSignalLive</code></td>
<td>Live only</td>
<td>Continuous</td>
<td>No</td>
<td>Manual only</td>
</tr>
<tr>
<td><code>listenSignalLiveOnce</code></td>
<td>Live only</td>
<td>One-time</td>
<td>Yes</td>
<td>After first match</td>
</tr>
</tbody>
</table>
<a id="continuous-listeners" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Continuous Listeners<a href="#continuous-listeners" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Continuous listeners (<code>listenSignal</code>, <code>listenSignalBacktest</code>, <code>listenSignalLive</code>) execute the callback for every matching event until manually unsubscribed.</p>
<pre><code class="typescript"><span class="hl-5">// Listen to all events continuously</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">unsubscribe</span><span class="hl-1"> = </span><span class="hl-0">listenSignal</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Event:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Later: stop listening</span><br/><span class="hl-0">unsubscribe</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="one-time-listeners" class="tsd-anchor"></a><h3 class="tsd-anchor-link">One-Time Listeners<a href="#one-time-listeners" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>One-time listeners (<code>listenSignalOnce</code>, <code>listenSignalBacktestOnce</code>, <code>listenSignalLiveOnce</code>) accept a filter predicate and execute the callback once when an event matches the filter, then automatically unsubscribe.</p>
<pre><code class="typescript"><span class="hl-5">// Wait for first take profit event</span><br/><span class="hl-0">listenSignalBacktestOnce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1"> === </span><span class="hl-2">&quot;take_profit&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Take profit hit:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// Automatically unsubscribed after this</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="event-types" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Types<a href="#event-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All event listeners receive <code>IStrategyTickResult</code> discriminated union events. The discriminated union has four possible states based on the <code>action</code> field:</p>
<p><img src="../media/13_Event_Listeners_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: IStrategyTickResult Discriminated Union</strong></p>
<p>Each event contains the full state information for type-safe handling:</p>
<table>
<thead>
<tr>
<th>State</th>
<th>Description</th>
<th>Fields</th>
<th>Common in Backtest</th>
<th>Common in Live</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>idle</code></td>
<td>No active signal exists</td>
<td><code>signal: null</code></td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td><code>opened</code></td>
<td>New signal created and validated</td>
<td><code>signal: ISignalRow</code></td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td><code>active</code></td>
<td>Signal monitored, TP/SL not hit</td>
<td><code>signal: ISignalRow</code>, <code>currentPrice</code></td>
<td>✗ (filtered)</td>
<td>✓</td>
</tr>
<tr>
<td><code>closed</code></td>
<td>Signal completed with PNL</td>
<td><code>signal: ISignalRow</code>, <code>currentPrice</code>, <code>closeReason</code>, <code>pnl</code>, <code>closeTimestamp</code></td>
<td>✓</td>
<td>✓</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: In backtest mode, <code>active</code> events are filtered and not yielded to optimize throughput. Live mode yields all states for real-time monitoring.</p>
<hr>
<a id="background-execution-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Background Execution Pattern<a href="#background-execution-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Event listeners are designed for use with <code>Backtest.background()</code> and <code>Live.background()</code>, which execute strategies without yielding results. This pattern decouples strategy execution from result consumption.</p>
<p><img src="../media/13_Event_Listeners_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Background Execution with Event Listener</strong></p>
<a id="example-background-backtest-with-listener" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example: Background Backtest with Listener<a href="#example-background-backtest-with-listener" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Backtest</span><span class="hl-1">, </span><span class="hl-4">listenSignalBacktest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Start backtest in background (doesn&#39;t block)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cancel</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Subscribe to backtest events</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">unsubscribe</span><span class="hl-1"> = </span><span class="hl-0">listenSignalBacktest</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;PNL:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-2">&quot;%&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Later: stop execution and listening</span><br/><span class="hl-0">cancel</span><span class="hl-1">();</span><br/><span class="hl-0">unsubscribe</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="queued-async-processing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Queued Async Processing<a href="#queued-async-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All event listener callbacks use queued async processing via <code>functools-kit</code> to ensure sequential execution. Even if callbacks are async, they execute one at a time in the order events are emitted.</p>
<p>This guarantees:</p>
<ul>
<li><strong>No race conditions</strong>: Callbacks cannot run concurrently</li>
<li><strong>Order preservation</strong>: Events processed in emission order</li>
<li><strong>Async support</strong>: Callbacks can perform async operations (API calls, file I/O)</li>
</ul>
<pre><code class="typescript"><span class="hl-5">// Even with async operations, callbacks execute sequentially</span><br/><span class="hl-0">listenSignal</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// These operations execute in order, one at a time</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">saveToDatabase</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">sendNotification</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">updateDashboard</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="unsubscribe-mechanism" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Unsubscribe Mechanism<a href="#unsubscribe-mechanism" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All listener functions return an unsubscribe function that removes the listener from the internal registry. Calling unsubscribe prevents future events from triggering the callback.</p>
<pre><code class="typescript"><span class="hl-5">// Subscribe to events</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">unsubscribe1</span><span class="hl-1"> = </span><span class="hl-0">listenSignal</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Listener 1:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">unsubscribe2</span><span class="hl-1"> = </span><span class="hl-0">listenSignalBacktest</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Listener 2:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Remove specific listener</span><br/><span class="hl-0">unsubscribe1</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// Remove another listener</span><br/><span class="hl-0">unsubscribe2</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="automatic-unsubscribe-once-variants" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Automatic Unsubscribe (Once Variants)<a href="#automatic-unsubscribe-once-variants" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The &quot;Once&quot; variants automatically unsubscribe after the first matching event:</p>
<pre><code class="typescript"><span class="hl-5">// Automatically unsubscribes after first match</span><br/><span class="hl-0">listenSignalOnce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &gt; </span><span class="hl-8">5</span><span class="hl-1">,</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Large profit detected:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// No manual unsubscribe needed</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>If you need to cancel a &quot;Once&quot; listener before it fires:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cancel</span><span class="hl-1"> = </span><span class="hl-0">listenSignalOnce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Closed&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-5">// Cancel before event fires</span><br/><span class="hl-0">cancel</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="multiple-listeners" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Multiple Listeners<a href="#multiple-listeners" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Multiple listeners can coexist simultaneously. Each listener receives all matching events independently.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenSignal</span><span class="hl-1">, </span><span class="hl-4">listenSignalLive</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Listener 1: Log all events</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">unsub1</span><span class="hl-1"> = </span><span class="hl-0">listenSignal</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Logger:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Listener 2: Track live signals only</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">unsub2</span><span class="hl-1"> = </span><span class="hl-0">listenSignalLive</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Send alert</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Listener 3: Wait for first stop loss (auto-unsubscribes)</span><br/><span class="hl-0">listenSignalOnce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1"> === </span><span class="hl-2">&quot;stop_loss&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Stop loss hit!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// Generate emergency report</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-5">// All three listeners receive events independently</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="usage-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage Patterns<a href="#usage-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="pattern-1-real-time-monitoring" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 1: Real-Time Monitoring<a href="#pattern-1-real-time-monitoring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Monitor live trading in real-time while strategy runs in background:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Live</span><span class="hl-1">, </span><span class="hl-4">listenSignalLive</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Start live trading</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cancel</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Monitor in real-time</span><br/><span class="hl-0">listenSignalLive</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Signal opened:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">sendNotification</span><span class="hl-1">(</span><span class="hl-2">&quot;New signal opened&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Signal closed:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="pattern-2-conditional-early-termination" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 2: Conditional Early Termination<a href="#pattern-2-conditional-early-termination" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Stop execution when specific condition is met:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Backtest</span><span class="hl-1">, </span><span class="hl-4">listenSignalBacktestOnce</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Start backtest</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cancel</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Stop on first stop loss</span><br/><span class="hl-0">listenSignalBacktestOnce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1"> === </span><span class="hl-2">&quot;stop_loss&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Stop loss hit - terminating backtest&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">cancel</span><span class="hl-1">(); </span><span class="hl-5">// Stop backtest execution</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="pattern-3-multi-mode-monitoring" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 3: Multi-Mode Monitoring<a href="#pattern-3-multi-mode-monitoring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Listen to both backtest and live events simultaneously:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenSignal</span><span class="hl-1">, </span><span class="hl-4">Backtest</span><span class="hl-1">, </span><span class="hl-4">Live</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Listen to all events from both modes</span><br/><span class="hl-0">listenSignal</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">mode</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">.</span><span class="hl-0">includes</span><span class="hl-1">(</span><span class="hl-2">&quot;backtest&quot;</span><span class="hl-1">) ? </span><span class="hl-2">&quot;BT&quot;</span><span class="hl-1"> : </span><span class="hl-2">&quot;LIVE&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[</span><span class="hl-6">${</span><span class="hl-4">mode</span><span class="hl-6">}</span><span class="hl-2">] </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">action</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`PNL: </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">pnl</span><span class="hl-9">.</span><span class="hl-4">pnlPercentage</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Run backtest and live in parallel</span><br/><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy-backtest&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy-live&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="pattern-4-filtered-analytics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pattern 4: Filtered Analytics<a href="#pattern-4-filtered-analytics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Collect specific events for analysis:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenSignalBacktest</span><span class="hl-1">, </span><span class="hl-4">Backtest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">takeProfits</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">[] = [];</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">stopLosses</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">[] = [];</span><br/><br/><span class="hl-5">// Collect PNL data</span><br/><span class="hl-0">listenSignalBacktest</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1"> === </span><span class="hl-2">&quot;take_profit&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">takeProfits</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-3">else</span><span class="hl-1"> </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1"> === </span><span class="hl-2">&quot;stop_loss&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">stopLosses</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Run backtest</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;1d-backtest&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Analyze results</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Avg TP:&quot;</span><span class="hl-1">, </span><span class="hl-4">takeProfits</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">a</span><span class="hl-1"> + </span><span class="hl-4">b</span><span class="hl-1">, </span><span class="hl-8">0</span><span class="hl-1">) / </span><span class="hl-4">takeProfits</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Avg SL:&quot;</span><span class="hl-1">, </span><span class="hl-4">stopLosses</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">a</span><span class="hl-1"> + </span><span class="hl-4">b</span><span class="hl-1">, </span><span class="hl-8">0</span><span class="hl-1">) / </span><span class="hl-4">stopLosses</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="best-practices" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Best Practices<a href="#best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="1-always-unsubscribe" class="tsd-anchor"></a><h3 class="tsd-anchor-link">1. Always Unsubscribe<a href="#1-always-unsubscribe" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Prevent memory leaks by unsubscribing when listeners are no longer needed:</p>
<pre><code class="typescript"><span class="hl-5">// ✓ Good: Store unsubscribe function</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">unsubscribe</span><span class="hl-1"> = </span><span class="hl-0">listenSignal</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Clean up when done</span><br/><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&quot;SIGINT&quot;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">unsubscribe</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-0">exit</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="2-use-once-variants-for-single-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">2. Use Once Variants for Single Events<a href="#2-use-once-variants-for-single-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Prefer <code>listenSignalOnce</code> for one-time actions to avoid manual unsubscribe:</p>
<pre><code class="typescript"><span class="hl-5">// ✓ Good: Automatic cleanup</span><br/><span class="hl-0">listenSignalOnce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;First close&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-5">// ✗ Bad: Manual cleanup required</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">unsub</span><span class="hl-1"> = </span><span class="hl-0">listenSignal</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;First close&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">unsub</span><span class="hl-1">(); </span><span class="hl-5">// Easy to forget</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="3-filter-events-in-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">3. Filter Events in Callbacks<a href="#3-filter-events-in-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For continuous listeners, filter events in the callback to reduce processing:</p>
<pre><code class="typescript"><span class="hl-5">// ✓ Good: Early return for unwanted events</span><br/><span class="hl-0">listenSignal</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> !== </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &lt; </span><span class="hl-8">5</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Large profit:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="4-use-mode-specific-listeners" class="tsd-anchor"></a><h3 class="tsd-anchor-link">4. Use Mode-Specific Listeners<a href="#4-use-mode-specific-listeners" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Use <code>listenSignalBacktest</code> and <code>listenSignalLive</code> instead of <code>listenSignal</code> when you only care about one mode:</p>
<pre><code class="typescript"><span class="hl-5">// ✓ Good: Backtest-specific listener</span><br/><span class="hl-0">listenSignalBacktest</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Only receives backtest events</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// ✗ Bad: Manual filtering</span><br/><span class="hl-0">listenSignal</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Need to check if backtest manually</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">.</span><span class="hl-0">includes</span><span class="hl-1">(</span><span class="hl-2">&quot;backtest&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-5">// ...</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="5-handle-errors-in-callbacks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">5. Handle Errors in Callbacks<a href="#5-handle-errors-in-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Wrap callback logic in try-catch to prevent uncaught errors:</p>
<pre><code class="typescript"><span class="hl-0">listenSignal</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">saveToDatabase</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">sendNotification</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Error processing event:&quot;</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Summary<a href="#summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Event listeners provide a flexible mechanism for subscribing to strategy signals:</p>
<ul>
<li><strong>Six functions</strong>: All/Backtest/Live × Continuous/Once</li>
<li><strong>Queued processing</strong>: Sequential async execution prevents race conditions</li>
<li><strong>Type-safe events</strong>: Discriminated union <code>IStrategyTickResult</code> with four states</li>
<li><strong>Background pattern</strong>: Decouples execution from monitoring</li>
<li><strong>Automatic cleanup</strong>: &quot;Once&quot; variants auto-unsubscribe</li>
</ul>
<p>Event listeners enable patterns like real-time monitoring, conditional early termination, and event-driven analytics without blocking strategy execution.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#event-listeners"><span>Event <wbr/>Listeners</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#event-listener-functions-overview"><span>Event <wbr/>Listener <wbr/>Functions <wbr/>Overview</span></a></li><li><a href="#listener-function-variants"><span>Listener <wbr/>Function <wbr/>Variants</span></a></li><li><ul><li><a href="#continuous-listeners"><span>Continuous <wbr/>Listeners</span></a></li><li><a href="#one-time-listeners"><span>One-<wbr/>Time <wbr/>Listeners</span></a></li></ul></li><li><a href="#event-types"><span>Event <wbr/>Types</span></a></li><li><a href="#background-execution-pattern"><span>Background <wbr/>Execution <wbr/>Pattern</span></a></li><li><ul><li><a href="#example-background-backtest-with-listener"><span>Example: <wbr/>Background <wbr/>Backtest with <wbr/>Listener</span></a></li></ul></li><li><a href="#queued-async-processing"><span>Queued <wbr/>Async <wbr/>Processing</span></a></li><li><a href="#unsubscribe-mechanism"><span>Unsubscribe <wbr/>Mechanism</span></a></li><li><ul><li><a href="#automatic-unsubscribe-once-variants"><span>Automatic <wbr/>Unsubscribe (<wbr/>Once <wbr/>Variants)</span></a></li></ul></li><li><a href="#multiple-listeners"><span>Multiple <wbr/>Listeners</span></a></li><li><a href="#usage-patterns"><span>Usage <wbr/>Patterns</span></a></li><li><ul><li><a href="#pattern-1-real-time-monitoring"><span>Pattern 1: <wbr/>Real-<wbr/>Time <wbr/>Monitoring</span></a></li><li><a href="#pattern-2-conditional-early-termination"><span>Pattern 2: <wbr/>Conditional <wbr/>Early <wbr/>Termination</span></a></li><li><a href="#pattern-3-multi-mode-monitoring"><span>Pattern 3: <wbr/>Multi-<wbr/>Mode <wbr/>Monitoring</span></a></li><li><a href="#pattern-4-filtered-analytics"><span>Pattern 4: <wbr/>Filtered <wbr/>Analytics</span></a></li></ul></li><li><a href="#best-practices"><span>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#1-always-unsubscribe"><span>1. <wbr/>Always <wbr/>Unsubscribe</span></a></li><li><a href="#2-use-once-variants-for-single-events"><span>2. <wbr/>Use <wbr/>Once <wbr/>Variants for <wbr/>Single <wbr/>Events</span></a></li><li><a href="#3-filter-events-in-callbacks"><span>3. <wbr/>Filter <wbr/>Events in <wbr/>Callbacks</span></a></li><li><a href="#4-use-mode-specific-listeners"><span>4. <wbr/>Use <wbr/>Mode-<wbr/>Specific <wbr/>Listeners</span></a></li><li><a href="#5-handle-errors-in-callbacks"><span>5. <wbr/>Handle <wbr/>Errors in <wbr/>Callbacks</span></a></li></ul></li><li><a href="#summary"><span>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
