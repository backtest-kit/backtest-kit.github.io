<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/11_live_trading_api | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_11_live_trading_api.html">design/11_live_trading_api</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="live-trading-api" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Live Trading API<a href="#live-trading-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents the public-facing Live Trading API provided by the <code>Live</code> class. This API enables production-ready live trading execution with infinite async generators, crash-safe state persistence, and real-time signal monitoring. The API is designed for production use with automatic state recovery after process crashes.</p>
<p>For backtesting operations, see <a href="design_10_backtest_api.html">Backtest API</a>. For detailed implementation of crash recovery mechanisms, see <a href="design_34_crash_recovery.html">Crash Recovery</a>. For signal persistence internals, see <a href="design_26_signal_persistence.html">Signal Persistence</a>. For the complete live execution flow including service orchestration, see <a href="design_33_live_execution_flow.html">Live Execution Flow</a>.</p>
<hr>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Live Trading API is implemented as a singleton class <code>LiveUtils</code> exported as <code>Live</code>. It provides four primary methods for live trading operations:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Return Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>run()</code></td>
<td><code>AsyncIterableIterator&lt;IStrategyTickResult&gt;</code></td>
<td>Infinite generator yielding signal events</td>
</tr>
<tr>
<td><code>background()</code></td>
<td><code>Promise&lt;() =&gt; void&gt;</code></td>
<td>Background execution with cancellation</td>
</tr>
<tr>
<td><code>getReport()</code></td>
<td><code>Promise&lt;string&gt;</code></td>
<td>Generate markdown report</td>
</tr>
<tr>
<td><code>dump()</code></td>
<td><code>Promise&lt;void&gt;</code></td>
<td>Save report to disk</td>
</tr>
</tbody>
</table>
<p>Unlike the Backtest API which terminates when the timeframe is exhausted, the Live API runs indefinitely until manually stopped or the process crashes. State is persisted atomically before each signal transition, enabling seamless recovery on restart.</p>
<hr>
<a id="liverun-method" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Live.run Method<a href="#liverun-method" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="signature" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signature<a href="#signature" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">context</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">): </span><span class="hl-4">AsyncIterableIterator</span><span class="hl-1">&lt;</span><span class="hl-4">IStrategyTickResult</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<p>The <code>run()</code> method initiates live trading execution for a trading pair. It returns an infinite async generator that yields signal events in real-time. The generator executes with 1-minute intervals, monitoring active signals and checking for new signal generation opportunities.</p>
<a id="execution-characteristics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Execution Characteristics<a href="#execution-characteristics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/11_Live_Trading_API_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Live.run Execution Path</strong></p>
<p>The execution flow propagates through dependency injection layers:</p>
<ol>
<li><code>Live.run()</code> logs the request and delegates to <code>liveGlobalService</code></li>
<li><code>LiveGlobalService</code> wraps the call with <code>MethodContextService</code> for context propagation</li>
<li><code>LiveLogicPrivateService</code> implements the infinite generator with 1-minute sleep intervals</li>
<li>Each iteration calls <code>strategyGlobalService.tick()</code> to check signal state</li>
<li>State changes are persisted atomically via <code>PersistSignalAdapter</code> before yielding</li>
</ol>
<a id="yielded-results" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Yielded Results<a href="#yielded-results" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The generator yields only <code>opened</code> and <code>closed</code> results. The <code>idle</code> and <code>active</code> states are filtered out to reduce noise in live mode:</p>
<table>
<thead>
<tr>
<th>Result Type</th>
<th>When Yielded</th>
<th>Signal State</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IStrategyTickResultOpened</code></td>
<td>New signal created and validated</td>
<td>Just opened</td>
</tr>
<tr>
<td><code>IStrategyTickResultClosed</code></td>
<td>Signal hit TP/SL or time expired</td>
<td>Just closed</td>
</tr>
<tr>
<td><code>IStrategyTickResultIdle</code></td>
<td>❌ Not yielded in live mode</td>
<td>No active signal</td>
</tr>
<tr>
<td><code>IStrategyTickResultActive</code></td>
<td>❌ Not yielded in live mode</td>
<td>Monitoring signal</td>
</tr>
</tbody>
</table>
<p>This filtering is implemented in <a href="">src/lib/services/logic/private/LiveLogicPrivateService.ts</a> where only <code>opened</code> and <code>closed</code> actions are yielded to the caller.</p>
<a id="state-persistence-and-recovery" class="tsd-anchor"></a><h3 class="tsd-anchor-link">State Persistence and Recovery<a href="#state-persistence-and-recovery" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/11_Live_Trading_API_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Crash Recovery Flow</strong></p>
<p>Every signal state change is persisted atomically before yielding results. This ensures:</p>
<ul>
<li>No duplicate signals after restart</li>
<li>No lost signals during crashes</li>
<li>Deterministic recovery to last known state</li>
</ul>
<hr>
<a id="livebackground-method" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Live.background Method<a href="#livebackground-method" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="signature-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signature<a href="#signature-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">context</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">exchangeName</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;() </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">void</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<p>The <code>background()</code> method runs live trading without yielding results to the caller. It internally consumes all generator values, allowing the strategy to execute for side effects only (callbacks, persistence, logging). Returns a cancellation function to stop execution gracefully.</p>
<a id="implementation-details" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Implementation Details<a href="#implementation-details" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Implementation from src/classes/Live.ts:85-117</span><br/><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">background</span><span class="hl-1"> = </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">iterator</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-4">isStopped</span><span class="hl-1"> = </span><span class="hl-6">false</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-4">lastValue</span><span class="hl-1"> = </span><span class="hl-6">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-0">task</span><span class="hl-1"> = </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">while</span><span class="hl-1"> (</span><span class="hl-6">true</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-7">value</span><span class="hl-1">, </span><span class="hl-7">done</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">iterator</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">lastValue</span><span class="hl-1"> = </span><span class="hl-4">value</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">done</span><span class="hl-1">) </span><span class="hl-3">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">lastValue</span><span class="hl-1">?.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">isStopped</span><span class="hl-1">) </span><span class="hl-3">break</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">task</span><span class="hl-1">(); </span><span class="hl-5">// Fire and forget</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> { </span><span class="hl-4">isStopped</span><span class="hl-1"> = </span><span class="hl-6">true</span><span class="hl-1">; }; </span><span class="hl-5">// Cancellation closure</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The method waits for the next <code>closed</code> event before honoring the cancellation flag. This ensures signals are not interrupted mid-lifecycle.</p>
<a id="cancellation-behavior" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Cancellation Behavior<a href="#cancellation-behavior" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/11_Live_Trading_API_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Background Cancellation State Machine</strong></p>
<p>The cancellation mechanism ensures signals are not left in an inconsistent state when stopping live trading.</p>
<hr>
<a id="reporting-methods" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Reporting Methods<a href="#reporting-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="livegetreport" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live.getReport<a href="#livegetreport" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">getReport</span><span class="hl-1">(</span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<p>Generates a markdown-formatted report for the specified strategy. The report includes:</p>
<ul>
<li>Total event count (idle, opened, active, closed)</li>
<li>Closed signals count</li>
<li>Win rate calculation (percentage, wins/losses)</li>
<li>Average PNL across all closed signals</li>
<li>Signal-by-signal table with timestamps, prices, and outcomes</li>
</ul>
<p>The report is generated by <code>LiveMarkdownService</code> which accumulates events passively via event listeners.</p>
<a id="livedump" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live.dump<a href="#livedump" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">path</span><span class="hl-1">?: </span><span class="hl-4">string</span><br/><span class="hl-1">): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<p>Saves the markdown report to disk. Default path is <code>./logs/live/{strategyName}.md</code>. Custom paths can be specified via the optional <code>path</code> parameter.</p>
<a id="report-output-format" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Report Output Format<a href="#report-output-format" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Section</th>
<th>Content</th>
</tr>
</thead>
<tbody>
<tr>
<td>Header</td>
<td>Strategy name, total events, closed signals</td>
</tr>
<tr>
<td>Statistics</td>
<td>Win rate (% and W/L ratio), average PNL</td>
</tr>
<tr>
<td>Signal Table</td>
<td>Columns: Timestamp, Action, Symbol, Signal ID, Position, Prices (Open/TP/SL), PNL, Close Reason</td>
</tr>
</tbody>
</table>
<hr>
<a id="result-type-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Result Type System<a href="#result-type-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The generator yields a discriminated union <code>IStrategyTickResult</code> with the <code>action</code> field as the discriminator:</p>
<p><img src="../media/11_Live_Trading_API_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Live Result Type Hierarchy</strong></p>
<p>Type guards enable safe property access:</p>
<pre><code class="typescript"><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">)) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// TypeScript knows: result is IStrategyTickResultOpened</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-3">else</span><span class="hl-1"> </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// TypeScript knows: result is IStrategyTickResultClosed</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="usage-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage Patterns<a href="#usage-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="basic-live-trading-loop" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Live Trading Loop<a href="#basic-live-trading-loop" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Reference: README.md:142-169</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Live</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><br/><span class="hl-1">})) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;opened&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Signal opened:&quot;</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// State already persisted to disk</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Closed:&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">reason:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">closeReason</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">pnl:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Generate report after each close</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="background-execution-with-event-listeners" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Background Execution with Event Listeners<a href="#background-execution-with-event-listeners" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Reference: README.md:387-418</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Live</span><span class="hl-1">, </span><span class="hl-4">listenSignalLive</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Start background execution</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cancel</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// React to events</span><br/><span class="hl-0">listenSignalLive</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;PNL:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Stop on condition</span><br/><span class="hl-0">setTimeout</span><span class="hl-1">(() </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-0">cancel</span><span class="hl-1">(), </span><span class="hl-8">3600000</span><span class="hl-1">); </span><span class="hl-5">// Stop after 1 hour</span>
</code><button type="button">Copy</button></pre>

<a id="multi-symbol-live-trading" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Multi-Symbol Live Trading<a href="#multi-symbol-live-trading" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// Reference: README.md:693-715</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Live</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">symbols</span><span class="hl-1"> = [</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;ETHUSDT&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;SOLUSDT&quot;</span><span class="hl-1">];</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-11">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">symbols</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;binance&quot;</span><br/><span class="hl-1">    })) {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[</span><span class="hl-6">${</span><span class="hl-4">symbol</span><span class="hl-6">}</span><span class="hl-2">]`</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Each symbol maintains independent state persistence in separate files: <code>./data/signal/binance-my-strategy-BTCUSDT.json</code>, etc.</p>
<hr>
<a id="comparison-with-backtest-api" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Comparison with Backtest API<a href="#comparison-with-backtest-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Feature</th>
<th>Live.run()</th>
<th>Backtest.run()</th>
</tr>
</thead>
<tbody>
<tr>
<td>Generator Type</td>
<td>Infinite</td>
<td>Finite (exhausts timeframe)</td>
</tr>
<tr>
<td>Time Progression</td>
<td>Real-time (Date.now())</td>
<td>Historical (frame timestamps)</td>
</tr>
<tr>
<td>Sleep Interval</td>
<td>1 minute + 1ms</td>
<td>No sleep (fast iteration)</td>
</tr>
<tr>
<td>Yielded Results</td>
<td><code>opened</code>, <code>closed</code> only</td>
<td><code>closed</code> only (after fast-forward)</td>
</tr>
<tr>
<td>State Persistence</td>
<td>Enabled (crash recovery)</td>
<td>Disabled (stateless)</td>
</tr>
<tr>
<td>Context Parameter</td>
<td><code>{ strategyName, exchangeName }</code></td>
<td><code>{ strategyName, exchangeName, frameName }</code></td>
</tr>
<tr>
<td>Termination</td>
<td>Manual (break/cancel)</td>
<td>Automatic (frame end)</td>
</tr>
</tbody>
</table>
<hr>
<a id="service-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Integration<a href="#service-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/11_Live_Trading_API_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Diagram: Live API Service Dependencies</strong></p>
<p>The Live API delegates to service layers which handle:</p>
<ul>
<li><strong>Context Propagation</strong>: <code>MethodContextService</code> and <code>ExecutionContextService</code> inject implicit context</li>
<li><strong>Strategy Execution</strong>: <code>StrategyGlobalService</code> routes to correct <code>ClientStrategy</code> instance</li>
<li><strong>State Management</strong>: <code>PersistSignalAdapter</code> handles crash-safe file writes</li>
<li><strong>Reporting</strong>: <code>LiveMarkdownService</code> accumulates events passively</li>
</ul>
<hr>
<a id="error-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Error Handling<a href="#error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Live API does not catch exceptions - they bubble up to the caller. This design enables crash recovery:</p>
<ol>
<li><strong>Process crashes</strong> → State persisted on disk</li>
<li><strong>Process restarts</strong> → State loaded from disk</li>
<li><strong>Execution resumes</strong> → No duplicate signals</li>
</ol>
<p>For custom error handling, wrap the generator in try-catch:</p>
<pre><code class="typescript"><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">for</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-4">context</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Process result</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Live trading error:&quot;</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">// Log, alert, restart, etc.</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#live-trading-api"><span>Live <wbr/>Trading API</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#liverun-method"><span>Live.run <wbr/>Method</span></a></li><li><ul><li><a href="#signature"><span>Signature</span></a></li><li><a href="#execution-characteristics"><span>Execution <wbr/>Characteristics</span></a></li><li><a href="#yielded-results"><span>Yielded <wbr/>Results</span></a></li><li><a href="#state-persistence-and-recovery"><span>State <wbr/>Persistence and <wbr/>Recovery</span></a></li></ul></li><li><a href="#livebackground-method"><span>Live.background <wbr/>Method</span></a></li><li><ul><li><a href="#signature-1"><span>Signature</span></a></li><li><a href="#implementation-details"><span>Implementation <wbr/>Details</span></a></li><li><a href="#cancellation-behavior"><span>Cancellation <wbr/>Behavior</span></a></li></ul></li><li><a href="#reporting-methods"><span>Reporting <wbr/>Methods</span></a></li><li><ul><li><a href="#livegetreport"><span>Live.get<wbr/>Report</span></a></li><li><a href="#livedump"><span>Live.dump</span></a></li><li><a href="#report-output-format"><span>Report <wbr/>Output <wbr/>Format</span></a></li></ul></li><li><a href="#result-type-system"><span>Result <wbr/>Type <wbr/>System</span></a></li><li><a href="#usage-patterns"><span>Usage <wbr/>Patterns</span></a></li><li><ul><li><a href="#basic-live-trading-loop"><span>Basic <wbr/>Live <wbr/>Trading <wbr/>Loop</span></a></li><li><a href="#background-execution-with-event-listeners"><span>Background <wbr/>Execution with <wbr/>Event <wbr/>Listeners</span></a></li><li><a href="#multi-symbol-live-trading"><span>Multi-<wbr/>Symbol <wbr/>Live <wbr/>Trading</span></a></li></ul></li><li><a href="#comparison-with-backtest-api"><span>Comparison with <wbr/>Backtest API</span></a></li><li><a href="#service-integration"><span>Service <wbr/>Integration</span></a></li><li><a href="#error-handling"><span>Error <wbr/>Handling</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
