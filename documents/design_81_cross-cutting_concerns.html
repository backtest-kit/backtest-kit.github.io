<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/81_cross-cutting_concerns | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_81_cross-cutting_concerns.html">design/81_cross-cutting_concerns</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="cross-cutting-concerns" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Cross-Cutting Concerns<a href="#cross-cutting-concerns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents system-wide concerns that affect multiple components across the backtest-kit architecture. These concerns include logging, error handling, and persistence, which are not specific to any single component but are fundamental to the system's operation.</p>
<p>For component-specific logging, error handling, or persistence behavior, see the individual component documentation in <a href="design_32_client_implementations.html">Client Implementations</a>, <a href="design_40_service_layer.html">Service Layer</a>, or <a href="design_48_signal_lifecycle.html">Signal Lifecycle</a>.</p>
<hr>
<a id="151-logging-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">15.1 Logging System<a href="#151-logging-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The logging system provides a standardized interface for recording diagnostic information across all components. It uses dependency injection to ensure all services have access to logging capabilities without tight coupling.</p>
<a id="ilogger-interface" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ILogger Interface<a href="#ilogger-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>ILogger</code> interface defines four severity levels for logging operations:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Severity</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>log()</code></td>
<td>General</td>
<td>Significant events or state changes</td>
</tr>
<tr>
<td><code>debug()</code></td>
<td>Diagnostic</td>
<td>Detailed information for troubleshooting</td>
</tr>
<tr>
<td><code>info()</code></td>
<td>Informational</td>
<td>High-level overview of system activity</td>
</tr>
<tr>
<td><code>warn()</code></td>
<td>Warning</td>
<td>Potentially problematic situations</td>
</tr>
</tbody>
</table>
<p><a href="">types.d.ts:52-77</a></p>
<a id="configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Configuration<a href="#configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Users configure the logger implementation via <code>setLogger()</code>:</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">setLogger</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;backtest-kit&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">customLogger</span><span class="hl-2"> = {</span><br/><span class="hl-2">  </span><span class="hl-1">log</span><span class="hl-6">:</span><span class="hl-2"> (</span><span class="hl-6">topic</span><span class="hl-2">, ...</span><span class="hl-6">args</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">`[LOG] </span><span class="hl-3">${</span><span class="hl-6">topic</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">, ...</span><span class="hl-6">args</span><span class="hl-2">),</span><br/><span class="hl-2">  </span><span class="hl-1">debug</span><span class="hl-6">:</span><span class="hl-2"> (</span><span class="hl-6">topic</span><span class="hl-2">, ...</span><span class="hl-6">args</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">debug</span><span class="hl-2">(</span><span class="hl-4">`[DEBUG] </span><span class="hl-3">${</span><span class="hl-6">topic</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">, ...</span><span class="hl-6">args</span><span class="hl-2">),</span><br/><span class="hl-2">  </span><span class="hl-1">info</span><span class="hl-6">:</span><span class="hl-2"> (</span><span class="hl-6">topic</span><span class="hl-2">, ...</span><span class="hl-6">args</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">info</span><span class="hl-2">(</span><span class="hl-4">`[INFO] </span><span class="hl-3">${</span><span class="hl-6">topic</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">, ...</span><span class="hl-6">args</span><span class="hl-2">),</span><br/><span class="hl-2">  </span><span class="hl-1">warn</span><span class="hl-6">:</span><span class="hl-2"> (</span><span class="hl-6">topic</span><span class="hl-2">, ...</span><span class="hl-6">args</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">warn</span><span class="hl-2">(</span><span class="hl-4">`[WARN] </span><span class="hl-3">${</span><span class="hl-6">topic</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">, ...</span><span class="hl-6">args</span><span class="hl-2">),</span><br/><span class="hl-2">};</span><br/><br/><span class="hl-1">setLogger</span><span class="hl-2">(</span><span class="hl-6">customLogger</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<p>The logger is stored in <code>LoggerService</code> and injected throughout the system via the dependency injection container.</p>
<p><a href="">src/function/setup.ts</a>, <a href="">src/lib/services/base/LoggerService.ts</a></p>
<a id="dependency-injection-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Dependency Injection Pattern<a href="#dependency-injection-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/81_Cross-Cutting_Concerns_0.svg" alt="Mermaid Diagram"></p>
<a id="logging-conventions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Logging Conventions<a href="#logging-conventions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each component logs with a consistent topic format:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Log Topic Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Global Services</td>
<td><code>{serviceName} {methodName}</code></td>
<td><code>&quot;strategyGlobalService tick&quot;</code></td>
</tr>
<tr>
<td>Connection Services</td>
<td><code>{serviceName} {methodName}</code></td>
<td><code>&quot;strategyConnectionService getStrategy&quot;</code></td>
</tr>
<tr>
<td>Client Implementations</td>
<td><code>{className} {methodName}</code></td>
<td><code>&quot;ClientStrategy tick&quot;</code></td>
</tr>
<tr>
<td>Persistence Layer</td>
<td><code>{className}.{methodName}</code></td>
<td><code>&quot;PersistBase.waitForInit&quot;</code></td>
</tr>
</tbody>
</table>
<p><a href="">src/client/ClientStrategy.ts</a>, <a href="">src/lib/services/global/StrategyGlobalService.ts</a>, <a href="">src/classes/Persist.ts:45-53</a></p>
<a id="usage-examples" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Usage Examples<a href="#usage-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">// Service layer logging</span><br/><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">loggerService</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-4">&quot;strategyGlobalService tick&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">symbol</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">strategyName</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">backtest</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Client layer logging with structured data</span><br/><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">params</span><span class="hl-2">.</span><span class="hl-6">logger</span><span class="hl-2">.</span><span class="hl-1">debug</span><span class="hl-2">(</span><span class="hl-4">&quot;ClientPartial profit level reached&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">symbol</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">signalId:</span><span class="hl-2"> </span><span class="hl-6">data</span><span class="hl-2">.</span><span class="hl-6">id</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">level</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">revenuePercent</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">backtest</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Persistence layer logging with entity context</span><br/><span class="hl-6">swarm</span><span class="hl-2">.</span><span class="hl-6">loggerService</span><span class="hl-2">.</span><span class="hl-1">debug</span><span class="hl-2">(</span><span class="hl-4">&quot;PersistBase.readValue&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-6">entityName:</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">entityName</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">entityId</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="152-error-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">15.2 Error Handling<a href="#152-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The error handling system distinguishes between recoverable and fatal errors, providing appropriate mechanisms for each scenario.</p>
<a id="error-classification" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Classification<a href="#error-classification" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/81_Cross-Cutting_Concerns_1.svg" alt="Mermaid Diagram"></p>
<a id="error-emitters" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Emitters<a href="#error-emitters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Emitter</th>
<th>Purpose</th>
<th>When to Use</th>
<th>Execution Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>errorEmitter</code></td>
<td>Recoverable errors</td>
<td>API failures, transient issues</td>
<td>Continues execution</td>
</tr>
<tr>
<td><code>exitEmitter</code></td>
<td>Fatal errors</td>
<td>System failures, unrecoverable states</td>
<td>Terminates execution</td>
</tr>
<tr>
<td><code>validationSubject</code></td>
<td>Validation errors</td>
<td>Risk rule violations</td>
<td>Rejects signal only</td>
</tr>
</tbody>
</table>
<p><a href="">src/config/emitters.ts:36-44</a>, <a href="">src/config/emitters.ts:109-112</a></p>
<a id="event-listeners" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Listeners<a href="#event-listeners" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">listenError</span><span class="hl-2">, </span><span class="hl-6">listenExit</span><span class="hl-2">, </span><span class="hl-6">listenValidation</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;backtest-kit&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Recoverable errors - execution continues</span><br/><span class="hl-1">listenError</span><span class="hl-2">((</span><span class="hl-6">error</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">error</span><span class="hl-2">(</span><span class="hl-4">&#39;Recoverable error:&#39;</span><span class="hl-2">, </span><span class="hl-6">error</span><span class="hl-2">.</span><span class="hl-6">message</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-0">// Log to monitoring, send non-critical alerts</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Fatal errors - execution terminates</span><br/><span class="hl-1">listenExit</span><span class="hl-2">((</span><span class="hl-6">error</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">error</span><span class="hl-2">(</span><span class="hl-4">&#39;FATAL ERROR:&#39;</span><span class="hl-2">, </span><span class="hl-6">error</span><span class="hl-2">.</span><span class="hl-6">message</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-0">// Send critical alerts, trigger restart logic</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Risk validation errors - signal rejected</span><br/><span class="hl-1">listenValidation</span><span class="hl-2">((</span><span class="hl-6">error</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">warn</span><span class="hl-2">(</span><span class="hl-4">&#39;Risk validation failed:&#39;</span><span class="hl-2">, </span><span class="hl-6">error</span><span class="hl-2">.</span><span class="hl-6">message</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-0">// Track rejection patterns, adjust parameters</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<a id="try-catch-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Try-Catch Patterns<a href="#try-catch-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="pattern-1-graceful-degradation-with-default-value" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Pattern 1: Graceful Degradation with Default Value<a href="#pattern-1-graceful-degradation-with-default-value" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">// From PersistBase - retry with fallback</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">success</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">trycatch</span><span class="hl-2">(</span><br/><span class="hl-2">  </span><span class="hl-1">retry</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-3">async</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2">.</span><span class="hl-1">unlink</span><span class="hl-2">(</span><span class="hl-6">filePath</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">;</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-8">BASE_UNLINK_RETRY_COUNT</span><span class="hl-2">,  </span><span class="hl-0">// 5 attempts</span><br/><span class="hl-2">    </span><span class="hl-8">BASE_UNLINK_RETRY_DELAY</span><span class="hl-2">   </span><span class="hl-0">// 1000ms between attempts</span><br/><span class="hl-2">  ),</span><br/><span class="hl-2">  {</span><br/><span class="hl-2">    </span><span class="hl-6">defaultValue:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">  </span><span class="hl-0">// Return false if all retries fail</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<p><a href="">src/classes/Persist.ts:155-177</a></p>
<a id="pattern-2-error-transformation" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Pattern 2: Error Transformation<a href="#pattern-2-error-transformation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">// From ClientExchange - transform to user-friendly message</span><br/><span class="hl-5">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">fileContent</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2">.</span><span class="hl-1">readFile</span><span class="hl-2">(</span><span class="hl-6">filePath</span><span class="hl-2">, </span><span class="hl-4">&#39;utf-8&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-8">JSON</span><span class="hl-2">.</span><span class="hl-1">parse</span><span class="hl-2">(</span><span class="hl-6">fileContent</span><span class="hl-2">);</span><br/><span class="hl-2">} </span><span class="hl-5">catch</span><span class="hl-2"> (</span><span class="hl-6">error</span><span class="hl-2">: </span><span class="hl-11">any</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">error</span><span class="hl-2">?.</span><span class="hl-6">code</span><span class="hl-2"> === </span><span class="hl-4">&#39;ENOENT&#39;</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><span class="hl-4">`Entity </span><span class="hl-3">${</span><span class="hl-3">this</span><span class="hl-9">.</span><span class="hl-6">entityName</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-3">${</span><span class="hl-6">entityId</span><span class="hl-3">}</span><span class="hl-4"> not found`</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Error</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-4">`Failed to read entity: </span><span class="hl-3">${</span><span class="hl-1">getErrorMessage</span><span class="hl-9">(</span><span class="hl-6">error</span><span class="hl-9">)</span><span class="hl-3">}</span><span class="hl-4">`</span><br/><span class="hl-2">  );</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p><a href="">src/classes/Persist.ts:258-272</a></p>
<a id="pattern-3-background-error-emission" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Pattern 3: Background Error Emission<a href="#pattern-3-background-error-emission" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">// Background execution wraps async generators</span><br/><span class="hl-5">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">generator</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-0">// Process result</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">} </span><span class="hl-5">catch</span><span class="hl-2"> (</span><span class="hl-6">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-6">errorEmitter</span><span class="hl-2">.</span><span class="hl-1">next</span><span class="hl-2">(</span><span class="hl-6">error</span><span class="hl-2">);  </span><span class="hl-0">// Emit recoverable error</span><br/><span class="hl-2">  </span><span class="hl-0">// Continue execution</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p><a href="">src/classes/Backtest.ts</a>, <a href="">src/classes/Live.ts</a></p>
<a id="validation-error-handling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Error Handling<a href="#validation-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/81_Cross-Cutting_Concerns_2.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="153-persistence-layer" class="tsd-anchor"></a><h2 class="tsd-anchor-link">15.3 Persistence Layer<a href="#153-persistence-layer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The persistence layer provides crash-safe storage for live trading state using atomic file operations and automatic validation.</p>
<a id="persistbase-abstract-class" class="tsd-anchor"></a><h3 class="tsd-anchor-link">PersistBase Abstract Class<a href="#persistbase-abstract-class" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>PersistBase</code> is the foundation for all persistence adapters, implementing CRUD operations with automatic directory management and corruption recovery.</p>
<p><img src="../media/81_Cross-Cutting_Concerns_3.svg" alt="Mermaid Diagram"></p>
<a id="directory-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Directory Structure<a href="#directory-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Adapter</th>
<th>Directory Pattern</th>
<th>Entity ID</th>
<th>Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PersistSignalAdapter</code></td>
<td><code>./dump/data/signal/{symbol}_{strategy}/</code></td>
<td><code>symbol</code></td>
<td><code>ISignalRow | null</code></td>
</tr>
<tr>
<td><code>PersistRiskAdapter</code></td>
<td><code>./dump/data/risk/{riskName}/</code></td>
<td><code>riskName</code></td>
<td><code>IRiskActivePosition[]</code></td>
</tr>
<tr>
<td><code>PersistScheduleAdapter</code></td>
<td><code>./dump/data/schedule/{symbol}_{strategy}/</code></td>
<td><code>symbol</code></td>
<td><code>IScheduledSignalRow[]</code></td>
</tr>
<tr>
<td><code>PersistPartialAdapter</code></td>
<td><code>./dump/data/partial/{symbol}_{strategy}/</code></td>
<td><code>symbol</code></td>
<td><code>Record&lt;signalId, IPartialData&gt;</code></td>
</tr>
</tbody>
</table>
<p><a href="">src/classes/Persist.ts:514-783</a></p>
<a id="atomic-write-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Atomic Write Pattern<a href="#atomic-write-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The atomic write pattern ensures that files are never left in a corrupted state, even if the process crashes during write operations.</p>
<p><img src="../media/81_Cross-Cutting_Concerns_4.svg" alt="Mermaid Diagram"></p>
<a id="initialization-and-validation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Initialization and Validation<a href="#initialization-and-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>On initialization, <code>PersistBase</code> validates all existing files and automatically removes corrupted ones:</p>
<pre><code class="typescript"><span class="hl-0">// From PersistBase.waitForInit implementation</span><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2">.</span><span class="hl-1">mkdir</span><span class="hl-2">(</span><span class="hl-6">self</span><span class="hl-2">.</span><span class="hl-6">_directory</span><span class="hl-2">, { </span><span class="hl-6">recursive:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2"> });</span><br/><br/><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">key</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">self</span><span class="hl-2">.</span><span class="hl-1">keys</span><span class="hl-2">()) {</span><br/><span class="hl-2">  </span><span class="hl-5">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">self</span><span class="hl-2">.</span><span class="hl-1">readValue</span><span class="hl-2">(</span><span class="hl-6">key</span><span class="hl-2">);  </span><span class="hl-0">// Validate by attempting to read</span><br/><span class="hl-2">  } </span><span class="hl-5">catch</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">filePath</span><span class="hl-2"> = </span><span class="hl-6">self</span><span class="hl-2">.</span><span class="hl-1">_getFilePath</span><span class="hl-2">(</span><span class="hl-6">key</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">error</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-4">`backtest-kit PersistBase found invalid document for filePath=</span><span class="hl-3">${</span><span class="hl-6">filePath</span><span class="hl-3">}</span><span class="hl-4">`</span><br/><span class="hl-2">    );</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Retry deletion up to 5 times with 1s delay</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">success</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">retry</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-3">async</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2">.</span><span class="hl-1">unlink</span><span class="hl-2">(</span><span class="hl-6">filePath</span><span class="hl-2">);</span><br/><span class="hl-2">        </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">;</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-8">BASE_UNLINK_RETRY_COUNT</span><span class="hl-2">,    </span><span class="hl-0">// 5</span><br/><span class="hl-2">      </span><span class="hl-8">BASE_UNLINK_RETRY_DELAY</span><span class="hl-2">     </span><span class="hl-0">// 1000ms</span><br/><span class="hl-2">    );</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (!</span><span class="hl-6">success</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">error</span><span class="hl-2">(</span><br/><span class="hl-2">        </span><span class="hl-4">`backtest-kit PersistBase failed to remove invalid document`</span><br/><span class="hl-2">      );</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p><a href="">src/classes/Persist.ts:132-153</a></p>
<a id="crash-recovery-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Crash Recovery Integration<a href="#crash-recovery-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/81_Cross-Cutting_Concerns_5.svg" alt="Mermaid Diagram"></p>
<a id="custom-persistence-adapters" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom Persistence Adapters<a href="#custom-persistence-adapters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Users can replace the default file-based persistence with custom implementations (e.g., Redis, MongoDB):</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-2"> { </span><span class="hl-6">PersistBase</span><span class="hl-2">, </span><span class="hl-6">PersistSignalAdapter</span><span class="hl-2"> } </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-4">&#39;backtest-kit&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-3">class</span><span class="hl-2"> </span><span class="hl-11">RedisPersist</span><span class="hl-2"> </span><span class="hl-3">extends</span><span class="hl-2"> </span><span class="hl-11">PersistBase</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">private</span><span class="hl-2"> </span><span class="hl-6">redis</span><span class="hl-2">: </span><span class="hl-11">RedisClient</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-3">constructor</span><span class="hl-2">(</span><span class="hl-6">entityName</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-6">baseDir</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-3">super</span><span class="hl-2">(</span><span class="hl-6">entityName</span><span class="hl-2">, </span><span class="hl-6">baseDir</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">redis</span><span class="hl-2"> = </span><span class="hl-1">createRedisClient</span><span class="hl-2">();</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-1">readValue</span><span class="hl-2">(</span><span class="hl-6">entityId</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">data</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">redis</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-3">this</span><span class="hl-9">.</span><span class="hl-6">entityName</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-3">${</span><span class="hl-6">entityId</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-8">JSON</span><span class="hl-2">.</span><span class="hl-1">parse</span><span class="hl-2">(</span><span class="hl-6">data</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-1">writeValue</span><span class="hl-2">(</span><span class="hl-6">entityId</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-6">entity</span><span class="hl-2">: </span><span class="hl-11">any</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">data</span><span class="hl-2"> = </span><span class="hl-8">JSON</span><span class="hl-2">.</span><span class="hl-1">stringify</span><span class="hl-2">(</span><span class="hl-6">entity</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">redis</span><span class="hl-2">.</span><span class="hl-1">set</span><span class="hl-2">(</span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-3">this</span><span class="hl-9">.</span><span class="hl-6">entityName</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-3">${</span><span class="hl-6">entityId</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">, </span><span class="hl-6">data</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-1">hasValue</span><span class="hl-2">(</span><span class="hl-6">entityId</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">redis</span><span class="hl-2">.</span><span class="hl-1">exists</span><span class="hl-2">(</span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-3">this</span><span class="hl-9">.</span><span class="hl-6">entityName</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-3">${</span><span class="hl-6">entityId</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Implement other required methods...</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Register custom adapter</span><br/><span class="hl-6">PersistSignalAdapter</span><span class="hl-2">.</span><span class="hl-1">usePersistSignalAdapter</span><span class="hl-2">(</span><span class="hl-6">RedisPersist</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<a id="persistence-adapter-comparison" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Persistence Adapter Comparison<a href="#persistence-adapter-comparison" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Adapter</th>
<th>Purpose</th>
<th>Write Frequency</th>
<th>Data Size</th>
<th>Backtest Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PersistSignalAdapter</code></td>
<td>Active signal state</td>
<td>Every signal state change</td>
<td>~1KB per signal</td>
<td>Disabled</td>
</tr>
<tr>
<td><code>PersistRiskAdapter</code></td>
<td>Portfolio positions</td>
<td>Every position add/remove</td>
<td>~5-50KB per risk profile</td>
<td>Disabled</td>
</tr>
<tr>
<td><code>PersistScheduleAdapter</code></td>
<td>Scheduled signals</td>
<td>Every scheduled signal update</td>
<td>~5-50KB per strategy</td>
<td>Disabled</td>
</tr>
<tr>
<td><code>PersistPartialAdapter</code></td>
<td>Profit/loss levels</td>
<td>Every level milestone</td>
<td>~1-5KB per signal</td>
<td>Disabled</td>
</tr>
</tbody>
</table>
<p>All adapters skip persistence in backtest mode (<code>backtest=true</code>) for performance, as crash recovery is unnecessary for historical simulations.</p>
<p><a href="">src/client/ClientPartial.ts:214-218</a>, <a href="">src/classes/Persist.ts</a></p>
<a id="async-iteration-support" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Async Iteration Support<a href="#async-iteration-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>PersistBase</code> implements async iteration for convenient data access:</p>
<pre><code class="typescript"><span class="hl-0">// Iterate all entities</span><br/><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">entity</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">persistAdapter</span><span class="hl-2">.</span><span class="hl-1">values</span><span class="hl-2">()) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">entity</span><span class="hl-2">);</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Iterate all keys</span><br/><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">key</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">persistAdapter</span><span class="hl-2">.</span><span class="hl-1">keys</span><span class="hl-2">()) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">key</span><span class="hl-2">);</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Filter entities</span><br/><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">entity</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">persistAdapter</span><span class="hl-2">.</span><span class="hl-1">filter</span><span class="hl-2">(</span><span class="hl-6">e</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">e</span><span class="hl-2">.</span><span class="hl-6">status</span><span class="hl-2"> === </span><span class="hl-4">&#39;active&#39;</span><span class="hl-2">)) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">entity</span><span class="hl-2">);</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Take first N entities</span><br/><span class="hl-5">for</span><span class="hl-2"> </span><span class="hl-5">await</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">entity</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">persistAdapter</span><span class="hl-2">.</span><span class="hl-1">take</span><span class="hl-2">(</span><span class="hl-7">10</span><span class="hl-2">)) {</span><br/><span class="hl-2">  </span><span class="hl-6">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-6">entity</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#cross-cutting-concerns"><span>Cross-<wbr/>Cutting <wbr/>Concerns</span></a><ul><li><a href="#151-logging-system"><span>15.1 <wbr/>Logging <wbr/>System</span></a></li><li><ul><li><a href="#ilogger-interface"><span>ILogger <wbr/>Interface</span></a></li><li><a href="#configuration"><span>Configuration</span></a></li><li><a href="#dependency-injection-pattern"><span>Dependency <wbr/>Injection <wbr/>Pattern</span></a></li><li><a href="#logging-conventions"><span>Logging <wbr/>Conventions</span></a></li><li><a href="#usage-examples"><span>Usage <wbr/>Examples</span></a></li></ul></li><li><a href="#152-error-handling"><span>15.2 <wbr/>Error <wbr/>Handling</span></a></li><li><ul><li><a href="#error-classification"><span>Error <wbr/>Classification</span></a></li><li><a href="#error-emitters"><span>Error <wbr/>Emitters</span></a></li><li><a href="#event-listeners"><span>Event <wbr/>Listeners</span></a></li><li><a href="#try-catch-patterns"><span>Try-<wbr/>Catch <wbr/>Patterns</span></a></li><li><ul><li><a href="#pattern-1-graceful-degradation-with-default-value"><span>Pattern 1: <wbr/>Graceful <wbr/>Degradation with <wbr/>Default <wbr/>Value</span></a></li><li><a href="#pattern-2-error-transformation"><span>Pattern 2: <wbr/>Error <wbr/>Transformation</span></a></li><li><a href="#pattern-3-background-error-emission"><span>Pattern 3: <wbr/>Background <wbr/>Error <wbr/>Emission</span></a></li></ul></li><li><a href="#validation-error-handling"><span>Validation <wbr/>Error <wbr/>Handling</span></a></li></ul></li><li><a href="#153-persistence-layer"><span>15.3 <wbr/>Persistence <wbr/>Layer</span></a></li><li><ul><li><a href="#persistbase-abstract-class"><span>Persist<wbr/>Base <wbr/>Abstract <wbr/>Class</span></a></li><li><a href="#directory-structure"><span>Directory <wbr/>Structure</span></a></li><li><a href="#atomic-write-pattern"><span>Atomic <wbr/>Write <wbr/>Pattern</span></a></li><li><a href="#initialization-and-validation"><span>Initialization and <wbr/>Validation</span></a></li><li><a href="#crash-recovery-integration"><span>Crash <wbr/>Recovery <wbr/>Integration</span></a></li><li><a href="#custom-persistence-adapters"><span>Custom <wbr/>Persistence <wbr/>Adapters</span></a></li><li><a href="#persistence-adapter-comparison"><span>Persistence <wbr/>Adapter <wbr/>Comparison</span></a></li><li><a href="#async-iteration-support"><span>Async <wbr/>Iteration <wbr/>Support</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
