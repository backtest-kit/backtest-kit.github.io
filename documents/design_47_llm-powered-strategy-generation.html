<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/47_llm-powered-strategy-generation | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_47_llm-powered-strategy-generation.html">design/47_llm-powered-strategy-generation</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="llm-powered-strategy-generation" class="tsd-anchor"></a><h1 class="tsd-anchor-link">LLM-Powered Strategy Generation<a href="#llm-powered-strategy-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This page documents the LLM-powered strategy generation system in Backtest Kit, which uses AI language models to automatically generate trading strategies from historical data and market analysis. The system collects data from configurable sources, builds conversation context for an LLM, generates strategy prompts, and outputs executable TypeScript code complete with strategies, walkers, and backtests.</p>
<p>For information about the Optimizer system architecture, see <a href="design_46_advanced-features.html">Optimizer System</a>. For details on code generation templates, see <a href="design_46_advanced-features.html">Code Generation &amp; Templates</a>.</p>
<p><strong>Key Capabilities:</strong></p>
<ul>
<li>Automated strategy creation from historical backtest data</li>
<li>Multi-timeframe market analysis (1m, 5m, 15m, 1h candles)</li>
<li>LLM conversation history building with pagination support</li>
<li>Complete executable code generation with Walker comparison</li>
<li>Debug logging of LLM conversations to <code>./dump/strategy/</code></li>
</ul>
<hr>
<a id="system-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">System Architecture<a href="#system-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The LLM strategy generation system consists of four main layers: schema registration, data collection, LLM interaction, and code generation. The <code>ClientOptimizer</code> orchestrates the entire workflow while <code>OptimizerTemplateService</code> provides the code generation templates.</p>
<p><img src="../media/47_llm-powered-strategy-generation_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Architecture Flow:</strong></p>
<ol>
<li><strong>Registration</strong>: User calls <code>addOptimizer()</code> with <code>IOptimizerSchema</code> configuration</li>
<li><strong>Validation</strong>: <code>OptimizerValidationService</code> checks for duplicate names</li>
<li><strong>Storage</strong>: <code>OptimizerSchemaService</code> stores schema in <code>ToolRegistry</code></li>
<li><strong>Instantiation</strong>: <code>OptimizerConnectionService</code> creates memoized <code>ClientOptimizer</code> instances</li>
<li><strong>Execution</strong>: <code>ClientOptimizer.getData()</code> fetches from sources, builds messages, calls LLM</li>
<li><strong>Generation</strong>: <code>ClientOptimizer.getCode()</code> uses templates to generate executable code</li>
<li><strong>Export</strong>: <code>ClientOptimizer.dump()</code> writes <code>.mjs</code> file to disk</li>
</ol>
<hr>
<a id="core-interfaces" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Interfaces<a href="#core-interfaces" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="ioptimizerschema-configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IOptimizerSchema Configuration<a href="#ioptimizerschema-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>IOptimizerSchema</code> interface defines the complete optimizer configuration, including data sources, time ranges, and custom generation logic.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>optimizerName</code></td>
<td><code>OptimizerName</code></td>
<td>Yes</td>
<td>Unique identifier for registry lookup</td>
</tr>
<tr>
<td><code>rangeTrain</code></td>
<td><code>IOptimizerRange[]</code></td>
<td>Yes</td>
<td>Training periods for strategy generation</td>
</tr>
<tr>
<td><code>rangeTest</code></td>
<td><code>IOptimizerRange</code></td>
<td>Yes</td>
<td>Testing period for Walker validation</td>
</tr>
<tr>
<td><code>source</code></td>
<td><code>Source[]</code></td>
<td>Yes</td>
<td>Data sources (functions or objects)</td>
</tr>
<tr>
<td><code>getPrompt</code></td>
<td><code>(symbol, messages) =&gt; string</code></td>
<td>Yes</td>
<td>Generates strategy prompt from messages</td>
</tr>
<tr>
<td><code>template</code></td>
<td><code>Partial&lt;IOptimizerTemplate&gt;</code></td>
<td>No</td>
<td>Custom template method overrides</td>
</tr>
<tr>
<td><code>callbacks</code></td>
<td><code>Partial&lt;IOptimizerCallbacks&gt;</code></td>
<td>No</td>
<td>Lifecycle event hooks</td>
</tr>
</tbody>
</table>
<a id="ioptimizerrange-time-periods" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IOptimizerRange Time Periods<a href="#ioptimizerrange-time-periods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">IOptimizerRange</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">note</span><span class="hl-1">?: </span><span class="hl-11">string</span><span class="hl-1">;        </span><span class="hl-5">// Optional description</span><br/><span class="hl-1">  </span><span class="hl-4">startDate</span><span class="hl-1">: </span><span class="hl-11">Date</span><span class="hl-1">;      </span><span class="hl-5">// Inclusive start</span><br/><span class="hl-1">  </span><span class="hl-4">endDate</span><span class="hl-1">: </span><span class="hl-11">Date</span><span class="hl-1">;        </span><span class="hl-5">// Inclusive end</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Multiple Training Ranges</strong>: Each range in <code>rangeTrain</code> generates a separate strategy variant. For example, configuring three ranges produces three strategies that are compared in the generated Walker.</p>
<a id="ioptimizersource-data-fetching" class="tsd-anchor"></a><h3 class="tsd-anchor-link">IOptimizerSource Data Fetching<a href="#ioptimizersource-data-fetching" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Data sources can be simple functions or full configuration objects with custom message formatters:</p>
<p><img src="../media/47_llm-powered-strategy-generation_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Simple Function Source</strong>:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-0">source</span><span class="hl-1">: </span><span class="hl-11">IOptimizerSourceFn</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Fetch and return data array</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">;</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><strong>Full Configuration Source</strong>:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">source</span><span class="hl-1">: </span><span class="hl-11">IOptimizerSource</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-results&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Historical performance data&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">fetch</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">args</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> { </span><span class="hl-5">/* ... */</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">user</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`Analyze these </span><span class="hl-7">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> backtests...`</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">assistant</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;Analysis complete&quot;</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="data-collection-pipeline" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Data Collection Pipeline<a href="#data-collection-pipeline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The data collection pipeline fetches data from all sources across all training ranges, building a comprehensive conversation history for the LLM. Pagination is handled automatically via <code>functools-kit</code>.</p>
<p><img src="../media/47_llm-powered-strategy-generation_2.svg" alt="Mermaid Diagram"></p>
<a id="pagination-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pagination Implementation<a href="#pagination-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The system uses <code>functools-kit</code> utilities for automatic pagination with deduplication:</p>
<p><strong>Pagination Constants</strong>:</p>
<ul>
<li><code>ITERATION_LIMIT = 25</code> - Records per page <code>src/client/ClientOptimizer.ts:19</code></li>
</ul>
<p><strong>Pagination Flow</strong>:</p>
<ol>
<li><code>iterateDocuments()</code> - Creates async iterator with <code>limit</code> and <code>offset</code></li>
<li><code>distinctDocuments()</code> - Deduplicates by <code>data.id</code> field</li>
<li><code>resolveDocuments()</code> - Materializes all pages into array</li>
</ol>
<a id="message-building" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Message Building<a href="#message-building" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For each source in each training range, the system creates a user-assistant message pair:</p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Action</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Fetch all data from source</td>
<td><code>Data[]</code> with pagination</td>
</tr>
<tr>
<td>2</td>
<td>Call <code>callbacks.onSourceData()</code></td>
<td>Monitoring hook (optional)</td>
</tr>
<tr>
<td>3</td>
<td>Format user message</td>
<td><code>user(symbol, data, name)</code> → string</td>
</tr>
<tr>
<td>4</td>
<td>Format assistant message</td>
<td><code>assistant(symbol, data, name)</code> → string</td>
</tr>
<tr>
<td>5</td>
<td>Append to message list</td>
<td><code>MessageModel[]</code></td>
</tr>
<tr>
<td>6</td>
<td>Call <code>getPrompt()</code> after all sources</td>
<td>Strategy description string</td>
</tr>
</tbody>
</table>
<p><strong>Default Message Formatters</strong>: If source doesn't provide custom <code>user()</code> or <code>assistant()</code> functions, defaults delegate to template methods:</p>
<ul>
<li><code>src/client/ClientOptimizer.ts:34-41</code> - <code>DEFAULT_USER_FN</code></li>
<li><code>src/client/ClientOptimizer.ts:43-60</code> - <code>DEFAULT_ASSISTANT_FN</code></li>
</ul>
<hr>
<a id="llm-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">LLM Integration<a href="#llm-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The generated code integrates with Ollama LLM for real-time strategy decisions. The template system creates two LLM helper functions: <code>text()</code> for narrative analysis and <code>json()</code> for structured signal generation.</p>
<a id="llm-helper-functions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">LLM Helper Functions<a href="#llm-helper-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/47_llm-powered-strategy-generation_3.svg" alt="Mermaid Diagram"></p>
<a id="text-template" class="tsd-anchor"></a><h3 class="tsd-anchor-link">text() Template<a href="#text-template" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>text()</code> function generates narrative market analysis with fundamental recommendations:</p>
<p><strong>Template Location</strong>: <code>src/lib/services/template/OptimizerTemplateService.ts:555-612</code></p>
<p><strong>Key Features</strong>:</p>
<ul>
<li>Uses <code>deepseek-v3.1:671b</code> model</li>
<li>System prompt: &quot;Write strategy with no extra text, ready for copy-paste&quot;</li>
<li>User prompt asks for support/resistance analysis, entry points, R/R ratios</li>
<li>Escapes special characters to prevent code injection</li>
<li>Returns plain text analysis</li>
</ul>
<p><strong>Generated Function Structure</strong>:</p>
<pre><code class="typescript"><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">text</span><span class="hl-1">(</span><span class="hl-4">messages</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ollama</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Ollama</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">host:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://ollama.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">headers:</span><span class="hl-1"> { </span><span class="hl-4">Authorization:</span><span class="hl-1"> </span><span class="hl-2">`Bearer </span><span class="hl-7">${</span><span class="hl-4">process</span><span class="hl-9">.</span><span class="hl-4">env</span><span class="hl-9">.</span><span class="hl-8">OLLAMA_API_KEY</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1"> }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">response</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">ollama</span><span class="hl-1">.</span><span class="hl-0">chat</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">model:</span><span class="hl-1"> </span><span class="hl-2">&quot;deepseek-v3.1:671b&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">messages:</span><span class="hl-1"> [</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;system&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">&quot;Strategic recommendation, no greetings&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      ...</span><span class="hl-4">messages</span><span class="hl-1">,</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">&quot;Market analysis for ${symbol}&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">escapedContent</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="json-template-with-signal-schema" class="tsd-anchor"></a><h3 class="tsd-anchor-link">json() Template with Signal Schema<a href="#json-template-with-signal-schema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>json()</code> function generates structured trading signals using JSON schema validation:</p>
<p><strong>Template Location</strong>: <code>src/lib/services/template/OptimizerTemplateService.ts:614-732</code></p>
<p><strong>Signal Schema Definition</strong>:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Enum/Range</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>position</code></td>
<td>string</td>
<td>Yes</td>
<td><code>wait</code>, <code>long</code>, <code>short</code></td>
<td>Trade direction</td>
</tr>
<tr>
<td><code>note</code></td>
<td>string</td>
<td>Yes</td>
<td>-</td>
<td>Strategy explanation</td>
</tr>
<tr>
<td><code>priceOpen</code></td>
<td>number</td>
<td>Conditional</td>
<td>&gt; 0</td>
<td>Entry price (if not <code>wait</code>)</td>
</tr>
<tr>
<td><code>priceTakeProfit</code></td>
<td>number</td>
<td>Conditional</td>
<td>&gt; 0</td>
<td>Target price (if not <code>wait</code>)</td>
</tr>
<tr>
<td><code>priceStopLoss</code></td>
<td>number</td>
<td>Conditional</td>
<td>&gt; 0</td>
<td>Stop price (if not <code>wait</code>)</td>
</tr>
<tr>
<td><code>minuteEstimatedTime</code></td>
<td>integer</td>
<td>Conditional</td>
<td>1-360</td>
<td>Duration (if not <code>wait</code>)</td>
</tr>
</tbody>
</table>
<p><strong>JSON Schema Enforcement</strong>:</p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-13">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;object&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-13">&quot;required&quot;</span><span class="hl-1">: [</span><span class="hl-2">&quot;position&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;note&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-13">&quot;properties&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;position&quot;</span><span class="hl-1">: { </span><span class="hl-13">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;string&quot;</span><span class="hl-1">, </span><span class="hl-13">&quot;enum&quot;</span><span class="hl-1">: [</span><span class="hl-2">&quot;wait&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;short&quot;</span><span class="hl-1">] },</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;note&quot;</span><span class="hl-1">: { </span><span class="hl-13">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;string&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;priceOpen&quot;</span><span class="hl-1">: { </span><span class="hl-13">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">, </span><span class="hl-13">&quot;minimum&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;priceTakeProfit&quot;</span><span class="hl-1">: { </span><span class="hl-13">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">, </span><span class="hl-13">&quot;minimum&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;priceStopLoss&quot;</span><span class="hl-1">: { </span><span class="hl-13">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">, </span><span class="hl-13">&quot;minimum&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;minuteEstimatedTime&quot;</span><span class="hl-1">: { </span><span class="hl-13">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;integer&quot;</span><span class="hl-1">, </span><span class="hl-13">&quot;minimum&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-13">&quot;maximum&quot;</span><span class="hl-1">: </span><span class="hl-6">360</span><span class="hl-1"> }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-13">&quot;if&quot;</span><span class="hl-1">: { </span><span class="hl-13">&quot;properties&quot;</span><span class="hl-1">: { </span><span class="hl-13">&quot;position&quot;</span><span class="hl-1">: { </span><span class="hl-13">&quot;not&quot;</span><span class="hl-1">: { </span><span class="hl-13">&quot;const&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;wait&quot;</span><span class="hl-1"> } } } },</span><br/><span class="hl-1">  </span><span class="hl-13">&quot;then&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;required&quot;</span><span class="hl-1">: [</span><span class="hl-2">&quot;priceOpen&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;priceTakeProfit&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;priceStopLoss&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;minuteEstimatedTime&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Generated Function Structure</strong>:</p>
<pre><code class="typescript"><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">json</span><span class="hl-1">(</span><span class="hl-4">messages</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">ollama</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Ollama</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">host:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://ollama.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">headers:</span><span class="hl-1"> { </span><span class="hl-4">Authorization:</span><span class="hl-1"> </span><span class="hl-2">`Bearer </span><span class="hl-7">${</span><span class="hl-4">process</span><span class="hl-9">.</span><span class="hl-4">env</span><span class="hl-9">.</span><span class="hl-8">OLLAMA_API_KEY</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1"> }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">response</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">ollama</span><span class="hl-1">.</span><span class="hl-0">chat</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">model:</span><span class="hl-1"> </span><span class="hl-2">&quot;deepseek-v3.1:671b&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">messages:</span><span class="hl-1"> [</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;system&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">&quot;Analyze strategy and return signal&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      ...</span><span class="hl-4">messages</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-4">format:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;json&quot;</span><span class="hl-1">, </span><span class="hl-4">schema:</span><span class="hl-1"> </span><span class="hl-4">signalSchema</span><span class="hl-1"> }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">.</span><span class="hl-4">content</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="debug-logging---dumpjson" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Debug Logging - dumpJson()<a href="#debug-logging---dumpjson" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>dumpJson()</code> function saves LLM conversations and results to <code>./dump/strategy/{resultId}/</code>:</p>
<p><strong>Generated Files</strong>:</p>
<ol>
<li><code>00_system_prompt.md</code> - System messages and output summary</li>
<li><code>01_user_message.md</code>, <code>02_user_message.md</code>, etc. - User inputs</li>
<li><code>0X_llm_output.md</code> - Final LLM response</li>
</ol>
<p><strong>Warning System</strong>: Logs warning if user message exceeds <code>WARN_KB = 100</code> kilobytes</p>
<hr>
<a id="strategy-generation-workflow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Strategy Generation Workflow<a href="#strategy-generation-workflow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The complete workflow from configuration to executable code involves multiple stages: data fetching, message building, prompt generation, and code assembly.</p>
<p><img src="../media/47_llm-powered-strategy-generation_4.svg" alt="Mermaid Diagram"></p>
<a id="phase-1-registration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Phase 1: Registration<a href="#phase-1-registration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Entry Point</strong>: <code>addOptimizer(schema: IOptimizerSchema)</code> <code>src/index.ts</code></p>
<p><strong>Validation Steps</strong>:</p>
<ol>
<li>Check for duplicate <code>optimizerName</code> <code>src/lib/services/validation/OptimizerValidationService.ts:25-34</code></li>
<li>Validate schema structure <code>src/lib/services/schema/OptimizerSchemaService.ts:41-67</code></li>
<li>Store in <code>ToolRegistry</code> <code>src/lib/services/schema/OptimizerSchemaService.ts:28-32</code></li>
</ol>
<a id="phase-2-data-collection" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Phase 2: Data Collection<a href="#phase-2-data-collection" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Entry Point</strong>: <code>Optimizer.getData(symbol, { optimizerName })</code> <code>src/classes/Optimizer.ts:42-59</code></p>
<p><strong>Execution Flow</strong>:</p>
<ol>
<li><code>OptimizerGlobalService.getData()</code> validates and delegates <code>src/lib/services/global/OptimizerGlobalService.ts:37-50</code></li>
<li><code>OptimizerConnectionService.getData()</code> retrieves memoized instance <code>src/lib/services/connection/OptimizerConnectionService.ts:122-132</code></li>
<li><code>ClientOptimizer.getData()</code> executes collection logic <code>src/client/ClientOptimizer.ts:99-215</code></li>
</ol>
<p><strong>Inner Loops</strong>:</p>
<ul>
<li><strong>Outer Loop</strong>: Iterate through <code>rangeTrain</code> array</li>
<li><strong>Inner Loop</strong>: Iterate through <code>source</code> array</li>
<li>For each (range, source) pair:
<ul>
<li>Fetch data with pagination</li>
<li>Format user and assistant messages</li>
<li>Append to message list</li>
</ul>
</li>
<li>After each range:
<ul>
<li>Call <code>getPrompt(symbol, messages)</code></li>
<li>Store <code>IOptimizerStrategy</code> object</li>
</ul>
</li>
</ul>
<p><strong>Progress Events</strong>: Emits <code>ProgressOptimizerContract</code> via <code>progressOptimizerEmitter</code> <code>src/client/ClientOptimizer.ts:108-114</code></p>
<a id="phase-3-code-generation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Phase 3: Code Generation<a href="#phase-3-code-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Entry Point</strong>: <code>Optimizer.getCode(symbol, { optimizerName })</code> <code>src/classes/Optimizer.ts:70-87</code></p>
<p><strong>Template Merging</strong>: <code>OptimizerConnectionService</code> merges custom templates with defaults <code>src/lib/services/connection/OptimizerConnectionService.ts:59-112</code></p>
<p><strong>Code Assembly Order</strong>:</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>Template Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code>getTopBanner()</code></td>
<td>Shebang, imports, constants</td>
</tr>
<tr>
<td>2</td>
<td><code>getJsonDumpTemplate()</code></td>
<td>Debug logging helper</td>
</tr>
<tr>
<td>3</td>
<td><code>getTextTemplate()</code></td>
<td>LLM text generation</td>
</tr>
<tr>
<td>4</td>
<td><code>getJsonTemplate()</code></td>
<td>LLM JSON signal generation</td>
</tr>
<tr>
<td>5</td>
<td><code>getExchangeTemplate()</code></td>
<td>CCXT Binance configuration</td>
</tr>
<tr>
<td>6</td>
<td><code>getFrameTemplate()</code> (loop)</td>
<td>Train and test timeframes</td>
</tr>
<tr>
<td>7</td>
<td><code>getStrategyTemplate()</code> (loop)</td>
<td>Strategies from prompt</td>
</tr>
<tr>
<td>8</td>
<td><code>getWalkerTemplate()</code></td>
<td>Strategy comparison</td>
</tr>
<tr>
<td>9</td>
<td><code>getLauncherTemplate()</code></td>
<td>Event listeners and execution</td>
</tr>
</tbody>
</table>
<p><strong>Prefix Generation</strong>: Uses random prefix to prevent naming conflicts <code>src/client/ClientOptimizer.ts:22</code>, <code>src/client/ClientOptimizer.ts:228</code></p>
<a id="phase-4-file-export" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Phase 4: File Export<a href="#phase-4-file-export" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Entry Point</strong>: <code>Optimizer.dump(symbol, { optimizerName }, path)</code> <code>src/classes/Optimizer.ts:100-120</code></p>
<p><strong>File Operations</strong>:</p>
<ol>
<li>Generate complete code via <code>getCode()</code></li>
<li>Create output directory with <code>mkdir(path, { recursive: true })</code></li>
<li>Write file: <code>{optimizerName}_{symbol}.mjs</code></li>
<li>Call <code>callbacks.onDump()</code> if provided</li>
</ol>
<p><strong>Default Path</strong>: Current working directory (<code>./</code>)</p>
<hr>
<a id="generated-code-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Generated Code Structure<a href="#generated-code-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The generated <code>.mjs</code> file is a complete, executable Node.js script that includes all necessary components for strategy comparison. The structure follows a consistent 9-section format.</p>
<a id="complete-file-anatomy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Complete File Anatomy<a href="#complete-file-anatomy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/47_llm-powered-strategy-generation_5.svg" alt="Mermaid Diagram"></p>
<a id="multi-timeframe-strategy-template" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Multi-Timeframe Strategy Template<a href="#multi-timeframe-strategy-template" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each generated strategy performs four-level timeframe analysis before calling the LLM:</p>
<p><strong>Timeframe Cascade</strong>:</p>
<ol>
<li><strong>Medium-term (1h)</strong>: 24 candles for trend context</li>
<li><strong>Short-term (15m)</strong>: 24 candles for momentum</li>
<li><strong>Main-term (5m)</strong>: 24 candles for signal generation</li>
<li><strong>Micro-term (1m)</strong>: 30 candles for precise entry</li>
</ol>
<p><strong>Message Building</strong>:</p>
<pre><code class="typescript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;${prefix}_strategy-1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">messages</span><span class="hl-1"> = [];</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Load all timeframes</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">microTermCandles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">, </span><span class="hl-6">30</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">mainTermCandles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">shortTermCandles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">mediumTermCandles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Helper to format candles</span><br/><span class="hl-1">    </span><span class="hl-7">function</span><span class="hl-1"> </span><span class="hl-0">formatCandles</span><span class="hl-1">(</span><span class="hl-4">candles</span><span class="hl-1">, </span><span class="hl-4">timeframe</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">candles</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-4">c</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><br/><span class="hl-1">        </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-7">new</span><span class="hl-9"> </span><span class="hl-0">Date</span><span class="hl-9">(</span><span class="hl-4">c</span><span class="hl-9">.</span><span class="hl-4">timestamp</span><span class="hl-9">).</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2">[</span><span class="hl-7">${</span><span class="hl-4">timeframe</span><span class="hl-7">}</span><span class="hl-2">]: O:</span><span class="hl-7">${</span><span class="hl-4">c</span><span class="hl-9">.</span><span class="hl-4">open</span><span class="hl-7">}</span><span class="hl-2"> H:</span><span class="hl-7">${</span><span class="hl-4">c</span><span class="hl-9">.</span><span class="hl-4">high</span><span class="hl-7">}</span><span class="hl-2"> L:</span><span class="hl-7">${</span><span class="hl-4">c</span><span class="hl-9">.</span><span class="hl-4">low</span><span class="hl-7">}</span><span class="hl-2"> C:</span><span class="hl-7">${</span><span class="hl-4">c</span><span class="hl-9">.</span><span class="hl-4">close</span><span class="hl-7">}</span><span class="hl-2"> V:</span><span class="hl-7">${</span><span class="hl-4">c</span><span class="hl-9">.</span><span class="hl-4">volume</span><span class="hl-7">}</span><span class="hl-2">`</span><br/><span class="hl-1">      ).</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Message 1: Medium-term trend</span><br/><span class="hl-1">    </span><span class="hl-4">messages</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-14">\n</span><span class="hl-2">Analyze 1h candles:</span><span class="hl-14">\n\n</span><span class="hl-7">${</span><span class="hl-0">formatCandles</span><span class="hl-9">(</span><span class="hl-4">mediumTermCandles</span><span class="hl-9">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1"> },</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;assistant&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">&quot;1h trend analyzed&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Message 2: Short-term trend</span><br/><span class="hl-1">    </span><span class="hl-4">messages</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">`Analyze 15m candles:</span><span class="hl-14">\n\n</span><span class="hl-7">${</span><span class="hl-0">formatCandles</span><span class="hl-9">(</span><span class="hl-4">shortTermCandles</span><span class="hl-9">, </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1"> },</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;assistant&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">&quot;15m trend analyzed&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Message 3: Main timeframe</span><br/><span class="hl-1">    </span><span class="hl-4">messages</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">`Analyze 5m candles:</span><span class="hl-14">\n\n</span><span class="hl-7">${</span><span class="hl-0">formatCandles</span><span class="hl-9">(</span><span class="hl-4">mainTermCandles</span><span class="hl-9">, </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1"> },</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;assistant&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m timeframe analyzed&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Message 4: Micro-structure</span><br/><span class="hl-1">    </span><span class="hl-4">messages</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">`Analyze 1m candles:</span><span class="hl-14">\n\n</span><span class="hl-7">${</span><span class="hl-0">formatCandles</span><span class="hl-9">(</span><span class="hl-4">microTermCandles</span><span class="hl-9">, </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1"> },</span><br/><span class="hl-1">      { </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;assistant&quot;</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">&quot;1m microstructure analyzed&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Message 5: Request signal</span><br/><span class="hl-1">    </span><span class="hl-4">messages</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">content:</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Analyze all timeframes and generate signal per strategy.&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">escapedPrompt</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,  </span><span class="hl-5">// User&#39;s strategy logic</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;If signals contradict or trend weak then position: wait&quot;</span><br/><span class="hl-1">      ].</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">resultId</span><span class="hl-1"> = </span><span class="hl-0">uuid</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">json</span><span class="hl-1">(</span><span class="hl-4">messages</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">dumpJson</span><span class="hl-1">(</span><span class="hl-4">resultId</span><span class="hl-1">, </span><span class="hl-4">messages</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> = </span><span class="hl-4">resultId</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="walker-comparison-setup" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Walker Comparison Setup<a href="#walker-comparison-setup" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The generated Walker compares all strategies on the test frame:</p>
<p><strong>Configuration</strong>:</p>
<pre><code class="typescript"><span class="hl-0">addWalker</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;${prefix}_walker&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">exchangeName:</span><span class="hl-1"> </span><span class="hl-2">&quot;${prefix}_exchange&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">frameName:</span><span class="hl-1"> </span><span class="hl-2">&quot;${prefix}_test_frame&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strategies:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;${prefix}_strategy-1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;${prefix}_strategy-2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;${prefix}_strategy-3&quot;</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Launcher with Event Listeners</strong>:</p>
<pre><code class="typescript"><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">background</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">walkerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;${prefix}_walker&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">listenSignalBacktest</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">listenBacktestProgress</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Progress: </span><span class="hl-7">${</span><span class="hl-9">(</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">progress</span><span class="hl-9"> </span><span class="hl-1">*</span><span class="hl-9"> </span><span class="hl-6">100</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Processed: </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">processedFrames</span><span class="hl-7">}</span><span class="hl-2"> / </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">totalFrames</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">listenWalkerProgress</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Progress: </span><span class="hl-7">${</span><span class="hl-9">(</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">progress</span><span class="hl-9"> </span><span class="hl-1">*</span><span class="hl-9"> </span><span class="hl-6">100</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">processedStrategies</span><span class="hl-7">}</span><span class="hl-2"> / </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">totalStrategies</span><span class="hl-7">}</span><span class="hl-2"> strategies`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Walker: </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">walkerName</span><span class="hl-7">}</span><span class="hl-2">, Symbol: </span><span class="hl-7">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">listenWalkerComplete</span><span class="hl-1">((</span><span class="hl-4">results</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Walker completed:&quot;</span><span class="hl-1">, </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-4">bestStrategy</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">Walker</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-4">walkerName</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">listenDoneBacktest</span><span class="hl-1">((</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Backtest completed:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">listenError</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Error occurred:&quot;</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="configuration-examples" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Configuration Examples<a href="#configuration-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="basic-optimizer-configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Optimizer Configuration<a href="#basic-optimizer-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Minimal configuration with single source and training range:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addOptimizer</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addOptimizer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;simple-optimizer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Training period</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTrain:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Bull market 2024&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-03-31&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Testing period</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTest:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Validation period&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-04-01&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-06-30&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Single data source</span><br/><span class="hl-1">  </span><span class="hl-4">source:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-7">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Fetch historical backtest results</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">results</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchBacktests</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">startDate</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">endDate</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">limit</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">offset</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">r</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">        </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">pnl:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">winRate:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">winRate</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">sharpe:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">sharpe</span><br/><span class="hl-1">      }));</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Generate strategy prompt</span><br/><span class="hl-1">  </span><span class="hl-0">getPrompt</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">messages</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`Based on the analysis above, trade </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> with conservative risk management`</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="advanced-configuration-with-custom-templates" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Advanced Configuration with Custom Templates<a href="#advanced-configuration-with-custom-templates" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Full-featured configuration with multiple sources, custom messages, and template overrides:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">addOptimizer</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">addOptimizer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;advanced-optimizer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Multiple training ranges for strategy variants</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTrain:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Bull market&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-03-31&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Sideways market&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2023-06-01&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2023-09-30&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Bear market&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2022-05-01&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2022-08-31&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-4">rangeTest:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-04-01&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-06-30&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Multiple data sources</span><br/><span class="hl-1">  </span><span class="hl-4">source:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-5">// Source 1: Backtest results</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-results&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">note:</span><span class="hl-1"> </span><span class="hl-2">&quot;Historical performance data&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">fetch</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">args</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">results</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchBacktests</span><span class="hl-1">(</span><span class="hl-4">args</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">r</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">strategy:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">pnl:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">totalPnl</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">trades:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">closedSignals</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">winRate:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">statistics</span><span class="hl-1">.</span><span class="hl-4">winRate</span><br/><span class="hl-1">        }));</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">user</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> [</span><br/><span class="hl-1">          </span><span class="hl-2">`Historical backtest results for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">:`</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-7">null</span><span class="hl-1">, </span><span class="hl-6">2</span><span class="hl-1">),</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">`Total strategies tested: </span><span class="hl-7">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2">`</span><br/><span class="hl-1">        ].</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">assistant</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgPnl</span><span class="hl-1"> = </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">d</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">d</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`Analyzed </span><span class="hl-7">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> strategies. Average PNL: </span><span class="hl-7">${</span><span class="hl-4">avgPnl</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Source 2: Market news</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;market-sentiment&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">fetch</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">news</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchNews</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">news</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">n</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">n</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">date:</span><span class="hl-1"> </span><span class="hl-4">n</span><span class="hl-1">.</span><span class="hl-4">publishedAt</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">headline:</span><span class="hl-1"> </span><span class="hl-4">n</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">sentiment:</span><span class="hl-1"> </span><span class="hl-4">n</span><span class="hl-1">.</span><span class="hl-4">sentimentScore</span><br/><span class="hl-1">        }));</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">user</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`Recent news for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">:</span><span class="hl-14">\n</span><span class="hl-7">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-0">map</span><span class="hl-9">(</span><span class="hl-4">n</span><span class="hl-9"> </span><span class="hl-7">=&gt;</span><span class="hl-9"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">n</span><span class="hl-9">.</span><span class="hl-4">date</span><span class="hl-7">}</span><span class="hl-2">: </span><span class="hl-7">${</span><span class="hl-4">n</span><span class="hl-9">.</span><span class="hl-4">headline</span><span class="hl-7">}</span><span class="hl-2"> (sentiment: </span><span class="hl-7">${</span><span class="hl-4">n</span><span class="hl-9">.</span><span class="hl-4">sentiment</span><span class="hl-7">}</span><span class="hl-2">)`</span><span class="hl-9">).</span><span class="hl-0">join</span><span class="hl-9">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">&quot;</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">assistant</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;News sentiment analyzed&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Source 3: Technical indicators</span><br/><span class="hl-1">    </span><span class="hl-7">async</span><span class="hl-1"> ({ </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">indicators</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">calculateIndicators</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">, </span><span class="hl-4">limit</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">indicators</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">i</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">        </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">_</span><span class="hl-7">${</span><span class="hl-4">i</span><span class="hl-9">.</span><span class="hl-4">timestamp</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">i</span><span class="hl-1">.</span><span class="hl-4">timestamp</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">rsi:</span><span class="hl-1"> </span><span class="hl-4">i</span><span class="hl-1">.</span><span class="hl-4">rsi</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">macd:</span><span class="hl-1"> </span><span class="hl-4">i</span><span class="hl-1">.</span><span class="hl-4">macd</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">bbands:</span><span class="hl-1"> </span><span class="hl-4">i</span><span class="hl-1">.</span><span class="hl-4">bbands</span><br/><span class="hl-1">      }));</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// LLM prompt generation</span><br/><span class="hl-1">  </span><span class="hl-0">getPrompt</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">messages</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Could call text() here for LLM-generated prompt</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> [</span><br/><span class="hl-1">      </span><span class="hl-2">`Trade </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2"> using the following strategy:`</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;1. Confirm trend direction across all timeframes&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;2. Wait for RSI divergence on 15m timeframe&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;3. Enter on 5m momentum confirmation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;4. Set stop-loss at recent structure level&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;5. Target 2:1 risk-reward minimum&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Risk Management:&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;- Maximum 2% risk per trade&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;- No more than 3 concurrent positions&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;- Close all positions if daily loss exceeds 5%&quot;</span><br/><span class="hl-1">    ].</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Custom template overrides</span><br/><span class="hl-1">  </span><span class="hl-4">template:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Override strategy template to use different intervals</span><br/><span class="hl-1">    </span><span class="hl-0">getStrategyTemplate</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">strategyName</span><span class="hl-1">, </span><span class="hl-4">interval</span><span class="hl-1">, </span><span class="hl-4">prompt</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-2">`addStrategy({`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`  strategyName: &quot;</span><span class="hl-7">${</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2">&quot;,`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`  interval: &quot;15m&quot;,  // Custom: 15m instead of 5m`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`  getSignal: async (symbol) =&gt; {`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`    // Custom multi-timeframe logic`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`    const candles4h = await getCandles(symbol, &quot;4h&quot;, 24);`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`    const candles1h = await getCandles(symbol, &quot;1h&quot;, 48);`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`    const candles15m = await getCandles(symbol, &quot;15m&quot;, 96);`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`    // ... custom implementation`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`  }`</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">`});`</span><br/><span class="hl-1">      ].</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Lifecycle callbacks</span><br/><span class="hl-1">  </span><span class="hl-4">callbacks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onSourceData</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">sourceName</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">startDate</span><span class="hl-1">, </span><span class="hl-4">endDate</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Fetched </span><span class="hl-7">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> rows from </span><span class="hl-7">${</span><span class="hl-4">sourceName</span><span class="hl-7">}</span><span class="hl-2"> for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Period: </span><span class="hl-7">${</span><span class="hl-4">startDate</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2"> to </span><span class="hl-7">${</span><span class="hl-4">endDate</span><span class="hl-9">.</span><span class="hl-0">toISOString</span><span class="hl-9">()</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onData</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">strategyData</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated </span><span class="hl-7">${</span><span class="hl-4">strategyData</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> strategy variants for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">strategyData</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-4">s</span><span class="hl-1">, </span><span class="hl-4">i</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Strategy </span><span class="hl-7">${</span><span class="hl-4">i</span><span class="hl-9"> </span><span class="hl-1">+</span><span class="hl-9"> </span><span class="hl-6">1</span><span class="hl-7">}</span><span class="hl-2">: </span><span class="hl-7">${</span><span class="hl-4">s</span><span class="hl-9">.</span><span class="hl-4">messages</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> messages, prompt length: </span><span class="hl-7">${</span><span class="hl-4">s</span><span class="hl-9">.</span><span class="hl-4">strategy</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> chars`</span><span class="hl-1">);</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onCode</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">code</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Generated code for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">: </span><span class="hl-7">${</span><span class="hl-4">code</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> characters`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Lines: </span><span class="hl-7">${</span><span class="hl-4">code</span><span class="hl-9">.</span><span class="hl-0">split</span><span class="hl-9">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">&quot;</span><span class="hl-9">).</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">onDump</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">filepath</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Saved strategy to: </span><span class="hl-7">${</span><span class="hl-4">filepath</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Run with: node </span><span class="hl-7">${</span><span class="hl-4">filepath</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="api-reference" class="tsd-anchor"></a><h2 class="tsd-anchor-link">API Reference<a href="#api-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="optimizer-class-methods" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Optimizer Class Methods<a href="#optimizer-class-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Method</th>
<th>Signature</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getData()</code></td>
<td><code>async (symbol: string, context: { optimizerName: string }) =&gt; IOptimizerStrategy[]</code></td>
<td>Fetches data and generates strategies</td>
</tr>
<tr>
<td><code>getCode()</code></td>
<td><code>async (symbol: string, context: { optimizerName: string }) =&gt; string</code></td>
<td>Generates executable code</td>
</tr>
<tr>
<td><code>dump()</code></td>
<td><code>async (symbol: string, context: { optimizerName: string }, path?: string) =&gt; void</code></td>
<td>Saves code to file</td>
</tr>
</tbody>
</table>
<a id="event-emitters" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Emitters<a href="#event-emitters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Progress Tracking</strong>:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">listenProgressOptimizer</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">listenProgressOptimizer</span><span class="hl-1">((</span><span class="hl-4">progress</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Optimizer: </span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">optimizerName</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Symbol: </span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Progress: </span><span class="hl-7">${</span><span class="hl-9">(</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">progress</span><span class="hl-9"> </span><span class="hl-1">*</span><span class="hl-9"> </span><span class="hl-6">100</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Processed: </span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">processedSources</span><span class="hl-7">}</span><span class="hl-2"> / </span><span class="hl-7">${</span><span class="hl-4">progress</span><span class="hl-9">.</span><span class="hl-4">totalSources</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Contract Definition</strong>:</p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">ProgressOptimizerContract</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalSources</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;        </span><span class="hl-5">// Total data sources to process</span><br/><span class="hl-1">  </span><span class="hl-4">processedSources</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;    </span><span class="hl-5">// Sources completed</span><br/><span class="hl-1">  </span><span class="hl-4">progress</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;            </span><span class="hl-5">// 0.0 to 1.0</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="template-method-reference" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Template Method Reference<a href="#template-method-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All template methods return <code>string | Promise&lt;string&gt;</code> and can be overridden in <code>IOptimizerSchema.template</code>:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Parameters</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getTopBanner()</code></td>
<td><code>symbol: string</code></td>
<td>Imports and constants</td>
</tr>
<tr>
<td><code>getUserMessage()</code></td>
<td><code>symbol: string, data: any[], name: string</code></td>
<td>Default user message</td>
</tr>
<tr>
<td><code>getAssistantMessage()</code></td>
<td><code>symbol: string, data: any[], name: string</code></td>
<td>Default assistant message</td>
</tr>
<tr>
<td><code>getWalkerTemplate()</code></td>
<td><code>walkerName, exchangeName, frameName, strategies[]</code></td>
<td>Walker config</td>
</tr>
<tr>
<td><code>getExchangeTemplate()</code></td>
<td><code>symbol, exchangeName</code></td>
<td>Exchange config</td>
</tr>
<tr>
<td><code>getFrameTemplate()</code></td>
<td><code>symbol, frameName, interval, startDate, endDate</code></td>
<td>Frame config</td>
</tr>
<tr>
<td><code>getStrategyTemplate()</code></td>
<td><code>strategyName, interval, prompt</code></td>
<td>Strategy with getSignal</td>
</tr>
<tr>
<td><code>getLauncherTemplate()</code></td>
<td><code>symbol, walkerName</code></td>
<td>Walker execution</td>
</tr>
<tr>
<td><code>getTextTemplate()</code></td>
<td><code>symbol</code></td>
<td>LLM text helper</td>
</tr>
<tr>
<td><code>getJsonTemplate()</code></td>
<td><code>symbol</code></td>
<td>LLM JSON helper</td>
</tr>
<tr>
<td><code>getJsonDumpTemplate()</code></td>
<td><code>symbol</code></td>
<td>Debug logging helper</td>
</tr>
</tbody>
</table>
<hr>
<a id="integration-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration Patterns<a href="#integration-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="using-with-walker-for-comparison" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using with Walker for Comparison<a href="#using-with-walker-for-comparison" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The generated code automatically creates a Walker that compares all strategy variants:</p>
<pre><code class="typescript"><span class="hl-5">// Register optimizer with 3 training ranges</span><br/><span class="hl-0">addOptimizer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;market-conditions&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTrain:</span><span class="hl-1"> [</span><br/><span class="hl-1">    { </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-01-01&quot;</span><span class="hl-1">), </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-02-01&quot;</span><span class="hl-1">) },  </span><span class="hl-5">// Bull</span><br/><span class="hl-1">    { </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2023-06-01&quot;</span><span class="hl-1">), </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2023-07-01&quot;</span><span class="hl-1">) },  </span><span class="hl-5">// Sideways</span><br/><span class="hl-1">    { </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2022-11-01&quot;</span><span class="hl-1">), </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2022-12-01&quot;</span><span class="hl-1">) }   </span><span class="hl-5">// Bear</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTest:</span><span class="hl-1"> { </span><span class="hl-4">startDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-04-01&quot;</span><span class="hl-1">), </span><span class="hl-4">endDate:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;2024-05-01&quot;</span><span class="hl-1">) },</span><br/><span class="hl-1">  </span><span class="hl-4">source:</span><span class="hl-1"> [</span><span class="hl-5">/* ... */</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-0">getPrompt</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">messages</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;Strategy for specific market condition&quot;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Generate code</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Optimizer</span><span class="hl-1">.</span><span class="hl-0">dump</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, { </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;market-conditions&quot;</span><span class="hl-1"> }, </span><span class="hl-2">&quot;./output&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Run generated file</span><br/><span class="hl-5">// $ node ./output/market-conditions_BTCUSDT.mjs</span><br/><span class="hl-5">// </span><br/><span class="hl-5">// Output:</span><br/><span class="hl-5">// Progress: 33.33%</span><br/><span class="hl-5">// 1 / 3 strategies</span><br/><span class="hl-5">// Walker: abc123_walker, Symbol: BTCUSDT</span><br/><span class="hl-5">// </span><br/><span class="hl-5">// Progress: 66.67%</span><br/><span class="hl-5">// 2 / 3 strategies</span><br/><span class="hl-5">// </span><br/><span class="hl-5">// Progress: 100.00%</span><br/><span class="hl-5">// 3 / 3 strategies</span><br/><span class="hl-5">// </span><br/><span class="hl-5">// Walker completed: abc123_strategy-2</span><br/><span class="hl-5">// Best strategy: abc123_strategy-2 (Sideways market variant)</span>
</code><button type="button">Copy</button></pre>

<a id="custom-data-source-with-pagination" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom Data Source with Pagination<a href="#custom-data-source-with-pagination" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Implement a paginated data source with proper ID handling:</p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-11">BacktestResult</span><span class="hl-1"> </span><span class="hl-7">extends</span><span class="hl-1"> </span><span class="hl-11">IOptimizerData</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-11">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">pnl</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">winRate</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">sharpeRatio</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalTrades</span><span class="hl-1">: </span><span class="hl-11">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-0">backtestSource</span><span class="hl-1">: </span><span class="hl-11">IOptimizerSourceFn</span><span class="hl-1">&lt;</span><span class="hl-11">BacktestResult</span><span class="hl-1">&gt; = </span><span class="hl-7">async</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">startDate</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">endDate</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">limit</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">offset</span><br/><span class="hl-1">}) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Fetch from database with pagination</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">results</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">.</span><span class="hl-4">backtests</span><span class="hl-1">.</span><span class="hl-0">findMany</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">where:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">completedAt:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">gte:</span><span class="hl-1"> </span><span class="hl-4">startDate</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">lte:</span><span class="hl-1"> </span><span class="hl-4">endDate</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">skip:</span><span class="hl-1"> </span><span class="hl-4">offset</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">take:</span><span class="hl-1"> </span><span class="hl-4">limit</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">orderBy:</span><span class="hl-1"> { </span><span class="hl-4">completedAt:</span><span class="hl-1"> </span><span class="hl-2">&quot;asc&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Map to IOptimizerData with required id field</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">r</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,  </span><span class="hl-5">// Required for deduplication</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">symbol:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">pnl:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">totalPnl</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">winRate:</span><span class="hl-1"> (</span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">profitableTrades</span><span class="hl-1"> / </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">totalTrades</span><span class="hl-1">) * </span><span class="hl-6">100</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">sharpeRatio:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">sharpeRatio</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">totalTrades:</span><span class="hl-1"> </span><span class="hl-4">r</span><span class="hl-1">.</span><span class="hl-4">totalTrades</span><br/><span class="hl-1">  }));</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">addOptimizer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;historical-learner&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTrain:</span><span class="hl-1"> [</span><span class="hl-5">/* ... */</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTest:</span><span class="hl-1"> { </span><span class="hl-5">/* ... */</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">source:</span><span class="hl-1"> [</span><span class="hl-4">backtestSource</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-0">getPrompt</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">messages</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Analyze conversation history to generate prompt</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Strategy based on historical performance patterns&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Deduplication</strong>: The <code>id</code> field is used by <code>distinctDocuments()</code> to remove duplicates when pages overlap.</p>
<a id="custom-message-formatting" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom Message Formatting<a href="#custom-message-formatting" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Override default message formatters for specialized data presentation:</p>
<pre><code class="typescript"><span class="hl-0">addOptimizer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;custom-messages&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTrain:</span><span class="hl-1"> [</span><span class="hl-5">/* ... */</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">rangeTest:</span><span class="hl-1"> { </span><span class="hl-5">/* ... */</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">source:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;performance-metrics&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">fetch</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">args</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">metrics</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchMetrics</span><span class="hl-1">(</span><span class="hl-4">args</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">metrics</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">m</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">m</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">sharpe:</span><span class="hl-1"> </span><span class="hl-4">m</span><span class="hl-1">.</span><span class="hl-4">sharpeRatio</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">sortino:</span><span class="hl-1"> </span><span class="hl-4">m</span><span class="hl-1">.</span><span class="hl-4">sortinoRatio</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">calmar:</span><span class="hl-1"> </span><span class="hl-4">m</span><span class="hl-1">.</span><span class="hl-4">calmarRatio</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">maxDrawdown:</span><span class="hl-1"> </span><span class="hl-4">m</span><span class="hl-1">.</span><span class="hl-4">maxDrawdown</span><br/><span class="hl-1">        }));</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-5">// Custom user message with formatted table</span><br/><span class="hl-1">      </span><span class="hl-0">user</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">table</span><span class="hl-1"> = </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">d</span><span class="hl-1"> </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><br/><span class="hl-1">          </span><span class="hl-2">`| </span><span class="hl-7">${</span><span class="hl-4">d</span><span class="hl-9">.</span><span class="hl-4">sharpe</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2"> | </span><span class="hl-7">${</span><span class="hl-4">d</span><span class="hl-9">.</span><span class="hl-4">sortino</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2"> | </span><span class="hl-7">${</span><span class="hl-4">d</span><span class="hl-9">.</span><span class="hl-4">calmar</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2"> | </span><span class="hl-7">${</span><span class="hl-9">(</span><span class="hl-4">d</span><span class="hl-9">.</span><span class="hl-4">maxDrawdown</span><span class="hl-9"> </span><span class="hl-1">*</span><span class="hl-9"> </span><span class="hl-6">100</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">% |`</span><br/><span class="hl-1">        ).</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> [</span><br/><span class="hl-1">          </span><span class="hl-2">`Performance metrics for </span><span class="hl-7">${</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">:`</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;| Sharpe | Sortino | Calmar | Max DD |&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;|--------|---------|--------|--------|&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">table</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">`Total records: </span><span class="hl-7">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2">`</span><br/><span class="hl-1">        ].</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-5">// Custom assistant message with analysis</span><br/><span class="hl-1">      </span><span class="hl-0">assistant</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgSharpe</span><span class="hl-1"> = </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">d</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">d</span><span class="hl-1">.</span><span class="hl-4">sharpe</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">avgMaxDD</span><span class="hl-1"> = </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">d</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">d</span><span class="hl-1">.</span><span class="hl-4">maxDrawdown</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">) / </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> [</span><br/><span class="hl-1">          </span><span class="hl-2">`Analyzed </span><span class="hl-7">${</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-7">}</span><span class="hl-2"> performance records.`</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">`Average Sharpe Ratio: </span><span class="hl-7">${</span><span class="hl-4">avgSharpe</span><span class="hl-9">.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">`Average Max Drawdown: </span><span class="hl-7">${</span><span class="hl-9">(</span><span class="hl-4">avgMaxDD</span><span class="hl-9"> </span><span class="hl-1">*</span><span class="hl-9"> </span><span class="hl-6">100</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-6">2</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">%`</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">`Risk-adjusted returns are </span><span class="hl-7">${</span><span class="hl-4">avgSharpe</span><span class="hl-9"> </span><span class="hl-1">&gt;</span><span class="hl-9"> </span><span class="hl-6">1</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;favorable&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">&quot;unfavorable&quot;</span><span class="hl-7">}</span><span class="hl-2">.`</span><br/><span class="hl-1">        ].</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&quot; &quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-0">getPrompt</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-4">messages</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;Risk-optimized strategy&quot;</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="performance-considerations" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Considerations<a href="#performance-considerations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="memory-management" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memory Management<a href="#memory-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Data Deduplication</strong>: The <code>distinctDocuments()</code> function prevents memory bloat from overlapping pagination:</p>
<ul>
<li>Maintains a <code>Set</code> of seen IDs</li>
<li>Filters out duplicate records</li>
<li>Critical for large datasets with many pages</li>
</ul>
<p><strong>Message Size Warning</strong>: The <code>dumpJson()</code> function warns when user messages exceed 100KB <code>src/lib/services/template/OptimizerTemplateService.ts:508-515</code></p>
<a id="memoization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoization<a href="#memoization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Optimizer Instance Caching</strong>: <code>OptimizerConnectionService</code> memoizes <code>ClientOptimizer</code> instances by <code>optimizerName</code>:</p>
<ul>
<li>Single instance per optimizer name</li>
<li>Template merging done once</li>
<li>Reduces initialization overhead</li>
</ul>
<p><strong>Memoization Key</strong>: <code>[optimizerName]</code> <code>src/lib/services/connection/OptimizerConnectionService.ts:59-112</code></p>
<a id="pagination-efficiency" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pagination Efficiency<a href="#pagination-efficiency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Iteration Limit</strong>: <code>ITERATION_LIMIT = 25</code> records per page balances:</p>
<ul>
<li>Network request overhead</li>
<li>Memory consumption</li>
<li>Response time</li>
</ul>
<p><strong>Optimal For</strong>:</p>
<ul>
<li>Database sources with efficient <code>LIMIT</code>/<code>OFFSET</code></li>
<li>APIs with cursor-based pagination</li>
<li>Datasets with 100-10,000 total records</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#llm-powered-strategy-generation"><span>LLM-<wbr/>Powered <wbr/>Strategy <wbr/>Generation</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#system-architecture"><span>System <wbr/>Architecture</span></a></li><li><a href="#core-interfaces"><span>Core <wbr/>Interfaces</span></a></li><li><ul><li><a href="#ioptimizerschema-configuration"><span>IOptimizer<wbr/>Schema <wbr/>Configuration</span></a></li><li><a href="#ioptimizerrange-time-periods"><span>IOptimizer<wbr/>Range <wbr/>Time <wbr/>Periods</span></a></li><li><a href="#ioptimizersource-data-fetching"><span>IOptimizer<wbr/>Source <wbr/>Data <wbr/>Fetching</span></a></li></ul></li><li><a href="#data-collection-pipeline"><span>Data <wbr/>Collection <wbr/>Pipeline</span></a></li><li><ul><li><a href="#pagination-implementation"><span>Pagination <wbr/>Implementation</span></a></li><li><a href="#message-building"><span>Message <wbr/>Building</span></a></li></ul></li><li><a href="#llm-integration"><span>LLM <wbr/>Integration</span></a></li><li><ul><li><a href="#llm-helper-functions"><span>LLM <wbr/>Helper <wbr/>Functions</span></a></li><li><a href="#text-template"><span>text() <wbr/>Template</span></a></li><li><a href="#json-template-with-signal-schema"><span>json() <wbr/>Template with <wbr/>Signal <wbr/>Schema</span></a></li><li><a href="#debug-logging---dumpjson"><span>Debug <wbr/>Logging -<wbr/> dump<wbr/>Json()</span></a></li></ul></li><li><a href="#strategy-generation-workflow"><span>Strategy <wbr/>Generation <wbr/>Workflow</span></a></li><li><ul><li><a href="#phase-1-registration"><span>Phase 1: <wbr/>Registration</span></a></li><li><a href="#phase-2-data-collection"><span>Phase 2: <wbr/>Data <wbr/>Collection</span></a></li><li><a href="#phase-3-code-generation"><span>Phase 3: <wbr/>Code <wbr/>Generation</span></a></li><li><a href="#phase-4-file-export"><span>Phase 4: <wbr/>File <wbr/>Export</span></a></li></ul></li><li><a href="#generated-code-structure"><span>Generated <wbr/>Code <wbr/>Structure</span></a></li><li><ul><li><a href="#complete-file-anatomy"><span>Complete <wbr/>File <wbr/>Anatomy</span></a></li><li><a href="#multi-timeframe-strategy-template"><span>Multi-<wbr/>Timeframe <wbr/>Strategy <wbr/>Template</span></a></li><li><a href="#walker-comparison-setup"><span>Walker <wbr/>Comparison <wbr/>Setup</span></a></li></ul></li><li><a href="#configuration-examples"><span>Configuration <wbr/>Examples</span></a></li><li><ul><li><a href="#basic-optimizer-configuration"><span>Basic <wbr/>Optimizer <wbr/>Configuration</span></a></li><li><a href="#advanced-configuration-with-custom-templates"><span>Advanced <wbr/>Configuration with <wbr/>Custom <wbr/>Templates</span></a></li></ul></li><li><a href="#api-reference"><span>API <wbr/>Reference</span></a></li><li><ul><li><a href="#optimizer-class-methods"><span>Optimizer <wbr/>Class <wbr/>Methods</span></a></li><li><a href="#event-emitters"><span>Event <wbr/>Emitters</span></a></li><li><a href="#template-method-reference"><span>Template <wbr/>Method <wbr/>Reference</span></a></li></ul></li><li><a href="#integration-patterns"><span>Integration <wbr/>Patterns</span></a></li><li><ul><li><a href="#using-with-walker-for-comparison"><span>Using with <wbr/>Walker for <wbr/>Comparison</span></a></li><li><a href="#custom-data-source-with-pagination"><span>Custom <wbr/>Data <wbr/>Source with <wbr/>Pagination</span></a></li><li><a href="#custom-message-formatting"><span>Custom <wbr/>Message <wbr/>Formatting</span></a></li></ul></li><li><a href="#performance-considerations"><span>Performance <wbr/>Considerations</span></a></li><li><ul><li><a href="#memory-management"><span>Memory <wbr/>Management</span></a></li><li><a href="#memoization"><span>Memoization</span></a></li><li><a href="#pagination-efficiency"><span>Pagination <wbr/>Efficiency</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
