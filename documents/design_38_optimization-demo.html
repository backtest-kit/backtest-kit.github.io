<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/38_optimization-demo | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_38_optimization-demo.html">design/38_optimization-demo</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="optimization-demo" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Optimization Demo<a href="#optimization-demo" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The optimization demo demonstrates the <strong>LLM-based strategy generation</strong> capabilities of backtest-kit. This demo uses historical market data from multiple timeframes to generate trading strategies via Large Language Model (LLM) inference, then produces executable strategy code that can be backtested using the Walker mode.</p>
<p>The demo showcases:</p>
<ul>
<li>Multi-timeframe technical analysis data collection (1m, 15m, 30m, 1h candles)</li>
<li>LLM conversation history building with market data</li>
<li>Automated strategy code generation with complete executable output</li>
<li>Integration with external data sources (CCXT Dumper API) and LLM providers (Ollama)</li>
</ul>
<p>For general Optimizer system architecture, see <a href="design_20_optimizer-mode.html">Optimizer Mode</a>. For information on running demos in general, see <a href="design_39_running-demos.html">Running Demos</a>.</p>
<hr>
<a id="demo-architecture-and-data-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Demo Architecture and Data Flow<a href="#demo-architecture-and-data-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The optimization demo follows a structured pipeline from data collection through LLM inference to code generation:</p>
<p><img src="../media/38-optimization-demo_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Workflow:</strong></p>
<ol>
<li><strong>Configuration</strong>: Demo defines 7 training ranges (one per day) and 1 testing range</li>
<li><strong>Data Collection</strong>: For each training range, fetch data from 4 timeframe sources via pagination</li>
<li><strong>Message Formatting</strong>: Convert technical indicator data to markdown tables for LLM consumption</li>
<li><strong>LLM Inference</strong>: Build conversation history and call Ollama API to generate strategy logic</li>
<li><strong>Code Generation</strong>: Use <code>OptimizerTemplateService</code> to create complete executable code</li>
<li><strong>File Export</strong>: Save generated strategy to <code>./generated/btc-optimizer_BTCUSDT.mjs</code></li>
</ol>
<hr>
<a id="data-source-configuration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Data Source Configuration<a href="#data-source-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The demo configures four data sources, each representing a different timeframe for technical analysis. These sources fetch pre-calculated technical indicators from the CCXT Dumper API.</p>
<a id="source-specifications" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Source Specifications<a href="#source-specifications" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Source Name</th>
<th>Timeframe</th>
<th>Lookback Period</th>
<th>Key Indicators</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>long-term-range</code></td>
<td>1-hour candles</td>
<td>48 candles (48h)</td>
<td>RSI(14), MACD(12,26,9), ADX(14), ATR(14), Bollinger(20,2.0), Fibonacci levels</td>
</tr>
<tr>
<td><code>swing-term-range</code></td>
<td>30-minute candles</td>
<td>96 candles (48h)</td>
<td>RSI(14), MACD(12,26,9), ADX(14), CCI(20), Stochastic(14,3,3), Momentum(8)</td>
</tr>
<tr>
<td><code>short-term-range</code></td>
<td>15-minute candles</td>
<td>192 candles (48h)</td>
<td>RSI(9), MACD(8,21,5), ADX(14), CCI(14), ROC(5,10), Support/Resistance</td>
</tr>
<tr>
<td><code>micro-term-range</code></td>
<td>1-minute candles</td>
<td>60 candles (1h)</td>
<td>RSI(9), MACD(8,21,5), Bollinger(8,2.0), Stochastic(3,3,3), ATR(5,9), Squeeze Momentum</td>
</tr>
</tbody>
</table>
<a id="source-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Source Structure<a href="#source-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each source in <code>SOURCE_LIST</code> implements <code>IOptimizerSource</code> interface:</p>
<p><img src="../media/38-optimization-demo_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Fetch Function Example:</strong></p>
<p>The fetch function constructs URLs with query parameters and retrieves data from CCXT Dumper API:</p>
<pre><code><span class="hl-10">URL</span><span class="hl-1">: </span><span class="hl-4">$</span><span class="hl-1">{</span><span class="hl-8">CCXT_DUMPER_URL</span><span class="hl-1">}/</span><span class="hl-4">view</span><span class="hl-1">/</span><span class="hl-4">long</span><span class="hl-1">-</span><span class="hl-4">term</span><span class="hl-1">-</span><span class="hl-4">range</span><br/><span class="hl-10">Params</span><span class="hl-1">: </span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-0">startDate</span><span class="hl-1"> (</span><span class="hl-4">timestamp</span><span class="hl-1">), </span><span class="hl-0">endDate</span><span class="hl-1"> (</span><span class="hl-4">timestamp</span><span class="hl-1">), </span><span class="hl-0">limit</span><span class="hl-1"> (</span><span class="hl-6">1000</span><span class="hl-1">), </span><span class="hl-0">offset</span><span class="hl-1"> (</span><span class="hl-6">0</span><span class="hl-1">)</span><br/><span class="hl-10">Response</span><span class="hl-1">: { </span><span class="hl-10">rows</span><span class="hl-1">: </span><span class="hl-4">Array</span><span class="hl-1">&lt;</span><span class="hl-4">IOptimizerData</span><span class="hl-1">&gt; }</span>
</code><button>Copy</button></pre>

<p><strong>User Message Format:</strong></p>
<p>Each user message contains:</p>
<ol>
<li>Title: &quot;# {Timeframe} Candles Trading Analysis for {symbol} (Historical Data)&quot;</li>
<li>Markdown table with all indicator values</li>
<li>Data Sources section explaining each indicator with min/max ranges</li>
</ol>
<hr>
<a id="llm-integration-and-prompt-construction" class="tsd-anchor"></a><h2 class="tsd-anchor-link">LLM Integration and Prompt Construction<a href="#llm-integration-and-prompt-construction" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The demo uses Ollama API with the <code>deepseek-v3.1:671b</code> model to generate trading strategies. The LLM receives multi-timeframe market data and produces strategy recommendations.</p>
<a id="message-flow-sequence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Message Flow Sequence<a href="#message-flow-sequence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/38-optimization-demo_2.svg" alt="Mermaid Diagram"></p>
<a id="text-generation-function" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Text Generation Function<a href="#text-generation-function" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>text()</code> function implements the LLM call with specific system instructions:</p>
<p><strong>Function:</strong> <a href="">demo/optimization/src/index.mjs:312-359</a></p>
<p><strong>Key Configuration:</strong></p>
<ul>
<li><strong>Model</strong>: <code>deepseek-v3.1:671b</code></li>
<li><strong>Think Mode</strong>: <code>true</code> (enables reasoning)</li>
<li><strong>System Messages</strong>:
<ul>
<li>Primary instruction: &quot;Напиши торговую стратегию где нет ничего лишнего&quot; (Write clean strategy)</li>
<li>Reasoning level: &quot;high&quot;</li>
<li>Output constraint: &quot;Не здоровайся, не говори что делаешь - только отчёт&quot; (No greetings, just report)</li>
</ul>
</li>
</ul>
<p><strong>Final User Prompt:</strong></p>
<pre><code><span class="hl-4">На</span><span class="hl-1"> </span><span class="hl-4">каких</span><span class="hl-1"> </span><span class="hl-4">условиях</span><span class="hl-1"> </span><span class="hl-4">мне</span><span class="hl-1"> </span><span class="hl-4">купить</span><span class="hl-1"> {</span><span class="hl-4">symbol</span><span class="hl-1">}?</span><br/><span class="hl-4">Дай</span><span class="hl-1"> </span><span class="hl-4">анализ</span><span class="hl-1"> </span><span class="hl-4">рынка</span><span class="hl-1"> </span><span class="hl-4">на</span><span class="hl-1"> </span><span class="hl-4">основе</span><span class="hl-1"> </span><span class="hl-4">поддержки</span><span class="hl-1">/</span><span class="hl-4">сопротивления</span><span class="hl-1">, </span><span class="hl-4">точек</span><span class="hl-1"> </span><span class="hl-4">входа</span><span class="hl-1"> </span><span class="hl-4">в</span><span class="hl-1"> </span><span class="hl-8">LONG</span><span class="hl-1">/</span><span class="hl-8">SHORT</span><span class="hl-1"> </span><span class="hl-4">позиции</span><span class="hl-1">.</span><br/><span class="hl-4">Какой</span><span class="hl-1"> </span><span class="hl-8">RR</span><span class="hl-1"> </span><span class="hl-4">ставить</span><span class="hl-1"> </span><span class="hl-4">для</span><span class="hl-1"> </span><span class="hl-4">позиций</span><span class="hl-1">?</span><br/><span class="hl-4">Предпочтительны</span><span class="hl-1"> </span><span class="hl-8">LONG</span><span class="hl-1"> </span><span class="hl-4">или</span><span class="hl-1"> </span><span class="hl-8">SHORT</span><span class="hl-1"> </span><span class="hl-4">позиции</span><span class="hl-1">?</span><br/><br/><span class="hl-4">Сделай</span><span class="hl-1"> </span><span class="hl-4">не</span><span class="hl-1"> </span><span class="hl-4">сухой</span><span class="hl-1"> </span><span class="hl-4">технический</span><span class="hl-1">, </span><span class="hl-4">а</span><span class="hl-1"> </span><span class="hl-4">фундаментальный</span><span class="hl-1"> </span><span class="hl-4">анализ</span><span class="hl-1">, </span><span class="hl-4">содержащий</span><span class="hl-1"> </span><span class="hl-4">стратигическую</span><span class="hl-1"> </span><span class="hl-4">рекомендацию</span>
</code><button>Copy</button></pre>

<a id="response-processing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Response Processing<a href="#response-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The LLM response is escaped to prevent code injection when inserted into generated templates:</p>
<p><strong>Escaping Chain:</strong> <a href="">demo/optimization/src/index.mjs:353-358</a></p>
<pre><code><span class="hl-4">content</span><span class="hl-1">.</span><span class="hl-0">replace</span><span class="hl-1">(</span><span class="hl-15">/</span><span class="hl-12">\\</span><span class="hl-15">/</span><span class="hl-7">g</span><span class="hl-1">, </span><span class="hl-2">&quot;</span><span class="hl-12">\\\\</span><span class="hl-2">&quot;</span><span class="hl-1">)    </span><span class="hl-5">// Escape backslashes</span><br/><span class="hl-1">       .</span><span class="hl-0">replace</span><span class="hl-1">(</span><span class="hl-15">/`/</span><span class="hl-7">g</span><span class="hl-1">, </span><span class="hl-2">&quot;</span><span class="hl-12">\\</span><span class="hl-2">`&quot;</span><span class="hl-1">)       </span><span class="hl-5">// Escape backticks</span><br/><span class="hl-1">       .</span><span class="hl-0">replace</span><span class="hl-1">(</span><span class="hl-15">/</span><span class="hl-12">\$</span><span class="hl-15">/</span><span class="hl-7">g</span><span class="hl-1">, </span><span class="hl-2">&quot;</span><span class="hl-12">\\</span><span class="hl-2">$&quot;</span><span class="hl-1">)      </span><span class="hl-5">// Escape dollar signs</span><br/><span class="hl-1">       .</span><span class="hl-0">replace</span><span class="hl-1">(</span><span class="hl-15">/&quot;/</span><span class="hl-7">g</span><span class="hl-1">, </span><span class="hl-2">&#39;</span><span class="hl-12">\\</span><span class="hl-2">&quot;&#39;</span><span class="hl-1">)       </span><span class="hl-5">// Escape double quotes</span><br/><span class="hl-1">       .</span><span class="hl-0">replace</span><span class="hl-1">(</span><span class="hl-15">/&#39;/</span><span class="hl-7">g</span><span class="hl-1">, </span><span class="hl-2">&quot;</span><span class="hl-12">\\</span><span class="hl-2">&#39;&quot;</span><span class="hl-1">)       </span><span class="hl-5">// Escape single quotes</span>
</code><button>Copy</button></pre>

<hr>
<a id="generated-code-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Generated Code Structure<a href="#generated-code-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The optimizer generates a complete executable Node.js script containing all necessary components for strategy backtesting. The generated file follows a structured template system.</p>
<a id="code-generation-pipeline" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Code Generation Pipeline<a href="#code-generation-pipeline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/38-optimization-demo_3.svg" alt="Mermaid Diagram"></p>
<a id="generated-file-sections" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Generated File Sections<a href="#generated-file-sections" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The generated code contains 9 distinct sections, concatenated with newlines:</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>Template Method</th>
<th>Content</th>
<th>Lines Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>1. Top Banner</td>
<td><code>getTopBanner()</code></td>
<td>Shebang, imports, constants</td>
<td><a href="">src/lib/services/template/OptimizerTemplateService.ts:36-66</a></td>
</tr>
<tr>
<td>2. JSON Dump Helper</td>
<td><code>getJsonDumpTemplate()</code></td>
<td><code>dumpJson()</code> function for debug output</td>
<td><a href="">src/lib/services/template/OptimizerTemplateService.ts:452-546</a></td>
</tr>
<tr>
<td>3. Text Helper</td>
<td><code>getTextTemplate()</code></td>
<td><code>text()</code> function for LLM text generation</td>
<td><a href="">src/lib/services/template/OptimizerTemplateService.ts:555-612</a></td>
</tr>
<tr>
<td>4. JSON Helper</td>
<td><code>getJsonTemplate()</code></td>
<td><code>json()</code> function for structured signal output</td>
<td><a href="">src/lib/services/template/OptimizerTemplateService.ts:629-712</a></td>
</tr>
<tr>
<td>5. Exchange Config</td>
<td><code>getExchangeTemplate()</code></td>
<td><code>addExchange()</code> with CCXT Binance</td>
<td><a href="">src/lib/services/template/OptimizerTemplateService.ts:314-342</a></td>
</tr>
<tr>
<td>6. Frame Configs</td>
<td><code>getFrameTemplate()</code></td>
<td>Multiple <code>addFrame()</code> calls (train + test)</td>
<td><a href="">src/lib/services/template/OptimizerTemplateService.ts:354-385</a></td>
</tr>
<tr>
<td>7. Strategy Configs</td>
<td><code>getStrategyTemplate()</code></td>
<td>Multiple <code>addStrategy()</code> with LLM integration</td>
<td><a href="">src/lib/services/template/OptimizerTemplateService.ts:168-304</a></td>
</tr>
<tr>
<td>8. Walker Config</td>
<td><code>getWalkerTemplate()</code></td>
<td><code>addWalker()</code> for strategy comparison</td>
<td><a href="">src/lib/services/template/OptimizerTemplateService.ts:122-157</a></td>
</tr>
<tr>
<td>9. Launcher</td>
<td><code>getLauncherTemplate()</code></td>
<td><code>Walker.background()</code> + event listeners</td>
<td><a href="">src/lib/services/template/OptimizerTemplateService.ts:395-443</a></td>
</tr>
</tbody>
</table>
<a id="strategy-template-details" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Strategy Template Details<a href="#strategy-template-details" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The strategy template is the most complex section, containing multi-timeframe candle fetching and LLM inference:</p>
<p><strong>Structure:</strong> <a href="">src/lib/services/template/OptimizerTemplateService.ts:168-304</a></p>
<pre><code class="javascript"><span class="hl-0">addStrategy</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">strategyName:</span><span class="hl-1"> </span><span class="hl-2">&quot;{prefix}_strategy-{N}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">getSignal</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">symbol</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">messages</span><span class="hl-1"> = [];</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Load candles for all timeframes</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">microTermCandles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1m&quot;</span><span class="hl-1">, </span><span class="hl-6">30</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">mainTermCandles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;5m&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">shortTermCandles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;15m&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">mediumTermCandles</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getCandles</span><span class="hl-1">(</span><span class="hl-4">symbol</span><span class="hl-1">, </span><span class="hl-2">&quot;1h&quot;</span><span class="hl-1">, </span><span class="hl-6">24</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Build conversation with 4 user/assistant pairs (one per timeframe)</span><br/><span class="hl-1">        </span><span class="hl-5">// ...push messages analyzing 1h, 15m, 5m, 1m data</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Final prompt with strategy logic (from LLM-generated text)</span><br/><span class="hl-1">        </span><span class="hl-4">messages</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">content:</span><span class="hl-1"> [</span><br/><span class="hl-1">                </span><span class="hl-2">&quot;Проанализируй все таймфреймы и сгенерируй торговый сигнал...&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">`{ESCAPED_STRATEGY_PROMPT}`</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">&quot;Если сигналы противоречивы или тренд слабый то position: wait&quot;</span><br/><span class="hl-1">            ].</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-12">\\</span><span class="hl-2">n&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Call json() helper for structured output</span><br/><span class="hl-1">        </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">json</span><span class="hl-1">(</span><span class="hl-4">messages</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Dump debug data and return signal</span><br/><span class="hl-1">        </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">dumpJson</span><span class="hl-1">(</span><span class="hl-4">resultId</span><span class="hl-1">, </span><span class="hl-4">messages</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="signal-schema" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signal Schema<a href="#signal-schema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>json()</code> helper uses a JSON schema to ensure structured signal output:</p>
<p><strong>Schema Fields:</strong> <a href="">src/lib/services/template/OptimizerTemplateService.ts:675-704</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Enum/Range</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>position</code></td>
<td>string</td>
<td><code>&quot;wait&quot;</code> | <code>&quot;long&quot;</code> | <code>&quot;short&quot;</code></td>
<td>Trade decision</td>
</tr>
<tr>
<td><code>note</code></td>
<td>string</td>
<td>-</td>
<td>Strategy explanation</td>
</tr>
<tr>
<td><code>priceOpen</code></td>
<td>number</td>
<td>&gt; 0</td>
<td>Entry price (market or limit)</td>
</tr>
<tr>
<td><code>priceTakeProfit</code></td>
<td>number</td>
<td>&gt; 0</td>
<td>Target exit price</td>
</tr>
<tr>
<td><code>priceStopLoss</code></td>
<td>number</td>
<td>&gt; 0</td>
<td>Stop loss price</td>
</tr>
<tr>
<td><code>minuteEstimatedTime</code></td>
<td>number</td>
<td>0-360</td>
<td>Expected duration to TP</td>
</tr>
</tbody>
</table>
<hr>
<a id="environment-configuration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Environment Configuration<a href="#environment-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The demo requires two environment variables for external service integration:</p>
<a id="required-variables" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Required Variables<a href="#required-variables" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="bash"><span class="hl-4">OLLAMA_API_KEY</span><span class="hl-1">=</span><span class="hl-2">your_ollama_api_key_here</span><br/><span class="hl-4">CCXT_DUMPER_URL</span><span class="hl-1">=</span><span class="hl-2">http://your-ccxt-dumper-url:port</span>
</code><button type="button">Copy</button></pre>

<p><strong><code>OLLAMA_API_KEY</code></strong>:</p>
<ul>
<li>Used for authentication with Ollama hosted API</li>
<li>Injected in Authorization header: <code>Bearer ${process.env.OLLAMA_API_KEY}</code></li>
<li>Required for <code>text()</code> function calls to <code>https://ollama.com</code></li>
<li><strong>Usage:</strong> <a href="">demo/optimization/src/index.mjs:316</a></li>
</ul>
<p><strong><code>CCXT_DUMPER_URL</code></strong>:</p>
<ul>
<li>Base URL for CCXT Dumper API endpoints</li>
<li>Used to construct view URLs: <code>${CCXT_DUMPER_URL}/view/{source-name}</code></li>
<li>Provides pre-calculated technical indicators for multiple timeframes</li>
<li><strong>Usage:</strong> <a href="">demo/optimization/src/index.mjs:71</a>, <a href="">demo/optimization/src/index.mjs:129</a>, <a href="">demo/optimization/src/index.mjs:186</a>, <a href="">demo/optimization/src/index.mjs:241</a></li>
</ul>
<a id="ccxt-dumper-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">CCXT Dumper Integration<a href="#ccxt-dumper-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The demo expects CCXT Dumper to expose four endpoints:</p>
<pre><code><span class="hl-8">GET</span><span class="hl-1"> /</span><span class="hl-4">view</span><span class="hl-1">/</span><span class="hl-4">long</span><span class="hl-1">-</span><span class="hl-4">term</span><span class="hl-1">-</span><span class="hl-4">range</span><span class="hl-1">?</span><span class="hl-4">symbol</span><span class="hl-1">=</span><span class="hl-8">BTCUSDT</span><span class="hl-1">&amp;</span><span class="hl-4">startDate</span><span class="hl-1">=</span><span class="hl-6">1732406400000</span><span class="hl-1">&amp;</span><span class="hl-4">endDate</span><span class="hl-1">=</span><span class="hl-6">1732492799999</span><span class="hl-1">&amp;</span><span class="hl-4">limit</span><span class="hl-1">=</span><span class="hl-6">1000</span><span class="hl-1">&amp;</span><span class="hl-4">offset</span><span class="hl-1">=</span><span class="hl-6">0</span><br/><span class="hl-8">GET</span><span class="hl-1"> /</span><span class="hl-4">view</span><span class="hl-1">/</span><span class="hl-4">swing</span><span class="hl-1">-</span><span class="hl-4">term</span><span class="hl-1">-</span><span class="hl-4">range</span><span class="hl-1">?</span><span class="hl-4">symbol</span><span class="hl-1">=</span><span class="hl-8">BTCUSDT</span><span class="hl-1">&amp;</span><span class="hl-4">startDate</span><span class="hl-1">=</span><span class="hl-6">1732406400000</span><span class="hl-1">&amp;</span><span class="hl-4">endDate</span><span class="hl-1">=</span><span class="hl-6">1732492799999</span><span class="hl-1">&amp;</span><span class="hl-4">limit</span><span class="hl-1">=</span><span class="hl-6">1000</span><span class="hl-1">&amp;</span><span class="hl-4">offset</span><span class="hl-1">=</span><span class="hl-6">0</span><br/><span class="hl-8">GET</span><span class="hl-1"> /</span><span class="hl-4">view</span><span class="hl-1">/</span><span class="hl-4">short</span><span class="hl-1">-</span><span class="hl-4">term</span><span class="hl-1">-</span><span class="hl-4">range</span><span class="hl-1">?</span><span class="hl-4">symbol</span><span class="hl-1">=</span><span class="hl-8">BTCUSDT</span><span class="hl-1">&amp;</span><span class="hl-4">startDate</span><span class="hl-1">=</span><span class="hl-6">1732406400000</span><span class="hl-1">&amp;</span><span class="hl-4">endDate</span><span class="hl-1">=</span><span class="hl-6">1732492799999</span><span class="hl-1">&amp;</span><span class="hl-4">limit</span><span class="hl-1">=</span><span class="hl-6">1000</span><span class="hl-1">&amp;</span><span class="hl-4">offset</span><span class="hl-1">=</span><span class="hl-6">0</span><br/><span class="hl-8">GET</span><span class="hl-1"> /</span><span class="hl-4">view</span><span class="hl-1">/</span><span class="hl-4">micro</span><span class="hl-1">-</span><span class="hl-4">term</span><span class="hl-1">-</span><span class="hl-4">range</span><span class="hl-1">?</span><span class="hl-4">symbol</span><span class="hl-1">=</span><span class="hl-8">BTCUSDT</span><span class="hl-1">&amp;</span><span class="hl-4">startDate</span><span class="hl-1">=</span><span class="hl-6">1732406400000</span><span class="hl-1">&amp;</span><span class="hl-4">endDate</span><span class="hl-1">=</span><span class="hl-6">1732492799999</span><span class="hl-1">&amp;</span><span class="hl-4">limit</span><span class="hl-1">=</span><span class="hl-6">1000</span><span class="hl-1">&amp;</span><span class="hl-4">offset</span><span class="hl-1">=</span><span class="hl-6">0</span>
</code><button>Copy</button></pre>

<p><strong>Response Format:</strong></p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;rows&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-11">&quot;id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;unique_row_id&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-11">&quot;timestamp&quot;</span><span class="hl-1">: </span><span class="hl-6">1732406400000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-11">&quot;rsi&quot;</span><span class="hl-1">: </span><span class="hl-6">45.67</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-11">&quot;macd&quot;</span><span class="hl-1">: </span><span class="hl-6">12.34</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-11">&quot;signal&quot;</span><span class="hl-1">: </span><span class="hl-6">10.23</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">// ... other indicators</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Reference:</strong> CCXT Dumper API documented at <a href="https://github.com/tripolskypetr/node-ccxt-dumper">https://github.com/tripolskypetr/node-ccxt-dumper</a></p>
<hr>
<a id="running-the-demo" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Running the Demo<a href="#running-the-demo" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="prerequisites" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Prerequisites<a href="#prerequisites" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li>
<p>Install dependencies in demo directory:</p>
<pre><code class="bash"><span class="hl-0">cd</span><span class="hl-1"> </span><span class="hl-2">demo/optimization</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p>Create <code>.env</code> file with required variables:</p>
<pre><code class="bash"><span class="hl-0">cp</span><span class="hl-1"> </span><span class="hl-2">.env.example</span><span class="hl-1"> </span><span class="hl-2">.env</span><br/><span class="hl-5"># Edit .env with your API keys</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p>Ensure CCXT Dumper service is running and accessible</p>
</li>
</ol>
<a id="execution" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Execution<a href="#execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Command:</strong></p>
<pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">start</span>
</code><button type="button">Copy</button></pre>

<p><strong>Execution Flow:</strong> <a href="">demo/optimization/src/index.mjs:361-399</a></p>
<ol>
<li><strong>Registration</strong>: <code>addOptimizer()</code> registers optimizer configuration with 7 training ranges, 4 data sources, and LLM prompt generation</li>
<li><strong>Progress Monitoring</strong>: <code>listenOptimizerProgress()</code> logs completion percentage</li>
<li><strong>Code Generation</strong>: <code>Optimizer.dump()</code> executes the full pipeline:
<ul>
<li>Fetch data from all sources for each training range</li>
<li>Build LLM conversation history</li>
<li>Generate strategy prompts via Ollama</li>
<li>Produce executable code using templates</li>
<li>Write to <code>./generated/btc-optimizer_BTCUSDT.mjs</code></li>
</ul>
</li>
</ol>
<a id="progress-output" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Progress Output<a href="#progress-output" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-10">Progress</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1">%</span><br/><span class="hl-10">Progress</span><span class="hl-1">: </span><span class="hl-6">3.57</span><span class="hl-1">%</span><br/><span class="hl-10">Progress</span><span class="hl-1">: </span><span class="hl-6">7.14</span><span class="hl-1">%</span><br/><span class="hl-1">...</span><br/><span class="hl-10">Progress</span><span class="hl-1">: </span><span class="hl-6">100</span><span class="hl-1">%</span>
</code><button>Copy</button></pre>

<p><strong>Progress Calculation:</strong> <a href="">src/client/ClientOptimizer.ts:102-114</a></p>
<pre><code><span class="hl-4">progress</span><span class="hl-1"> = </span><span class="hl-4">processedSources</span><span class="hl-1"> / </span><span class="hl-4">totalSources</span><br/><span class="hl-4">totalSources</span><span class="hl-1"> = </span><span class="hl-4">rangeTrain</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> × </span><span class="hl-4">source</span><span class="hl-1">.</span><span class="hl-4">length</span><br/><span class="hl-1">            = </span><span class="hl-6">7</span><span class="hl-1"> </span><span class="hl-4">training</span><span class="hl-1"> </span><span class="hl-4">ranges</span><span class="hl-1"> × </span><span class="hl-6">4</span><span class="hl-1"> </span><span class="hl-4">sources</span><br/><span class="hl-1">            = </span><span class="hl-6">28</span><span class="hl-1"> </span><span class="hl-4">total</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1"> </span><span class="hl-4">fetches</span>
</code><button>Copy</button></pre>

<a id="generated-output-location" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Generated Output Location<a href="#generated-output-location" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>File Path:</strong> <code>./generated/btc-optimizer_BTCUSDT.mjs</code></p>
<p><strong>File Structure:</strong></p>
<ul>
<li>Executable Node.js script with shebang <code>#!/usr/bin/env node</code></li>
<li>Complete standalone file with all dependencies imported</li>
<li>Can be executed directly after generation</li>
</ul>
<p><strong>Alternative Operations:</strong></p>
<p>Commented code in <a href="">demo/optimization/src/index.mjs:385-398</a> shows how to retrieve strategy data without code generation:</p>
<pre><code class="javascript"><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Optimizer</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">optimizerName:</span><span class="hl-1"> </span><span class="hl-2">&quot;btc-optimizer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">}).</span><span class="hl-0">then</span><span class="hl-1">((</span><span class="hl-4">list</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-4">fs</span><span class="hl-1">.</span><span class="hl-0">writeFile</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;./strategy_list.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">list</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(({ </span><span class="hl-4">strategy</span><span class="hl-1"> }) </span><span class="hl-7">=&gt;</span><span class="hl-1"> </span><span class="hl-4">strategy</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-7">null</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">2</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>This extracts only the LLM-generated strategy text for inspection without generating full executable code.</p>
<hr>
<a id="debug-output-and-logging" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Debug Output and Logging<a href="#debug-output-and-logging" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The generated strategy code includes debug output capabilities via the <code>dumpJson()</code> helper function. This creates detailed logs of LLM interactions for analysis and troubleshooting.</p>
<a id="debug-directory-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Debug Directory Structure<a href="#debug-directory-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-1">./</span><span class="hl-4">dump</span><span class="hl-1">/</span><span class="hl-4">strategy</span><span class="hl-1">/</span><br/><span class="hl-1">└── {</span><span class="hl-4">resultId</span><span class="hl-1">}/</span><br/><span class="hl-1">    ├── 00</span><span class="hl-4">_system_prompt</span><span class="hl-1">.</span><span class="hl-4">md</span><br/><span class="hl-1">    ├── 01</span><span class="hl-4">_user_message</span><span class="hl-1">.</span><span class="hl-4">md</span><br/><span class="hl-1">    ├── 02</span><span class="hl-4">_user_message</span><span class="hl-1">.</span><span class="hl-4">md</span><br/><span class="hl-1">    ├── 03</span><span class="hl-4">_user_message</span><span class="hl-1">.</span><span class="hl-4">md</span><br/><span class="hl-1">    ├── 04</span><span class="hl-4">_user_message</span><span class="hl-1">.</span><span class="hl-4">md</span><br/><span class="hl-1">    └── 05</span><span class="hl-4">_llm_output</span><span class="hl-1">.</span><span class="hl-4">md</span>
</code><button>Copy</button></pre>

<a id="debug-file-contents" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Debug File Contents<a href="#debug-file-contents" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>File</th>
<th>Content</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>00_system_prompt.md</code></td>
<td>System messages + output data JSON</td>
<td>Shows system instructions and final signal result</td>
</tr>
<tr>
<td><code>0X_user_message.md</code></td>
<td>User input markdown with timestamp</td>
<td>Documents each timeframe analysis request</td>
</tr>
<tr>
<td><code>05_llm_output.md</code></td>
<td>Final LLM response JSON</td>
<td>Shows the structured signal output</td>
</tr>
</tbody>
</table>
<p><strong>Template Implementation:</strong> <a href="">src/lib/services/template/OptimizerTemplateService.ts:452-546</a></p>
<a id="size-warning-system" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Size Warning System<a href="#size-warning-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>dumpJson()</code> function includes size monitoring to warn about large messages that may impact LLM performance:</p>
<p><strong>Warning Logic:</strong> <a href="">src/lib/services/template/OptimizerTemplateService.ts:507-515</a></p>
<pre><code class="javascript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">messageSizeBytes</span><span class="hl-1"> = </span><span class="hl-4">Buffer</span><span class="hl-1">.</span><span class="hl-0">byteLength</span><span class="hl-1">(</span><span class="hl-4">message</span><span class="hl-1">.</span><span class="hl-4">content</span><span class="hl-1">, </span><span class="hl-2">&quot;utf8&quot;</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">messageSizeKb</span><span class="hl-1"> = </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">floor</span><span class="hl-1">(</span><span class="hl-4">messageSizeBytes</span><span class="hl-1"> / </span><span class="hl-6">1024</span><span class="hl-1">);</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">messageSizeKb</span><span class="hl-1"> &gt; </span><span class="hl-8">WARN_KB</span><span class="hl-1">) {  </span><span class="hl-5">// WARN_KB = 100</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-2">`User message </span><span class="hl-7">${</span><span class="hl-4">idx</span><span class="hl-9"> </span><span class="hl-1">+</span><span class="hl-9"> </span><span class="hl-6">1</span><span class="hl-7">}</span><span class="hl-2"> is </span><span class="hl-7">${</span><span class="hl-4">messageSizeBytes</span><span class="hl-7">}</span><span class="hl-2"> bytes (</span><span class="hl-7">${</span><span class="hl-4">messageSizeKb</span><span class="hl-7">}</span><span class="hl-2">kb), </span><br/><span class="hl-2">         which exceeds warning limit`</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="progress-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Progress Events<a href="#progress-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The optimizer emits progress events during data collection, allowing real-time monitoring:</p>
<p><strong>Event Contract:</strong> <a href="">src/contract/ProgressOptimizer.contract.ts:17-28</a></p>
<pre><code class="typescript"><span class="hl-7">interface</span><span class="hl-1"> </span><span class="hl-13">ProgressOptimizerContract</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">optimizerName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">;     </span><span class="hl-5">// &quot;btc-optimizer&quot;</span><br/><span class="hl-1">    </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">;            </span><span class="hl-5">// &quot;BTCUSDT&quot;</span><br/><span class="hl-1">    </span><span class="hl-4">totalSources</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;      </span><span class="hl-5">// 28 (7 ranges × 4 sources)</span><br/><span class="hl-1">    </span><span class="hl-4">processedSources</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;  </span><span class="hl-5">// Current count</span><br/><span class="hl-1">    </span><span class="hl-4">progress</span><span class="hl-1">: </span><span class="hl-13">number</span><span class="hl-1">;          </span><span class="hl-5">// 0.0 to 1.0</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Emission Points:</strong> <a href="">src/client/ClientOptimizer.ts:108-114</a>, <a href="">src/client/ClientOptimizer.ts:201-208</a></p>
<p>Progress events are emitted:</p>
<ol>
<li>At the start of processing each source</li>
<li>After completing all sources (100%)</li>
</ol>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#optimization-demo"><span>Optimization <wbr/>Demo</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#demo-architecture-and-data-flow"><span>Demo <wbr/>Architecture and <wbr/>Data <wbr/>Flow</span></a></li><li><a href="#data-source-configuration"><span>Data <wbr/>Source <wbr/>Configuration</span></a></li><li><ul><li><a href="#source-specifications"><span>Source <wbr/>Specifications</span></a></li><li><a href="#source-structure"><span>Source <wbr/>Structure</span></a></li></ul></li><li><a href="#llm-integration-and-prompt-construction"><span>LLM <wbr/>Integration and <wbr/>Prompt <wbr/>Construction</span></a></li><li><ul><li><a href="#message-flow-sequence"><span>Message <wbr/>Flow <wbr/>Sequence</span></a></li><li><a href="#text-generation-function"><span>Text <wbr/>Generation <wbr/>Function</span></a></li><li><a href="#response-processing"><span>Response <wbr/>Processing</span></a></li></ul></li><li><a href="#generated-code-structure"><span>Generated <wbr/>Code <wbr/>Structure</span></a></li><li><ul><li><a href="#code-generation-pipeline"><span>Code <wbr/>Generation <wbr/>Pipeline</span></a></li><li><a href="#generated-file-sections"><span>Generated <wbr/>File <wbr/>Sections</span></a></li><li><a href="#strategy-template-details"><span>Strategy <wbr/>Template <wbr/>Details</span></a></li><li><a href="#signal-schema"><span>Signal <wbr/>Schema</span></a></li></ul></li><li><a href="#environment-configuration"><span>Environment <wbr/>Configuration</span></a></li><li><ul><li><a href="#required-variables"><span>Required <wbr/>Variables</span></a></li><li><a href="#ccxt-dumper-integration"><span>CCXT <wbr/>Dumper <wbr/>Integration</span></a></li></ul></li><li><a href="#running-the-demo"><span>Running the <wbr/>Demo</span></a></li><li><ul><li><a href="#prerequisites"><span>Prerequisites</span></a></li><li><a href="#execution"><span>Execution</span></a></li><li><a href="#progress-output"><span>Progress <wbr/>Output</span></a></li><li><a href="#generated-output-location"><span>Generated <wbr/>Output <wbr/>Location</span></a></li></ul></li><li><a href="#debug-output-and-logging"><span>Debug <wbr/>Output and <wbr/>Logging</span></a></li><li><ul><li><a href="#debug-directory-structure"><span>Debug <wbr/>Directory <wbr/>Structure</span></a></li><li><a href="#debug-file-contents"><span>Debug <wbr/>File <wbr/>Contents</span></a></li><li><a href="#size-warning-system"><span>Size <wbr/>Warning <wbr/>System</span></a></li><li><a href="#progress-events"><span>Progress <wbr/>Events</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
