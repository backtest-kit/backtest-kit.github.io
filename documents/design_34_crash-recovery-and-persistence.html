<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/34_crash-recovery-and-persistence | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_34_crash-recovery-and-persistence.html">design/34_crash-recovery-and-persistence</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="crash-recovery-and-persistence" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Crash Recovery and Persistence<a href="#crash-recovery-and-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This document describes the crash recovery and persistence system that enables crash-safe live trading in backtest-kit. The persistence layer ensures that active trading signals, scheduled signals, risk state, and partial profit/loss tracking survive process crashes and restarts. For information about live trading execution modes, see <a href="design_18_live-trading-mode.html">5.2 Live Trading Mode</a>. For details on risk management state, see <a href="design_14_risk-management.html">4.3 Risk Management</a>.</p>
<p>The persistence system uses atomic file writes to guarantee data consistency and a <code>waitForInit()</code> pattern for state recovery on startup. All persistence adapters extend <code>PersistBase</code> and can be replaced with custom implementations for alternative storage backends (Redis, MongoDB, etc.).</p>
<hr>
<a id="crash-recovery-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Crash Recovery Architecture<a href="#crash-recovery-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The crash recovery system follows a <strong>persist-and-restart</strong> architecture where the process is stateless and all critical state is written to disk immediately after each state change. This ensures that if the process crashes at any moment, the state can be fully recovered on restart.</p>
<p><strong>Key Design Principles:</strong></p>
<table>
<thead>
<tr>
<th>Principle</th>
<th>Implementation</th>
<th>Benefit</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Stateless Process</strong></td>
<td>All state written to disk immediately</td>
<td>Process can crash and restart without data loss</td>
</tr>
<tr>
<td><strong>Atomic Writes</strong></td>
<td>Write to temp file, then rename</td>
<td>File system guarantees consistency</td>
</tr>
<tr>
<td><strong>Singleshot Init</strong></td>
<td><code>waitForInit()</code> runs exactly once per strategy</td>
<td>State loaded once, cached in memory</td>
</tr>
<tr>
<td><strong>JSON Serialization</strong></td>
<td>Human-readable files in <code>./dump/</code></td>
<td>Easy debugging and manual recovery</td>
</tr>
<tr>
<td><strong>Per-Symbol-Strategy Isolation</strong></td>
<td>Separate files per symbol:strategy pair</td>
<td>Independent recovery per trading pair</td>
</tr>
</tbody>
</table>
<hr>
<a id="persistence-layer-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Persistence Layer Architecture<a href="#persistence-layer-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/34-crash-recovery-and-persistence_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Persistence Flow:</strong></p>
<ol>
<li><strong>On Startup:</strong> <code>ClientStrategy.waitForInit()</code> calls <code>readSignalData()</code> and <code>readScheduleData()</code> to load persisted state</li>
<li><strong>On State Change:</strong> <code>setPendingSignal()</code> and <code>setScheduledSignal()</code> call <code>writeSignalData()</code> and <code>writeScheduleData()</code></li>
<li><strong>Atomic Write:</strong> <code>PersistBase</code> writes to temp file, then atomically renames to final filename</li>
<li><strong>Recovery:</strong> On restart, <code>waitForInit()</code> loads last known state from disk</li>
</ol>
<hr>
<a id="persistence-adapters" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Persistence Adapters<a href="#persistence-adapters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework includes four persistence adapters for different state types:</p>
<table>
<thead>
<tr>
<th>Adapter</th>
<th>Entity Type</th>
<th>Purpose</th>
<th>File Pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PersistSignalAdapter</strong></td>
<td><code>SignalData</code> (ISignalRow)</td>
<td>Active pending signal per symbol:strategy</td>
<td><code>signal_{symbol}_{strategyName}.json</code></td>
</tr>
<tr>
<td><strong>PersistScheduleAdapter</strong></td>
<td><code>ScheduleData</code> (IScheduledSignalRow)</td>
<td>Scheduled signal awaiting activation</td>
<td><code>schedule_{symbol}_{strategyName}.json</code></td>
</tr>
<tr>
<td><strong>PersistRiskAdapter</strong></td>
<td><code>RiskData</code> (active positions)</td>
<td>Risk state for position tracking</td>
<td><code>risk_{symbol}_{riskName}.json</code></td>
</tr>
<tr>
<td><strong>PersistPartialAdapter</strong></td>
<td><code>PartialData</code> (profit/loss levels)</td>
<td>Partial milestone tracking per signal</td>
<td><code>partial_{symbol}.json</code></td>
</tr>
</tbody>
</table>
<p><strong>Key Characteristics:</strong></p>
<ul>
<li>All adapters extend <code>PersistBase&lt;TEntityId, TData&gt;</code></li>
<li>Use <code>EntityId</code> helper type for type-safe identifiers</li>
<li>Store data as JSON for human-readable debugging</li>
<li>Support <code>null</code> data to represent &quot;no active state&quot;</li>
</ul>
<hr>
<a id="persistbase-base-class" class="tsd-anchor"></a><h2 class="tsd-anchor-link">PersistBase Base Class<a href="#persistbase-base-class" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All persistence adapters extend <code>PersistBase</code>, which provides the core atomic write functionality and file system abstraction.</p>
<p><strong>Generic Type Parameters:</strong></p>
<ul>
<li><code>TEntityId</code>: Type for entity identifier (e.g., <code>{ symbol: string, strategyName: string }</code>)</li>
<li><code>TData</code>: Type for persisted data structure (e.g., <code>ISignalRow | null</code>)</li>
</ul>
<p><strong>Core Methods:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>readData(entityId)</code></td>
<td>Load persisted state</td>
<td>Returns <code>null</code> if file doesn't exist</td>
</tr>
<tr>
<td><code>writeData(entityId, data)</code></td>
<td>Save state atomically</td>
<td>Writes to temp file, then renames</td>
</tr>
<tr>
<td><code>getFilePath(entityId)</code></td>
<td>Generate file path</td>
<td>Abstract method for subclass implementation</td>
</tr>
</tbody>
</table>
<p><strong>Atomic Write Implementation:</strong></p>
<ol>
<li>Serialize data to JSON string</li>
<li>Write JSON to temporary file (<code>path.tmp</code>)</li>
<li>Atomically rename temp file to final path</li>
<li>File system guarantees rename is atomic (crash-safe)</li>
</ol>
<hr>
<a id="state-recovery-with-waitforinit" class="tsd-anchor"></a><h2 class="tsd-anchor-link">State Recovery with waitForInit<a href="#state-recovery-with-waitforinit" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>waitForInit()</code> method is called once per <code>ClientStrategy</code> instance before any tick operations. It uses the <strong>singleshot pattern</strong> from <code>functools-kit</code> to ensure initialization happens exactly once, even if called multiple times.</p>
<a id="waitforinit-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">waitForInit Implementation<a href="#waitforinit-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/34-crash-recovery-and-persistence_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Implementation Details:</strong></p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-0">WAIT_FOR_INIT_FN</span><span class="hl-1"> = </span><span class="hl-7">async</span><span class="hl-1"> (</span><span class="hl-4">self</span><span class="hl-1">: </span><span class="hl-13">ClientStrategy</span><span class="hl-1">) </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">debug</span><span class="hl-1">(</span><span class="hl-2">&quot;ClientStrategy waitForInit&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">backtest</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1">;  </span><span class="hl-5">// No persistence in backtest mode</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">// Restore pending signal</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">pendingSignal</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">PersistSignalAdapter</span><span class="hl-1">.</span><span class="hl-0">readSignalData</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">pendingSignal</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Validate schema names match</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">pendingSignal</span><span class="hl-1">.</span><span class="hl-4">exchangeName</span><span class="hl-1"> !== </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">method</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">exchangeName</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">pendingSignal</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1"> !== </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">method</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">_pendingSignal</span><span class="hl-1"> = </span><span class="hl-4">pendingSignal</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Call onActive callback for restored signal</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">callbacks</span><span class="hl-1">?.</span><span class="hl-4">onActive</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">currentPrice</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">exchange</span><span class="hl-1">.</span><span class="hl-0">getAveragePrice</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">symbol</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">      </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">callbacks</span><span class="hl-1">.</span><span class="hl-0">onActive</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">pendingSignal</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">currentPrice</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">backtest</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">// Restore scheduled signal</span><br/><span class="hl-1">  </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">scheduledSignal</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">PersistScheduleAdapter</span><span class="hl-1">.</span><span class="hl-0">readScheduleData</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">execution</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">symbol</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">self</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">strategyName</span><span class="hl-1">,</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-5">// Similar validation and restoration logic...</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><strong>Validation Checks:</strong></p>
<ul>
<li><code>exchangeName</code> must match current strategy configuration</li>
<li><code>strategyName</code> must match current strategy configuration</li>
<li>Prevents loading state from different strategy configurations</li>
</ul>
<hr>
<a id="signal-state-persistence-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Signal State Persistence Flow<a href="#signal-state-persistence-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/34-crash-recovery-and-persistence_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Persistence Triggers:</strong></p>
<table>
<thead>
<tr>
<th>Event</th>
<th>Method Call</th>
<th>Persisted State</th>
<th>File Operation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Signal opened</strong></td>
<td><code>setPendingSignal(signal)</code></td>
<td><code>ISignalRow</code></td>
<td>Write <code>signal_*.json</code></td>
</tr>
<tr>
<td><strong>Signal closed</strong></td>
<td><code>setPendingSignal(null)</code></td>
<td><code>null</code></td>
<td>Delete file</td>
</tr>
<tr>
<td><strong>Scheduled created</strong></td>
<td><code>setScheduledSignal(signal)</code></td>
<td><code>IScheduledSignalRow</code></td>
<td>Write <code>schedule_*.json</code></td>
</tr>
<tr>
<td><strong>Scheduled activated</strong></td>
<td><code>setScheduledSignal(null)</code></td>
<td><code>null</code></td>
<td>Delete file</td>
</tr>
<tr>
<td><strong>Scheduled cancelled</strong></td>
<td><code>setScheduledSignal(null)</code></td>
<td><code>null</code></td>
<td>Delete file</td>
</tr>
</tbody>
</table>
<hr>
<a id="file-system-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">File System Structure<a href="#file-system-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Persistence files are stored in the <code>./dump/</code> directory relative to the process working directory. Each file is named using a pattern that uniquely identifies the entity.</p>
<a id="file-naming-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">File Naming Patterns<a href="#file-naming-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Adapter</th>
<th>File Pattern</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PersistSignalAdapter</strong></td>
<td><code>signal_{symbol}_{strategyName}.json</code></td>
<td><code>signal_BTCUSDT_my-strategy.json</code></td>
</tr>
<tr>
<td><strong>PersistScheduleAdapter</strong></td>
<td><code>schedule_{symbol}_{strategyName}.json</code></td>
<td><code>schedule_BTCUSDT_my-strategy.json</code></td>
</tr>
<tr>
<td><strong>PersistRiskAdapter</strong></td>
<td><code>risk_{symbol}_{riskName}.json</code></td>
<td><code>risk_BTCUSDT_max-3-positions.json</code></td>
</tr>
<tr>
<td><strong>PersistPartialAdapter</strong></td>
<td><code>partial_{symbol}.json</code></td>
<td><code>partial_BTCUSDT.json</code></td>
</tr>
</tbody>
</table>
<a id="directory-structure-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Directory Structure Example<a href="#directory-structure-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-1">.</span><span class="hl-15">/dump/</span><br/><span class="hl-1">├── </span><span class="hl-4">signal_BTCUSDT_ma</span><span class="hl-1">-</span><span class="hl-4">crossover</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">├── </span><span class="hl-4">signal_ETHUSDT_ma</span><span class="hl-1">-</span><span class="hl-4">crossover</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">├── </span><span class="hl-4">schedule_BTCUSDT_limit</span><span class="hl-1">-</span><span class="hl-4">entry</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">├── </span><span class="hl-4">risk_BTCUSDT_portfolio</span><span class="hl-1">-</span><span class="hl-4">risk</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">├── </span><span class="hl-4">partial_BTCUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span><br/><span class="hl-1">└── </span><span class="hl-4">partial_ETHUSDT</span><span class="hl-1">.</span><span class="hl-4">json</span>
</code><button>Copy</button></pre>

<a id="signal-file-format" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signal File Format<a href="#signal-file-format" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Active Signal Example:</strong></p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;a1b2c3d4-e5f6-7890-abcd-ef1234567890&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;symbol&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;BTCUSDT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;strategyName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;ma-crossover&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;exchangeName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;binance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;position&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;long&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;priceOpen&quot;</span><span class="hl-1">: </span><span class="hl-6">50000.00</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;priceTakeProfit&quot;</span><span class="hl-1">: </span><span class="hl-6">52000.00</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;priceStopLoss&quot;</span><span class="hl-1">: </span><span class="hl-6">49000.00</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;minuteEstimatedTime&quot;</span><span class="hl-1">: </span><span class="hl-6">1440</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;scheduledAt&quot;</span><span class="hl-1">: </span><span class="hl-6">1704067200000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;pendingAt&quot;</span><span class="hl-1">: </span><span class="hl-6">1704067200000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;_isScheduled&quot;</span><span class="hl-1">: </span><span class="hl-7">false</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">&quot;note&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MA crossover detected&quot;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Null State (No Active Signal):</strong></p>
<ul>
<li>File is deleted when signal closes</li>
<li><code>readSignalData()</code> returns <code>null</code> if file doesn't exist</li>
</ul>
<hr>
<a id="atomic-write-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Atomic Write Pattern<a href="#atomic-write-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The atomic write pattern ensures that persistence files are never corrupted, even if the process crashes during a write operation.</p>
<a id="atomic-write-sequence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Atomic Write Sequence<a href="#atomic-write-sequence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/34-crash-recovery-and-persistence_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Why Atomic Renames Are Crash-Safe:</strong></p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>File System Behavior</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Crash during JSON write</strong></td>
<td>Temp file incomplete</td>
<td>Original file untouched, old state preserved</td>
</tr>
<tr>
<td><strong>Crash during rename</strong></td>
<td>Rename completes or fails atomically</td>
<td>Either old or new state, never corrupted</td>
</tr>
<tr>
<td><strong>Crash after rename</strong></td>
<td>Rename already completed</td>
<td>New state persisted successfully</td>
</tr>
</tbody>
</table>
<p><strong>File System Guarantees:</strong></p>
<ul>
<li>POSIX <code>rename()</code> is atomic on the same file system</li>
<li>Either the old filename or new filename exists, never both</li>
<li>No partial writes visible to readers</li>
<li>Crash at any point leaves file system in consistent state</li>
</ul>
<hr>
<a id="integration-with-live-mode" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Live Mode<a href="#integration-with-live-mode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The persistence system is tightly integrated with Live mode execution to ensure crash-safe trading.</p>
<a id="live-mode-execution-with-persistence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Live Mode Execution with Persistence<a href="#live-mode-execution-with-persistence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/34-crash-recovery-and-persistence_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Crash Recovery Scenarios:</strong></p>
<table>
<thead>
<tr>
<th>Crash Point</th>
<th>Persisted State</th>
<th>Recovery Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Before signal open</strong></td>
<td>No active signal</td>
<td>Starts idle, waits for next signal</td>
</tr>
<tr>
<td><strong>After signal open</strong></td>
<td><code>ISignalRow</code> persisted</td>
<td>Loads active signal, continues monitoring</td>
</tr>
<tr>
<td><strong>During TP/SL check</strong></td>
<td>Active signal preserved</td>
<td>Resumes monitoring from last tick</td>
</tr>
<tr>
<td><strong>After signal close</strong></td>
<td><code>null</code> (file deleted)</td>
<td>Starts idle, ready for new signal</td>
</tr>
<tr>
<td><strong>Scheduled signal waiting</strong></td>
<td><code>IScheduledSignalRow</code> persisted</td>
<td>Continues waiting for activation</td>
</tr>
</tbody>
</table>
<p><strong>Sleep Interval and Persistence:</strong></p>
<ul>
<li>Live mode sleeps 61 seconds between ticks (<code>TICK_TTL</code>)</li>
<li>Persistence happens <strong>before</strong> sleep, ensuring state is saved</li>
<li>If crash occurs during sleep, state already persisted</li>
<li>On restart, <code>waitForInit()</code> loads last known state</li>
</ul>
<hr>
<a id="extending-with-custom-storage-backends" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Extending with Custom Storage Backends<a href="#extending-with-custom-storage-backends" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The persistence system is designed to be extensible. All adapters extend <code>PersistBase</code>, which can be subclassed for custom storage implementations.</p>
<a id="custom-adapter-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom Adapter Implementation<a href="#custom-adapter-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To implement a custom persistence backend (e.g., Redis, MongoDB, PostgreSQL):</p>
<ol>
<li>
<p><strong>Extend PersistBase:</strong></p>
<ul>
<li>Implement <code>getFilePath()</code> for entity identification</li>
<li>Override <code>readData()</code> and <code>writeData()</code> for custom storage logic</li>
</ul>
</li>
<li>
<p><strong>Example: Redis Adapter</strong></p>
</li>
</ol>
<pre><code class="typescript"><span class="hl-5">// Custom Redis-based persistence adapter</span><br/><span class="hl-7">class</span><span class="hl-1"> </span><span class="hl-13">PersistSignalRedisAdapter</span><span class="hl-1"> </span><span class="hl-7">extends</span><span class="hl-1"> </span><span class="hl-13">PersistBase</span><span class="hl-1">&lt;</span><br/><span class="hl-1">  { </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">; </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-13">SignalData</span><br/><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-7">private</span><span class="hl-1"> </span><span class="hl-4">redis</span><span class="hl-1">: </span><span class="hl-13">Redis</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-7">constructor</span><span class="hl-1">(</span><span class="hl-4">redis</span><span class="hl-1">: </span><span class="hl-13">Redis</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">super</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">redis</span><span class="hl-1"> = </span><span class="hl-4">redis</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Generate Redis key instead of file path</span><br/><span class="hl-1">  </span><span class="hl-7">protected</span><span class="hl-1"> </span><span class="hl-0">getFilePath</span><span class="hl-1">(</span><span class="hl-4">entityId</span><span class="hl-1">: { </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">; </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1"> }): </span><span class="hl-13">string</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`signal:</span><span class="hl-7">${</span><span class="hl-4">entityId</span><span class="hl-9">.</span><span class="hl-4">symbol</span><span class="hl-7">}</span><span class="hl-2">:</span><span class="hl-7">${</span><span class="hl-4">entityId</span><span class="hl-9">.</span><span class="hl-4">strategyName</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Override to use Redis GET</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">readData</span><span class="hl-1">(</span><span class="hl-4">entityId</span><span class="hl-1">: { </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">; </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1"> }): </span><span class="hl-13">Promise</span><span class="hl-1">&lt;</span><span class="hl-13">SignalData</span><span class="hl-1"> | </span><span class="hl-13">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">key</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">getFilePath</span><span class="hl-1">(</span><span class="hl-4">entityId</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">json</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">json</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-4">json</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Override to use Redis SET</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">writeData</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">entityId</span><span class="hl-1">: { </span><span class="hl-4">symbol</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1">; </span><span class="hl-4">strategyName</span><span class="hl-1">: </span><span class="hl-13">string</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-13">SignalData</span><span class="hl-1"> | </span><span class="hl-13">null</span><br/><span class="hl-1">  ): </span><span class="hl-13">Promise</span><span class="hl-1">&lt;</span><span class="hl-13">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">key</span><span class="hl-1"> = </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-0">getFilePath</span><span class="hl-1">(</span><span class="hl-4">entityId</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1"> === </span><span class="hl-7">null</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">del</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-3">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">this</span><span class="hl-1">.</span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">, </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">));</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<ol start="3">
<li><strong>Replace Default Adapter:</strong>
<ul>
<li>Import custom adapter in strategy configuration</li>
<li>Use custom adapter methods instead of default <code>PersistSignalAdapter</code></li>
</ul>
</li>
</ol>
<p><strong>Custom Backend Considerations:</strong></p>
<table>
<thead>
<tr>
<th>Backend</th>
<th>Atomicity</th>
<th>Durability</th>
<th>Latency</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>File System</strong></td>
<td>✅ Atomic rename</td>
<td>✅ Disk-backed</td>
<td>Low</td>
<td>Default, simple setup</td>
</tr>
<tr>
<td><strong>Redis</strong></td>
<td>✅ Single-op atomic</td>
<td>⚠️ Optional persistence</td>
<td>Very low</td>
<td>High-frequency trading</td>
</tr>
<tr>
<td><strong>MongoDB</strong></td>
<td>✅ Single-doc atomic</td>
<td>✅ Replicated</td>
<td>Medium</td>
<td>Multi-region deployments</td>
</tr>
<tr>
<td><strong>PostgreSQL</strong></td>
<td>✅ ACID transactions</td>
<td>✅ ACID</td>
<td>Medium</td>
<td>Complex queries, auditing</td>
</tr>
</tbody>
</table>
<hr>
<a id="singleshot-initialization-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Singleshot Initialization Pattern<a href="#singleshot-initialization-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>waitForInit()</code> method uses the <strong>singleshot pattern</strong> from <code>functools-kit</code> to ensure initialization runs exactly once per instance, even if called multiple times.</p>
<a id="singleshot-behavior" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Singleshot Behavior<a href="#singleshot-behavior" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/34-crash-recovery-and-persistence_5.svg" alt="Mermaid Diagram"></p>
<p><strong>Implementation Pattern:</strong></p>
<ul>
<li><code>waitForInit()</code> wrapped with <code>singleshot()</code> from <code>functools-kit</code></li>
<li>First call executes full initialization</li>
<li>Subsequent calls return cached result immediately</li>
<li>No race conditions even with concurrent calls</li>
<li>Memory efficient: state loaded once, reused</li>
</ul>
<p><strong>Benefits:</strong></p>
<table>
<thead>
<tr>
<th>Benefit</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Performance</strong></td>
<td>Avoid repeated file I/O operations</td>
</tr>
<tr>
<td><strong>Consistency</strong></td>
<td>State loaded once, immutable across execution</td>
</tr>
<tr>
<td><strong>Thread Safety</strong></td>
<td><code>singleshot()</code> handles concurrent calls safely</td>
</tr>
<tr>
<td><strong>Memory Efficiency</strong></td>
<td>Single copy of state in memory</td>
</tr>
</tbody>
</table>
<hr>
<a id="best-practices" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Best Practices<a href="#best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="persistence-best-practices" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Persistence Best Practices<a href="#persistence-best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li>
<p><strong>Always Use Atomic Writes:</strong></p>
<ul>
<li>Never write directly to final file path</li>
<li>Always write to temp file, then rename</li>
<li>Prevents corrupted state on crash</li>
</ul>
</li>
<li>
<p><strong>Validate Loaded State:</strong></p>
<ul>
<li>Check <code>exchangeName</code> and <code>strategyName</code> match current config</li>
<li>Ignore state from different strategies</li>
<li>Prevents loading incompatible state</li>
</ul>
</li>
<li>
<p><strong>Handle Null State:</strong></p>
<ul>
<li><code>null</code> means &quot;no active state&quot;</li>
<li>Don't throw errors on missing files</li>
<li>Treat missing file as <code>null</code> state</li>
</ul>
</li>
<li>
<p><strong>Monitor Disk Space:</strong></p>
<ul>
<li>Each symbol:strategy pair creates files</li>
<li>Clean up old files periodically</li>
<li>Implement file rotation for long-running systems</li>
</ul>
</li>
<li>
<p><strong>Test Crash Scenarios:</strong></p>
<ul>
<li>Simulate crashes at different execution points</li>
<li>Verify state recovers correctly</li>
<li>Test with concurrent symbol:strategy pairs</li>
</ul>
</li>
</ol>
<a id="recovery-best-practices" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Recovery Best Practices<a href="#recovery-best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li>
<p><strong>Graceful Shutdown:</strong></p>
<ul>
<li>Use <code>Live.background()</code> with cancellation</li>
<li>Wait for <code>doneLiveSubject</code> event</li>
<li>Ensures final state persisted before exit</li>
</ul>
</li>
<li>
<p><strong>Monitor Recovery:</strong></p>
<ul>
<li>Log <code>waitForInit()</code> results</li>
<li>Track which signals are recovered</li>
<li>Alert on unexpected state changes</li>
</ul>
</li>
<li>
<p><strong>Version State Format:</strong></p>
<ul>
<li>Include version field in persisted data</li>
<li>Handle migration on format changes</li>
<li>Maintain backward compatibility</li>
</ul>
</li>
</ol>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#crash-recovery-and-persistence"><span>Crash <wbr/>Recovery and <wbr/>Persistence</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#crash-recovery-architecture"><span>Crash <wbr/>Recovery <wbr/>Architecture</span></a></li><li><a href="#persistence-layer-architecture"><span>Persistence <wbr/>Layer <wbr/>Architecture</span></a></li><li><a href="#persistence-adapters"><span>Persistence <wbr/>Adapters</span></a></li><li><a href="#persistbase-base-class"><span>Persist<wbr/>Base <wbr/>Base <wbr/>Class</span></a></li><li><a href="#state-recovery-with-waitforinit"><span>State <wbr/>Recovery with wait<wbr/>For<wbr/>Init</span></a></li><li><ul><li><a href="#waitforinit-implementation"><span>wait<wbr/>For<wbr/>Init <wbr/>Implementation</span></a></li></ul></li><li><a href="#signal-state-persistence-flow"><span>Signal <wbr/>State <wbr/>Persistence <wbr/>Flow</span></a></li><li><a href="#file-system-structure"><span>File <wbr/>System <wbr/>Structure</span></a></li><li><ul><li><a href="#file-naming-patterns"><span>File <wbr/>Naming <wbr/>Patterns</span></a></li><li><a href="#directory-structure-example"><span>Directory <wbr/>Structure <wbr/>Example</span></a></li><li><a href="#signal-file-format"><span>Signal <wbr/>File <wbr/>Format</span></a></li></ul></li><li><a href="#atomic-write-pattern"><span>Atomic <wbr/>Write <wbr/>Pattern</span></a></li><li><ul><li><a href="#atomic-write-sequence"><span>Atomic <wbr/>Write <wbr/>Sequence</span></a></li></ul></li><li><a href="#integration-with-live-mode"><span>Integration with <wbr/>Live <wbr/>Mode</span></a></li><li><ul><li><a href="#live-mode-execution-with-persistence"><span>Live <wbr/>Mode <wbr/>Execution with <wbr/>Persistence</span></a></li></ul></li><li><a href="#extending-with-custom-storage-backends"><span>Extending with <wbr/>Custom <wbr/>Storage <wbr/>Backends</span></a></li><li><ul><li><a href="#custom-adapter-implementation"><span>Custom <wbr/>Adapter <wbr/>Implementation</span></a></li></ul></li><li><a href="#singleshot-initialization-pattern"><span>Singleshot <wbr/>Initialization <wbr/>Pattern</span></a></li><li><ul><li><a href="#singleshot-behavior"><span>Singleshot <wbr/>Behavior</span></a></li></ul></li><li><a href="#best-practices"><span>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#persistence-best-practices"><span>Persistence <wbr/>Best <wbr/>Practices</span></a></li><li><a href="#recovery-best-practices"><span>Recovery <wbr/>Best <wbr/>Practices</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
