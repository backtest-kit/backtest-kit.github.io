<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/09_temporal_isolation_and_look-ahead_prevention | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_09_temporal_isolation_and_look-ahead_prevention.html">design/09_temporal_isolation_and_look-ahead_prevention</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="temporal-isolation-and-look-ahead-prevention" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Temporal Isolation and Look-Ahead Prevention<a href="#temporal-isolation-and-look-ahead-prevention" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="purpose-and-scope" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Purpose and Scope<a href="#purpose-and-scope" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This page explains how backtest-kit prevents look-ahead bias—the critical flaw where backtesting code accidentally uses future data that wouldn't be available in real-time trading. The system achieves this through <strong>temporal isolation</strong> using Node.js <code>AsyncLocalStorage</code> to enforce strict time boundaries during strategy execution.</p>
<p>For information about the three execution modes (Backtest, Live, Walker) and how they handle data differently, see <a href="design_06_execution_modes.html">Execution Modes</a>. For details about the overall component registration pattern, see <a href="design_08_component_registration.html">Component Registration</a>.</p>
<hr>
<a id="the-look-ahead-bias-problem" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Look-Ahead Bias Problem<a href="#the-look-ahead-bias-problem" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Look-ahead bias occurs when backtesting code accesses data from the future, producing unrealistically profitable results that fail in live trading. Common scenarios include:</p>
<table>
<thead>
<tr>
<th>Bias Type</th>
<th>Example</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Direct Future Access</strong></td>
<td>Fetching tomorrow's price to decide today's trade</td>
<td>Strategy appears profitable but impossible to execute live</td>
</tr>
<tr>
<td><strong>Multi-Timeframe Misalignment</strong></td>
<td>Using 1-hour candle that includes next 30 minutes while making 1-minute decisions</td>
<td>Signals generated with information not yet available</td>
</tr>
<tr>
<td><strong>Indicator Calculation</strong></td>
<td>Computing moving average using data points from the future</td>
<td>Indicators predict with perfect foresight</td>
</tr>
<tr>
<td><strong>VWAP Contamination</strong></td>
<td>Calculating volume-weighted average price including future volume</td>
<td>Entry/exit prices artificially favorable</td>
</tr>
</tbody>
</table>
<p>Traditional backtesting frameworks require manual timestamp management, making it easy to introduce subtle look-ahead bugs. backtest-kit makes look-ahead bias <strong>architecturally impossible</strong> through automatic temporal isolation.</p>
<hr>
<a id="architecture-overview-context-propagation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Overview: Context Propagation<a href="#architecture-overview-context-propagation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/09_Temporal_Isolation_and_Look-Ahead_Prevention_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Components</strong>:</p>
<ol>
<li><strong>ExecutionContextService</strong> (<a href="">types.d.ts:38-44</a>): Scoped service wrapping AsyncLocalStorage for implicit context passing</li>
<li><strong>IExecutionContext</strong> (<a href="">types.d.ts:11-18</a>): Contains <code>symbol</code> (trading pair), <code>when</code> (current timestamp), <code>backtest</code> (mode flag)</li>
<li><strong>BacktestLogicPrivateService</strong>: Sets <code>when</code> to each frame timestamp during historical iteration</li>
<li><strong>LiveLogicPrivateService</strong>: Sets <code>when</code> to <code>Date.now()</code> for real-time execution</li>
<li><strong>ClientExchange.getCandles()</strong>: Filters candle data to only return records with <code>timestamp &lt;= context.when</code></li>
</ol>
<hr>
<a id="temporal-filtering-mechanism" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Temporal Filtering Mechanism<a href="#temporal-filtering-mechanism" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="data-access-timeline" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Data Access Timeline<a href="#data-access-timeline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/09_Temporal_Isolation_and_Look-Ahead_Prevention_1.svg" alt="Mermaid Diagram"></p>
<a id="filtering-logic-sequence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Filtering Logic Sequence<a href="#filtering-logic-sequence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>At each backtest tick, the following sequence executes:</p>
<ol>
<li><strong>Context Establishment</strong>: <code>BacktestLogicPrivateService</code> calls <code>ExecutionContextService.runInContext()</code> with current frame timestamp</li>
<li><strong>AsyncLocalStorage Activation</strong>: Context stored in Node.js async context for the duration of the callback</li>
<li><strong>Strategy Invocation</strong>: <code>ClientStrategy.tick()</code> calls user's <code>getSignal(symbol, when)</code> function</li>
<li><strong>Data Requests</strong>: Strategy code calls <code>getCandles()</code>, <code>getAveragePrice()</code>, etc.</li>
<li><strong>Context Retrieval</strong>: Data access functions read <code>execution.context.when</code> from AsyncLocalStorage</li>
<li><strong>Temporal Filtering</strong>: Exchange implementation filters: <code>candles.filter(c =&gt; c.timestamp &lt;= context.when)</code></li>
<li><strong>Historical Data Only</strong>: Only past data returned to strategy</li>
</ol>
<hr>
<a id="implementation-executioncontextservice" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Implementation: ExecutionContextService<a href="#implementation-executioncontextservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="type-definition" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Type Definition<a href="#type-definition" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">// From types.d.ts:11-18</span><br/><span class="hl-3">interface</span><span class="hl-2"> </span><span class="hl-11">IExecutionContext</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">symbol</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">;      </span><span class="hl-0">// Trading pair (e.g., &quot;BTCUSDT&quot;)</span><br/><span class="hl-2">    </span><span class="hl-6">when</span><span class="hl-2">: </span><span class="hl-11">Date</span><span class="hl-2">;          </span><span class="hl-0">// Current timestamp for operation</span><br/><span class="hl-2">    </span><span class="hl-6">backtest</span><span class="hl-2">: </span><span class="hl-11">boolean</span><span class="hl-2">;   </span><span class="hl-0">// true = backtest, false = live</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="service-declaration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Declaration<a href="#service-declaration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">// From types.d.ts:38-44</span><br/><span class="hl-3">declare</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">ExecutionContextService</span><span class="hl-2">: </span><br/><span class="hl-2">    (</span><span class="hl-5">new</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> { </span><span class="hl-3">readonly</span><span class="hl-2"> </span><span class="hl-6">context</span><span class="hl-2">: </span><span class="hl-11">IExecutionContext</span><span class="hl-2"> }) </span><br/><span class="hl-2">    &amp; </span><span class="hl-11">di_scoped</span><span class="hl-2">.</span><span class="hl-11">IScopedClassRun</span><span class="hl-2">&lt;[</span><span class="hl-10">context</span><span class="hl-2">: </span><span class="hl-11">IExecutionContext</span><span class="hl-2">]&gt;;</span>
</code><button type="button">Copy</button></pre>

<p>The <code>IScopedClassRun</code> interface from <code>di-scoped</code> provides:</p>
<ul>
<li><strong>runInContext(callback, context)</strong>: Executes callback with context in AsyncLocalStorage</li>
<li><strong>Automatic propagation</strong>: Context available in all nested async calls without explicit parameter passing</li>
<li><strong>Isolation</strong>: Different execution branches have separate contexts</li>
</ul>
<a id="usage-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Usage Pattern<a href="#usage-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">// Backtest mode: iterate through historical timestamps</span><br/><span class="hl-5">for</span><span class="hl-2"> (</span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">timestamp</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-6">timeframes</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">ExecutionContextService</span><span class="hl-2">.</span><span class="hl-1">runInContext</span><span class="hl-2">(</span><br/><span class="hl-2">        </span><span class="hl-3">async</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">            </span><span class="hl-0">// Strategy executes here</span><br/><span class="hl-2">            </span><span class="hl-0">// All data access automatically filtered to &lt;= timestamp</span><br/><span class="hl-2">            </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">strategy</span><span class="hl-2">.</span><span class="hl-1">tick</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">strategyName</span><span class="hl-2">);</span><br/><span class="hl-2">            </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">result</span><span class="hl-2">;</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">        { </span><span class="hl-6">symbol:</span><span class="hl-2"> </span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-6">when:</span><span class="hl-2"> </span><span class="hl-6">timestamp</span><span class="hl-2">, </span><span class="hl-6">backtest:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2"> }</span><br/><span class="hl-2">    );</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// Live mode: use current time</span><br/><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">ExecutionContextService</span><span class="hl-2">.</span><span class="hl-1">runInContext</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-3">async</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">result</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">strategy</span><span class="hl-2">.</span><span class="hl-1">tick</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">strategyName</span><span class="hl-2">);</span><br/><span class="hl-2">        </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">result</span><span class="hl-2">;</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    { </span><span class="hl-6">symbol:</span><span class="hl-2"> </span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-6">when:</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">Date</span><span class="hl-2">(), </span><span class="hl-6">backtest:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2"> }</span><br/><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="public-api-functions-with-temporal-context" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Public API Functions with Temporal Context<a href="#public-api-functions-with-temporal-context" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="getcandles" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getCandles()<a href="#getcandles" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/09_Temporal_Isolation_and_Look-Ahead_Prevention_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Function Signature</strong>:</p>
<pre><code class="typescript"><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">: </span><span class="hl-6">string</span><span class="hl-2">, </span><span class="hl-6">interval</span><span class="hl-2">: </span><span class="hl-6">CandleInterval</span><span class="hl-2">, </span><span class="hl-6">limit</span><span class="hl-2">: </span><span class="hl-6">number</span><span class="hl-2">): </span><span class="hl-11">Promise</span><span class="hl-2">&lt;</span><span class="hl-6">ICandleData</span><span class="hl-2">[]&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Behavior</strong>:</p>
<ul>
<li><strong>Backtest Mode</strong>: Returns last <code>limit</code> candles up to <code>context.when</code></li>
<li><strong>Live Mode</strong>: Returns last <code>limit</code> candles up to <code>Date.now()</code> (same as backtest behavior)</li>
<li><strong>No timestamp parameter needed</strong>: Context provides it implicitly</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-0">// In strategy code - no explicit timestamp needed</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles1h</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;1h&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);  </span><span class="hl-0">// Last 24 hours</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles5m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">, </span><span class="hl-7">60</span><span class="hl-2">);  </span><span class="hl-0">// Last 60 periods</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="getaverageprice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getAveragePrice()<a href="#getaverageprice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-1">getAveragePrice</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">: </span><span class="hl-6">string</span><span class="hl-2">): </span><span class="hl-11">Promise</span><span class="hl-2">&lt;</span><span class="hl-6">number</span><span class="hl-2">&gt;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Behavior</strong>:</p>
<ul>
<li>Fetches last 5 1-minute candles (configurable via <code>CC_AVG_PRICE_CANDLES_COUNT</code>)</li>
<li>Calculates VWAP: <code>Σ(Typical Price × Volume) / Σ(Volume)</code></li>
<li>Where Typical Price = <code>(High + Low + Close) / 3</code></li>
<li><strong>Temporal filtering</strong>: Only uses candles with <code>timestamp &lt;= context.when</code></li>
</ul>
<p><strong>Usage in ClientStrategy</strong> (<a href="">src/client/ClientStrategy.ts:354-356</a>):</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">currentPrice</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">self</span><span class="hl-2">.</span><span class="hl-6">params</span><span class="hl-2">.</span><span class="hl-6">exchange</span><span class="hl-2">.</span><span class="hl-1">getAveragePrice</span><span class="hl-2">(</span><br/><span class="hl-2">    </span><span class="hl-6">self</span><span class="hl-2">.</span><span class="hl-6">params</span><span class="hl-2">.</span><span class="hl-6">execution</span><span class="hl-2">.</span><span class="hl-6">context</span><span class="hl-2">.</span><span class="hl-6">symbol</span><br/><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="getdate-and-getmode" class="tsd-anchor"></a><h3 class="tsd-anchor-link">getDate() and getMode()<a href="#getdate-and-getmode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-1">getDate</span><span class="hl-2">(): </span><span class="hl-6">Date</span><span class="hl-2">        </span><span class="hl-0">// Returns execution.context.when</span><br/><span class="hl-1">getMode</span><span class="hl-2">(): </span><span class="hl-6">boolean</span><span class="hl-2">     </span><span class="hl-0">// Returns execution.context.backtest</span>
</code><button type="button">Copy</button></pre>

<p><strong>Purpose</strong>:</p>
<ul>
<li><strong>getDate()</strong>: Access current &quot;simulation time&quot; in backtest or real time in live mode</li>
<li><strong>getMode()</strong>: Conditional logic based on execution mode</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">currentTime</span><span class="hl-2"> = </span><span class="hl-1">getDate</span><span class="hl-2">();</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">isBacktest</span><span class="hl-2"> = </span><span class="hl-1">getMode</span><span class="hl-2">();</span><br/><br/><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">isBacktest</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-0">// Backtest-specific logic (e.g., logging without API calls)</span><br/><span class="hl-2">} </span><span class="hl-5">else</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// Live trading logic (e.g., send alerts)</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="multi-timeframe-data-synchronization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Multi-Timeframe Data Synchronization<a href="#multi-timeframe-data-synchronization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="the-challenge" class="tsd-anchor"></a><h3 class="tsd-anchor-link">The Challenge<a href="#the-challenge" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Strategies often analyze multiple timeframes simultaneously:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles1m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1m&quot;</span><span class="hl-2">, </span><span class="hl-7">30</span><span class="hl-2">);  </span><span class="hl-0">// Last 30 minutes</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles5m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);  </span><span class="hl-0">// Last 2 hours</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles1h</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1h&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);  </span><span class="hl-0">// Last 24 hours</span>
</code><button type="button">Copy</button></pre>

<p><strong>Problem in traditional systems</strong>: Each call could return data from different time points if not carefully synchronized.</p>
<a id="automatic-synchronization" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Automatic Synchronization<a href="#automatic-synchronization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/09_Temporal_Isolation_and_Look-Ahead_Prevention_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Guarantee</strong>: All data fetched within a single <code>runInContext()</code> callback shares the same temporal boundary. Look-ahead bias across timeframes is architecturally impossible.</p>
<hr>
<a id="backtest-vs-live-mode-behavior" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Backtest vs Live Mode Behavior<a href="#backtest-vs-live-mode-behavior" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="identical-code-different-time-sources" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Identical Code, Different Time Sources<a href="#identical-code-different-time-sources" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Aspect</th>
<th>Backtest Mode</th>
<th>Live Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Context Source</strong></td>
<td><code>BacktestLogicPrivateService</code></td>
<td><code>LiveLogicPrivateService</code></td>
</tr>
<tr>
<td><strong>when Value</strong></td>
<td>Frame timestamp (historical)</td>
<td><code>Date.now()</code> (current time)</td>
</tr>
<tr>
<td><strong>backtest Flag</strong></td>
<td><code>true</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>Data Access</strong></td>
<td>Filtered to historical</td>
<td>Filtered to current (same logic)</td>
</tr>
<tr>
<td><strong>Persistence</strong></td>
<td>In-memory only</td>
<td>Atomic file writes (crash recovery)</td>
</tr>
<tr>
<td><strong>Iteration</strong></td>
<td>Fast-forward through frames</td>
<td>Real-time tick loop</td>
</tr>
</tbody>
</table>
<a id="code-example-mode-agnostic-strategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Code Example: Mode-Agnostic Strategy<a href="#code-example-mode-agnostic-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">// This exact code runs in both backtest and live mode</span><br/><span class="hl-1">addStrategy</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">interval:</span><span class="hl-2"> </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-1">getSignal</span><span class="hl-6">:</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-0">// getDate() returns frame timestamp (backtest) or Date.now() (live)</span><br/><span class="hl-2">        </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">currentTime</span><span class="hl-2"> = </span><span class="hl-1">getDate</span><span class="hl-2">();</span><br/><span class="hl-2">        </span><br/><span class="hl-2">        </span><span class="hl-0">// getCandles() filters to &lt;= currentTime automatically</span><br/><span class="hl-2">        </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles1h</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1h&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);</span><br/><span class="hl-2">        </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles5m</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">, </span><span class="hl-7">60</span><span class="hl-2">);</span><br/><span class="hl-2">        </span><br/><span class="hl-2">        </span><span class="hl-0">// Calculate indicators using historical data only</span><br/><span class="hl-2">        </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">sma20</span><span class="hl-2"> = </span><span class="hl-1">calculateSMA</span><span class="hl-2">(</span><span class="hl-6">candles5m</span><span class="hl-2">, </span><span class="hl-7">20</span><span class="hl-2">);</span><br/><span class="hl-2">        </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">rsi</span><span class="hl-2"> = </span><span class="hl-1">calculateRSI</span><span class="hl-2">(</span><span class="hl-6">candles1h</span><span class="hl-2">, </span><span class="hl-7">14</span><span class="hl-2">);</span><br/><span class="hl-2">        </span><br/><span class="hl-2">        </span><span class="hl-0">// Generate signal (same logic for both modes)</span><br/><span class="hl-2">        </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">rsi</span><span class="hl-2"> &lt; </span><span class="hl-7">30</span><span class="hl-2"> &amp;&amp; </span><span class="hl-6">sma20</span><span class="hl-2"> &gt; </span><span class="hl-6">candles5m</span><span class="hl-2">[</span><span class="hl-7">0</span><span class="hl-2">].</span><span class="hl-6">close</span><span class="hl-2">) {</span><br/><span class="hl-2">            </span><span class="hl-5">return</span><span class="hl-2"> {</span><br/><span class="hl-2">                </span><span class="hl-6">position:</span><span class="hl-2"> </span><span class="hl-4">&quot;long&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">priceTakeProfit:</span><span class="hl-2"> </span><span class="hl-6">candles5m</span><span class="hl-2">[</span><span class="hl-7">0</span><span class="hl-2">].</span><span class="hl-6">close</span><span class="hl-2"> * </span><span class="hl-7">1.02</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">priceStopLoss:</span><span class="hl-2"> </span><span class="hl-6">candles5m</span><span class="hl-2">[</span><span class="hl-7">0</span><span class="hl-2">].</span><span class="hl-6">close</span><span class="hl-2"> * </span><span class="hl-7">0.98</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-6">minuteEstimatedTime:</span><span class="hl-2"> </span><span class="hl-7">60</span><span class="hl-2">,</span><br/><span class="hl-2">            };</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">        </span><br/><span class="hl-2">        </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">null</span><span class="hl-2">;</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Run backtest</span><br/><span class="hl-6">Backtest</span><span class="hl-2">.</span><span class="hl-1">background</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">    </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-4">&quot;binance&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">frameName:</span><span class="hl-2"> </span><span class="hl-4">&quot;1d-test&quot;</span><span class="hl-2">,  </span><span class="hl-0">// Historical period</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Run live (same strategy code)</span><br/><span class="hl-6">Live</span><span class="hl-2">.</span><span class="hl-1">background</span><span class="hl-2">(</span><span class="hl-4">&quot;BTCUSDT&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">    </span><span class="hl-6">strategyName:</span><span class="hl-2"> </span><span class="hl-4">&quot;my-strategy&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-6">exchangeName:</span><span class="hl-2"> </span><span class="hl-4">&quot;binance&quot;</span><span class="hl-2">,  </span><span class="hl-0">// Live API</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Key Insight</strong>: The strategy code never explicitly handles timestamps. Temporal isolation is enforced by the execution engine, not by user code discipline.</p>
<hr>
<a id="context-propagation-through-call-stack" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context Propagation Through Call Stack<a href="#context-propagation-through-call-stack" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="asynclocalstorage-behavior" class="tsd-anchor"></a><h3 class="tsd-anchor-link">AsyncLocalStorage Behavior<a href="#asynclocalstorage-behavior" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/09_Temporal_Isolation_and_Look-Ahead_Prevention_4.svg" alt="Mermaid Diagram"></p>
<p><strong>Key Characteristics</strong>:</p>
<ol>
<li><strong>No explicit parameter passing</strong>: <code>when</code> timestamp never appears in user function signatures</li>
<li><strong>Automatic propagation</strong>: Context flows through <code>await</code>, <code>Promise.then()</code>, <code>async</code> functions automatically</li>
<li><strong>Call stack isolation</strong>: Nested contexts don't interfere (important for parallel execution)</li>
<li><strong>Memory efficiency</strong>: Context destroyed after callback completes</li>
</ol>
<hr>
<a id="validation-and-testing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation and Testing<a href="#validation-and-testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="test-case-look-ahead-protection" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Test Case: Look-Ahead Protection<a href="#test-case-look-ahead-protection" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>From <a href="">test/e2e/defend.test.mjs:1519-1653</a>, a test verifies extreme volatility scenarios where both TP and SL are hit on a single candle:</p>
<pre><code class="typescript"><span class="hl-1">test</span><span class="hl-2">(</span><span class="hl-4">&quot;DEFEND: Extreme volatility - price crosses both TP and SL in single candle&quot;</span><span class="hl-2">, </span><br/><span class="hl-2">    </span><span class="hl-3">async</span><span class="hl-2"> ({ </span><span class="hl-6">pass</span><span class="hl-2">, </span><span class="hl-6">fail</span><span class="hl-2"> }) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// Candle with: low=40500 (&lt; SL), high=43500 (&gt; TP)</span><br/><span class="hl-2">    </span><span class="hl-0">// Strategy: priceOpen=42000, TP=43000, SL=41000</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Expected: Closes at TP (not SL)</span><br/><span class="hl-2">    </span><span class="hl-0">// Because temporal ordering: price rises first (TP), then falls (SL)</span><br/><span class="hl-2">    </span><span class="hl-0">// Confirms temporal filtering respects candle internal structure</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>What This Tests</strong>:</p>
<ul>
<li>Context provides single timestamp per candle</li>
<li>Both TP and SL conditions checked within that timestamp</li>
<li>Correct exit selection based on candle data</li>
<li>No access to &quot;future&quot; candles during decision</li>
</ul>
<a id="test-case-scheduled-signal-temporal-isolation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Test Case: Scheduled Signal Temporal Isolation<a href="#test-case-scheduled-signal-temporal-isolation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>From <a href="">test/e2e/defend.test.mjs:1393-1507</a>, a test verifies scheduled signals cannot access future data:</p>
<pre><code class="typescript"><span class="hl-1">test</span><span class="hl-2">(</span><span class="hl-4">&quot;DEFEND: Scheduled LONG cancelled by SL BEFORE activation&quot;</span><span class="hl-2">, </span><br/><span class="hl-2">    </span><span class="hl-3">async</span><span class="hl-2"> ({ </span><span class="hl-6">pass</span><span class="hl-2">, </span><span class="hl-6">fail</span><span class="hl-2"> }) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// Price: 45000 → 39000 (skips priceOpen=42000)</span><br/><span class="hl-2">    </span><span class="hl-0">// StopLoss=40000 hit without activation</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Expected: Signal cancelled (not opened)</span><br/><span class="hl-2">    </span><span class="hl-0">// Confirms context enforces activation timing</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="performance-considerations" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Considerations<a href="#performance-considerations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="context-overhead" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context Overhead<a href="#context-overhead" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Operation</th>
<th>Overhead</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>AsyncLocalStorage creation</strong></td>
<td>~1µs per context</td>
<td>Negligible (once per tick)</td>
</tr>
<tr>
<td><strong>Context read</strong></td>
<td>~100ns</td>
<td>Negligible (cached in V8)</td>
</tr>
<tr>
<td><strong>Call stack propagation</strong></td>
<td>0ns</td>
<td>No cost (native async_hooks)</td>
</tr>
<tr>
<td><strong>Memory per context</strong></td>
<td>~200 bytes</td>
<td>Minimal (short-lived)</td>
</tr>
</tbody>
</table>
<p><strong>Benchmark</strong>: 10,000 ticks/second sustainable on modern hardware with full context propagation.</p>
<a id="optimization-context-caching" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Optimization: Context Caching<a href="#optimization-context-caching" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>ExecutionContextService</code> instance is memoized per execution, avoiding repeated DI lookups:</p>
<pre><code class="typescript"><span class="hl-0">// From connection service pattern</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">getExchange</span><span class="hl-2"> = </span><span class="hl-1">memoize</span><span class="hl-2">((</span><span class="hl-6">symbol</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">: </span><span class="hl-11">string</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">ClientExchange</span><span class="hl-2">({</span><br/><span class="hl-2">        </span><span class="hl-6">execution:</span><span class="hl-2"> </span><span class="hl-6">ExecutionContextService</span><span class="hl-2">,  </span><span class="hl-0">// Same instance reused</span><br/><span class="hl-2">        </span><span class="hl-0">// ...</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="common-patterns-and-anti-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Common Patterns and Anti-Patterns<a href="#common-patterns-and-anti-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="✅-correct-implicit-context-usage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">✅ Correct: Implicit Context Usage<a href="#✅-correct-implicit-context-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-2">: </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// CORRECT: No timestamp parameters</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1h&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">price</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getAveragePrice</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">now</span><span class="hl-2"> = </span><span class="hl-1">getDate</span><span class="hl-2">();</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Strategy logic using historical data only</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="❌-anti-pattern-manual-timestamp-management" class="tsd-anchor"></a><h3 class="tsd-anchor-link">❌ Anti-Pattern: Manual Timestamp Management<a href="#❌-anti-pattern-manual-timestamp-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-2">: </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">when</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// WRONG: Don&#39;t manage timestamps manually</span><br/><span class="hl-2">    </span><span class="hl-0">// This bypasses temporal isolation</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">fetchCandlesDirect</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">when</span><span class="hl-2">);  </span><span class="hl-0">// Bad!</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// CORRECT: Use provided functions</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">candles</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1h&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">);  </span><span class="hl-0">// Good!</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="✅-correct-multi-timeframe-analysis" class="tsd-anchor"></a><h3 class="tsd-anchor-link">✅ Correct: Multi-Timeframe Analysis<a href="#✅-correct-multi-timeframe-analysis" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-2">: </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// All fetches automatically synchronized to same &#39;when&#39;</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> [</span><span class="hl-8">candles1m</span><span class="hl-2">, </span><span class="hl-8">candles5m</span><span class="hl-2">, </span><span class="hl-8">candles1h</span><span class="hl-2">] = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-11">Promise</span><span class="hl-2">.</span><span class="hl-1">all</span><span class="hl-2">([</span><br/><span class="hl-2">        </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1m&quot;</span><span class="hl-2">, </span><span class="hl-7">30</span><span class="hl-2">),</span><br/><span class="hl-2">        </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;5m&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">),</span><br/><span class="hl-2">        </span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-4">&quot;1h&quot;</span><span class="hl-2">, </span><span class="hl-7">24</span><span class="hl-2">),</span><br/><span class="hl-2">    ]);</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// All data aligned to same temporal boundary</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="❌-anti-pattern-storing-context-reference" class="tsd-anchor"></a><h3 class="tsd-anchor-link">❌ Anti-Pattern: Storing Context Reference<a href="#❌-anti-pattern-storing-context-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-6">savedContext</span><span class="hl-2">;</span><br/><br/><span class="hl-10">getSignal</span><span class="hl-2">: </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// WRONG: Don&#39;t store context across ticks</span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (!</span><span class="hl-6">savedContext</span><span class="hl-2">) {</span><br/><span class="hl-2">        </span><span class="hl-6">savedContext</span><span class="hl-2"> = </span><span class="hl-6">ExecutionContextService</span><span class="hl-2">;  </span><span class="hl-0">// Bad!</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// CORRECT: Context is ephemeral, accessed per-call</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">now</span><span class="hl-2"> = </span><span class="hl-1">getDate</span><span class="hl-2">();  </span><span class="hl-0">// Good!</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="integration-with-other-systems" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Other Systems<a href="#integration-with-other-systems" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="clientstrategy-context-usage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ClientStrategy Context Usage<a href="#clientstrategy-context-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>From <a href="">src/client/ClientStrategy.ts:339</a>:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">currentTime</span><span class="hl-2"> = </span><span class="hl-6">self</span><span class="hl-2">.</span><span class="hl-6">params</span><span class="hl-2">.</span><span class="hl-6">execution</span><span class="hl-2">.</span><span class="hl-6">context</span><span class="hl-2">.</span><span class="hl-6">when</span><span class="hl-2">.</span><span class="hl-1">getTime</span><span class="hl-2">();</span>
</code><button type="button">Copy</button></pre>

<p>The strategy client directly reads <code>execution.context.when</code> for:</p>
<ul>
<li>Signal throttling (interval enforcement)</li>
<li>Timestamp assignment (<code>scheduledAt</code>, <code>pendingAt</code>)</li>
<li>Time-based validation</li>
</ul>
<a id="clientexchange-temporal-filtering" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ClientExchange Temporal Filtering<a href="#clientexchange-temporal-filtering" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The exchange client implements filtering in <code>getCandles()</code>:</p>
<pre><code class="typescript"><span class="hl-10">getCandles</span><span class="hl-2">: </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">interval</span><span class="hl-2">, </span><span class="hl-6">limit</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">execution</span><span class="hl-2"> = </span><span class="hl-1">inject</span><span class="hl-2">(</span><span class="hl-6">ExecutionContextService</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">rawCandles</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">schema</span><span class="hl-2">.</span><span class="hl-1">getCandles</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">interval</span><span class="hl-2">, </span><span class="hl-6">since</span><span class="hl-2">, </span><span class="hl-6">limit</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Temporal filter</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">rawCandles</span><span class="hl-2">.</span><span class="hl-1">filter</span><span class="hl-2">(</span><span class="hl-6">c</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">c</span><span class="hl-2">.</span><span class="hl-6">timestamp</span><span class="hl-2"> &lt;= </span><span class="hl-6">execution</span><span class="hl-2">.</span><span class="hl-6">context</span><span class="hl-2">.</span><span class="hl-6">when</span><span class="hl-2">.</span><span class="hl-1">getTime</span><span class="hl-2">());</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="risk-management-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Risk Management Integration<a href="#risk-management-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Risk validation receives current price via <code>getAveragePrice()</code>, which automatically respects temporal boundaries:</p>
<pre><code class="typescript"><span class="hl-0">// From IRiskValidationPayload</span><br/><span class="hl-3">interface</span><span class="hl-2"> </span><span class="hl-11">IRiskValidationPayload</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">currentPrice</span><span class="hl-2">: </span><span class="hl-11">number</span><span class="hl-2">;  </span><span class="hl-0">// Always historical in backtest</span><br/><span class="hl-2">    </span><span class="hl-0">// ...</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="limitations-and-edge-cases" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Limitations and Edge Cases<a href="#limitations-and-edge-cases" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="1-external-api-calls" class="tsd-anchor"></a><h3 class="tsd-anchor-link">1. External API Calls<a href="#1-external-api-calls" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If strategy code makes direct HTTP requests (bypassing <code>getCandles()</code>), temporal isolation <strong>does not apply</strong>:</p>
<pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-2">: </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// UNSAFE: External API bypasses context</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">news</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-1">fetch</span><span class="hl-2">(</span><span class="hl-4">`https://api.example.com/news?symbol=</span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// In backtest: receives current/future news (look-ahead bias!)</span><br/><span class="hl-2">    </span><span class="hl-0">// In live: works correctly</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Mitigation</strong>: Use <code>IOptimizerSource</code> pattern for external data with proper date filtering.</p>
<a id="2-file-system-access" class="tsd-anchor"></a><h3 class="tsd-anchor-link">2. File System Access<a href="#2-file-system-access" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Reading from disk files directly does not respect temporal context:</p>
<pre><code class="typescript"><span class="hl-10">getSignal</span><span class="hl-2">: </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// UNSAFE: File contains all-time data</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">allData</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">fs</span><span class="hl-2">.</span><span class="hl-1">readFile</span><span class="hl-2">(</span><span class="hl-4">`./data/</span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">.json`</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// Must manually filter by getDate()</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">filteredData</span><span class="hl-2"> = </span><span class="hl-6">allData</span><span class="hl-2">.</span><span class="hl-1">filter</span><span class="hl-2">(</span><span class="hl-6">d</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">d</span><span class="hl-2">.</span><span class="hl-6">timestamp</span><span class="hl-2"> &lt;= </span><span class="hl-1">getDate</span><span class="hl-2">());</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="3-shared-state-across-ticks" class="tsd-anchor"></a><h3 class="tsd-anchor-link">3. Shared State Across Ticks<a href="#3-shared-state-across-ticks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Mutable state persisted across ticks can leak future information:</p>
<pre><code class="typescript"><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-6">globalCache</span><span class="hl-2"> = {};  </span><span class="hl-0">// DANGEROUS!</span><br/><br/><span class="hl-10">getSignal</span><span class="hl-2">: </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-6">symbol</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// In backtest: cache may contain future data from previous ticks</span><br/><span class="hl-2">    </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">globalCache</span><span class="hl-2">[</span><span class="hl-6">symbol</span><span class="hl-2">]) {</span><br/><span class="hl-2">        </span><span class="hl-0">// Potentially using future data</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-0">// SAFE: Clear cache or use tick-local state</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">localCache</span><span class="hl-2"> = {};</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<a id="summary" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Summary<a href="#summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Feature</th>
<th>Implementation</th>
<th>Benefit</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Temporal Isolation</strong></td>
<td><code>ExecutionContextService</code> + AsyncLocalStorage</td>
<td>Architecturally prevents look-ahead bias</td>
</tr>
<tr>
<td><strong>Implicit Context</strong></td>
<td>No timestamp parameters in user code</td>
<td>Simpler API, fewer bugs</td>
</tr>
<tr>
<td><strong>Multi-Timeframe Sync</strong></td>
<td>Shared <code>when</code> across all data fetches</td>
<td>Automatic alignment, no manual coordination</td>
</tr>
<tr>
<td><strong>Mode Independence</strong></td>
<td>Same context pattern for backtest/live</td>
<td>Write once, run anywhere</td>
</tr>
<tr>
<td><strong>Zero Overhead</strong></td>
<td>Native async_hooks, ~100ns reads</td>
<td>Production-grade performance</td>
</tr>
</tbody>
</table>
<p>The temporal isolation system makes it <strong>impossible</strong> to accidentally introduce look-ahead bias through normal API usage. The <code>when</code> timestamp is enforced at the framework level, not relying on developer discipline.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#temporal-isolation-and-look-ahead-prevention"><span>Temporal <wbr/>Isolation and <wbr/>Look-<wbr/>Ahead <wbr/>Prevention</span></a><ul><li><a href="#purpose-and-scope"><span>Purpose and <wbr/>Scope</span></a></li><li><a href="#the-look-ahead-bias-problem"><span>The <wbr/>Look-<wbr/>Ahead <wbr/>Bias <wbr/>Problem</span></a></li><li><a href="#architecture-overview-context-propagation"><span>Architecture <wbr/>Overview: <wbr/>Context <wbr/>Propagation</span></a></li><li><a href="#temporal-filtering-mechanism"><span>Temporal <wbr/>Filtering <wbr/>Mechanism</span></a></li><li><ul><li><a href="#data-access-timeline"><span>Data <wbr/>Access <wbr/>Timeline</span></a></li><li><a href="#filtering-logic-sequence"><span>Filtering <wbr/>Logic <wbr/>Sequence</span></a></li></ul></li><li><a href="#implementation-executioncontextservice"><span>Implementation: <wbr/>Execution<wbr/>Context<wbr/>Service</span></a></li><li><ul><li><a href="#type-definition"><span>Type <wbr/>Definition</span></a></li><li><a href="#service-declaration"><span>Service <wbr/>Declaration</span></a></li><li><a href="#usage-pattern"><span>Usage <wbr/>Pattern</span></a></li></ul></li><li><a href="#public-api-functions-with-temporal-context"><span>Public API <wbr/>Functions with <wbr/>Temporal <wbr/>Context</span></a></li><li><ul><li><a href="#getcandles"><span>get<wbr/>Candles()</span></a></li><li><a href="#getaverageprice"><span>get<wbr/>Average<wbr/>Price()</span></a></li><li><a href="#getdate-and-getmode"><span>get<wbr/>Date() and get<wbr/>Mode()</span></a></li></ul></li><li><a href="#multi-timeframe-data-synchronization"><span>Multi-<wbr/>Timeframe <wbr/>Data <wbr/>Synchronization</span></a></li><li><ul><li><a href="#the-challenge"><span>The <wbr/>Challenge</span></a></li><li><a href="#automatic-synchronization"><span>Automatic <wbr/>Synchronization</span></a></li></ul></li><li><a href="#backtest-vs-live-mode-behavior"><span>Backtest vs <wbr/>Live <wbr/>Mode <wbr/>Behavior</span></a></li><li><ul><li><a href="#identical-code-different-time-sources"><span>Identical <wbr/>Code, <wbr/>Different <wbr/>Time <wbr/>Sources</span></a></li><li><a href="#code-example-mode-agnostic-strategy"><span>Code <wbr/>Example: <wbr/>Mode-<wbr/>Agnostic <wbr/>Strategy</span></a></li></ul></li><li><a href="#context-propagation-through-call-stack"><span>Context <wbr/>Propagation <wbr/>Through <wbr/>Call <wbr/>Stack</span></a></li><li><ul><li><a href="#asynclocalstorage-behavior"><span>Async<wbr/>Local<wbr/>Storage <wbr/>Behavior</span></a></li></ul></li><li><a href="#validation-and-testing"><span>Validation and <wbr/>Testing</span></a></li><li><ul><li><a href="#test-case-look-ahead-protection"><span>Test <wbr/>Case: <wbr/>Look-<wbr/>Ahead <wbr/>Protection</span></a></li><li><a href="#test-case-scheduled-signal-temporal-isolation"><span>Test <wbr/>Case: <wbr/>Scheduled <wbr/>Signal <wbr/>Temporal <wbr/>Isolation</span></a></li></ul></li><li><a href="#performance-considerations"><span>Performance <wbr/>Considerations</span></a></li><li><ul><li><a href="#context-overhead"><span>Context <wbr/>Overhead</span></a></li><li><a href="#optimization-context-caching"><span>Optimization: <wbr/>Context <wbr/>Caching</span></a></li></ul></li><li><a href="#common-patterns-and-anti-patterns"><span>Common <wbr/>Patterns and <wbr/>Anti-<wbr/>Patterns</span></a></li><li><ul><li><a href="#✅-correct-implicit-context-usage"><span>✅ <wbr/>Correct: <wbr/>Implicit <wbr/>Context <wbr/>Usage</span></a></li><li><a href="#❌-anti-pattern-manual-timestamp-management"><span>❌ <wbr/>Anti-<wbr/>Pattern: <wbr/>Manual <wbr/>Timestamp <wbr/>Management</span></a></li><li><a href="#✅-correct-multi-timeframe-analysis"><span>✅ <wbr/>Correct: <wbr/>Multi-<wbr/>Timeframe <wbr/>Analysis</span></a></li><li><a href="#❌-anti-pattern-storing-context-reference"><span>❌ <wbr/>Anti-<wbr/>Pattern: <wbr/>Storing <wbr/>Context <wbr/>Reference</span></a></li></ul></li><li><a href="#integration-with-other-systems"><span>Integration with <wbr/>Other <wbr/>Systems</span></a></li><li><ul><li><a href="#clientstrategy-context-usage"><span>Client<wbr/>Strategy <wbr/>Context <wbr/>Usage</span></a></li><li><a href="#clientexchange-temporal-filtering"><span>Client<wbr/>Exchange <wbr/>Temporal <wbr/>Filtering</span></a></li><li><a href="#risk-management-integration"><span>Risk <wbr/>Management <wbr/>Integration</span></a></li></ul></li><li><a href="#limitations-and-edge-cases"><span>Limitations and <wbr/>Edge <wbr/>Cases</span></a></li><li><ul><li><a href="#1-external-api-calls"><span>1. <wbr/>External API <wbr/>Calls</span></a></li><li><a href="#2-file-system-access"><span>2. <wbr/>File <wbr/>System <wbr/>Access</span></a></li><li><a href="#3-shared-state-across-ticks"><span>3. <wbr/>Shared <wbr/>State <wbr/>Across <wbr/>Ticks</span></a></li></ul></li><li><a href="#summary"><span>Summary</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
