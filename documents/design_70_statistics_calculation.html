<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/70_statistics_calculation | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_70_statistics_calculation.html">design/70_statistics_calculation</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="statistics-calculation" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Statistics Calculation<a href="#statistics-calculation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This page documents the statistical calculation system in backtest-kit, which computes performance metrics from signal data. For report generation and markdown formatting, see <a href="design_68_markdown_report_generation.html">Markdown Report Generation</a>. For performance timing metrics, see <a href="design_69_performance_metrics.html">Performance Metrics</a>.</p>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The statistics calculation system transforms raw signal events into actionable performance metrics. Three specialized services handle different execution modes:</p>
<ul>
<li><strong>BacktestStatistics</strong> - Metrics for historical simulation (<a href="">BacktestMarkdownService.ts:66-102</a>)</li>
<li><strong>LiveStatistics</strong> - Metrics for real-time trading (<a href="">LiveMarkdownService.ts:91-130</a>)</li>
<li><strong>ScheduleStatistics</strong> - Metrics for scheduled signal tracking (<a href="">ScheduleMarkdownService.ts:68-86</a>)</li>
</ul>
<p>All metrics include safe math checks to handle edge cases (NaN, Infinity) and return <code>null</code> for unsafe calculations.</p>
<a id="statistics-calculation-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Statistics Calculation Architecture<a href="#statistics-calculation-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/70_Statistics_Calculation_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Calculation Flow:</strong></p>
<ol>
<li><strong>Event Emission</strong> - Signals emitted via Subject-based emitters</li>
<li><strong>Event Subscription</strong> - Markdown services subscribe in <code>init()</code> via singleshot</li>
<li><strong>Event Accumulation</strong> - ReportStorage classes maintain event lists (max 250 for live/schedule)</li>
<li><strong>Statistics Calculation</strong> - <code>getData()</code> computes metrics from accumulated data</li>
<li><strong>Safe Math Validation</strong> - <code>isUnsafe()</code> checks prevent NaN/Infinity in results</li>
</ol>
<a id="backteststatistics-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">BacktestStatistics Structure<a href="#backteststatistics-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>Purpose:</strong> Comprehensive metrics for historical backtesting with closed signals only.</p>
<a id="interface-definition" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interface Definition<a href="#interface-definition" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">BacktestStatistics</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">signalList</span><span class="hl-1">: </span><span class="hl-10">IStrategyTickResultClosed</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">totalSignals</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">winCount</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">lossCount</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">winRate</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;              </span><span class="hl-5">// 0-100%, higher is better</span><br/><span class="hl-1">  </span><span class="hl-4">avgPnl</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;               </span><span class="hl-5">// Average PNL %, higher is better</span><br/><span class="hl-1">  </span><span class="hl-4">totalPnl</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;             </span><span class="hl-5">// Cumulative PNL %, higher is better</span><br/><span class="hl-1">  </span><span class="hl-4">stdDev</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;               </span><span class="hl-5">// Volatility, lower is better</span><br/><span class="hl-1">  </span><span class="hl-4">sharpeRatio</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;          </span><span class="hl-5">// Risk-adjusted return, higher is better</span><br/><span class="hl-1">  </span><span class="hl-4">annualizedSharpeRatio</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">; </span><span class="hl-5">// Sharpe × √365, higher is better</span><br/><span class="hl-1">  </span><span class="hl-4">certaintyRatio</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;       </span><span class="hl-5">// avgWin / |avgLoss|, higher is better</span><br/><span class="hl-1">  </span><span class="hl-4">expectedYearlyReturns</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">; </span><span class="hl-5">// Projected annual return, higher is better</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="calculation-location" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Calculation Location<a href="#calculation-location" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Statistics computed in <a href="">BacktestMarkdownService.ts:183-194</a> by <code>ReportStorage.getData()</code>:</p>
<pre><code class="typescript"><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">getData</span><span class="hl-1">(): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-4">BacktestStatistics</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (this._signalList.length === 0) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> { </span><span class="hl-5">/* null values */</span><span class="hl-1"> };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  const </span><span class="hl-4">totalSignals</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-1">  const </span><span class="hl-4">winCount</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-1">  const </span><span class="hl-4">lossCount</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Calculate metrics with safe math checks...</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="livestatistics-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">LiveStatistics Structure<a href="#livestatistics-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>Purpose:</strong> Real-time trading metrics including idle, opened, active, and closed events.</p>
<a id="interface-definition-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interface Definition<a href="#interface-definition-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">LiveStatistics</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">eventList</span><span class="hl-1">: </span><span class="hl-10">TickEvent</span><span class="hl-1">[];              </span><span class="hl-5">// All events (idle/opened/active/closed)</span><br/><span class="hl-1">  </span><span class="hl-4">totalEvents</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;                 </span><span class="hl-5">// All event types</span><br/><span class="hl-1">  </span><span class="hl-4">totalClosed</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;                 </span><span class="hl-5">// Closed signals only</span><br/><span class="hl-1">  </span><span class="hl-4">winCount</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">lossCount</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">winRate</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">avgPnl</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalPnl</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">stdDev</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">sharpeRatio</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">annualizedSharpeRatio</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">certaintyRatio</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">expectedYearlyReturns</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="key-differences-from-backtest" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Key Differences from Backtest<a href="#key-differences-from-backtest" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Event List Scope</strong> - Includes idle/active events, not just closed</li>
<li><strong>Dual Totals</strong> - <code>totalEvents</code> (all) vs <code>totalClosed</code> (metrics basis)</li>
<li><strong>Event Replacement</strong> - Active events replace previous with same signalId (<a href="">LiveMarkdownService.ts:299-329</a>)</li>
<li><strong>Max Queue Size</strong> - Limited to 250 events (<a href="">LiveMarkdownService.ts:223</a>)</li>
</ol>
<a id="schedulestatistics-structure" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ScheduleStatistics Structure<a href="#schedulestatistics-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>Purpose:</strong> Track scheduled signal behavior and cancellation patterns.</p>
<a id="interface-definition-2" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Interface Definition<a href="#interface-definition-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-10">ScheduleStatistics</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">eventList</span><span class="hl-1">: </span><span class="hl-10">ScheduledEvent</span><span class="hl-1">[];         </span><span class="hl-5">// Scheduled + cancelled events</span><br/><span class="hl-1">  </span><span class="hl-4">totalEvents</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalScheduled</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalCancelled</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">cancellationRate</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;     </span><span class="hl-5">// %, lower is better</span><br/><span class="hl-1">  </span><span class="hl-4">avgWaitTime</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">;          </span><span class="hl-5">// Minutes for cancelled signals</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="unique-metrics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Unique Metrics<a href="#unique-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Metric</th>
<th>Formula</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cancellationRate</code></td>
<td><code>(totalCancelled / totalScheduled) × 100</code></td>
<td>Measures limit order fill rate</td>
</tr>
<tr>
<td><code>avgWaitTime</code></td>
<td><code>Σ(duration) / totalCancelled</code></td>
<td>Average time before cancellation</td>
</tr>
</tbody>
</table>
<a id="safe-math-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Safe Math Implementation<a href="#safe-math-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="isunsafe-function" class="tsd-anchor"></a><h3 class="tsd-anchor-link">isUnsafe Function<a href="#isunsafe-function" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Prevents invalid numeric values from appearing in statistics:</p>
<pre><code class="typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">): </span><span class="hl-10">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-6">typeof</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1"> !== </span><span class="hl-2">&quot;number&quot;</span><span class="hl-1">) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-0">isNaN</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-0">isFinite</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Validation Flow:</strong></p>
<p><img src="../media/70_Statistics_Calculation_1.svg" alt="Mermaid Diagram"></p>
<a id="application-examples" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Application Examples<a href="#application-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All calculated metrics pass through safe math checks:</p>
<pre><code class="typescript"><span class="hl-5">// From BacktestMarkdownService.ts</span><br/><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">winRate:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">winRate</span><span class="hl-1">) ? </span><span class="hl-6">null</span><span class="hl-1"> : </span><span class="hl-4">winRate</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">avgPnl:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">avgPnl</span><span class="hl-1">) ? </span><span class="hl-6">null</span><span class="hl-1"> : </span><span class="hl-4">avgPnl</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">totalPnl:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">totalPnl</span><span class="hl-1">) ? </span><span class="hl-6">null</span><span class="hl-1"> : </span><span class="hl-4">totalPnl</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">stdDev:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">stdDev</span><span class="hl-1">) ? </span><span class="hl-6">null</span><span class="hl-1"> : </span><span class="hl-4">stdDev</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">sharpeRatio:</span><span class="hl-1"> </span><span class="hl-0">isUnsafe</span><span class="hl-1">(</span><span class="hl-4">sharpeRatio</span><span class="hl-1">) ? </span><span class="hl-6">null</span><span class="hl-1"> : </span><span class="hl-4">sharpeRatio</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">// ... all other metrics</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><strong>Edge Cases Handled:</strong></p>
<ul>
<li>Division by zero (returns <code>null</code>)</li>
<li>Empty signal list (returns <code>null</code>)</li>
<li>Square root of negative variance (returns <code>null</code>)</li>
<li>Infinite trade duration (returns <code>null</code>)</li>
</ul>
<a id="basic-metrics-calculation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Basic Metrics Calculation<a href="#basic-metrics-calculation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="win-rate" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Win Rate<a href="#win-rate" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Formula:</strong> <code>(winCount / totalSignals) × 100</code></p>
<p><strong>Code Location:</strong> <a href="">BacktestMarkdownService.ts:227</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">winCount</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lossCount</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">winRate</span><span class="hl-1"> = (</span><span class="hl-4">winCount</span><span class="hl-1"> / </span><span class="hl-4">totalSignals</span><span class="hl-1">) * </span><span class="hl-8">100</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Interpretation:</strong> Percentage of profitable trades. Higher is better.</p>
<a id="average-pnl" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Average PNL<a href="#average-pnl" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Formula:</strong> <code>Σ(pnlPercentage) / totalSignals</code></p>
<p><strong>Code Location:</strong> <a href="">BacktestMarkdownService.ts:225</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">avgPnl</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-8">0</span><br/><span class="hl-1">) / </span><span class="hl-4">totalSignals</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Interpretation:</strong> Mean profit/loss per trade. Higher is better.</p>
<a id="total-pnl" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Total PNL<a href="#total-pnl" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Formula:</strong> <code>Σ(pnlPercentage)</code></p>
<p><strong>Code Location:</strong> <a href="">BacktestMarkdownService.ts:226</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">totalPnl</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-8">0</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Interpretation:</strong> Cumulative profit/loss across all trades. Higher is better.</p>
<a id="risk-adjusted-metrics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Risk-Adjusted Metrics<a href="#risk-adjusted-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="standard-deviation-calculation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Standard Deviation Calculation<a href="#standard-deviation-calculation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Purpose:</strong> Measures volatility of returns (risk).</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">variance</span><span class="hl-1"> = </span><span class="hl-0">Σ</span><span class="hl-1">((</span><span class="hl-4">return</span><span class="hl-1"> - </span><span class="hl-4">avgPnl</span><span class="hl-1">)²) / </span><span class="hl-4">totalSignals</span><br/><span class="hl-4">stdDev</span><span class="hl-1"> = √</span><span class="hl-4">variance</span>
</code><button>Copy</button></pre>

<p><strong>Code Location:</strong> <a href="">BacktestMarkdownService.ts:229-232</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">returns</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">variance</span><span class="hl-1"> = </span><span class="hl-4">returns</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">r</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">pow</span><span class="hl-1">(</span><span class="hl-4">r</span><span class="hl-1"> - </span><span class="hl-4">avgPnl</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">), </span><br/><span class="hl-1">  </span><span class="hl-8">0</span><br/><span class="hl-1">) / </span><span class="hl-4">totalSignals</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">stdDev</span><span class="hl-1"> = </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">sqrt</span><span class="hl-1">(</span><span class="hl-4">variance</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Interpretation:</strong> Lower is better (less volatile).</p>
<a id="sharpe-ratio" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Sharpe Ratio<a href="#sharpe-ratio" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Purpose:</strong> Risk-adjusted return (assuming risk-free rate = 0).</p>
<p><strong>Formula:</strong> <code>avgPnl / stdDev</code></p>
<p><strong>Code Location:</strong> <a href="">BacktestMarkdownService.ts:233</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">sharpeRatio</span><span class="hl-1"> = </span><span class="hl-4">stdDev</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><span class="hl-1"> ? </span><span class="hl-4">avgPnl</span><span class="hl-1"> / </span><span class="hl-4">stdDev</span><span class="hl-1"> : </span><span class="hl-8">0</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Interpretation:</strong> Higher is better. Measures excess return per unit of risk.</p>
<p><strong>Typical Values:</strong></p>
<ul>
<li><code>&lt; 0</code> - Losing strategy</li>
<li><code>0-1</code> - Sub-optimal</li>
<li><code>1-2</code> - Good</li>
<li><code>&gt; 2</code> - Excellent</li>
</ul>
<a id="annualized-sharpe-ratio" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Annualized Sharpe Ratio<a href="#annualized-sharpe-ratio" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Purpose:</strong> Standardize Sharpe ratio to annual timeframe.</p>
<p><strong>Formula:</strong> <code>sharpeRatio × √365</code></p>
<p><strong>Code Location:</strong> <a href="">BacktestMarkdownService.ts:234</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">annualizedSharpeRatio</span><span class="hl-1"> = </span><span class="hl-4">sharpeRatio</span><span class="hl-1"> * </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">sqrt</span><span class="hl-1">(</span><span class="hl-8">365</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Interpretation:</strong> Higher is better. Accounts for trade frequency.</p>
<a id="advanced-metrics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Advanced Metrics<a href="#advanced-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="certainty-ratio-winloss-ratio" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Certainty Ratio (Win/Loss Ratio)<a href="#certainty-ratio-winloss-ratio" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Purpose:</strong> Measures quality of wins vs losses.</p>
<p><strong>Formula:</strong> <code>avgWin / |avgLoss|</code></p>
<p><strong>Code Location:</strong> <a href="">BacktestMarkdownService.ts:236-245</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">wins</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">losses</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1">);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">avgWin</span><span class="hl-1"> = </span><span class="hl-4">wins</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><br/><span class="hl-1">  ? </span><span class="hl-4">wins</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-8">0</span><span class="hl-1">) / </span><span class="hl-4">wins</span><span class="hl-1">.</span><span class="hl-4">length</span><br/><span class="hl-1">  : </span><span class="hl-8">0</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">avgLoss</span><span class="hl-1"> = </span><span class="hl-4">losses</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><br/><span class="hl-1">  ? </span><span class="hl-4">losses</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">pnl</span><span class="hl-1">.</span><span class="hl-4">pnlPercentage</span><span class="hl-1">, </span><span class="hl-8">0</span><span class="hl-1">) / </span><span class="hl-4">losses</span><span class="hl-1">.</span><span class="hl-4">length</span><br/><span class="hl-1">  : </span><span class="hl-8">0</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">certaintyRatio</span><span class="hl-1"> = </span><span class="hl-4">avgLoss</span><span class="hl-1"> &lt; </span><span class="hl-8">0</span><span class="hl-1"> ? </span><span class="hl-4">avgWin</span><span class="hl-1"> / </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">abs</span><span class="hl-1">(</span><span class="hl-4">avgLoss</span><span class="hl-1">) : </span><span class="hl-8">0</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Interpretation:</strong></p>
<ul>
<li><code>&gt; 1.0</code> - Average win exceeds average loss (good)</li>
<li><code>&lt; 1.0</code> - Average loss exceeds average win (requires high win rate)</li>
</ul>
<a id="expected-yearly-returns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Expected Yearly Returns<a href="#expected-yearly-returns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Purpose:</strong> Project annual returns based on average trade duration.</p>
<p><strong>Formula:</strong></p>
<pre><code><span class="hl-4">avgDurationDays</span><span class="hl-1"> = </span><span class="hl-4">avgDurationMs</span><span class="hl-1"> / (</span><span class="hl-8">1000</span><span class="hl-1"> × </span><span class="hl-8">60</span><span class="hl-1"> × </span><span class="hl-8">60</span><span class="hl-1"> × </span><span class="hl-8">24</span><span class="hl-1">)</span><br/><span class="hl-4">tradesPerYear</span><span class="hl-1"> = </span><span class="hl-8">365</span><span class="hl-1"> / </span><span class="hl-4">avgDurationDays</span><br/><span class="hl-4">expectedYearlyReturns</span><span class="hl-1"> = </span><span class="hl-4">avgPnl</span><span class="hl-1"> × </span><span class="hl-4">tradesPerYear</span>
</code><button>Copy</button></pre>

<p><strong>Code Location:</strong> <a href="">BacktestMarkdownService.ts:247-254</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">avgDurationMs</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">_signalList</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">s</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + (</span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">closeTimestamp</span><span class="hl-1"> - </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">pendingAt</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-8">0</span><br/><span class="hl-1">) / </span><span class="hl-4">totalSignals</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">avgDurationDays</span><span class="hl-1"> = </span><span class="hl-4">avgDurationMs</span><span class="hl-1"> / (</span><span class="hl-8">1000</span><span class="hl-1"> * </span><span class="hl-8">60</span><span class="hl-1"> * </span><span class="hl-8">60</span><span class="hl-1"> * </span><span class="hl-8">24</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">tradesPerYear</span><span class="hl-1"> = </span><span class="hl-4">avgDurationDays</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><span class="hl-1"> ? </span><span class="hl-8">365</span><span class="hl-1"> / </span><span class="hl-4">avgDurationDays</span><span class="hl-1"> : </span><span class="hl-8">0</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">expectedYearlyReturns</span><span class="hl-1"> = </span><span class="hl-4">avgPnl</span><span class="hl-1"> * </span><span class="hl-4">tradesPerYear</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Assumptions:</strong></p>
<ul>
<li>Consistent trade frequency</li>
<li>Consistent position sizing</li>
<li>No compounding effects</li>
</ul>
<p><strong>Interpretation:</strong> Projected annual return percentage. Higher is better.</p>
<a id="schedule-specific-metrics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Schedule-Specific Metrics<a href="#schedule-specific-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="cancellation-rate" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Cancellation Rate<a href="#cancellation-rate" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Purpose:</strong> Measure effectiveness of scheduled (limit) orders.</p>
<p><strong>Formula:</strong> <code>(totalCancelled / totalScheduled) × 100</code></p>
<p><strong>Code Location:</strong> <a href="">ScheduleMarkdownService.ts:267-268</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cancellationRate</span><span class="hl-1"> = </span><span class="hl-4">totalScheduled</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><span class="hl-1"> </span><br/><span class="hl-1">  ? (</span><span class="hl-4">totalCancelled</span><span class="hl-1"> / </span><span class="hl-4">totalScheduled</span><span class="hl-1">) * </span><span class="hl-8">100</span><span class="hl-1"> </span><br/><span class="hl-1">  : </span><span class="hl-6">null</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Interpretation:</strong></p>
<ul>
<li>Low rate (&lt; 30%) - Good entry price selection</li>
<li>Medium rate (30-60%) - Average fill rate</li>
<li>High rate (&gt; 60%) - Poor entry price selection</li>
</ul>
<a id="average-wait-time" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Average Wait Time<a href="#average-wait-time" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Purpose:</strong> Measure time spent waiting before cancellation.</p>
<p><strong>Formula:</strong> <code>Σ(durationMinutes) / totalCancelled</code></p>
<p><strong>Code Location:</strong> <a href="">ScheduleMarkdownService.ts:271-275</a></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">avgWaitTime</span><span class="hl-1"> = </span><span class="hl-4">totalCancelled</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><br/><span class="hl-1">  ? </span><span class="hl-4">cancelledEvents</span><span class="hl-1">.</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-4">sum</span><span class="hl-1">, </span><span class="hl-4">e</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> + (</span><span class="hl-4">e</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1"> || </span><span class="hl-8">0</span><span class="hl-1">), </span><span class="hl-8">0</span><span class="hl-1">) / </span><span class="hl-4">totalCancelled</span><br/><span class="hl-1">  : </span><span class="hl-6">null</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Interpretation:</strong> Average minutes before scheduled signal cancels. Indicates patience threshold.</p>
<a id="metrics-calculation-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Metrics Calculation Flow<a href="#metrics-calculation-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/70_Statistics_Calculation_2.svg" alt="Mermaid Diagram"></p>
<a id="usage-examples" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage Examples<a href="#usage-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="accessing-backtest-statistics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Accessing Backtest Statistics<a href="#accessing-backtest-statistics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Backtest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// After backtest completion</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Backtest</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total Signals: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalSignals</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Win Rate: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">winRate</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Sharpe Ratio: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">sharpeRatio</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">3</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Expected Yearly Returns: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">expectedYearlyReturns</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Check for null values (safe math)</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">sharpeRatio</span><span class="hl-1"> === </span><span class="hl-6">null</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">&quot;Sharpe Ratio calculation resulted in unsafe value&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="accessing-live-statistics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Accessing Live Statistics<a href="#accessing-live-statistics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Live</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// During or after live trading</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Live</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total Events: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalEvents</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Closed Signals: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalClosed</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Win Rate: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">winRate</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Certainty Ratio: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">certaintyRatio</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">3</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Access raw event data</span><br/><span class="hl-4">stats</span><span class="hl-1">.</span><span class="hl-4">eventList</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-2">&quot;closed&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Signal </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">signalId</span><span class="hl-6">}</span><span class="hl-2">: </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">pnl</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="accessing-schedule-statistics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Accessing Schedule Statistics<a href="#accessing-schedule-statistics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Schedule</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;backtest-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">stats</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">Schedule</span><span class="hl-1">.</span><span class="hl-0">getData</span><span class="hl-1">(</span><span class="hl-2">&quot;my-strategy&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Scheduled: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalScheduled</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Cancelled: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">totalCancelled</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Cancellation Rate: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">cancellationRate</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Avg Wait Time: </span><span class="hl-6">${</span><span class="hl-4">stats</span><span class="hl-9">.</span><span class="hl-4">avgWaitTime</span><span class="hl-9">?.</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-8">2</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2"> minutes`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="metrics-interpretation-guide" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Metrics Interpretation Guide<a href="#metrics-interpretation-guide" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Metric</th>
<th>Optimal Range</th>
<th>Red Flag</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>winRate</code></td>
<td>55-70%</td>
<td>&lt; 45% or &gt; 80%</td>
</tr>
<tr>
<td><code>sharpeRatio</code></td>
<td>1.5-3.0</td>
<td>&lt; 0.5</td>
</tr>
<tr>
<td><code>annualizedSharpeRatio</code></td>
<td>2.0-4.0</td>
<td>&lt; 1.0</td>
</tr>
<tr>
<td><code>certaintyRatio</code></td>
<td>&gt; 1.5</td>
<td>&lt; 0.8</td>
</tr>
<tr>
<td><code>expectedYearlyReturns</code></td>
<td>&gt; 20%</td>
<td>&lt; 5%</td>
</tr>
<tr>
<td><code>cancellationRate</code></td>
<td>&lt; 40%</td>
<td>&gt; 70%</td>
</tr>
</tbody>
</table>
<p><strong>Warning Signs:</strong></p>
<ul>
<li><code>winRate &gt; 80%</code> - Possible over-fitting or unrealistic strategy</li>
<li><code>sharpeRatio &lt; 0.5</code> - High risk relative to returns</li>
<li><code>certaintyRatio &lt; 1.0</code> - Average losses exceed average wins</li>
<li><code>cancellationRate &gt; 70%</code> - Poor entry price selection</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#statistics-calculation"><span>Statistics <wbr/>Calculation</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#statistics-calculation-architecture"><span>Statistics <wbr/>Calculation <wbr/>Architecture</span></a></li><li><a href="#backteststatistics-structure"><span>Backtest<wbr/>Statistics <wbr/>Structure</span></a></li><li><ul><li><a href="#interface-definition"><span>Interface <wbr/>Definition</span></a></li><li><a href="#calculation-location"><span>Calculation <wbr/>Location</span></a></li></ul></li><li><a href="#livestatistics-structure"><span>Live<wbr/>Statistics <wbr/>Structure</span></a></li><li><ul><li><a href="#interface-definition-1"><span>Interface <wbr/>Definition</span></a></li><li><a href="#key-differences-from-backtest"><span>Key <wbr/>Differences from <wbr/>Backtest</span></a></li></ul></li><li><a href="#schedulestatistics-structure"><span>Schedule<wbr/>Statistics <wbr/>Structure</span></a></li><li><ul><li><a href="#interface-definition-2"><span>Interface <wbr/>Definition</span></a></li><li><a href="#unique-metrics"><span>Unique <wbr/>Metrics</span></a></li></ul></li><li><a href="#safe-math-implementation"><span>Safe <wbr/>Math <wbr/>Implementation</span></a></li><li><ul><li><a href="#isunsafe-function"><span>is<wbr/>Unsafe <wbr/>Function</span></a></li><li><a href="#application-examples"><span>Application <wbr/>Examples</span></a></li></ul></li><li><a href="#basic-metrics-calculation"><span>Basic <wbr/>Metrics <wbr/>Calculation</span></a></li><li><ul><li><a href="#win-rate"><span>Win <wbr/>Rate</span></a></li><li><a href="#average-pnl"><span>Average PNL</span></a></li><li><a href="#total-pnl"><span>Total PNL</span></a></li></ul></li><li><a href="#risk-adjusted-metrics"><span>Risk-<wbr/>Adjusted <wbr/>Metrics</span></a></li><li><ul><li><a href="#standard-deviation-calculation"><span>Standard <wbr/>Deviation <wbr/>Calculation</span></a></li><li><a href="#sharpe-ratio"><span>Sharpe <wbr/>Ratio</span></a></li><li><a href="#annualized-sharpe-ratio"><span>Annualized <wbr/>Sharpe <wbr/>Ratio</span></a></li></ul></li><li><a href="#advanced-metrics"><span>Advanced <wbr/>Metrics</span></a></li><li><ul><li><a href="#certainty-ratio-winloss-ratio"><span>Certainty <wbr/>Ratio (<wbr/>Win/<wbr/>Loss <wbr/>Ratio)</span></a></li><li><a href="#expected-yearly-returns"><span>Expected <wbr/>Yearly <wbr/>Returns</span></a></li></ul></li><li><a href="#schedule-specific-metrics"><span>Schedule-<wbr/>Specific <wbr/>Metrics</span></a></li><li><ul><li><a href="#cancellation-rate"><span>Cancellation <wbr/>Rate</span></a></li><li><a href="#average-wait-time"><span>Average <wbr/>Wait <wbr/>Time</span></a></li></ul></li><li><a href="#metrics-calculation-flow"><span>Metrics <wbr/>Calculation <wbr/>Flow</span></a></li><li><a href="#usage-examples"><span>Usage <wbr/>Examples</span></a></li><li><ul><li><a href="#accessing-backtest-statistics"><span>Accessing <wbr/>Backtest <wbr/>Statistics</span></a></li><li><a href="#accessing-live-statistics"><span>Accessing <wbr/>Live <wbr/>Statistics</span></a></li><li><a href="#accessing-schedule-statistics"><span>Accessing <wbr/>Schedule <wbr/>Statistics</span></a></li></ul></li><li><a href="#metrics-interpretation-guide"><span>Metrics <wbr/>Interpretation <wbr/>Guide</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
