<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/11_layer_responsibilities | backtest-kit</title><meta name="description" content="Documentation for backtest-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">backtest-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">backtest-kit</a></li><li><a href="design_11_layer_responsibilities.html">design/11_layer_responsibilities</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="layer-responsibilities" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Layer Responsibilities<a href="#layer-responsibilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This document describes the service architecture of backtest-kit and the responsibilities of each layer. The framework follows a clean architecture pattern with strict separation of concerns, dependency injection, and unidirectional data flow from public API down to business logic.</p>
<p>For information about how dependency injection works across these layers, see <a href="design_12_dependency_injection_system.html">Dependency Injection System</a>. For details on how context flows through the layers, see <a href="design_13_context_propagation.html">Context Propagation</a>.</p>
<hr>
<a id="architecture-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture Overview<a href="#architecture-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The backtest-kit framework organizes services into distinct functional layers. Services are bound via dependency injection using Symbol-based tokens defined in <a href="">src/lib/core/types.ts:1-81</a>.</p>
<p><strong>Complete Layer Architecture</strong></p>
<p><img src="../media/11_Layer_Responsibilities_0.svg" alt="Mermaid Diagram"></p>
</thinking>
<a id="layer-1-api-layer" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 1: API Layer<a href="#layer-1-api-layer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The API Layer provides user-facing classes and functions that serve as entry points to the framework. This layer has no business logic and delegates immediately to Command Services.</p>
<a id="execution-classes" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Execution Classes<a href="#execution-classes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Execution classes in <a href="">src/classes/Backtest.ts</a>, <a href="">src/classes/Live.ts</a>, and <a href="">src/classes/Walker.ts</a> provide the primary user interface:</p>
<table>
<thead>
<tr>
<th>Class</th>
<th>Key Methods</th>
<th>Delegates To</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Backtest</code></td>
<td><code>run()</code>, <code>background()</code>, <code>getData()</code>, <code>getReport()</code>, <code>dump()</code></td>
<td><code>BacktestCommandService</code></td>
</tr>
<tr>
<td><code>Live</code></td>
<td><code>run()</code>, <code>background()</code>, <code>getData()</code>, <code>getReport()</code>, <code>dump()</code></td>
<td><code>LiveCommandService</code></td>
</tr>
<tr>
<td><code>Walker</code></td>
<td><code>run()</code>, <code>background()</code>, <code>getData()</code>, <code>getReport()</code>, <code>dump()</code></td>
<td><code>WalkerCommandService</code></td>
</tr>
</tbody>
</table>
<p><strong>API Layer Delegation Pattern</strong></p>
<p><img src="../media/11_Layer_Responsibilities_1.svg" alt="Mermaid Diagram"></p>
<p>Each execution class:</p>
<ol>
<li>Logs the operation via <code>backtest.loggerService</code></li>
<li>Clears relevant markdown services and strategy caches</li>
<li>Delegates to the corresponding Command Service</li>
</ol>
<a id="registration-functions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Functions<a href="#registration-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Component registration functions in <a href="">src/function/add.ts</a> provide schema registration:</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Purpose</th>
<th>Delegates To</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>addStrategy()</code></td>
<td>Register strategy schema</td>
<td><code>StrategyValidationService</code>, <code>StrategySchemaService</code></td>
</tr>
<tr>
<td><code>addExchange()</code></td>
<td>Register exchange schema</td>
<td><code>ExchangeValidationService</code>, <code>ExchangeSchemaService</code></td>
</tr>
<tr>
<td><code>addFrame()</code></td>
<td>Register frame schema</td>
<td><code>FrameValidationService</code>, <code>FrameSchemaService</code></td>
</tr>
<tr>
<td><code>addRisk()</code></td>
<td>Register risk profile</td>
<td><code>RiskValidationService</code>, <code>RiskSchemaService</code></td>
</tr>
<tr>
<td><code>addSizing()</code></td>
<td>Register sizing method</td>
<td><code>SizingValidationService</code>, <code>SizingSchemaService</code></td>
</tr>
<tr>
<td><code>addWalker()</code></td>
<td>Register walker comparison</td>
<td><code>WalkerValidationService</code>, <code>WalkerSchemaService</code></td>
</tr>
<tr>
<td><code>addOptimizer()</code></td>
<td>Register optimizer configuration</td>
<td><code>OptimizerValidationService</code>, <code>OptimizerSchemaService</code></td>
</tr>
</tbody>
</table>
<hr>
<a id="layer-2-command-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 2: Command Services<a href="#layer-2-command-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Command Services validate component configurations and delegate to Logic Services. They act as validation gateways before execution.</p>
<a id="command-service-responsibilities" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Command Service Responsibilities<a href="#command-service-responsibilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Command Service Architecture</strong></p>
<p><img src="../media/11_Layer_Responsibilities_2.svg" alt="Mermaid Diagram"></p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Validates</th>
<th>Delegates To</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BacktestCommandService</code></td>
<td>strategyName, exchangeName, frameName, riskName</td>
<td><code>BacktestLogicPublicService</code></td>
</tr>
<tr>
<td><code>LiveCommandService</code></td>
<td>strategyName, exchangeName, riskName</td>
<td><code>LiveLogicPublicService</code></td>
</tr>
<tr>
<td><code>WalkerCommandService</code></td>
<td>walkerName, exchangeName, frameName, all strategy names</td>
<td><code>WalkerLogicPublicService</code></td>
</tr>
</tbody>
</table>
<a id="command-service-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Command Service Pattern<a href="#command-service-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each Command Service follows a consistent pattern:</p>
<ol>
<li><strong>Log operation</strong> - Record method call with parameters</li>
<li><strong>Validate components</strong> - Check that all referenced components are registered</li>
<li><strong>Validate dependencies</strong> - If strategy has <code>riskName</code>, validate risk profile exists</li>
<li><strong>Delegate execution</strong> - Pass validated parameters to Logic Service</li>
</ol>
<p><strong>Example from BacktestCommandService</strong>:</p>
<p>The service validates all components before delegating:</p>
<pre><code><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-0">// Validate strategy exists</span><br/><span class="hl-2">  </span><span class="hl-6">strategyValidationService</span><span class="hl-2">.</span><span class="hl-1">validate</span><span class="hl-2">(</span><span class="hl-6">context</span><span class="hl-2">.</span><span class="hl-6">strategyName</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Validate exchange exists  </span><br/><span class="hl-2">  </span><span class="hl-6">exchangeValidationService</span><span class="hl-2">.</span><span class="hl-1">validate</span><span class="hl-2">(</span><span class="hl-6">context</span><span class="hl-2">.</span><span class="hl-6">exchangeName</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Validate frame exists</span><br/><span class="hl-2">  </span><span class="hl-6">frameValidationService</span><span class="hl-2">.</span><span class="hl-1">validate</span><span class="hl-2">(</span><span class="hl-6">context</span><span class="hl-2">.</span><span class="hl-6">frameName</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Get strategy schema and validate risk if present</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">schema</span><span class="hl-2"> = </span><span class="hl-6">strategySchemaService</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-6">context</span><span class="hl-2">.</span><span class="hl-6">strategyName</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-6">schema</span><span class="hl-2">.</span><span class="hl-6">riskName</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-6">riskValidationService</span><span class="hl-2">.</span><span class="hl-1">validate</span><span class="hl-2">(</span><span class="hl-6">schema</span><span class="hl-2">.</span><span class="hl-6">riskName</span><span class="hl-2">)</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Delegate to logic service</span><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">backtestLogicPublicService</span><span class="hl-2">.</span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">context</span><span class="hl-2">)</span><br/><span class="hl-2">}</span>
</code><button>Copy</button></pre>

<hr>
<a id="layer-3-logic-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 3: Logic Services<a href="#layer-3-logic-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Logic Services orchestrate execution flow. They are split into Public and Private services to separate context management from execution logic.</p>
<a id="public-logic-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Public Logic Services<a href="#public-logic-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Public Logic Services wrap Private Logic Services with <code>MethodContextService</code> to inject component names into execution context:</p>
<p><strong>Logic Service Context Injection</strong></p>
<p><img src="../media/11_Layer_Responsibilities_3.svg" alt="Mermaid Diagram"></p>
<p>Each Public Logic Service:</p>
<ol>
<li>Receives context parameters (strategyName, exchangeName, frameName)</li>
<li>Wraps Private Logic Service call with <code>MethodContextService.runAsyncIterator()</code></li>
<li>Returns AsyncGenerator from Private Logic Service</li>
</ol>
<p>The <code>MethodContextService</code> uses scoped dependency injection to make context available to downstream services without explicit parameter passing.</p>
<a id="private-logic-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Private Logic Services<a href="#private-logic-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Private Logic Services implement the core execution algorithms:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Responsibility</th>
<th>Key Operations</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BacktestLogicPrivateService</code></td>
<td>Sequential timeframe iteration</td>
<td>Load frames, iterate dates, call <code>strategyGlobalService.tick()</code>, fetch future candles, call <code>strategyGlobalService.backtest()</code>, skip timeframes, emit to <code>signalBacktestEmitter</code></td>
</tr>
<tr>
<td><code>LiveLogicPrivateService</code></td>
<td>Infinite real-time loop</td>
<td>Enter <code>while(true)</code> loop, call <code>strategyGlobalService.tick()</code> with <code>new Date()</code>, sleep for <code>TICK_TTL</code> (61s), emit to <code>signalLiveEmitter</code></td>
</tr>
<tr>
<td><code>WalkerLogicPrivateService</code></td>
<td>Strategy comparison</td>
<td>Iterate walker strategies, run <code>BacktestLogicPublicService</code> for each, collect statistics, compare metrics, track best strategy, emit to <code>walkerEmitter</code></td>
</tr>
</tbody>
</table>
<p><strong>BacktestLogicPrivateService Execution Flow</strong></p>
<p><img src="../media/11_Layer_Responsibilities_4.svg" alt="Mermaid Diagram"></p>
<p><strong>LiveLogicPrivateService Execution Flow</strong></p>
<p><img src="../media/11_Layer_Responsibilities_5.svg" alt="Mermaid Diagram"></p>
<hr>
<a id="layer-4-global-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 4: Global Services<a href="#layer-4-global-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Global Services wrap Connection Services with <code>ExecutionContextService</code> to inject runtime parameters (symbol, when, backtest flag) into execution scope.</p>
<a id="global-service-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Global Service Pattern<a href="#global-service-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Global Service Wrapper Architecture</strong></p>
<p><img src="../media/11_Layer_Responsibilities_6.svg" alt="Mermaid Diagram"></p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Wraps</th>
<th>Injects Context For</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>StrategyGlobalService</code></td>
<td><code>StrategyConnectionService</code></td>
<td>Strategy operations</td>
</tr>
<tr>
<td><code>ExchangeGlobalService</code></td>
<td><code>ExchangeConnectionService</code></td>
<td>Market data fetching</td>
</tr>
<tr>
<td><code>FrameGlobalService</code></td>
<td><code>FrameConnectionService</code></td>
<td>Timeframe generation</td>
</tr>
<tr>
<td><code>RiskGlobalService</code></td>
<td><code>RiskConnectionService</code></td>
<td>Risk validation</td>
</tr>
<tr>
<td><code>SizingGlobalService</code></td>
<td><code>SizingConnectionService</code></td>
<td>Position sizing</td>
</tr>
</tbody>
</table>
<p>Each Global Service:</p>
<ol>
<li><strong>Validates component</strong> - Memoized validation check</li>
<li><strong>Wraps in ExecutionContext</strong> - Calls <code>ExecutionContextService.runInContext()</code></li>
<li><strong>Delegates to Connection Service</strong> - Passes call to underlying connection service</li>
</ol>
<p>The <code>ExecutionContextService</code> makes <code>symbol</code>, <code>when</code>, and <code>backtest</code> flag available to Client Classes without parameter drilling.</p>
<hr>
<a id="layer-5-connection-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 5: Connection Services<a href="#layer-5-connection-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Connection Services manage memoized client instances, ensuring a single instance exists per component-symbol pair.</p>
<hr>
<a id="layer-1-public-api" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 1: Public API<a href="#layer-1-public-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Public API layer provides the user-facing functions for component registration and execution. These functions have no business logic and immediately delegate to Global Services.</p>
<a id="registration-functions-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Functions<a href="#registration-functions-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Component registration functions are exposed in <a href="">src/function/add.ts:1-342</a>:</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Purpose</th>
<th>Delegates To</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>addStrategy()</code></td>
<td>Register strategy schema</td>
<td><code>StrategyValidationService.addStrategy()</code><br/><code>StrategySchemaService.register()</code></td>
</tr>
<tr>
<td><code>addExchange()</code></td>
<td>Register exchange schema</td>
<td><code>ExchangeValidationService.addExchange()</code><br/><code>ExchangeSchemaService.register()</code></td>
</tr>
<tr>
<td><code>addFrame()</code></td>
<td>Register timeframe schema</td>
<td><code>FrameValidationService.addFrame()</code><br/><code>FrameSchemaService.register()</code></td>
</tr>
<tr>
<td><code>addRisk()</code></td>
<td>Register risk profile</td>
<td><code>RiskValidationService.addRisk()</code><br/><code>RiskSchemaService.register()</code></td>
</tr>
<tr>
<td><code>addSizing()</code></td>
<td>Register sizing method</td>
<td><code>SizingValidationService.addSizing()</code><br/><code>SizingSchemaService.register()</code></td>
</tr>
<tr>
<td><code>addWalker()</code></td>
<td>Register strategy comparison</td>
<td><code>WalkerValidationService.addWalker()</code><br/><code>WalkerSchemaService.register()</code></td>
</tr>
</tbody>
</table>
<a id="query-functions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Query Functions<a href="#query-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Component listing functions are exposed in <a href="">src/function/list.ts:1-218</a>:</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Purpose</th>
<th>Delegates To</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>listStrategies()</code></td>
<td>Get all strategy schemas</td>
<td><code>StrategyValidationService.list()</code></td>
</tr>
<tr>
<td><code>listExchanges()</code></td>
<td>Get all exchange schemas</td>
<td><code>ExchangeValidationService.list()</code></td>
</tr>
<tr>
<td><code>listFrames()</code></td>
<td>Get all frame schemas</td>
<td><code>FrameValidationService.list()</code></td>
</tr>
<tr>
<td><code>listRisks()</code></td>
<td>Get all risk schemas</td>
<td><code>RiskValidationService.list()</code></td>
</tr>
<tr>
<td><code>listSizings()</code></td>
<td>Get all sizing schemas</td>
<td><code>SizingValidationService.list()</code></td>
</tr>
<tr>
<td><code>listWalkers()</code></td>
<td>Get all walker schemas</td>
<td><code>WalkerValidationService.list()</code></td>
</tr>
</tbody>
</table>
<a id="execution-classes-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Execution Classes<a href="#execution-classes-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Execution entry points provide static methods for running backtests and live trading:</p>
<ul>
<li><code>Backtest.run()</code> / <code>Backtest.background()</code> - Historical simulation</li>
<li><code>Live.run()</code> / <code>Live.background()</code> - Real-time trading</li>
<li><code>Walker.run()</code> / <code>Walker.background()</code> - Multi-strategy comparison</li>
</ul>
<p>These delegate to corresponding Global Services which wrap Logic Services with validation.</p>
<hr>
<a id="layer-2-logic-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 2: Logic Services<a href="#layer-2-logic-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Logic Services orchestrate the core execution flow. They are split into Public and Private services to separate context management from core logic.</p>
<a id="public-logic-services-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Public Logic Services<a href="#public-logic-services-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Public logic services wrap execution in context and provide the public interface:</p>
<p><strong>Logic Service Responsibilities</strong></p>
<p><img src="../media/11_Layer_Responsibilities_7.svg" alt="Mermaid Diagram"></p>
<p>Each public service:</p>
<ol>
<li>Accepts context parameters (strategyName, exchangeName, frameName)</li>
<li>Wraps private service call with <code>MethodContextService.runAsyncIterator()</code></li>
<li>Returns async generator from private service</li>
</ol>
<p><strong>Example from BacktestLogicPublicService</strong>:</p>
<p>The public service receives context and wraps the private service:</p>
<pre><code><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, { </span><span class="hl-6">strategyName</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">, </span><span class="hl-6">frameName</span><span class="hl-2"> }) {</span><br/><span class="hl-2">  </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-6">methodContextService</span><span class="hl-2">.</span><span class="hl-1">runAsyncIterator</span><span class="hl-2">(</span><br/><span class="hl-2">    () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-6">backtestLogicPrivateService</span><span class="hl-2">.</span><span class="hl-1">run</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">),</span><br/><span class="hl-2">    { </span><span class="hl-6">strategyName</span><span class="hl-2">, </span><span class="hl-6">exchangeName</span><span class="hl-2">, </span><span class="hl-6">frameName</span><span class="hl-2"> }</span><br/><span class="hl-2">  )</span><br/><span class="hl-2">}</span>
</code><button>Copy</button></pre>

<a id="private-logic-services-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Private Logic Services<a href="#private-logic-services-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Private logic services contain the core execution orchestration:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Responsibility</th>
<th>Key Methods</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BacktestLogicPrivateService</code></td>
<td>Iterate timeframes, call strategy.tick(), yield signals</td>
<td><code>run()</code>, emits to <code>signalBacktestEmitter</code></td>
</tr>
<tr>
<td><code>LiveLogicPrivateService</code></td>
<td>Infinite loop, Date.now() progression, persistence</td>
<td><code>run()</code>, emits to <code>signalLiveEmitter</code></td>
</tr>
<tr>
<td><code>WalkerLogicPrivateService</code></td>
<td>Run multiple strategies, compare metrics</td>
<td><code>run()</code>, emits to <code>walkerEmitter</code></td>
</tr>
</tbody>
</table>
<p>These services have dependencies on:</p>
<ul>
<li><code>StrategyGlobalService</code> - Strategy operations</li>
<li><code>ExchangeGlobalService</code> - Market data (backtest only)</li>
<li><code>FrameGlobalService</code> - Timeframe generation (backtest only)</li>
<li>Markdown services - Report generation</li>
</ul>
<hr>
<a id="layer-3-connection-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 3: Connection Services<a href="#layer-3-connection-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Connection Services manage memoized client instances. Each service creates and caches client instances by component name, ensuring only one instance exists per registered component.</p>
<a id="service-registry" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Registry<a href="#service-registry" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Connection services are defined in <a href="">src/lib/core/types.ts:10-16</a>:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Manages Instances Of</th>
<th>Cache Key</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>StrategyConnectionService</code></td>
<td><code>ClientStrategy</code></td>
<td><code>${symbol}:${strategyName}</code></td>
</tr>
<tr>
<td><code>ExchangeConnectionService</code></td>
<td><code>ClientExchange</code></td>
<td><code>${symbol}:${exchangeName}</code></td>
</tr>
<tr>
<td><code>RiskConnectionService</code></td>
<td><code>ClientRisk</code></td>
<td><code>${riskName}</code></td>
</tr>
<tr>
<td><code>FrameConnectionService</code></td>
<td><code>ClientFrame</code></td>
<td><code>${symbol}:${exchangeName}:${frameName}</code></td>
</tr>
<tr>
<td><code>SizingConnectionService</code></td>
<td><code>ClientSizing</code></td>
<td><code>${sizingName}</code></td>
</tr>
</tbody>
</table>
<a id="memoization-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Memoization Pattern<a href="#memoization-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>StrategyConnectionService Architecture</strong></p>
<p><img src="../media/11_Layer_Responsibilities_8.svg" alt="Mermaid Diagram"></p>
<p>The <code>getStrategy</code> method in <a href="">src/lib/services/connection/StrategyConnectionService.ts:78-98</a> uses <code>memoize</code> from <code>functools-kit</code> to cache instances:</p>
<pre><code><span class="hl-6">private</span><span class="hl-2"> </span><span class="hl-6">getStrategy</span><span class="hl-2"> = </span><span class="hl-1">memoize</span><span class="hl-2">(</span><br/><span class="hl-2">  ([</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">strategyName</span><span class="hl-2">]) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-4">`</span><span class="hl-3">${</span><span class="hl-6">symbol</span><span class="hl-3">}</span><span class="hl-4">:</span><span class="hl-3">${</span><span class="hl-6">strategyName</span><span class="hl-3">}</span><span class="hl-4">`</span><span class="hl-2">,</span><br/><span class="hl-2">  (</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">strategyName</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> { </span><span class="hl-8">riskName</span><span class="hl-2">, </span><span class="hl-8">getSignal</span><span class="hl-2">, </span><span class="hl-8">interval</span><span class="hl-2">, </span><span class="hl-8">callbacks</span><span class="hl-2"> } = </span><br/><span class="hl-2">      </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">strategySchemaService</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-6">strategyName</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">return</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">ClientStrategy</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-6">symbol</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">interval</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">execution:</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">executionContextService</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">method:</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">methodContextService</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">logger:</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">loggerService</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">partial:</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">partialConnectionService</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">exchange:</span><span class="hl-2"> </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">exchangeConnectionService</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">risk:</span><span class="hl-2"> </span><span class="hl-6">riskName</span><span class="hl-2"> ? </span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">riskConnectionService</span><span class="hl-2">.</span><span class="hl-1">getRisk</span><span class="hl-2">(</span><span class="hl-6">riskName</span><span class="hl-2">) : </span><span class="hl-8">NOOP_RISK</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">riskName</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">strategyName</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">getSignal</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-6">callbacks</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">);</span>
</code><button>Copy</button></pre>

<a id="connection-service-operations" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Connection Service Operations<a href="#connection-service-operations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each Connection Service provides operation methods that delegate to cached client instances:</p>
<p><strong>StrategyConnectionService Operations</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
<th>Delegates To</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tick(symbol, strategyName)</code></td>
<td>Execute live trading tick</td>
<td><code>ClientStrategy.tick()</code></td>
</tr>
<tr>
<td><code>backtest(symbol, strategyName, candles)</code></td>
<td>Execute fast backtest</td>
<td><code>ClientStrategy.backtest()</code></td>
</tr>
<tr>
<td><code>getPendingSignal(symbol, strategyName)</code></td>
<td>Retrieve active signal</td>
<td><code>ClientStrategy.getPendingSignal()</code></td>
</tr>
<tr>
<td><code>stop({symbol, strategyName})</code></td>
<td>Stop signal generation</td>
<td><code>ClientStrategy.stop()</code></td>
</tr>
<tr>
<td><code>clear(ctx?)</code></td>
<td>Clear memoized instances</td>
<td>Memoization cache</td>
</tr>
</tbody>
</table>
<p>Connection Services also emit to appropriate event emitters after operations complete. For example, <a href="">src/lib/services/connection/StrategyConnectionService.ts:129-147</a> emits signals to three channels:</p>
<pre><code><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">tick</span><span class="hl-2"> = </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">strategy</span><span class="hl-2">.</span><span class="hl-1">tick</span><span class="hl-2">(</span><span class="hl-6">symbol</span><span class="hl-2">, </span><span class="hl-6">strategyName</span><span class="hl-2">);</span><br/><span class="hl-2">{</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (</span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">executionContextService</span><span class="hl-2">.</span><span class="hl-6">context</span><span class="hl-2">.</span><span class="hl-6">backtest</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">signalBacktestEmitter</span><span class="hl-2">.</span><span class="hl-1">next</span><span class="hl-2">(</span><span class="hl-6">tick</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-5">if</span><span class="hl-2"> (!</span><span class="hl-3">this</span><span class="hl-2">.</span><span class="hl-6">executionContextService</span><span class="hl-2">.</span><span class="hl-6">context</span><span class="hl-2">.</span><span class="hl-6">backtest</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">signalLiveEmitter</span><span class="hl-2">.</span><span class="hl-1">next</span><span class="hl-2">(</span><span class="hl-6">tick</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-5">await</span><span class="hl-2"> </span><span class="hl-6">signalEmitter</span><span class="hl-2">.</span><span class="hl-1">next</span><span class="hl-2">(</span><span class="hl-6">tick</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button>Copy</button></pre>

<hr>
<a id="layer-6-client-classes" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 6: Client Classes<a href="#layer-6-client-classes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Client Classes contain pure business logic without dependency injection. They receive dependencies via constructor parameters and implement core algorithms.</p>
<a id="client-responsibilities" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Client Responsibilities<a href="#client-responsibilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Client Class</th>
<th>Primary Responsibility</th>
<th>Key Methods</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ClientStrategy</code></td>
<td>Signal lifecycle management</td>
<td><code>tick()</code>, <code>backtest()</code>, <code>stop()</code>, <code>getPendingSignal()</code>, <code>waitForInit()</code></td>
</tr>
<tr>
<td><code>ClientExchange</code></td>
<td>Market data and VWAP calculation</td>
<td><code>getCandles()</code>, <code>getNextCandles()</code>, <code>getAveragePrice()</code>, <code>formatPrice()</code></td>
</tr>
<tr>
<td><code>ClientRisk</code></td>
<td>Position tracking and validation</td>
<td><code>checkSignal()</code>, <code>addSignal()</code>, <code>removeSignal()</code></td>
</tr>
<tr>
<td><code>ClientFrame</code></td>
<td>Timeframe generation</td>
<td><code>getTimeframe()</code></td>
</tr>
<tr>
<td><code>ClientSizing</code></td>
<td>Position size calculation</td>
<td><code>calculateQuantity()</code></td>
</tr>
</tbody>
</table>
<p><strong>ClientStrategy State Management</strong></p>
<p><img src="../media/11_Layer_Responsibilities_9.svg" alt="Mermaid Diagram"></p>
<p>Client Classes have no knowledge of:</p>
<ul>
<li>Dependency injection framework</li>
<li>Service layer architecture</li>
<li>Memoization caching</li>
<li>Event emission (handled by Connection Services)</li>
</ul>
<p>They receive all dependencies as constructor parameters and expose simple method interfaces.</p>
<hr>
<a id="layer-7-schema-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 7: Schema Services<a href="#layer-7-schema-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Schema Services store component configurations using the <code>ToolRegistry</code> pattern and provide runtime schema retrieval.</p>
<hr>
<a id="layer-4-client-classes" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 4: Client Classes<a href="#layer-4-client-classes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Client Classes contain pure business logic without dependency injection dependencies. They implement the core algorithms and state management.</p>
<a id="client-responsibilities-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Client Responsibilities<a href="#client-responsibilities-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Client Class Hierarchy</strong></p>
<p><img src="../media/11_Layer_Responsibilities_10.svg" alt="Mermaid Diagram"></p>
<table>
<thead>
<tr>
<th>Client Class</th>
<th>Primary Responsibility</th>
<th>Key State</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ClientStrategy</code></td>
<td>Signal lifecycle management, tick/backtest execution</td>
<td><code>_pendingSignal</code>, <code>_lastSignalTimestamp</code></td>
</tr>
<tr>
<td><code>ClientExchange</code></td>
<td>Market data fetching, VWAP calculation, formatting</td>
<td>Stateless (delegates to schema functions)</td>
</tr>
<tr>
<td><code>ClientRisk</code></td>
<td>Position tracking, custom validation execution</td>
<td><code>_activePositions</code> Map</td>
</tr>
<tr>
<td><code>ClientFrame</code></td>
<td>Timeframe generation for backtesting</td>
<td>Stateless</td>
</tr>
<tr>
<td><code>ClientSizing</code></td>
<td>Position size calculation</td>
<td>Stateless</td>
</tr>
</tbody>
</table>
<a id="pure-business-logic" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Pure Business Logic<a href="#pure-business-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Client classes have NO direct dependency injection. Instead:</p>
<ol>
<li><strong>Constructor parameters</strong> are simple values or functions from schemas</li>
<li><strong>Service dependencies</strong> are passed via Connection Service injection</li>
<li><strong>Prototype methods</strong> are used for memory efficiency (not arrow functions)</li>
</ol>
<p>Example: <code>ClientStrategy</code> receives schema functions and other clients as constructor parameters, not DI symbols.</p>
<hr>
<a id="layer-5-schema--validation-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 5: Schema &amp; Validation Services<a href="#layer-5-schema--validation-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Schema and Validation Services manage component registration and runtime validation. They use a parallel service structure with distinct responsibilities.</p>
<a id="schema-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Schema Services<a href="#schema-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Schema Services store component configurations using the <code>ToolRegistry</code> pattern:</p>
<p><strong>Schema Service Pattern</strong></p>
<p><img src="../media/11_Layer_Responsibilities_11.svg" alt="Mermaid Diagram"></p>
<p>Each Schema Service provides:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>register(name, schema)</code></td>
<td>Store component configuration</td>
</tr>
<tr>
<td><code>get(name)</code></td>
<td>Retrieve configuration by name</td>
</tr>
<tr>
<td><code>validateShallow(schema)</code></td>
<td>Check schema structure and types</td>
</tr>
<tr>
<td><code>override(name, partial)</code></td>
<td>Update existing schema</td>
</tr>
</tbody>
</table>
<p>Schema services are defined in <a href="">src/lib/core/types.ts:18-25</a>:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">schemaServices</span><span class="hl-2"> = {</span><br/><span class="hl-2">    </span><span class="hl-6">exchangeSchemaService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;exchangeSchemaService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">strategySchemaService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;strategySchemaService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">frameSchemaService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;frameSchemaService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">walkerSchemaService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;walkerSchemaService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">sizingSchemaService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;sizingSchemaService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">riskSchemaService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;riskSchemaService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="validation-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Services<a href="#validation-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Validation Services perform runtime existence checks with memoization:</p>
<p><strong>Validation Service Pattern</strong></p>
<p><img src="../media/11_Layer_Responsibilities_12.svg" alt="Mermaid Diagram"></p>
<p>Each Validation Service provides:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>addStrategy(name, schema)</code></td>
<td>Register component for validation</td>
</tr>
<tr>
<td><code>validate(name)</code></td>
<td>Check existence and dependencies</td>
</tr>
<tr>
<td><code>list()</code></td>
<td>Return all registered schemas</td>
</tr>
</tbody>
</table>
<p>Validation services are defined in <a href="">src/lib/core/types.ts:59-66</a>:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">validationServices</span><span class="hl-2"> = {</span><br/><span class="hl-2">    </span><span class="hl-6">exchangeValidationService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;exchangeValidationService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">strategyValidationService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;strategyValidationService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">frameValidationService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;frameValidationService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">walkerValidationService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;walkerValidationService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">sizingValidationService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;sizingValidationService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">riskValidationService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;riskValidationService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Example Validation Flow</strong>:</p>
<p>When <code>BacktestLogicPublicService</code> starts execution:</p>
<ol>
<li>Calls <code>StrategyValidationService.validate(strategyName)</code></li>
<li>Calls <code>ExchangeValidationService.validate(exchangeName)</code></li>
<li>Calls <code>FrameValidationService.validate(frameName)</code></li>
<li>If strategy has <code>riskName</code>, validates via <code>RiskValidationService.validate(riskName)</code></li>
</ol>
<hr>
<a id="layer-6-markdown-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer 6: Markdown Services<a href="#layer-6-markdown-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Markdown Services subscribe to event emitters and accumulate data for report generation. Each execution mode has a dedicated markdown service.</p>
<a id="service-registry-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Registry<a href="#service-registry-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Markdown services are defined in <a href="">src/lib/core/types.ts:50-57</a>:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">markdownServices</span><span class="hl-2"> = {</span><br/><span class="hl-2">    </span><span class="hl-6">backtestMarkdownService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;backtestMarkdownService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">liveMarkdownService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;liveMarkdownService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">scheduleMarkdownService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;scheduleMarkdownService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">performanceMarkdownService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;performanceMarkdownService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">walkerMarkdownService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;walkerMarkdownService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">    </span><span class="hl-6">heatMarkdownService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;heatMarkdownService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="event-subscription-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Subscription Pattern<a href="#event-subscription-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Markdown Service Data Flow</strong></p>
<p><img src="../media/11_Layer_Responsibilities_13.svg" alt="Mermaid Diagram"></p>
<p>Each Markdown Service:</p>
<ol>
<li><strong>Subscribes to emitter</strong> during initialization</li>
<li><strong>Accumulates events</strong> in memoized storage by strategy/walker name</li>
<li><strong>Limits event queue</strong> (e.g., <code>LiveMarkdownService</code> max 250 events)</li>
<li><strong>Calculates statistics</strong> on demand via <code>getData()</code></li>
<li><strong>Formats markdown</strong> via <code>getReport()</code></li>
<li><strong>Writes to disk</strong> via <code>dump()</code></li>
</ol>
<a id="report-storage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Report Storage<a href="#report-storage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Storage is memoized per component:</p>
<ul>
<li><code>BacktestMarkdownService</code> - One storage per (strategyName, exchangeName, frameName)</li>
<li><code>LiveMarkdownService</code> - One storage per (strategyName, exchangeName)</li>
<li><code>WalkerMarkdownService</code> - One storage per walkerName</li>
</ul>
<hr>
<a id="cross-cutting-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Cross-Cutting Services<a href="#cross-cutting-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Three services span all layers and provide infrastructure concerns.</p>
<a id="loggerservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">LoggerService<a href="#loggerservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>LoggerService</code> provides logging infrastructure with automatic context injection:</p>
<p><img src="../media/11_Layer_Responsibilities_14.svg" alt="Mermaid Diagram"></p>
<p>Injected into nearly every service via <a href="">src/lib/core/types.ts:1-3</a>:</p>
<pre><code class="typescript"><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">baseServices</span><span class="hl-2"> = {</span><br/><span class="hl-2">    </span><span class="hl-6">loggerService:</span><span class="hl-2"> </span><span class="hl-1">Symbol</span><span class="hl-2">(</span><span class="hl-4">&#39;loggerService&#39;</span><span class="hl-2">),</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="executioncontextservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ExecutionContextService<a href="#executioncontextservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>ExecutionContextService</code> manages execution-time parameters using <code>di-scoped</code>:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>symbol</code></td>
<td>Trading pair (e.g., &quot;BTCUSDT&quot;)</td>
</tr>
<tr>
<td><code>when</code></td>
<td>Current timestamp (Date for live, historical for backtest)</td>
</tr>
<tr>
<td><code>backtest</code></td>
<td>Boolean flag indicating execution mode</td>
</tr>
</tbody>
</table>
<p>Used by client classes to access current execution context without explicit parameter passing.</p>
<a id="methodcontextservice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">MethodContextService<a href="#methodcontextservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>MethodContextService</code> manages component selection using <code>di-scoped</code>:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strategyName</code></td>
<td>Active strategy identifier</td>
</tr>
<tr>
<td><code>exchangeName</code></td>
<td>Active exchange identifier</td>
</tr>
<tr>
<td><code>frameName</code></td>
<td>Active frame identifier (backtest only)</td>
</tr>
</tbody>
</table>
<p>Used by Connection Services to resolve which component instance to return.</p>
<hr>
<a id="layer-interaction-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Layer Interaction Patterns<a href="#layer-interaction-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="registration-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Registration Flow<a href="#registration-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Component Registration Pattern</strong></p>
<p><img src="../media/11_Layer_Responsibilities_15.svg" alt="Mermaid Diagram"></p>
<ol>
<li>Public API function receives schema</li>
<li>Validation Service stores for runtime checks</li>
<li>Schema Service validates structure and stores in registry</li>
</ol>
<a id="execution-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Execution Flow<a href="#execution-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Backtest Execution Pattern</strong></p>
<p><img src="../media/11_Layer_Responsibilities_16.svg" alt="Mermaid Diagram"></p>
<ol>
<li>Public service wraps with MethodContext</li>
<li>Private service gets client from Connection Service</li>
<li>Connection Service returns memoized instance</li>
<li>Private service calls client methods</li>
<li>Results yielded to user</li>
</ol>
<a id="data-flow-direction" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Data Flow Direction<a href="#data-flow-direction" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All data flows unidirectionally down the layers:</p>
<pre><code><span class="hl-6">Layer</span><span class="hl-2"> </span><span class="hl-7">1</span><span class="hl-2"> (</span><span class="hl-6">Public</span><span class="hl-2"> </span><span class="hl-8">API</span><span class="hl-2">)</span><br/><span class="hl-2">     </span><span class="hl-6">Delegates</span><br/><span class="hl-6">Layer</span><span class="hl-2"> </span><span class="hl-7">2</span><span class="hl-2"> (</span><span class="hl-6">Logic</span><span class="hl-2"> </span><span class="hl-6">Services</span><span class="hl-2">)</span><br/><span class="hl-2">     </span><span class="hl-6">Requests</span><span class="hl-2"> </span><span class="hl-6">Instances</span><br/><span class="hl-6">Layer</span><span class="hl-2"> </span><span class="hl-7">3</span><span class="hl-2"> (</span><span class="hl-6">Connection</span><span class="hl-2"> </span><span class="hl-6">Services</span><span class="hl-2">)</span><br/><span class="hl-2">     </span><span class="hl-6">Creates</span><span class="hl-2">/</span><span class="hl-6">Returns</span><br/><span class="hl-6">Layer</span><span class="hl-2"> </span><span class="hl-7">4</span><span class="hl-2"> (</span><span class="hl-6">Client</span><span class="hl-2"> </span><span class="hl-6">Classes</span><span class="hl-2">)</span><br/><span class="hl-2">     </span><span class="hl-6">Uses</span><br/><span class="hl-6">Layer</span><span class="hl-2"> </span><span class="hl-7">5</span><span class="hl-2"> (</span><span class="hl-6">Schemas</span><span class="hl-2">)</span>
</code><button>Copy</button></pre>

<p>Events flow horizontally to Layer 6 (Markdown Services) for reporting.</p>
<hr>
<a id="service-binding" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Service Binding<a href="#service-binding" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All services are bound in <a href="">src/lib/core/provide.ts:1-111</a> using the <code>provide()</code> function from the DI container. Services are organized in blocks matching their layer:</p>
<pre><code class="typescript"><span class="hl-0">// Base Services (Cross-cutting)</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">loggerService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">LoggerService</span><span class="hl-2">());</span><br/><br/><span class="hl-0">// Context Services (Cross-cutting)</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">executionContextService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">ExecutionContextService</span><span class="hl-2">());</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">methodContextService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">MethodContextService</span><span class="hl-2">());</span><br/><br/><span class="hl-0">// Connection Services (Layer 3)</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">strategyConnectionService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">StrategyConnectionService</span><span class="hl-2">());</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">exchangeConnectionService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">ExchangeConnectionService</span><span class="hl-2">());</span><br/><br/><span class="hl-0">// Schema Services (Layer 5)</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">strategySchemaService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">StrategySchemaService</span><span class="hl-2">());</span><br/><br/><span class="hl-0">// Global Services (Layer 2 wrappers)</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">strategyGlobalService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">StrategyGlobalService</span><span class="hl-2">());</span><br/><br/><span class="hl-0">// Logic Services (Layer 2)</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">backtestLogicPrivateService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">BacktestLogicPrivateService</span><span class="hl-2">());</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">backtestLogicPublicService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">BacktestLogicPublicService</span><span class="hl-2">());</span><br/><br/><span class="hl-0">// Markdown Services (Layer 6)</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">backtestMarkdownService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">BacktestMarkdownService</span><span class="hl-2">());</span><br/><br/><span class="hl-0">// Validation Services (Layer 5)</span><br/><span class="hl-1">provide</span><span class="hl-2">(</span><span class="hl-8">TYPES</span><span class="hl-2">.</span><span class="hl-6">strategyValidationService</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-1">StrategyValidationService</span><span class="hl-2">());</span>
</code><button type="button">Copy</button></pre>

<p>All services are then exported as a single object in <a href="">src/lib/index.ts:152-162</a>:</p>
<pre><code class="typescript"><span class="hl-5">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-8">backtest</span><span class="hl-2"> = {</span><br/><span class="hl-2">  ...</span><span class="hl-6">baseServices</span><span class="hl-2">,</span><br/><span class="hl-2">  ...</span><span class="hl-6">contextServices</span><span class="hl-2">,</span><br/><span class="hl-2">  ...</span><span class="hl-6">connectionServices</span><span class="hl-2">,</span><br/><span class="hl-2">  ...</span><span class="hl-6">schemaServices</span><span class="hl-2">,</span><br/><span class="hl-2">  ...</span><span class="hl-6">globalServices</span><span class="hl-2">,</span><br/><span class="hl-2">  ...</span><span class="hl-6">logicPrivateServices</span><span class="hl-2">,</span><br/><span class="hl-2">  ...</span><span class="hl-6">logicPublicServices</span><span class="hl-2">,</span><br/><span class="hl-2">  ...</span><span class="hl-6">markdownServices</span><span class="hl-2">,</span><br/><span class="hl-2">  ...</span><span class="hl-6">validationServices</span><span class="hl-2">,</span><br/><span class="hl-2">};</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#layer-responsibilities"><span>Layer <wbr/>Responsibilities</span></a><ul><li><a href="#architecture-overview"><span>Architecture <wbr/>Overview</span></a></li><li><a href="#layer-1-api-layer"><span>Layer 1: API <wbr/>Layer</span></a></li><li><ul><li><a href="#execution-classes"><span>Execution <wbr/>Classes</span></a></li><li><a href="#registration-functions"><span>Registration <wbr/>Functions</span></a></li></ul></li><li><a href="#layer-2-command-services"><span>Layer 2: <wbr/>Command <wbr/>Services</span></a></li><li><ul><li><a href="#command-service-responsibilities"><span>Command <wbr/>Service <wbr/>Responsibilities</span></a></li><li><a href="#command-service-pattern"><span>Command <wbr/>Service <wbr/>Pattern</span></a></li></ul></li><li><a href="#layer-3-logic-services"><span>Layer 3: <wbr/>Logic <wbr/>Services</span></a></li><li><ul><li><a href="#public-logic-services"><span>Public <wbr/>Logic <wbr/>Services</span></a></li><li><a href="#private-logic-services"><span>Private <wbr/>Logic <wbr/>Services</span></a></li></ul></li><li><a href="#layer-4-global-services"><span>Layer 4: <wbr/>Global <wbr/>Services</span></a></li><li><ul><li><a href="#global-service-pattern"><span>Global <wbr/>Service <wbr/>Pattern</span></a></li></ul></li><li><a href="#layer-5-connection-services"><span>Layer 5: <wbr/>Connection <wbr/>Services</span></a></li><li><a href="#layer-1-public-api"><span>Layer 1: <wbr/>Public API</span></a></li><li><ul><li><a href="#registration-functions-1"><span>Registration <wbr/>Functions</span></a></li><li><a href="#query-functions"><span>Query <wbr/>Functions</span></a></li><li><a href="#execution-classes-1"><span>Execution <wbr/>Classes</span></a></li></ul></li><li><a href="#layer-2-logic-services"><span>Layer 2: <wbr/>Logic <wbr/>Services</span></a></li><li><ul><li><a href="#public-logic-services-1"><span>Public <wbr/>Logic <wbr/>Services</span></a></li><li><a href="#private-logic-services-1"><span>Private <wbr/>Logic <wbr/>Services</span></a></li></ul></li><li><a href="#layer-3-connection-services"><span>Layer 3: <wbr/>Connection <wbr/>Services</span></a></li><li><ul><li><a href="#service-registry"><span>Service <wbr/>Registry</span></a></li><li><a href="#memoization-pattern"><span>Memoization <wbr/>Pattern</span></a></li><li><a href="#connection-service-operations"><span>Connection <wbr/>Service <wbr/>Operations</span></a></li></ul></li><li><a href="#layer-6-client-classes"><span>Layer 6: <wbr/>Client <wbr/>Classes</span></a></li><li><ul><li><a href="#client-responsibilities"><span>Client <wbr/>Responsibilities</span></a></li></ul></li><li><a href="#layer-7-schema-services"><span>Layer 7: <wbr/>Schema <wbr/>Services</span></a></li><li><a href="#layer-4-client-classes"><span>Layer 4: <wbr/>Client <wbr/>Classes</span></a></li><li><ul><li><a href="#client-responsibilities-1"><span>Client <wbr/>Responsibilities</span></a></li><li><a href="#pure-business-logic"><span>Pure <wbr/>Business <wbr/>Logic</span></a></li></ul></li><li><a href="#layer-5-schema--validation-services"><span>Layer 5: <wbr/>Schema &amp; <wbr/>Validation <wbr/>Services</span></a></li><li><ul><li><a href="#schema-services"><span>Schema <wbr/>Services</span></a></li><li><a href="#validation-services"><span>Validation <wbr/>Services</span></a></li></ul></li><li><a href="#layer-6-markdown-services"><span>Layer 6: <wbr/>Markdown <wbr/>Services</span></a></li><li><ul><li><a href="#service-registry-1"><span>Service <wbr/>Registry</span></a></li><li><a href="#event-subscription-pattern"><span>Event <wbr/>Subscription <wbr/>Pattern</span></a></li><li><a href="#report-storage"><span>Report <wbr/>Storage</span></a></li></ul></li><li><a href="#cross-cutting-services"><span>Cross-<wbr/>Cutting <wbr/>Services</span></a></li><li><ul><li><a href="#loggerservice"><span>Logger<wbr/>Service</span></a></li><li><a href="#executioncontextservice"><span>Execution<wbr/>Context<wbr/>Service</span></a></li><li><a href="#methodcontextservice"><span>Method<wbr/>Context<wbr/>Service</span></a></li></ul></li><li><a href="#layer-interaction-patterns"><span>Layer <wbr/>Interaction <wbr/>Patterns</span></a></li><li><ul><li><a href="#registration-flow"><span>Registration <wbr/>Flow</span></a></li><li><a href="#execution-flow"><span>Execution <wbr/>Flow</span></a></li><li><a href="#data-flow-direction"><span>Data <wbr/>Flow <wbr/>Direction</span></a></li></ul></li><li><a href="#service-binding"><span>Service <wbr/>Binding</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">backtest-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105455585', 'ym');

    ym(105455585, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105455585" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3MQZEBBDDR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3MQZEBBDDR');
</script>
